<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="《pytest测试指南》-- 章节1-3 pytest参数详解PART1, 软硬件测试">
    <meta name="description" content="《pytest测试指南》一书 章节1-3 pytest参数详解PART1。">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <!-- Global site tag (gtag.js) - Google Analytics -->

<script async src="https://www.googletagmanager.com/gtag/js?id="></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag() {
        dataLayer.push(arguments);
    }

    gtag('js', new Date());
    gtag('config', '');
</script>


    <title>《pytest测试指南》-- 章节1-3 pytest参数详解PART1 | Transcendent</title>
    <link rel="icon" type="image/png" href="/favicon.png">
    


    <!-- bg-cover style     -->



<link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.min.css">
<link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
<link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
<link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
<link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
<link rel="stylesheet" type="text/css" href="/css/matery.css">
<link rel="stylesheet" type="text/css" href="/css/my.css">
<link rel="stylesheet" type="text/css" href="/css/dark.css" media="none" onload="if(media!='all')media='all'">




    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
    <link rel="stylesheet" href="/css/post.css">




    
        <link rel="stylesheet" type="text/css" href="/css/reward.css">
    



    <script src="/libs/jquery/jquery-3.6.0.min.js"></script>

<style type="text/css" lang="css">
    #loading-container{
        position: fixed;
        top: 0;
        left: 0;
        min-height: 100vh;
        width: 100vw;
        z-index: 9999;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        background: #FFF;
        text-align: center;
        /* loader页面消失采用渐隐的方式*/
        -webkit-transition: opacity 1s ease;
        -moz-transition: opacity 1s ease;
        -o-transition: opacity 1s ease;
        transition: opacity 1s ease;
    }
    .loading-image{
        width: 120px;
        height: 50px;
        transform: translate(-50%);
    }

    .loading-image div:nth-child(2) {
        -webkit-animation: pacman-balls 1s linear 0s infinite;
        animation: pacman-balls 1s linear 0s infinite
    }

    .loading-image div:nth-child(3) {
        -webkit-animation: pacman-balls 1s linear .33s infinite;
        animation: pacman-balls 1s linear .33s infinite
    }

    .loading-image div:nth-child(4) {
        -webkit-animation: pacman-balls 1s linear .66s infinite;
        animation: pacman-balls 1s linear .66s infinite
    }

    .loading-image div:nth-child(5) {
        -webkit-animation: pacman-balls 1s linear .99s infinite;
        animation: pacman-balls 1s linear .99s infinite
    }

   .loading-image div:first-of-type {
        width: 0;
        height: 0;
        border: 25px solid #49b1f5;
        border-right-color: transparent;
        border-radius: 25px;
        -webkit-animation: rotate_pacman_half_up .5s 0s infinite;
        animation: rotate_pacman_half_up .5s 0s infinite;
    }
    .loading-image div:nth-child(2) {
        width: 0;
        height: 0;
        border: 25px solid #49b1f5;
        border-right-color: transparent;
        border-radius: 25px;
        -webkit-animation: rotate_pacman_half_down .5s 0s infinite;
        animation: rotate_pacman_half_down .5s 0s infinite;
        margin-top: -50px;
    }
    @-webkit-keyframes rotate_pacman_half_up {0% {transform: rotate(270deg)}50% {transform: rotate(1turn)}to {transform: rotate(270deg)}}

    @keyframes rotate_pacman_half_up {0% {transform: rotate(270deg)}50% {transform: rotate(1turn)}to {transform: rotate(270deg)}}

    @-webkit-keyframes rotate_pacman_half_down {0% {transform: rotate(90deg)}50% {transform: rotate(0deg)}to {transform: rotate(90deg)}}

    @keyframes rotate_pacman_half_down {0% {transform: rotate(90deg)}50% {transform: rotate(0deg)}to {transform: rotate(90deg)}}

    @-webkit-keyframes pacman-balls {75% {opacity: .7}to {transform: translate(-100px, -6.25px)}}

    @keyframes pacman-balls {75% {opacity: .7}to {transform: translate(-100px, -6.25px)}}


    .loading-image div:nth-child(3),
    .loading-image div:nth-child(4),
    .loading-image div:nth-child(5),
    .loading-image div:nth-child(6){
        background-color: #49b1f5;
        width: 15px;
        height: 15px;
        border-radius: 100%;
        margin: 2px;
        width: 10px;
        height: 10px;
        position: absolute;
        transform: translateY(-6.25px);
        top: 25px;
        left: 100px;
    }
    .loading-text{
        margin-bottom: 20vh;
        text-align: center;
        color: #2c3e50;
        font-size: 2rem;
        box-sizing: border-box;
        padding: 0 10px;
        text-shadow: 0 2px 10px rgba(0,0,0,0.2);
    }
    @media only screen and (max-width: 500px) {
         .loading-text{
            font-size: 1.5rem;
         }
    }
    .fadeout {
        opacity: 0;
        filter: alpha(opacity=0);
    }
    /* logo出现动画 */
    @-webkit-keyframes fadeInDown{0%{opacity:0;-webkit-transform:translate3d(0,-100%,0);transform:translate3d(0,-100%,0)}100%{opacity:1;-webkit-transform:none;transform:none}}
    @keyframes fadeInDown{0%{opacity:0;-webkit-transform:translate3d(0,-100%,0);}}
 </style>
 <script>
(function () {
    const loaded = function(){
       setTimeout(function(){
            const loader = document.getElementById("loading-container");
            loader.className="fadeout" ;//使用渐隐的方法淡出loading page
            // document.getElementById("body-wrap").style.display="flex";
            setTimeout(function(){
                loader.style.display="none";
            },1000); 
        },1000);//强制显示loading page 1s  
    };
    loaded();
})()
 </script><meta name="generator" content="Hexo 7.1.1">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<link rel="alternate" href="/atom.xml" title="Transcendent" type="application/atom+xml">
</head>



 <div id="loading-container">
     <p class="loading-text">玩命加载中 . . . </p> 
     <div class="loading-image">
         <div></div>
         <div></div>
         <div></div>
         <div></div> 
         <div></div>
     </div>
 </div><body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/img/loading.gif" data-original="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">Transcendent</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/goodpapers" class="waves-effect waves-light">
      
      <i class="fas fa-coffee" style="zoom: 0.6;"></i>
      
      <span>好文收藏</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/resume" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>简历</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
  <li>
    <a href="javascript:;" class="waves-effect waves-light" onclick="switchNightMode()" title="深色/浅色模式" >
      <i id="sum-moon-icon" class="fas fa-sun" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/img/loading.gif" data-original="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">Transcendent</div>
        <div class="logo-desc">
            
            资深测试工程师一枚，擅长pytest
            
        </div>
    </div>

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/goodpapers" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-coffee"></i>
			
			好文收藏
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/resume" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			简历
		</a>
          
        </li>
        
        
    </ul>
</div>


        </div>

        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/img/pytest/pytest-2.png')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">《pytest测试指南》-- 章节1-3 pytest参数详解PART1</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/pytest/">
                                <span class="chip bg-color">pytest</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/Automation/" class="post-category">
                                Automation
                            </a>
                        
                            <a href="/categories/pytest/" class="post-category">
                                pytest
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2024-03-03
                </div>
                

                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    12.1k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    50 分
                </div>
                

                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
        </div>
        <hr class="clearfix">

        
        <!-- 是否加载使用自带的 prismjs. -->
        <link rel="stylesheet" href="/libs/prism/prism.min.css">
        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <h1 id="gai-shu">概述</h1>
<p><code>pytest</code> 提供了丰富的参数，本文以 <code>pytest 7.4.0</code> 版本为基础，在未安装任何额外插件情况下，分类阐述参数的使用方法与介绍：</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>positional arguments</p>
</li>
<li class="lvl-2">
<p>general（通用）</p>
</li>
<li class="lvl-2">
<p>Reporting （报告）</p>
</li>
<li class="lvl-2">
<p>pytest-warnings （告警）</p>
</li>
<li class="lvl-2">
<p>collection （信息收集）</p>
</li>
<li class="lvl-2">
<p>test session debugging and configuration （测试会话调试和配置）</p>
</li>
<li class="lvl-2">
<p>logging （日志记录）</p>
</li>
<li class="lvl-2">
<p>[pytest] ini-options （pytest配置文件–pytest.ini|tox.ini|setup.cfg|pyproject.toml ）</p>
</li>
</ul>
<p>说明：</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>对于一些常用参数，在本书后续独立章节详细介绍。</p>
</li>
<li class="lvl-2">
<p>本文以 <code>pytest 7.4.0</code> 版本下展示的参数进行说明描述，<code>pytest</code> 版本不同，参数会有些许差异，所以你应当参照你所使用的 <code>pytest</code> 版本的官方文档以获得最准确的信息。</p>
</li>
</ul>
<h1 id="3-1-pytest-can-shu-jie-shao-yu-shi-li">3.1 pytest 参数介绍与示例</h1>
<h2 id="3-1-1-cha-kan-pytest-suo-you-ke-yong-can-shu">3.1.1 查看pytest所有可用参数</h2>
<p>可以使用<code>pytest -h</code> 或者 <code>pytest --help</code> ，查看所有可用参数：</p>
<pre><code class="language-shell">root@Gavin:~# pytest -h
usage: pytest [options] [file_or_dir] [file_or_dir] [...]

positional arguments:
  file_or_dir

general:
  -k EXPRESSION         Only run tests which match the given substring expression. An                             expression is a Python evaluatable expression where all names are                         substring-matched against test names and their parent classes.                           Example: -k 'test_method or test_other' matches all test                                 functions and classes whose name contains 'test_method' or                               'test_other', while -k 'not test_method' matches those that don't                         contain 'test_method' in their names. -k 'not test_method
                        and not test_other' will eliminate the matches. Additionally                             keywords are matched to classes and functions containing extra                           names in their 'extra_keyword_matches' set, as well as functions                         which have names assigned directly to them. The matching is case-                         insensitive.
  -m MARKEXPR           Only run tests matching given mark expression. For example: -m                           'mark1 and not mark2'.
  --markers             show markers (builtin, plugin and per-project ones).
  -x, --exitfirst       Exit instantly on first error or failed test
  --fixtures, --funcargs
                        Show available fixtures, sorted by plugin appearance (fixtures 
                        with leading '_' are only shown with '-v')
  --fixtures-per-test   Show fixtures per test
  --pdb                 Start the interactive Python debugger on errors or 
                        KeyboardInterrupt
  --pdbcls=modulename:classname
                        Specify a custom interactive Python debugger for use with 
                        --pdb.For example: --pdbcls=IPython.terminal.debugger:TerminalPdb
  --trace               Immediately break when running each test
  --capture=method      Per-test capturing method: one of fd|sys|no|tee-sys
  -s                    Shortcut for --capture=no
  --runxfail            Report the results of xfail tests as if they were not marked
  --lf, --last-failed   Rerun only the tests that failed at the last run (or all if 
                        none failed)
  --ff, --failed-first  Run all tests, but run the last failures first. This may re-order
                        tests and thus lead to repeated fixture setup/teardown.
  --nf, --new-first     Run tests from new files first, then the rest of the tests sorted
                        by file mtime
  --cache-show=[CACHESHOW]
                        Show cache contents, don't perform collection or tests. Optional
                        argument: glob (default: '*').
  --cache-clear         Remove all cache contents at start of test run
  --lfnf={all,none}, --last-failed-no-failures={all,none}
                        Which tests to run with no previously (known) failures
  --sw, --stepwise      Exit on test failure and continue from last failing test next
                        time
  --sw-skip, --stepwise-skip
                        Ignore the first failing test but stop on the next failing test.                         Implicitly enables --stepwise.

Reporting:
  --durations=N         Show N slowest setup/test durations (N=0 for all)
  --durations-min=N     Minimal duration in seconds for inclusion in slowest list.
                        Default: 0.005.
  -v, --verbose         Increase verbosity
  --no-header           Disable header
  --no-summary          Disable summary
  -q, --quiet           Decrease verbosity
  --verbosity=VERBOSE   Set verbosity. Default: 0.
  -r chars              Show extra test summary info as specified by chars: (f)ailed,
                        (E)rror, (s)kipped, (x)failed, (X)passed, (p)assed, (P)assed with
                        output, (a)ll except passed (p/P), or (A)ll. (w)arnings are 
                        enabled by default (see
                        --disable-warnings), 'N' can be used to reset the list. (default:
                        'fE').
  --disable-warnings, --disable-pytest-warnings
                        Disable warnings summary
  -l, --showlocals      Show locals in tracebacks (disabled by default)
  --no-showlocals       Hide locals in tracebacks (negate --showlocals passed through
                        addopts)
  --tb=style            Traceback print mode (auto/long/short/line/native/no)
  --show-capture={no,stdout,stderr,log,all}
                        Controls how captured stdout/stderr/log is shown on failed tests.
                        Default: all.
  --full-trace          Don't cut any tracebacks (default is to cut)
  --color=color         Color terminal output (yes/no/auto)
  --code-highlight={yes,no}
                        Whether code should be highlighted (only if --color is also
                        enabled). Default: yes.
  --pastebin=mode       Send failed|all info to bpaste.net pastebin service
  --junit-xml=path      Create junit-xml style report file at given path
  --junit-prefix=str    Prepend prefix to classnames in junit-xml output

pytest-warnings:
  -W PYTHONWARNINGS, --pythonwarnings=PYTHONWARNINGS
                        Set which warnings to report, see -W option of Python itself
  --maxfail=num         Exit after first num failures or errors
  --strict-config       Any warnings encountered while parsing the `pytest` section of
                        the configuration file raise errors
  --strict-markers      Markers not registered in the `markers` section of the 
                        configuration file raise errors
  --strict              (Deprecated) alias to --strict-markers
  -c FILE, --config-file=FILE
                        Load configuration from `FILE` instead of trying to locate one of
                        the implicit configuration files.
  --continue-on-collection-errors
                        Force test execution even if collection errors occur
  --rootdir=ROOTDIR     Define root directory for tests. Can be relative path: 
                        'root_dir', './root_dir', 'root_dir/another_dir/'; 
                        absolute path: '/home/user/root_dir'; path with variables: 
                        '$HOME/root_dir'.

collection:
  --collect-only, --co  Only collect tests, don't execute them
  --pyargs              Try to interpret all arguments as Python packages
  --ignore=path         Ignore path during collection (multi-allowed)
  --ignore-glob=path    Ignore path pattern during collection (multi-allowed)
  --deselect=nodeid_prefix
                        Deselect item (via node id prefix) during collection 
                        (multi-allowed)
  --confcutdir=dir      Only load conftest.py's relative to specified dir
  --noconftest          Don't load any conftest.py files
  --keep-duplicates     Keep duplicate tests
  --collect-in-virtualenv
                        Don't ignore tests in a local virtualenv directory
  --import-mode={prepend,append,importlib}
                        Prepend/append to sys.path when importing test modules and
                        conftest files. Default: prepend.
  --doctest-modules     Run doctests in all .py modules
  --doctest-report={none,cdiff,ndiff,udiff,only_first_failure}
                        Choose another output format for diffs on doctest failure
  --doctest-glob=pat    Doctests file matching pattern, default: test*.txt
  --doctest-ignore-import-errors
                        Ignore doctest ImportErrors
  --doctest-continue-on-failure
                        For a given doctest, continue to run after the first failure

test session debugging and configuration:
  --basetemp=dir        Base temporary directory for this test run. (Warning: this 
                        directory is removed if it exists.)
  -V, --version         Display pytest version and information about plugins. When given
                        twice, also display information about plugins.
  -h, --help            Show help message and configuration info
  -p name               Early-load given plugin module name or entry point 
                        (multi-allowed). To avoid loading of plugins, use the `no:`
                        prefix, e.g. `no:doctest`.
  --trace-config        Trace considerations of conftest.py files
  --debug=[DEBUG_FILE_NAME]
                        Store internal tracing debug information in this log file. 
                        This file is opened with 'w' and truncated as a result, care
                        advised. Default: pytestdebug.log.
  -o OVERRIDE_INI, --override-ini=OVERRIDE_INI
                        Override ini option with "option=value" style, e.g. 
                        `-o xfail_strict=True -o cache_dir=cache`.
  --assert=MODE         Control assertion debugging tools.
                        'plain' performs no assertion debugging.
                        'rewrite' (the default) rewrites assert statements in test 
                        modules on import to provide assert expression information.
  --setup-only          Only setup fixtures, do not execute tests
  --setup-show          Show setup of fixtures while executing tests
  --setup-plan          Show what fixtures and tests would be executed but don't execute 
                        anything

logging:
  --log-level=LEVEL     Level of messages to catch/display. Not set by default, so it
                        depends on the root/parent log handler's effective level, where
                        it is "WARNING" by default.
  --log-format=LOG_FORMAT
                        Log format used by the logging module
  --log-date-format=LOG_DATE_FORMAT
                        Log date format used by the logging module
  --log-cli-level=LOG_CLI_LEVEL
                        CLI logging level
  --log-cli-format=LOG_CLI_FORMAT
                        Log format used by the logging module
  --log-cli-date-format=LOG_CLI_DATE_FORMAT
                        Log date format used by the logging module
  --log-file=LOG_FILE   Path to a file when logging will be written to
  --log-file-level=LOG_FILE_LEVEL
                        Log file logging level
  --log-file-format=LOG_FILE_FORMAT
                        Log format used by the logging module
  --log-file-date-format=LOG_FILE_DATE_FORMAT
                        Log date format used by the logging module
  --log-auto-indent=LOG_AUTO_INDENT
                        Auto-indent multiline messages passed to the logging module.
                        Accepts true|on, false|off or an integer.
  --log-disable=LOGGER_DISABLE
                        Disable a logger by name. Can be passed multiple times.

[pytest] ini-options in the first pytest.ini|tox.ini|setup.cfg|pyproject.toml file found:

  markers (linelist):   Markers for test functions
  empty_parameter_set_mark (string):
                        Default marker for empty parametersets
  norecursedirs (args): Directory patterns to avoid for recursion
  testpaths (args):     Directories to search for tests when no files or directories are
                        given on the command line
  filterwarnings (linelist):
                        Each line specifies a pattern for warnings.filterwarnings. 
                        Processed after -W/--pythonwarnings.
  usefixtures (args):   List of default fixtures to be used with this project
  python_files (args):  Glob-style file patterns for Python test module discovery
  python_classes (args):
                        Prefixes or glob names for Python test class discovery
  python_functions (args):
                        Prefixes or glob names for Python test function and method
                        discovery
  disable_test_id_escaping_and_forfeit_all_rights_to_community_support (bool):
                        Disable string escape non-ASCII characters, might cause unwanted
                        side effects(use at your own risk)
  console_output_style (string):
                        Console output: "classic", or with additional progress 
                        information ("progress" (percentage) | "count" | 
                        "progress-even-when-capture-no" (forces progress even when 
                        capture=no)
  xfail_strict (bool):  Default for the strict parameter of xfail markers when not given
                        explicitly (default: False)
  tmp_path_retention_count (string):
                        How many sessions should we keep the `tmp_path` directories, 
                        according to `tmp_path_retention_policy`.
  tmp_path_retention_policy (string):
                        Controls which directories created by the `tmp_path` fixture are 
                        kept around, based on test outcome. (all/failed/none)
  enable_assertion_pass_hook (bool):
                        Enables the pytest_assertion_pass hook. Make sure to delete any 
                        previously generated pyc cache files.
  junit_suite_name (string):
                        Test suite name for JUnit report
  junit_logging (string):
                        Write captured log messages to JUnit report: one of 
                        no|log|system-out|system-err|out-err|all
  junit_log_passing_tests (bool):
                        Capture log information for passing tests to JUnit report:
  junit_duration_report (string):
                        Duration time to report: one of total|call
  junit_family (string):
                        Emit XML for schema: one of legacy|xunit1|xunit2
  doctest_optionflags (args):
                        Option flags for doctests
  doctest_encoding (string):
                        Encoding used for doctest files
  cache_dir (string):   Cache directory path
  log_level (string):   Default value for --log-level
  log_format (string):  Default value for --log-format
  log_date_format (string):
                        Default value for --log-date-format
  log_cli (bool):       Enable log display during test run (also known as "live logging")
  log_cli_level (string):
                        Default value for --log-cli-level
  log_cli_format (string):
                        Default value for --log-cli-format
  log_cli_date_format (string):
                        Default value for --log-cli-date-format
  log_file (string):    Default value for --log-file
  log_file_level (string):
                        Default value for --log-file-level
  log_file_format (string):
                        Default value for --log-file-format
  log_file_date_format (string):
                        Default value for --log-file-date-format
  log_auto_indent (string):
                        Default value for --log-auto-indent
  pythonpath (paths):   Add paths to sys.path
  faulthandler_timeout (string):
                        Dump the traceback of all threads if a test takes more than 
                        TIMEOUT seconds to finish
  addopts (args):       Extra command line options
  minversion (string):  Minimally required pytest version
  required_plugins (args):
                        Plugins that must be present for pytest to run

Environment variables:
  PYTEST_ADDOPTS           Extra command line options
  PYTEST_PLUGINS           Comma-separated plugins to load during startup
  PYTEST_DISABLE_PLUGIN_AUTOLOAD Set to disable plugin auto-loading
  PYTEST_DEBUG             Set to enable debug tracing of pytest's internals


to see available markers type: pytest --markers
to see available fixtures type: pytest --fixtures
(shown according to specified file_or_dir or current dir if not specified; fixtures with leading '_' are only shown with the '-v' option
root@Gavin:~#
</code></pre>
<p>请不要被上面这么多的使用参数吓到，实际常用十之有二。接下来我们将逐一分析每个参数的详细使用方法。</p>
<h2 id="3-1-2-fen-lei-hui-zong">3.1.2 分类汇总</h2>
<p>在Shell执行<code>pytest -h</code>可以看到<code>pytest</code>的命令行参数有这9大类（默认状态、未安装其他插件情况下），共130个，汇总如下表所示：</p>
<table>
<thead>
<tr>
<th style="text-align:left">序号</th>
<th style="text-align:left">类别</th>
<th style="text-align:left">中文名</th>
<th style="text-align:left">包含命令行参数数量</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">1</td>
<td style="text-align:left">positional arguments</td>
<td style="text-align:left">形参</td>
<td style="text-align:left">1</td>
</tr>
<tr>
<td style="text-align:left">2</td>
<td style="text-align:left">general</td>
<td style="text-align:left">通用</td>
<td style="text-align:left">20</td>
</tr>
<tr>
<td style="text-align:left">3</td>
<td style="text-align:left">reporting</td>
<td style="text-align:left">报告</td>
<td style="text-align:left">19</td>
</tr>
<tr>
<td style="text-align:left">4</td>
<td style="text-align:left">pytest-warnings</td>
<td style="text-align:left">pytest警告</td>
<td style="text-align:left">8</td>
</tr>
<tr>
<td style="text-align:left">5</td>
<td style="text-align:left">collection</td>
<td style="text-align:left">收集</td>
<td style="text-align:left">15</td>
</tr>
<tr>
<td style="text-align:left">6</td>
<td style="text-align:left">test session debugging and configuration</td>
<td style="text-align:left">测试session调试和配置</td>
<td style="text-align:left">11</td>
</tr>
<tr>
<td style="text-align:left">7</td>
<td style="text-align:left">logging</td>
<td style="text-align:left">日志</td>
<td style="text-align:left">12</td>
</tr>
<tr>
<td style="text-align:left">8</td>
<td style="text-align:left">ini-options</td>
<td style="text-align:left">pytest.ini/tox.ini/setup.cfg配置文件</td>
<td style="text-align:left">40</td>
</tr>
<tr>
<td style="text-align:left">9</td>
<td style="text-align:left">environment variables</td>
<td style="text-align:left">环境变量</td>
<td style="text-align:left">4</td>
</tr>
</tbody>
</table>
<h1 id="3-2-pytest-help-xin-xi-jie-shao">3.2 pytest help信息介绍</h1>
<h2 id="3-2-1-positional-arguments">3.2.1 positional arguments</h2>
<h3 id="3-2-1-1-can-shu-strong-file-or-dir-strong">3.2.1.1 参数 [<strong>file_or_dir</strong>]</h3>
<p>用途： 指定一个或多个文件/目录</p>
<p>使用方法：</p>
<pre><code class="language-shell">pytest [file_or_dir] [file_or_dir] [...]
</code></pre>
<h2 id="3-2-2-general-xiang-guan-can-shu">3.2.2 general 相关参数</h2>
<h3 id="3-2-2-1-can-shu-code-k-code">3.2.2.1 参数 <code>-k</code></h3>
<p><code>-k</code> 允许你运行名称符合某种表达式的测试用例。当使用 <code>-k</code> 参数时，你可以指定一个字符串表达式，<code>pytest</code> 将遍历项目中的每个测试用例名称，只有那些匹配表达式的测试用例才会被执行。</p>
<p><strong>使用方法：</strong></p>
<ul class="lvl-0">
<li class="lvl-2">
<p><strong>特定名称</strong></p>
</li>
</ul>
<p>如果你只想运行测试名称中包含 “login” 的测试用例，可以执行：</p>
<pre><code class="language-shell">pytest -k "login"
</code></pre>
<ul class="lvl-0">
<li class="lvl-2">
<p><strong>使用逻辑运算符</strong></p>
</li>
</ul>
<p><code>-k</code> 参数支持逻辑运算符 <code>AND</code>、<code>OR</code> 和 <code>NOT</code>（在 <code>-k</code> 参数中分别使用 <code>and</code>、<code>or</code>、<code>not</code> 关键词表示），比如：</p>
<p>若要运行包含 “login” 或 “logout” 的测试用例，可以执行：</p>
<pre><code class="language-shell">pytest -k "login or logout"
</code></pre>
<p>如果想要执行既包含 “login” 又包含 “account” 的测试用例，可以执行：</p>
<pre><code class="language-shell">pytest -k "login and account"
</code></pre>
<p>若要排除所有包含 “skip” 的测试用例，可以执行：</p>
<pre><code class="language-shell">pytest -k "not skip"
</code></pre>
<ul class="lvl-0">
<li class="lvl-2">
<p><strong>结合其他参数</strong></p>
</li>
</ul>
<p><code>-k</code> 参数可以与其他 <code>pytest</code> 命令行选项结合使用，例如 <code>--ignore</code> 或 <code>-v</code>（用于增加详细程度）。</p>
<p><strong>请注意：</strong></p>
<ul class="lvl-0">
<li class="lvl-2">
<p>表达式中的关键词大小写不敏感，且支持中文。</p>
</li>
<li class="lvl-2">
<p>确保 <code>-k</code> 参数后面的表达式用双引号或单引号括起来以避免由于 shell 的特殊字符处理而导致的问题。</p>
</li>
<li class="lvl-2">
<p>使用逻辑运算符时（<code>and</code>、<code>or</code>、<code>not</code>），需要按照 Python 逻辑语法规则进行组合。</p>
</li>
</ul>
<p><code>-k</code> 是一个非常有用的参数，可以快速选择子集的测试进行运行，非常适合在开发过程中对特定功能的测试或者当有大量的测试用例，但只有少数需要频繁运行时使用。</p>
<h3 id="3-2-2-2-can-shu-code-m-code">3.2.2.2 参数 <code>-m</code></h3>
<p><code>pytest</code> 提供的 <code>-m</code> 参数允许用户基于标记（mark）来选择运行特定的测试用例。通过使用标记，可以非常灵活地组织测试用例，并据此选择运行特定的一组测试。</p>
<p>使用标记的一个常见场景是对测试用例按照功能、模块或者是测试类型（如冒烟测试、回归测试、测试用例分级别等）进行分组。</p>
<p><strong>使用方法：</strong></p>
<p>以下是如何使用 <code>-m</code> 参数的几个示例：</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><strong>基本使用</strong></p>
</li>
</ul>
<p>如果你有一个标记为 <code>migration</code> 的测试用例，你可以使用 <code>-m</code> 参数来只运行所有带有 <code>migration</code> 标记的测试用例。</p>
<pre><code class="language-shell">pytest -m migration
</code></pre>
<p>这条命令会执行所有使用了 <code>@pytest.mark.migration</code> 装饰器的测试用例。</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><strong>逻辑运算</strong></p>
</li>
</ul>
<p>与 <code>-k</code> 参数类似，<code>-m</code> 参数也支持简单的逻辑运算符，如 <code>and</code>、<code>or</code> 和 <code>not</code>。</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>运行标记为 <code>migration</code> 或者 <code>loopdevice</code> 的测试：</p>
</li>
</ul>
<pre><code class="language-shell">pytest -m "migration or loopdevice"
</code></pre>
<ul class="lvl-0">
<li class="lvl-2">
<p>运行同时标记为 <code>migration</code> 和 <code>NAS</code> 的测试：</p>
</li>
</ul>
<pre><code class="language-shell">pytest -m "migration and NAS"
</code></pre>
<ul class="lvl-0">
<li class="lvl-2">
<p>运行未标记为 <code>migration</code> 的所有测试：</p>
</li>
</ul>
<pre><code class="language-shell">pytest -m "not migration"
</code></pre>
<ul class="lvl-0">
<li class="lvl-2">
<p><strong>结合其他参数</strong></p>
</li>
</ul>
<p><code>-k</code> 和 <code>-m</code>：<code>-m</code> 参数可以与 <code>-k</code> 参数或其它 <code>pytest</code> 参数结合使用，以实现更复杂的测试用例选择。</p>
<pre><code class="language-shell">pytest -m "not migration" -k "iSCSI"
</code></pre>
<p>上面的命令将执行所有未被标记为"migration"且名称中包含 “iSCSI” 的测试用例。</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><strong>自定义标记</strong></p>
</li>
</ul>
<p>可以在 <code>pytest.ini</code>、<code>pyproject.toml</code>、<code>tox.ini</code> 或者 <code>setup.cfg</code> 文件中定义自己的标记策略，以避免使用未定义的标记引起的警告。例如，在 <code>pytest.ini</code> 中定义 <code>migraion</code> 和 <code>NAS</code>：</p>
<pre><code class="language-ini">[pytest]
markers =
    migration: mark cases for migration features (deselect with '-m "not migration"')
    NAS: mark cases for all NAS features (deselect with '-m "not NAS"')
</code></pre>
<p>这段配置告诉 <code>pytest</code> 这些标记是已预定义的，并防止在使用未声明的标记时发出警告。</p>
<p><strong>请注意：</strong></p>
<p><code>-m</code> 是一个功能强大的参数，配合标记功能，可以帮助我们灵活地组织和执行测试用例，非常适合管理复杂或大型测试集。</p>
<p>在持续集成/持续部署（CI/CD）环境中，<code>-m</code> 参数经常用于指定运行某类测试，例如只运行与当前开发工作相关的测试。</p>
<h3 id="3-2-2-3-can-shu-code-markers-code">3.2.2.3 参数 <code>--markers</code></h3>
<p><code>pytest</code> 提供的<code>--markers</code> 是一个命令行选项，它提供了显示项目中可用标记（markers）列表的便捷方式。在 <code>pytest</code> 中，标记用于分类和选择测试，通常用于为测试用例添加额外的元数据，诸如区分慢速运行的测试、需要特殊硬件的测试或者指定测试与某个特定功能相关等，这些标记可以后续用来选择性地运行特定的测试用例集合。</p>
<p>当你运行 <code>pytest --markers</code> 命令时，将会列出所有已注册的标记及其相应的说明（如果有的话），包含内置标记和自定义标记。这些信息通常来源于以下几个地方：</p>
<p><strong>内置标记：</strong></p>
<p><code>pytest</code> 具有一些预设（内置）的标记，参考如下：</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><code>mark.name</code>: 这里的 <code>name</code> 是标记的名称，你可以将这个标记应用到一个测试函数上，然后通过 <code>-m 'name'</code> 选项来运行所有带有这个标记的测试。</p>
</li>
<li class="lvl-2">
<p><code>skip</code>: 这个内置的标记用于不运行那些标记了 <code>@pytest.mark.skip</code> 的测试函数。</p>
</li>
<li class="lvl-2">
<p><code>skipif</code>: 这个标记用作条件跳过，即在满足指定条件时，跳过使用了 <code>@pytest.mark.skipif</code> 的测试函数。</p>
</li>
<li class="lvl-2">
<p><code>xfail</code>: 表示“预期失败”的测试，即这些测试可能由于某种已知的原因无法通过，使用 <code>@pytest.mark.xfail</code> 标记。</p>
</li>
<li class="lvl-2">
<p><code>parametrize</code>: 这个标记允许用户为测试函数提供多组参数，使得同一测试函数可以用不同的数据多次运行。</p>
</li>
<li class="lvl-2">
<p><code>usefixtures</code>: 通过这个标记可以声明测试用例需要使用的 fixture，即在测试运行前后执行的准备和清理/销毁函数。</p>
</li>
<li class="lvl-2">
<p><code>filterwarnings</code>: 这个标记用于过滤掉在测试运行期间触发的特定警告。</p>
</li>
</ul>
<p><strong>自定义标记：</strong></p>
<p>用户可以在测试文件中通过使用装饰器 <code>@pytest.mark.&lt;marker_name&gt;</code> 自定义标记，并且经常在配置文件中对这些标记进行描述。</p>
<p><strong>配置文件中声明的标记：</strong></p>
<p>为了避免在使用未声明的标记时遭受警告，用户在 <code>pytest.ini</code>、<code>pyproject.toml</code>、<code>tox.ini</code> 或 <code>setup.cfg</code> 等配置文件中声明标记及其说明。</p>
<p>例如，在 <code>pytest.ini</code> 文件中定义了两个标记 <code>slow</code> 和 <code>fast</code>，如下所示：</p>
<pre><code class="language-ini">[pytest]
markers =
    slow: mark tests as slow (deselect with '-m "not slow"').
    fast: mark tests that run quickly (deselect with '-m "not fast"').
</code></pre>
<p>那么运行 <code>pytest --markers</code> 将列出所有可用的内置标记以及你定义的 <code>slow</code> 和 <code>fast</code> 标记。</p>
<p>输出结果会类似这样：</p>
<pre><code class="language-shell">@pytest.mark.slow: mark tests as slow (deselect with '-m "not slow"').
@pytest.mark.fast: mark tests that run quickly (deselect with '-m "not fast"').
@pytest.mark.skip(reason=None): skip the given test function with an optional reason. Explanations may be presented with '-rs' or '-rA'.
...
</code></pre>
<p>此列表对于维护测试集合、确保标记使用的一致性以及为新成员快速提供项目内标记概览非常有用。它可作为一个参考手册，帮助团队成员理解每个标记的使用意图和上下文。</p>
<p><strong>请注意：</strong></p>
<p>使用标记的好处是：增加了测试的灵活性和表达力。</p>
<p>用户可以标记慢速的测试、特定组件的测试、需要特定资源的测试、根据功能特性分类的自定义标记等，然后根据需要选择性地运行或跳过它们，这对于管理大型测试套件特别有用。</p>
<h3 id="3-2-2-4-can-shu-code-x-code-huo-zhe-code-exitfirst-code">3.2.2.4 参数 <code>-x</code> 或者 <code>--exitfirst</code></h3>
<p><code>pytest</code> 的 <code>-x</code> 或 <code>--exitfirst</code> 参数是用来选择在第一个错误或失败（failure）出现时立即退出测试运行的。这个选项对于那些需要迅速识别出导致测试失败的问题的情况十分有用，它可以帮助开发人员节省时间，因为他们不必等整个测试套件运行完毕就能开始排查问题。</p>
<p><code>pytest</code> 默认行为是运行所有的测试用例，不论它们成功还是失败，并在最后提供一个汇总报告。如果测试套件非常庞大，第一个错误可能在较早的阶段就发生了，但默认情况下你还是得等到所有测试用例运行完成后才会知道。使用 <code>-x</code> 选项，你可以在测试出现第一个失败时立刻得到反馈，这允许你更快地开始解决问题。</p>
<p>比如说，如果你有一个包含1000个测试用例的测试套件，并且第5个测试用例失败了，<code>pytest -x</code> 会在第5个测试用例失败后立即停止运行，而不是继续执行剩下的995个测试，这样你就可以专注于修复这个第5个测试用例的问题。</p>
<p><strong>使用方法：</strong></p>
<p>在命令行中可以这样使用 <code>-x</code> 选项：</p>
<pre><code class="language-shell">pytest -x
</code></pre>
<p>或使用长形式：</p>
<pre><code class="language-shell">pytest --exitfirst
</code></pre>
<p><strong>请注意：</strong></p>
<p>在某些情况下，比如在持续集成（CI）环境中运行测试时，你可能不想要这种行为，因为你会希望从单次构建中获得尽可能多的反馈信息。所以 <code>-x</code> 参数最适合在开发过程中使用，当你试图找到并修复测试失败的问题时。</p>
<h3 id="3-2-2-5-can-shu-code-fixtures-code">3.2.2.5 参数 <code>--fixtures</code></h3>
<p><code>pytest</code> 的 <code>--fixtures</code> 选项用于显示测试中可用的所有fixture的详细信息。在 <code>pytest</code> 中，fixtures 是一种功能，它们提供了一种固定的基础设施，可以被不同的测试用例所使用。这些fixture可能负责设置数据库、准备测试数据、启动某些服务、创建临时文件、清理某些设置等等。<code>--fixtures</code> 选项会列出所有的fixture及其文档字符串，这有助于开发者了解每个fixture的用途和功能。</p>
<p>而 <code>--funcargs</code> 选项在新版本的 <code>pytest</code> 中已经弃用了，因此它不会被 认可和使用（recognized and used）。过去，<code>--funcargs</code> 是用来展示可用的fixtures，与 <code>--fixtures</code> 类似。如果你尝试使用一个旧版本的 <code>pytest</code> 版本，<code>--funcargs</code> 选项可能仍然存在，但是在当前的 <code>pytest</code> 版本中，应该使用 <code>--fixtures</code> 来获得相同的结果。</p>
<p><strong>使用方法：</strong></p>
<p><code>--fixtures</code> 选项的示例如下：</p>
<pre><code class="language-shell">pytest --fixtures
</code></pre>
<p>这个命令会打印出所有已定义的fixtures，包括它们的名称、所在的测试文件以及配套的文档说明。这对于了解项目中已有的测试资源和如何使用它们来说非常有帮助。</p>
<p>假设你在测试代码中有如下的fixture定义：</p>
<pre><code class="language-python"># content of conftest.py
import pytest

@pytest.fixture
def smtp_connection():
    """Returns a smtp connection instance"""
    import smtplib
    return smtplib.SMTP("smtp.163.com", 587, timeout=5)

@pytest.fixture
def make_customer_record():
    """Create a test customer record"""
    def _make_customer_record(name):
        return {"name": name, "orders": []}
    return _make_customer_record
</code></pre>
<p>运行 <code>pytest --fixtures</code> 命令后，输出结果会包含类似以下内容的记录：</p>
<pre><code class="language-python">----------------------- fixtures defined from conftest -------------------------
make_customer_record -- conftest.py:11
    Create a test customer record

smtp_connection -- conftest.py:6
    Returns a smtp connection instance

</code></pre>
<p>每一个fixture都会携带其注册在 <code>pytest</code> 中的名称和提供的文档字符串。</p>
<p><strong>请注意：</strong></p>
<ul class="lvl-0">
<li class="lvl-2">
<p>下划线(_)开头的fixtures，需要使用参数 ‘-v’ 来显示。</p>
</li>
<li class="lvl-2">
<p>从<code>pytest</code> 的 <code>2.3</code> 版本起，<code>--funcargs</code> 参数已被废弃，其功能已由 <code>--fixtures</code> 接替。</p>
</li>
<li class="lvl-2">
<p>使用 <code>--fixtures</code> 可以帮助你查看所有可用的fixtures及其说明，包括内置的、conftest.py中使用的和其他自定义的fixtures。</p>
</li>
</ul>
<h3 id="3-2-2-6-can-shu-code-fixtures-per-test-code">3.2.2.6 参数 <code>--fixtures-per-test</code></h3>
<p>查看每个测试用例实际使用了哪些 fixtures，或是想要查找特定测试用例相关的所有fixtures，你可以简单地在命令行中指定具体的测试用例，配合 <code>--fixtures-per-test</code>  选项，来查看测试用例使用了哪些fixtures。除此之外，借助<code>--setup-show</code> 选项，来查看每个测试用例的 setup 阶段中使用了哪些 fixtures。关于<code>--setup-show</code> 选项，请参考本章节中的“test session debugging and configuration 相关参数”处。</p>
<p><strong>使用方法：</strong></p>
<pre><code class="language-shell">pytest --fixtures-per-test test_show_fixtures.py
</code></pre>
<p><strong>示例：</strong></p>
<pre><code class="language-python">root@Gavin:~/code/chapter1-3# cat test_show_fixtures.py 
#!/usr/bin/env python
# -*- coding:UTF-8 -*-

"""
This is an example pytest fixture
"""

import pytest


@pytest.fixture()
def run_function():
    """  This is a function doc info  """
    print("Run before function...")
    yield
    print("Run after function...")


def test_case_1(run_function):
    """  Test case 1  """
    print("case 1")


def test_case_2():
    """  Test case 2  """
    print("case 2")


def test_case_3(run_function):
    """  Test case 3  """
    print("case 3")
root@Gavin:~/code/chapter1-3#
</code></pre>
<p>测试结果：</p>
<pre><code class="language-python">root@Gavin:~/code/chapter1-3# pytest --fixtures-per-test test_show_fixtures.py 
============================= test session starts =============================
platform linux -- Python 3.11.6, pytest-7.4.0, pluggy-1.2.0
rootdir: /root/code/chapter1-3
collected 3 items                                                                         

---------------------------- fixtures used by test_case_1 ----------------------
---------------------------- (test_show_fixtures.py:20) ------------------------
run_function -- test_show_fixtures.py:12
    This is a function doc info  

---------------------------- fixtures used by test_case_3 ----------------------
---------------------------- (test_show_fixtures.py:30) ------------------------
run_function -- test_show_fixtures.py:12
    This is a function doc info  

============================= no tests ran in 0.00s ============================
root@Gavin:~/code/chapter1-3# 
</code></pre>
<h3 id="3-2-2-7-can-shu-code-pdb-code">3.2.2.7 参数 <code>--pdb</code></h3>
<p><code>pytest</code> 的 <code>--pdb</code> 选项是一个非常实用的调试助手。当使用这个选项运行测试时，如果发生了一个异常（例如测试失败了），<code>pytest</code> 将自动进入Python的调试器 <code>pdb</code>（Python Debugger）。它允许你在代码中的任何位置进行断点调试，并允许你检查堆栈、变量和执行任意的Python代码。</p>
<p><strong>使用方法：</strong></p>
<pre><code class="language-shell">pytest --pdb test_file.py
</code></pre>
<p>当你运行以上命令时，如果 <code>test_file.py</code> 中的测试发生错误，<code>pytest</code> 就会在第一个发生错误的地方立即进入 <code>pdb</code> 调试模式。在进入 <code>pdb</code> 后，你可以：</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>使用 <code>list</code> 或 <code>l</code> 命令查看当前的代码。</p>
</li>
<li class="lvl-2">
<p>使用 <code>next</code> 或 <code>n</code> 步过 (step over) 下一行代码。</p>
</li>
<li class="lvl-2">
<p>使用 <code>step</code> 或 <code>s</code> 步入 (step into) 函数或方法。</p>
</li>
<li class="lvl-2">
<p>使用 <code>continue</code> 或 <code>c</code> 继续执行程序直到碰到下一个断点。</p>
</li>
<li class="lvl-2">
<p>使用 <code>quit</code> 或 <code>q</code> 退出调试器。</p>
</li>
<li class="lvl-2">
<p>使用 <code>p</code> 打印一个表达式的值。</p>
</li>
</ul>
<p>这是一个强大的功能，因为它允许你在测试失败时直接从错误点开始调试，而不需要去手动设置断点。这经常被用于复杂的失败，或是那些仅在特定测试环境下发生的问题。</p>
<p>也可以在命令行中组合 <code>--pdb</code> 与其它 <code>pytest</code> 选项一起使用，例如 <code>--maxfail</code> 可以在一定数量的失败之后停止测试:</p>
<pre><code class="language-shell">pytest --pdb --maxfail=2 test_file.py
</code></pre>
<p>此命令告诉 <code>pytest</code> 在两个测试失败后停止执行，并且如果有测试失败，则在第一个失败的测试处打开 <code>pdb</code>。</p>
<p><strong>请注意：</strong></p>
<p>使用 <code>pytest --pdb</code> 可以帮助快速定位测试中的问题，特别是在复杂的测试或难以复现的问题时，它是一个极其有用的工具。不过，要记住，如果在自动化测试系统中运行测试，避免使用 <code>--pdb</code>, 因为它需要交互式输入，可能导致自动化流程暂停。</p>
<p>请记住，在 <code>pdb</code> 调试会话中，你需要了解一些基本的 <code>pdb</code> 命令来有效地进行调试。这个功能是Python标准库的一部分，因此无需额外安装即可与 <code>pytest</code> 一起使用。</p>
<h3 id="3-2-2-8-can-shu-code-pdbcls-code">3.2.2.8 参数 <code>--pdbcls</code></h3>
<p><code>pytest</code> 的 <code>--pdbcls</code> 选项允许用户指定一个自定义的调试器类来代替标准的 <code>pdb</code> 调试器。它非常有用，尤其是当你需要使用不同的特性或者接口来进行调试时。</p>
<p><strong>使用方法：</strong></p>
<p>选项的格式是 <code>--pdbcls=modulename:classname</code>，其中：</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><code>modulename</code> 对应于包含你希望使用的调试器的 Python 模块的名字。</p>
</li>
<li class="lvl-2">
<p><code>classname</code> 是模块中的调试器类的名称。</p>
</li>
</ul>
<p><strong>示例：</strong></p>
<p>如果你想使用 <code>ipdb</code> 作为你的调试器，首先确保你已安装了 <code>ipdb</code> 模块：</p>
<pre><code class="language-shell">pip install ipdb
</code></pre>
<p>然后，运行 <code>pytest</code> 时提供这个参数来使用 <code>ipdb</code> 的功能：</p>
<pre><code class="language-shell">pytest --pdbcls=IPython.terminal.debugger:TerminalPdb
</code></pre>
<p>在这个例子中：</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><code>IPython.terminal.debugger</code> 是含有调试器类的模块名。</p>
</li>
<li class="lvl-2">
<p><code>TerminalPdb</code> 是在 <code>IPython</code> 模块中对应的调试器类名。</p>
</li>
</ul>
<p>使用这个选项时，测试运行时触发的任何异常都会进入由 <code>--pdbcls</code> 指定的调试器而不是标准的 <code>pdb</code>。这就允许你利用你选择的调试器的所有功能，比如 <code>ipdb</code> 提供的更丰富的交互性和更高级的调试工具。</p>
<p>不过，需要注意的是，并不是所有的 Python 调试器都与 <code>pytest</code> 兼容，因此在使用前应确保想用的调试器支持该集成。此外，由于 <code>pytest</code> 本身可能时不时更新，最好查看官方文档来获取最新的兼容性信息和使用指南。</p>
<h3 id="3-2-2-9-can-shu-code-trace-code">3.2.2.9 参数 <code>--trace</code></h3>
<p><code>pytest</code> 的 <code>--trace</code> 选项是一个用于启动调试的实用功能，它在测试执行期间提供了一种直接进入调试模式的方式。</p>
<p>使用 <code>--trace</code> 选项，当 <code>pytest</code> 开始执行一条测试项时，它会自动启动一个调试器。这允许你单步执行代码，检查当前的变量状态，评估表达式等等，就像在典型的调试会话中一样。这个选项在需要理解测试执行流或者排查一个特别复杂的测试失败原因时特别有用。</p>
<p>如下为如何使用 <code>--trace</code> 选项的基本示例：</p>
<pre><code class="language-shell">pytest --trace tests/test_my_feature.py
</code></pre>
<p>在这个例子中，<code>pytest</code> 会执行 <code>tests/test_my_feature.py</code> 文件中所有的测试项，但对于每个测试项，它会在测试函数的开头打开调试器。</p>
<p>比较一下 <code>--pdb</code> 选项，也用于打开调试器，但仅在测试失败时。相反，无论测试是否失败，<code>--trace</code> 都会为每一个测试启动调试器。</p>
<p>这是一个非常给力的工具，但由于它会在每个测试项处停止，如果你有很多测试项，使用它可能不是很高效。通常，仅需针对单个测试或者很小的一组测试使用 <code>--trace</code> 选项，以便可以集中精力进行调试。</p>
<p>此外，<code>--trace</code> 选项会直接进入 <code>pdb</code> 调试器界面，因此对于不熟悉 <code>pdb</code> 命令的用户来说，可能需要一点时间去熟悉。</p>
<p>总体来说，<code>--trace</code> 选项在调试过程中提供了一种更立即的方法来控制测试的执行和分析。它对于快速定位问题和交互式地探究测试行为非常有帮助。</p>
<p>示例如下：</p>
<pre><code class="language-python">root@Gavin:~/code/chapter1-3# pytest --trace test_show_fixtures.py 
============================= test session starts =========================
platform linux -- Python 3.11.6, pytest-7.4.0, pluggy-1.2.0
rootdir: /root/code/chapter1-3
collected 3 items

test_show_fixtures.py 
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; PDB runcall (IO-capturing turned off) &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt; /root/code/chapter1-3/test_show_fixtures.py(21)test_case_1()
-&gt; print("case 1")
(Pdb) l
 16  	    print("Run after function...")
 17  	
 18  	
 19  	def test_case_1(run_function):
 20  	    """  Test case 1  """
 21  -&gt;	    print("case 1")
 22  	
 23  	
 24  	def test_case_2():
 25  	    """  Test case 2  """
 26  	    print("case 2")
(Pdb) 
</code></pre>
<h3 id="3-2-2-10-can-shu-code-capture-code">3.2.2.10 参数 <code>--capture</code></h3>
<p>在 <code>pytest</code> 中，<code>-s</code> 或 <code>--capture=no</code> 选项用于禁用所有的标准输出 (<code>stdout</code>) 和标准错误 (<code>stderr</code>) 捕获。通常，<code>pytest</code> 会捕获测试运行时产生的所有输出，并且仅当测试失败时才显示它，有助于在出现问题时保持输出的清晰和集中。然而，在某些情况下，你可能希望在测试执行时直接看到输出，而不是等待测试失败。</p>
<p>举个例子，运行以下命令:</p>
<pre><code class="language-shell">pytest -s test_my_feature.py
</code></pre>
<p>使用 <code>-s</code> 选项，<code>pytest</code> 将会运行 <code>test_my_feature.py</code> 文件中的测试，并将测试执行过程中的任何输出实时显示。这意味着打印到 <code>stdout</code> 或 <code>stderr</code> 的任何内容都会立刻显示在控制台上，而不是在测试结束后。</p>
<p>而 <code>-capture=method</code> 选项则允许更细粒度的控制。这里的 <code>method</code> 可以是以下选项之一：</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><code>no</code>: 不捕获输出，这与 <code>-s</code> 选项相同。</p>
</li>
<li class="lvl-2">
<p><code>fd</code>: 使用文件描述符捕获机制。这种方法可以捕获包括系统调用在内的输出，比如打印到 <code>sys.stdout</code> 和 <code>sys.stderr</code> 的内容。</p>
</li>
<li class="lvl-2">
<p><code>sys</code>: 只捕获写入 <code>sys.stdout</code> 和 <code>sys.stderr</code> Python 文件对象的输出。如果代码直接写入到操作系统提供的文件描述符，这些输出将不会被捕获。</p>
</li>
</ul>
<p>例如，使用文件描述符捕获可以通过以下命令实现：</p>
<pre><code class="language-shell">pytest --capture=fd test_my_feature.py
</code></pre>
<p>与 <code>-s</code> 选项不同，<code>--capture=fd</code> 将允许 <code>pytest</code> 捕获和控制输出，除非你明确要求显示它们。在实践中，根据具体的测试需求和调试偏好，你可能需要选择是否捕获输出以及如何捕获输出。通常情况下，你可能想要看到更多的输出来理解测试的行为，例如在引入新测试或调试现有测试失败时。</p>
<h3 id="3-2-2-11-can-shu-code-s-code">3.2.2.11 参数 <code>-s</code></h3>
<p><code>pytest</code>中的<code>-s</code>参数是禁用捕获输出的简写选项，它的全称是<code>--capture=no</code>。在使用<code>pytest</code>时，通常测试在运行过程中产生的输出会被捕获，这样可以让测试的结果输出更加清晰，因为只有在测试出现错误或失败时，捕获的输出才会显示出来。当你没有使用<code>-s</code>选项时，所有打印到<code>stdout</code>（标准输出）或<code>stderr</code>（标准错误）的内容在测试过程中是看不到的，它们被<code>pytest</code>内部捕获存储起来了。</p>
<p>当使用了<code>-s</code>选项后，测试运行中的输出不再被<code>pytest</code>捕获，而是直接打印出来。例如：</p>
<pre><code class="language-shell">pytest -s chapter1-3/
</code></pre>
<p>这条命令将运行<code>chapter1-3</code>目录下的所有测试，所有输出均会实时地显示在控制台上。这包括<code>print</code>语句、日志消息以及其他脚本可能输出的任何内容。这非常有助于调试测试脚本，特别是当你需要实时地获取反馈信息时。</p>
<p>假设我们有以下的测试用例：</p>
<pre><code class="language-python"># test_example.py
def test_example():
    print("Hello, this is a pytest test case!")
    assert 1 == 1
</code></pre>
<p>运行<code>pytest -s</code>后，你将会看到"Hello, this is a pytest test case!"的输出。如果没有<code>-s</code>选项，这段输出信息将不会被显示。</p>
<p>需要注意的是，虽然<code>-s</code>选项有助于调试，但是如果测试用例本身或被测试的代码需要读取<code>stdin</code>的话，那么使用<code>-s</code>选项可能会产生问题，因为<code>pytest</code>默认会屏蔽掉对<code>stdin</code>的访问，以防止测试在等待输入时挂起。</p>
<h3 id="3-2-2-12-can-shu-runxfail">3.2.2.12 参数 --runxfail</h3>
<p><code>pytest</code> 提供了一种处理预期失败（expected failures）的功能，通过使用 <code>@pytest.mark.xfail</code> 装饰器或使用内联的<code>pytest.mark.skipif</code>装饰器来标记那些由于某些已知问题而预期会失败的测试。这样做可以让这些测试在执行时不影响整个测试套件的结果。</p>
<p>在某些情况下，虽然我们将测试标记为预期失败，但我们可能想要强制执行这些标记为 <code>xfail</code> 的测试，来检查它们是否依然失败，或者是否提早解决了这个问题。这就是 <code>--runxfail</code> 参数的用途。当你在运行 <code>pytest</code> 时添加了 <code>--runxfail</code> 参数，它会执行所有标记为 <code>xfail</code> 的测试，就好像它们没有标记 <code>xfail</code>。</p>
<p>使用方法如下：</p>
<pre><code class="language-shell">pytest --runxfail
</code></pre>
<p>使用 <code>--runxfail</code> 的效果包括：</p>
<p><strong>运行所有标记为 <code>xfail</code> 的测试：</strong></p>
<p><code>--runxfail</code> 使所有使用 <code>@pytest.mark.xfail</code> 标记的测试都会执行，不考虑它们的 <code>xfail</code> 状态。</p>
<p><strong>忽略 <code>xfail</code> 状态：</strong></p>
<p>对于测试执行的结果，<code>--runxfail</code> 参数会导致 <code>pytest</code> 忽略 <code>xfail</code> 状态。即使测试预期失败，它们也会被记录为正常的失败或成功。</p>
<p>换言之，<code>pytest</code>会像平常一样运行这些测试，但不会特别关注预期失败的标记。如果测试失败了，它会被报告为一个普通的失败；如果测试通过了，它就会被报告为通过，不会有任何<code>xfail</code>或<code>xpass</code>的结果。</p>
<p>例如，你有以下的测试代码：</p>
<pre><code class="language-python"># test_example.py
import pytest

@pytest.mark.xfail(reason="This feature is not yet implemented.")
def test_future_feature():
    assert 0

def test_normal_feature():
    assert 1
</code></pre>
<p>在默认情况下运行<code>pytest</code>时，<code>test_future_feature</code>会被标记为<code>xfail</code>。但是，当你使用<code>--runxfail</code>选项运行测试时：</p>
<pre><code class="language-shell">pytest --runxfail test_example.py
</code></pre>
<p>此时，<code>test_future_feature</code>会被视为普通测试用例执行，如果它失败了，它会被报告为失败，不会考虑<code>xfail</code>。</p>
<p><strong>对bug修复测试：</strong></p>
<p>这个参数很有用，比如你修复了一个导致多个测试预期失败的bug，现在想要验证这些修复是否有效。而不是移除或者编辑每个 <code>xfail</code> 标记，你可以简单的使用 <code>--runxfail</code> 来执行这些测试。</p>
<p><strong>输出结果：</strong></p>
<p>即使测试是预期失败的，使用 <code>--runxfail</code> 后，失败结果会以正常的失败（FAIL）报告，而成功则为正常的成功（PASS）。这意味着 <code>xfail</code> 状态不会影响到测试结果的解释。</p>
<p>这个选项在持续集成或者测试环境中也非常有用，你可能想要临时极端地理解哪些 <code>xfail</code> 测试在当前环境中实际上是通过的，或者在排查问题的过程中需要确认这些测试的当前状态。不过，在常规的测试运行中，我们通常不加 <code>--runxfail</code>，让 <code>xfail</code> 的测试保持它们的预期状态。</p>
<h3 id="3-2-2-13-can-shu-code-lf-last-failed-code">3.2.2.13 参数 <code>--lf, --last-failed</code></h3>
<p><code>pytest</code> 提供了一种非常有用的功能来帮助开发者专注于最近失败的测试。通过 <code>--lf</code> 或 <code>--last-failed</code> 选项，<code>pytest</code> 只重新运行最近一次测试运行中失败的那些测试用例。这个选项能够节省时间，特别是处在解决 bug 和测试修复的循环中时，因为你不需要重新运行整个测试套件，只需关注那些失败的测试。</p>
<p>具体使用方法是在命令行中添加该选项：</p>
<pre><code class="language-shell">pytest --last-failed
</code></pre>
<p>或者是使用缩写形式：</p>
<pre><code class="language-shell">pytest --lf
</code></pre>
<p><strong><code>--lf</code> 或 <code>--last-failed</code> 的行为：</strong></p>
<p><strong>执行过滤：</strong></p>
<p>在你下次执行 <code>pytest</code> 时，只有上一次运行中失败的测试会被运行。如果在上一次运行中没有任何测试失败，那么使用 <code>--last-failed</code> 将不会运行任何测试。</p>
<p><strong>节省时间：</strong></p>
<p>这种方式特别有用，因为它可以帮助你专注于修复那些断言失败或出错的测试，而不必等待那些已经通过的测试再次运行。</p>
<p><strong>配合其他策略：</strong></p>
<p>你可以将 <code>--last-failed</code> 与其他 <code>pytest</code> 选项结合使用，例如 <code>-vv</code> 提高输出的详细程度，或者 <code>--pdb</code> 在失败的测试上直接进入调试器。</p>
<p><strong>持久化：</strong></p>
<p><code>pytest</code> 会在 <code>.pytest_cache</code> 目录中存储关于上一次运行哪些测试失败的信息，这样即使你在不同的测试运行之间关闭了你的工作站，<code>--last-failed</code> 也能继续工作。</p>
<p><strong>清除失败记录：</strong></p>
<p>如果想从头运行所有的测试，或者清理掉失败的记录，你可以运行 <code>pytest</code> 而不加任何参数，或者使用 <code>--clear-last-failed</code> 来清除失败的缓存记录。</p>
<p>这个功能在测试开发过程中特别高效，能够显著提高开发者处理失败测试的速度。不过，当你确信所有的问题都已经修复完毕，最好进行一次全面测试，以确保没有其他非预期的问题出现。</p>
<h3 id="3-2-2-14-can-shu-code-ff-failed-first-code">3.2.2.14 参数 <code>--ff, --failed-first</code></h3>
<p><code>pytest</code> 的 <code>--ff</code> 和 <code>--failed-first</code> 选项是用来优化测试运行的。这些选项被设计用于让在上一次运行中失败的测试用例首先执行，这样可以让开发者更快地看到修复这些失败用例是否有效。如果这些之前失败的测试现在都通过了，那么 <code>pytest</code> 将继续执行其余的测试用例。</p>
<p>使用这种方式，测试反馈循环更短，特别是在一个有许多测试用例的大型项目中，你可以更快地知道你的更改是否解决了问题而不必等待整个测试套件完成运行。</p>
<p>具体用法如下:</p>
<pre><code class="language-shell">pytest --failed-first
</code></pre>
<p>或者使用简写形式:</p>
<pre><code class="language-shell">pytest --ff
</code></pre>
<p>在命令执行时，<code>pytest</code> 会首先运行上次失败的测试集，如果这些测试通过，则继续执行剩余的测试集。</p>
<p>例如，假设你有一组测试用例，其中某几个在上次运行时失败了，如果你修改了相关代码以解决这些失败的测试，并想要确认这些修改的效果，可以使用 <code>--ff</code> 选项运行 <code>pytest</code>。这样做不仅可以快速获得关于这些特定测试的反馈，而且一旦这些测试都通过了，剩余的测试也会在之后执行，以确保其他部分的代码仍然是正确的。</p>
<p>就像 <code>--lf</code>（<code>--last-failed</code>）选项一样，<code>--ff</code> 选项依赖于 <code>.pytest_cache</code> 目录中存储的信息，它记录了哪些测试在上次运行中失败。如果你想要从头开始运行所有测试用例或者清除失败的历史，可以使用 <code>--cache-clear</code> 选项来清空缓存。</p>
<h3 id="3-2-2-15-can-shu-code-nf-new-first-code">3.2.2.15 参数  <code>--nf, --new-first</code></h3>
<p><code>pytest</code> 的 <code>--nf</code> 或 <code>--new-first</code> 选项是用于调整测试用例的执行顺序，以便最先运行最新的测试。这个功能特别适用于开发新功能或修复缺陷时，当你添加或修改了测试用例，并希望首先执行这些最新的测试来快速获得反馈。</p>
<p>当使用 <code>--nf</code> 或 <code>--new-first</code> 选项时，<code>pytest</code> 会尝试根据测试用例文件的修改时间来确定测试执行的顺序。较新或最近修改的测试文件中的测试用例会被提前到测试队列的前面。</p>
<p>具体用法如下:</p>
<pre><code class="language-shell">pytest --new-first
</code></pre>
<p>或者使用简写形式:</p>
<pre><code class="language-shell">pytest --nf
</code></pre>
<p>这与 <code>--ff</code>（<code>--failed-first</code>）选项不同，后者是将之前失败的测试用例置于队列前面。<code>--new-first</code> 选项则关注文件的新旧程度。</p>
<p>例如，假设你在开发一个特性并且添加了一些新的测试用例，或者对现有的一个测试文件进行了显著的修改。使用 <code>--new-first</code> 选项可以让你更快地看到这些更改是否成功，因为 <code>pytest</code> 将先运行这些新添加或修改的测试用例。</p>
<p>这是一种有助于提高开发效率的测试策略，尤其是当你正在频繁地添加新测试和更改现有测试时。这样可以先关注新的更改，确保它们按预期工作，然后再关注全局的测试情况。</p>
<p>记住，如果希望运行所有测试用例，而不对顺序做特殊处理，你应该运行裸 <code>pytest</code> 命令，而不带任何排序相关的选项。</p>
<h3 id="3-2-2-16-can-shu-code-cache-show-cacheshow-code">3.2.2.16 参数  <code>--cache-show=[CACHESHOW]</code></h3>
<p><code>pytest</code> 的 <code>--cache-show</code> 选项用于显示缓存内容（默认是<code>.pytest_cache</code>目录），可以查看之前测试运行时所保存的信息，这对调试和理解 <code>pytest</code> 缓存机制非常有帮助。<code>pytest</code> 缓存用于存储跟测试运行相关的数据。例如，<code>--lf</code> （–last-failed）和 <code>--ff</code>（–failed-first）选项依赖于 <code>.pytest_cache</code> 目录中的失败记录来确定失败的测试。</p>
<p><code>pytest</code>的缓存目录结构示例如下：</p>
<pre><code class="language-shell">root@Gavin:~/code# tree -a .pytest_cache/
.pytest_cache/
├── CACHEDIR.TAG
├── .gitignore
├── README.md
└── v
    └── cache
        ├── lastfailed
        ├── nodeids
        └── stepwise

3 directories, 6 files
root@Gavin:~/code# 
</code></pre>
<p>说明如下：</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><code>.pytest_cache/CACHEDIR.TAG</code>：pytest创建的缓存目录标签。</p>
</li>
<li class="lvl-2">
<p><code>.pytest_cache/.gitignore</code>：pytest测试框架 <code>.pytest_cache</code>的自带的 <code>.gitignore</code>文件。</p>
</li>
<li class="lvl-2">
<p><code>.pytest_cache/README.md</code>： <code>.pytest_cache</code>文件夹介绍。</p>
</li>
<li class="lvl-2">
<p><code>.pytest_cache/v/cache/lastfailed</code>: 上一次运行失败的测试用例。</p>
</li>
<li class="lvl-2">
<p><code>.pytest_cache/v/cache/nodeids</code>: 上一次运行的所有测试用例（无论测试用例的执行结果通过还是失败）。</p>
</li>
<li class="lvl-2">
<p><code>.pytest_cache/v/cache/stepwise</code>：测试用例的路径。</p>
</li>
</ul>
<p>如果指定 <code>--cache-show</code> 而不带任何参数，它将显示所有缓存的信息。你也可以提供具体的键值来查看特定的缓存信息。</p>
<p>具体用法如下:</p>
<pre><code class="language-shell">pytest --cache-show
</code></pre>
<p>这将会打印 <code>.pytest_cache</code> 目录中的所有内容，参考如下：</p>
<pre><code class="language-shell">root@Gavin:~/code# pytest --cache-show
============================== test session starts =============================
platform linux -- Python 3.11.6, pytest-7.4.0, pluggy-1.2.0
rootdir: /root/code
cachedir: /root/code/.pytest_cache
------------------------------ cache values for '*' ----------------------------
cache/lastfailed contains:
  {'chapter1-3/test_example.py::test_assert_failed': True}
cache/nodeids contains:
  ['chapter1-3/test_example.py::test_assert_failed',
   'chapter1-3/test_example.py::test_example',
   'chapter1-3/test_example.py::test_future_feature',
   'chapter1-3/test_example.py::test_normal_feature']
cache/stepwise contains:
  []

============================== no tests ran in 0.00s ===========================
root@Gavin:~/code#
</code></pre>
<p>如果你想针对特定缓存项获取详细信息，可以指定该项的名称：</p>
<pre><code class="language-shell">pytest --cache-show=[CACHENAME]
</code></pre>
<p>在这里，<code>[CACHENAME]</code> 应该替换为你希望查看的具体缓存项的名称。</p>
<p>例如：</p>
<pre><code class="language-shell">pytest --cache-show=chapter1-3/test_example.py
</code></pre>
<p>这个命令将会显示与 <code>chapter1-3/test_example.py</code> 相关的缓存信息，这个键值通常包含了上次运行中失败的测试。</p>
<p>缓存功能可以用来存储和检索测试间需要传递的数据。不过，请注意，过多依赖于测试间的缓存可能会导致测试结果不可靠，因为它们可以含有过时的数据，尤其是在代码改动频繁的情况下。</p>
<p>当你对 <code>pytest</code> 缓存机制有了深入理解，并且能够有效利用缓存数据时，<code>--cache-show</code> 就成为了一个非常有用的调试工具。</p>
<h3 id="3-2-2-17-can-shu-code-cache-clear-code">3.2.2.17 参数  <code>--cache-clear</code></h3>
<p><code>pytest</code> 的 <code>--cache-clear</code> 选项用于清除通过 <code>pytest</code> 缓存机制存储在本地的所有缓存数据。<code>pytest</code> 的缓存系统允许跨多次测试运行间存储和复用数据，这些数据默认存储在 <code>.pytest_cache</code> 目录中。使用 <code>--cache-clear</code> 可以删除这个目录下的所有内容，从而清空缓存。</p>
<p>使用 <code>--cache-clear</code> 选项的场景包括但不限制于：</p>
<ul class="lvl-0">
<li class="lvl-2">
<p>当你想要重新运行失败的测试而不受之前运行影响时。</p>
</li>
<li class="lvl-2">
<p>当你要清除由于某些原因可能已经不再准确或有用的缓存数据时。</p>
</li>
<li class="lvl-2">
<p>测试过程中某些缓存数据可能导致测试结果不一致，此时清除缓存能够确保每次运行测试都是在干净的状态下开始。</p>
</li>
</ul>
<p>具体的命令如下所示：</p>
<pre><code class="language-shell">pytest --cache-clear
</code></pre>
<p>执行这条命令，<code>pytest</code> 会先删除 <code>.pytest_cache</code> 目录及其内容，然后根据你可能的运行测试命令，开始新的测试运行。</p>
<p>需要注意的是，使用这个选项之后，所有的缓存都会被清除，包括用于 <code>--lf</code>（–last-failed）和 <code>--ff</code>（–failed-first）选项的失败记录。因此，使用它之前请确保你不需要缓存中的任何数据，或者已经做好了相应的数据备份工作。</p>
<h3 id="3-2-2-18-can-shu-code-lfnf-all-none-last-failed-no-failures-all-none-code">3.2.2.18 参数  <code>--lfnf={all,none}, --last-failed-no-failures={all,none}</code></h3>
<p><code>pytest</code> 的 <code>--lfnf</code> 或者全称 <code>--last-failed-no-failures</code> 选项用于指定当没有失败的测试时应该执行哪些测试。这个选项通常与 <code>--last-failed</code> 选项一起使用，后者会使 <code>pytest</code> 只重运行上次运行中失败的测试。</p>
<p><code>--last-failed-no-failures</code> 有两个可能的值：</p>
<ul class="lvl-0">
<li class="lvl-2">
<p><code>all</code>：如果在上次的测试中没有任何失败（或者使用了 <code>--cache-clear</code> 清空了缓存），则运行所有的测试用例。</p>
</li>
<li class="lvl-2">
<p><code>none</code>：如果在上次的测试中没有任何失败，则不运行任何测试用例。</p>
</li>
</ul>
<p>这个选项在持续集成流程中非常有用，让你可以先尝试只重运行那些失败的测试用例。如果在某次运行中所有的失败用例都被修复了，根据 <code>--lfnf</code> 的设置，你可以选择是运行全部测试保证整体健康，还是什么都不做。</p>
<p><strong>使用方法：</strong></p>
<p>如果上次没有失败的测试，运行所有测试：</p>
<pre><code class="language-shell">pytest --last-failed --last-failed-no-failures=all
</code></pre>
<p>如果上次没有失败的测试，不运行任何测试：</p>
<pre><code class="language-shell">pytest --last-failed --last-failed-no-failures=none
</code></pre>
<p><strong>请注意：</strong></p>
<p>这两个选项需要结合使用。如果你没有启用 <code>--last-failed</code>，则 <code>--last-failed-no-failures</code> 选项没有任何效果。当你期望根据失败用例的存在与否来决定运行策略时，这一选项组合尤其有帮助。</p>
<h3 id="3-2-2-19-can-shu-code-sw-stepwise-code">3.2.2.19 参数  <code>--sw, --stepwise</code></h3>
<p><code>pytest</code> 的 <code>--stepwise</code> 选项（缩写为 <code>--sw</code>）是一个有用的调试工具，它允许测试在第一个失败的测试处停止。其功能类似于逐步执行（stepwise），可以帮助你快速定位问题。当你在大型测试集中调试单个失败的测试时，这个选项特别有帮助，因为它避免了在修复当前失败的测试之前需要运行所有其他测试的情况。</p>
<p><strong>使用方法：</strong></p>
<p>开启 stepwise 模式，当遇到第一个失败的测试时立即停止执行剩余的测试:</p>
<pre><code class="language-shell">pytest --stepwise
</code></pre>
<p><strong>详细说明：</strong></p>
<ul class="lvl-0">
<li class="lvl-2">
<p>当启用 <code>--stepwise</code> 选项时，<code>pytest</code> 会开始执行测试，一旦遇到第一个测试失败，它就会停止执行。</p>
</li>
<li class="lvl-2">
<p>修复了导致测试失败的问题之后，你可以重新运行带有 <code>--stepwise</code> 选项的 <code>pytest</code>，它将继续从上一次失败的测试处开始执行，而不是从头开始。</p>
</li>
<li class="lvl-2">
<p>如果在 <code>--stepwise</code> 模式下所有的测试都通过了，那么 <code>pytest</code> 将正常退出。</p>
</li>
<li class="lvl-2">
<p>这个选项非常适合那些需要快速迭代和修复单个或一系列测试问题的开发者。</p>
</li>
<li class="lvl-2">
<p>请注意，<code>--stepwise</code> 模式与 <code>pytest</code> 的缓存机制一起工作；它利用缓存来记住上次失败的位置。</p>
</li>
</ul>
<p>可能需要注意的是，如果你的测试依赖于特定的顺序或者有涉及状态的依赖，那么 <code>--stepwise</code> 可能不是最好的选择，因为在测试序列中间的某个点开始执行可能会导致意外的副作用。在这种情况下，使用标准的 <code>--lf</code>（–last-failed）选项可能更加安全，<code>--lf</code> 会重新运行上次运行中失败的所有测试。</p>
<h3 id="3-3-3-20-can-shu-code-sw-skip-stepwise-skip-code">3.3.3.20 参数  <code>--sw-skip, --stepwise-skip</code></h3>
<p><code>pytest</code> 的 <code>--stepwise-skip</code> 选项（可缩写为 <code>--sw-skip</code>）是结合了 <code>--stepwise</code> 功能和忽略跳过（skip）测试的能力。启用这个选项后，<code>pytest</code> 会在遇到第一个失败的测试时停止执行，就像 <code>--stepwise</code> 那样，但它还将自动跳过任何标记为跳过的测试。</p>
<p><strong>使用方法：</strong></p>
<p>在 stepwise 模式下跳过使用 <code>pytest.mark.skip</code> 或 <code>pytest.mark.skipif</code> 标记的测试：</p>
<pre><code class="language-shell">pytest --stepwise --stepwise-skip
</code></pre>
<p><strong>详细说明：</strong></p>
<ul class="lvl-0">
<li class="lvl-2">
<p>启用 <code>--stepwise-skip</code> 时，<code>pytest</code> 开始执行测试并跳过任何明确被标记为需要跳过的测试。</p>
</li>
<li class="lvl-2">
<p>一旦遇到第一个测试失败，它就会停止执行后续的测试，就像在标准的 <code>--stepwise</code> 模式下那样。</p>
</li>
<li class="lvl-2">
<p>当你修复了导致停止的测试失败后，可以再次运行 <code>pytest</code> 带上 <code>--stepwise</code> 和 <code>--stepwise-skip</code> 选项，它将从上次失败的测试处继续执行，并且继续跳过那些被标记为跳过的测试。</p>
</li>
<li class="lvl-2">
<p>名为 <code>--sw-skip</code> 的缩写形式可以替代 <code>--stepwise-skip</code> 使用。</p>
</li>
<li class="lvl-2">
<p>类似 <code>--stepwise</code>，这个选项在调试一个大型测试套件时非常有用，尤其是当你希望忽略已知将被跳过的测试，将焦点放在需要修复的失败测试上时。</p>
</li>
<li class="lvl-2">
<p><code>--stepwise-skip</code> 选项创造了一个快速迭代的测试环境，特别是在调试过程中，它绕过了不需要关注的测试，让你可以集中精力在当前失败处一步步前进。</p>
</li>
<li class="lvl-2">
<p>这个选项的使用前提是你的测试套件中包含了使用 <code>pytest.mark.skip</code> 或 <code>pytest.mark.skipif</code> 标记的测试。如果没有这样的跳过标记，它的行为就和标准的 <code>--stepwise</code> 选项一样。</p>
</li>
</ul>
<p><a href="https://gavin-wang-note.github.io/2024/05/22/pytest_test_guide_part1_chapter1_3_2_pytest_params/">续下文</a></p>

                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">Gavin Wang</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://gavin-wang-note.github.io/2024/03/03/pytest_test_guide_part1_chapter1_3_1_pytest_params/">https://gavin-wang-note.github.io/2024/03/03/pytest_test_guide_part1_chapter1_3_1_pytest_params/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">Gavin Wang</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/pytest/">
                                    <span class="chip bg-color">pytest</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/img/loading.gif" data-original="/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/img/loading.gif" data-original="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2024/03/09/how_to_ensure_interface_automation_stability/">
                    <div class="card-image">
                        
                        <img src="/img/loading.gif" data-original="/img/API/api4.jpg" class="responsive-img" alt="接口自动化测试的稳定性保证">
                        
                        <span class="card-title">接口自动化测试的稳定性保证</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            如何保证接口自动化测试的稳定性
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2024-03-09
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/Automation/" class="post-category">
                                    Automation
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Automation/">
                        <span class="chip bg-color">Automation</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2024/02/17/pytest_test_guide_part1_chapter1_2_run_pytest_case/">
                    <div class="card-image">
                        
                        <img src="/img/loading.gif" data-original="/img/pytest/pytest-2.png" class="responsive-img" alt="《pytest测试指南》-- 章节1-2 pytest测试用例执行">
                        
                        <span class="card-title">《pytest测试指南》-- 章节1-2 pytest测试用例执行</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            《pytest测试指南》一书 章节1-2 pytest测试用例执行。
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2024-02-17
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/Automation/" class="post-category">
                                    Automation
                                </a>
                            
                            <a href="/categories/pytest/" class="post-category">
                                    pytest
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Automation/">
                        <span class="chip bg-color">Automation</span>
                    </a>
                    
                    <a href="/tags/pytest/">
                        <span class="chip bg-color">pytest</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>


<script>
    $('#articleContent').on('copy', function (e) {
        // IE8 or earlier browser is 'undefined'
        if (typeof window.getSelection === 'undefined') return;

        var selection = window.getSelection();
        // if the selection is short let's not annoy our users.
        if (('' + selection).length < Number.parseInt('120')) {
            return;
        }

        // create a div outside of the visible area and fill it with the selected text.
        var bodyElement = document.getElementsByTagName('body')[0];
        var newdiv = document.createElement('div');
        newdiv.style.position = 'absolute';
        newdiv.style.left = '-99999px';
        bodyElement.appendChild(newdiv);
        newdiv.appendChild(selection.getRangeAt(0).cloneContents());

        // we need a <pre> tag workaround.
        // otherwise the text inside "pre" loses all the line breaks!
        if (selection.getRangeAt(0).commonAncestorContainer.nodeName === 'PRE' || selection.getRangeAt(0).commonAncestorContainer.nodeName === 'CODE') {
            newdiv.innerHTML = "<pre>" + newdiv.innerHTML + "</pre>";
        }

        var url = document.location.href;
        newdiv.innerHTML += '<br />'
            + '来源: Transcendent<br />'
            + '文章作者: Gavin Wang<br />'
            + '文章链接: <a href="' + url + '">' + url + '</a><br />'
            + '本文章著作权归作者所有，任何形式的转载都请注明出处。';

        selection.selectAllChildren(newdiv);
        window.setTimeout(function () {bodyElement.removeChild(newdiv);}, 200);
    });
</script>


<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>


  <!-- 是否加载使用自带的 prismjs. -->
  <script type="text/javascript" src="/libs/prism/prism.min.js"></script>


<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>



    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('2'),
            headingSelector: 'h1, h2, h3, h4'
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    

    <div class="container row center-align"
         style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2009-2024</span>
            
            <a href="/about" target="_blank">Gavin Wang</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            
                <span id="translate">|&nbsp;繁/简：</span><a id="translateLink" href="javascript:translatePage();">繁</a>
            
            <br>
            
                &nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span
                        class="white-color">819.3k</span>
            
            
            
                
            
            
                <span id="busuanzi_container_site_pv">
                &nbsp;|&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;
                    <span id="busuanzi_value_site_pv" class="white-color"></span>
            </span>
            
            
                <span id="busuanzi_container_site_uv">
                &nbsp;|&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;
                    <span id="busuanzi_value_site_uv" class="white-color"></span>
            </span>
            
            <br>

            <!-- 运行天数提醒. -->
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">


    <a href="mailto:250556531@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=250556531" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 250556531" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 白天和黑夜主题 -->
<div class="stars-con">
    <div id="stars"></div>
    <div id="stars2"></div>
    <div id="stars3"></div>  
</div>

<script>
    function switchNightMode() {
        $('<div class="Cuteen_DarkSky"><div class="Cuteen_DarkPlanet"></div></div>').appendTo($('body')),
        setTimeout(function () {
            $('body').hasClass('DarkMode') 
            ? ($('body').removeClass('DarkMode'), localStorage.setItem('isDark', '0'), $('#sum-moon-icon').removeClass("fa-sun").addClass('fa-moon')) 
            : ($('body').addClass('DarkMode'), localStorage.setItem('isDark', '1'), $('#sum-moon-icon').addClass("fa-sun").removeClass('fa-moon')),
            
            setTimeout(function () {
            $('.Cuteen_DarkSky').fadeOut(1e3, function () {
                $(this).remove()
            })
            }, 2e3)
        })
    }
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    

    
        <script type="text/javascript" src="/js/tw_cn.js"></script>
        <script type="text/javascript">
          var defaultEncoding = 2; //网站编写字体是否繁体，1-繁体，2-简体
          var translateDelay = 0; //延迟时间,若不在前, 要设定延迟翻译时间, 如100表示100ms,默认为0
          var cookieDomain = "https://gavin-wang-note.github.io"; //Cookie地址, 一定要设定, 通常为你的网址
          var msgToTraditionalChinese = "繁"; //此处可以更改为你想要显示的文字
          var msgToSimplifiedChinese = "简"; //同上，但两处均不建议更改
          var translateButtonId = "translateLink"; //默认互换id
          translateInitilization();
        </script>
    
    
    

    <!-- 雪花特效 -->
    

    <!-- 鼠标星星特效 -->
     
        <script type="text/javascript">
            // 只在桌面版网页启用特效
            var windowWidth = $(window).width();
            if (windowWidth > 768) {
                document.write('<script type="text/javascript" src="/libs/others/star.js"><\/script>');
            }
        </script>
    

    

    <!-- Baidu Analytics -->

<script>
    var _hmt = _hmt || [];
    (function () {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    <!--腾讯兔小巢-->
    
    

    

    
    <script type="text/javascript" src="/libs/background/ribbon-dynamic.js" async="async"></script>
    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    


        <style>
            [bg-lazy] {
                background-image: none !important;
                background-color: #eee !important;
            }
        </style>
        <script>
            window.imageLazyLoadSetting = {
                isSPA: false,
                preloadRatio: 1,
                processImages: null,
            };
        </script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})});</script><script>!function(r){r.imageLazyLoadSetting.processImages=t;var e=r.imageLazyLoadSetting.isSPA,c=(r.imageLazyLoadSetting.preloadRatio,n());function n(){var t=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")),e=Array.prototype.slice.call(document.querySelectorAll("[bg-lazy]"));return t.concat(e)}function t(){e&&(c=n());for(var t,o=0;o<c.length;o++)0<=(t=(t=c[o]).getBoundingClientRect()).bottom&&0<=t.left&&t.top<=(r.innerHeight+240||document.documentElement.clientHeight+240)&&function(){var t,e,n,a,i=c[o];e=function(){c=c.filter(function(t){return i!==t}),r.imageLazyLoadSetting.onImageLoaded&&r.imageLazyLoadSetting.onImageLoaded(i)},(t=i).hasAttribute("bg-lazy")?(t.removeAttribute("bg-lazy"),e&&e()):(n=new Image,a=t.getAttribute("data-original"),n.onload=function(){t.src=a,t.removeAttribute("data-original"),e&&e()},t.src!==a&&(n.src=a))}()}function a(){clearTimeout(t.tId),t.tId=setTimeout(t,500)}t(),document.addEventListener("scroll",a),r.addEventListener("resize",a),r.addEventListener("orientationchange",a)}(this);</script></body>

</html>
