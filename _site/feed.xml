<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="4.0.1">Jekyll</generator><link href="http://172.17.73.80:4000/feed.xml" rel="self" type="application/atom+xml" /><link href="http://172.17.73.80:4000/" rel="alternate" type="text/html" /><updated>2022-01-28T14:50:17+08:00</updated><id>http://172.17.73.80:4000/feed.xml</id><title type="html">Gavin Blog</title><subtitle>关于软件测试, 与你一起发现更大的世界</subtitle><entry><title type="html">自动部署cosbench并提交任务与结果处理解析</title><link href="http://172.17.73.80:4000/2022/01/28/auto_deploy_submit_analyser_cosbench_task/" rel="alternate" type="text/html" title="自动部署cosbench并提交任务与结果处理解析" /><published>2022-01-28T00:00:00+08:00</published><updated>2022-01-28T00:00:00+08:00</updated><id>http://172.17.73.80:4000/2022/01/28/auto_deploy_submit_analyser_cosbench_task</id><content type="html" xml:base="http://172.17.73.80:4000/2022/01/28/auto_deploy_submit_analyser_cosbench_task/">&lt;h1 id=&quot;概述&quot;&gt;概述&lt;/h1&gt;

&lt;p&gt;每次跑S3 Performance时，总要花费蛮多时间在构造xml以及xml调测上，避免xml内容有误影响测试。&lt;/p&gt;

&lt;p&gt;此次直接将整个过程（部署jre，部署cosbench，提交任务，自动收集存储信息以及对cosbench测试结果处理），整合成一套完整测试script，提高下工作效率。&lt;/p&gt;

&lt;h2 id=&quot;script-directory-structure&quot;&gt;Script directory structure&lt;/h2&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;root@node243:~/cosbench# tree ./
./
├── 00_run.sh
├── 01_deploy_jre.sh
├── 02_deploy_cosbench.sh
├── 03_deplay_nmon.sh
├── 04_submit_cosbench_task.sh
├── 05_collect_result.sh
├── 06_analyser_cosbench_result.sh
├── 07_restart_cosbench.sh
├── config
│   ├── 10M_size_object_write_read_mix_files.xml.ini
│   ├── 120Million_only_write.xml.ini
│   ├── 1G_size_object_write_read_mix_files.xml.ini
│   ├── 1M_size_object_write_read_mix_files.xml.ini
│   ├── controller_template.conf
│   ├── dry_run.xml
│   ├── parameters.conf
│   └── small_object_write_read_mix_files.xml.ini
├── packages
│   ├── 0.4.2.c4.tar.gz
│   ├── binfmt-support_2.1.6-1_amd64.deb
│   ├── expect-5.44.1.15-5.el6_4.x86_64.rpm
│   ├── jre-8u171-linux-x64.tar.gz
│   ├── ksh-20120801-143.el7_9.x86_64.rpm
│   ├── ksh-2020.0.0-4.ky10.x86_64.rpm
│   ├── ksh_93u+20120801-2ubuntu0.16.04.1_amd64.deb
│   ├── nmon_14g+debian-1build1_amd64.deb
│   ├── nmon-16g-3.el7.x86_64.rpm
│   ├── nmonchart40.tar
│   └── tcl-8.5.7-6.el6.x86_64.rpm
├── README.md
├── subin
    ├── expect_scp.sh
    └── expect_ssh.sh
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;instructions&lt;/p&gt;

    &lt;p&gt;00_run.sh is the main entry point for the script. Other scripts starting with digits are invoked by this script.&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;sop&quot;&gt;SOP&lt;/h2&gt;

&lt;h4 id=&quot;prepare-test-environment&quot;&gt;Prepare test environment&lt;/h4&gt;

&lt;ul&gt;
  &lt;li&gt;Install Kylin V10 or CentOS 7 or Ubuntu 16.04 as clients, client number is suggested same as that of gateways&lt;/li&gt;
  &lt;li&gt;The IP address of clients must be sequential&lt;/li&gt;
  &lt;li&gt;Yum/apt-get install some packages, including expect under packages dir(00_run.sh done)&lt;/li&gt;
  &lt;li&gt;Install nmon,ksh on each storage nodes(00_run.sh done)&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;create-a-s3-account-in-web-ui&quot;&gt;Create a S3 account in web UI&lt;/h4&gt;

&lt;ul&gt;
  &lt;li&gt;Only support S3&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;create-a-pool-then-set-as-s3-pool&quot;&gt;Create a pool, then set as S3 pool&lt;/h4&gt;

&lt;ul&gt;
  &lt;li&gt;Not care EC pool or Replicate pool&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;enable-ssh-for-root-on-storage-nodes&quot;&gt;Enable ssh for root on Storage nodes&lt;/h4&gt;

&lt;ul&gt;
  &lt;li&gt;vim /etc/ssh/sshd_config to enable ssh for root(Default, after create cluster, forbidden root account to ssh)&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;content&quot;&gt;Content&lt;/h2&gt;

&lt;h3 id=&quot;parameterconf&quot;&gt;parameter.conf&lt;/h3&gt;

&lt;p&gt;This conf defines items below:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Info of clients and storage nodes&lt;/li&gt;
  &lt;li&gt;Config nmonchart result path&lt;/li&gt;
  &lt;li&gt;Some parameter for generating cosbench XML, such as workers, runtime, ini xml files, mix ratio and so on&lt;/li&gt;
  &lt;li&gt;S3 AKEY&amp;amp;SKEY&lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&quot;script-info&quot;&gt;Script info&lt;/h3&gt;

&lt;p&gt;Scripts are usually executed by order of the number prefixed to the filename.&lt;/p&gt;

&lt;h4 id=&quot;00_runsh&quot;&gt;00_run.sh:&lt;/h4&gt;

&lt;p&gt;This script can be treated as a set which is constituted by the following scripts. You can modify the steps to fill the concrete requirements.&lt;/p&gt;

&lt;h4 id=&quot;01_deploy_jresh&quot;&gt;01_deploy_jre.sh&lt;/h4&gt;

&lt;p&gt;This script is used to copy jre(jre-8u171-linux-x64.tar.gz) to all clients according to parameter.conf.
Since this script uses expect to interact, it is requested to install expect has not been installed on this client.&lt;/p&gt;

&lt;h4 id=&quot;02_deploy_cosbenchsh&quot;&gt;02_deploy_cosbench.sh&lt;/h4&gt;

&lt;p&gt;Execute it to install cosbench on all clients if have no cosbench installed before.
If has been installed cosbench, if cosbench in running status, do nothing; if not running, will replace controller.conf then start cosbench.
The first client as cosbench controller and driver, other nodes run driver&lt;/p&gt;

&lt;h4 id=&quot;03_deplay_nmonsh&quot;&gt;03_deplay_nmon.sh&lt;/h4&gt;

&lt;p&gt;Execute it to install nmon,ksh,nmonchart on all clients if have no nmon installed before.
Use nmon to collect monitor data from each storage node.
nmonchart needs ksh, so install ksh on each storage node.
Use nmonchart to chart nmon data on each storage node. 
    (1) After charted, mush be opened by Google browser
    (2) Needs to be able to access Google because needs Google plug-ins online(Can use nmon analyser to save excel)&lt;/p&gt;

&lt;h4 id=&quot;04_submit_cosbench_tasksh&quot;&gt;04_submit_cosbench_task.sh&lt;/h4&gt;

&lt;p&gt;Execute it to generate cosbench xml, then submit cosbench task, then run nmon to monitor storage on each storage node.
Support dry run or not, suggest to dry run, prevent problems in direct running, and run completely after ensuring that there are no problems in the whole process.&lt;/p&gt;

&lt;h4 id=&quot;05_collect_resultsh&quot;&gt;05_collect_result.sh&lt;/h4&gt;

&lt;p&gt;Execute it to collect nmon result from storage nodes&lt;/p&gt;

&lt;h4 id=&quot;06_analyser_cosbench_resultsh&quot;&gt;06_analyser_cosbench_result.sh&lt;/h4&gt;

&lt;p&gt;Execute it to analyser cosbench rest result on cosbench controller node&lt;/p&gt;

&lt;h4 id=&quot;07_restart_cosbenchsh&quot;&gt;07_restart_cosbench.sh&lt;/h4&gt;

&lt;p&gt;If wants to restart all of cosbench service, you can run this script to do it.
This action will not clean archive and log on each cosbench node.&lt;/p&gt;

&lt;h4 id=&quot;config&quot;&gt;config/&lt;/h4&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;controller_template.conf --&amp;gt; Generate controller.conf then sync to the controller node
dry_run.xml  --&amp;gt; For dry run
10M_size_object_write_read_mix_files.xml.ini   --&amp;gt; Template of cosbench xml to generate cosbench task of xml files (Under xml_files)
120Million_only_write.xml.ini                  --&amp;gt; Template of cosbench xml to generate cosbench task of xml files (Under xml_files)
1G_size_object_write_read_mix_files.xml.ini    --&amp;gt; Template of cosbench xml to generate cosbench task of xml files (Under xml_files)
1M_size_object_write_read_mix_files.xml.ini    --&amp;gt; Template of cosbench xml to generate cosbench task of xml files (Under xml_files)
small_object_write_read_mix_files.xml.ini      --&amp;gt; Template of cosbench xml to generate cosbench task of xml files (Under xml_files)
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;For cosbench xml files(under xml_files), can decide the running sequence by specfying proper filename.&lt;/p&gt;

&lt;h4 id=&quot;packages&quot;&gt;packages/&lt;/h4&gt;

&lt;p&gt;Include expect, nmon, nmonchart, ksh and other tools.&lt;/p&gt;

&lt;h4 id=&quot;subin&quot;&gt;subin/&lt;/h4&gt;

&lt;p&gt;Some internal functions used by scripts.&lt;/p&gt;

&lt;h1 id=&quot;an-example-of-script-output&quot;&gt;An example of script output&lt;/h1&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419
420
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;root@node243:~/cosbench# ./06_analyser_cosbench_result.sh 

----------------------------------------------------------------------------------- 
w1-QA_30workers_4K_30M_files_mix, cost_time:6H:22M:54S                    
             IOPS            BW(MB/s)        avg_res_time(ms)     avg_proc_time(ms)   
WRITE        4844.17         19.8417         6.05333              6.05333             
READ         3750.24         15.361          7.99                 7.94                
MIX_WRITE    1615.27         6.61614         10.1133              10.1133             
MIX_READ     1615.91         6.61874         8.31667              8.26333             
MIX_SUM      3231.18         13.2349         9.215                9.18833             

----------------------------------------------------------------------------------- 
w2-QA_30workers_100K_30M_files_mix, cost_time:6H:42M:30S                    
             IOPS            BW(MB/s)        avg_res_time(ms)     avg_proc_time(ms)   
WRITE        4020.6          411.709         7.32333              6.24667             
READ         3060.55         313.4           9.79667              8.9                 
MIX_WRITE    1378.69         141.178         11.5067              10.3833             
MIX_READ     1380.04         141.316         10.1067              9.17667             
MIX_SUM      2758.73         282.494         10.8067              9.78                

----------------------------------------------------------------------------------- 
w3-QA_30workers_200K_30M_files_mix, cost_time:7H:27M:26S                    
             IOPS            BW(MB/s)        avg_res_time(ms)     avg_proc_time(ms)   
WRITE        3300.63         675.969         8.96333              7.02333             
READ         2171.91         444.807         13.8033              12.14               
MIX_WRITE    1103.61         226.021         13.14                11.0667             
MIX_READ     1103.17         225.929         13.9167              12.15               
MIX_SUM      2206.78         451.95          13.5283              11.6083             

----------------------------------------------------------------------------------- 
w4-QA_30workers_1024K_1M_Size_file_mix, cost_time:1H:46M:52S                    
             IOPS            BW(MB/s)        avg_res_time(ms)     avg_proc_time(ms)   
WRITE        1377.91         1444.84         21.67                12.9667             
READ         1131.47         1186.44         26.5067              18.1567             
MIX_WRITE    555.8           582.804         25.1833              17.31               
MIX_READ     553.6           580.493         28.79                20.2333             
MIX_SUM      1109.4          1163.3          26.9867              18.7717             

----------------------------------------------------------------------------------- 
w5-QA_30workers_10240K_10M_Size_file_mix, cost_time:1H:13M:25S                    
             IOPS            BW(MB/s)        avg_res_time(ms)     avg_proc_time(ms)   
WRITE        204.93          2148.8          146.457              90.3733             
READ         264.15          2769.83         113.58               60.35               
MIX_WRITE    108.17          1134.28         155.517              107.767             
MIX_READ     108.23          1134.85         121.68               70.4                
MIX_SUM      216.4           2269.13         138.598              89.0833             

----------------------------------------------------------------------------------- 
w6-QA_30workers_1048576K_1G_Size_file_mix, cost_time:1H:0M:43S                     
             IOPS            BW(MB/s)        avg_res_time(ms)     avg_proc_time(ms)   
WRITE        3.02            3242.78         9933.77              595.353             
READ         5.64            6063.25         5313.1               173.7               
MIX_WRITE    1.97            2113.94         10108.3              656.83              
MIX_READ     1.98            2128.27         5094.47              188.393             
MIX_SUM      3.95            4242.21         7601.37              422.612             

----------------------------------------------------------------------------------- 
w7-QA_60workers_4K_30M_files_mix, cost_time:5H:46M:56S                    
             IOPS            BW(MB/s)        avg_res_time(ms)     avg_proc_time(ms)   
WRITE        7500.32         30.7213         7.86333              7.86                
READ         6762.72         27.7001         8.86667              8.81333             
MIX_WRITE    2714.85         11.12           13.1667              13.1667             
MIX_READ     2714.38         11.1181         8.8                  8.74667             
MIX_SUM      5429.23         22.2381         10.9833              10.9567             

----------------------------------------------------------------------------------- 
w8-QA_60workers_100K_30M_files_mix, cost_time:6H:5M:42S                     
             IOPS            BW(MB/s)        avg_res_time(ms)     avg_proc_time(ms)   
WRITE        5878.1          601.918         10.07                8.96                
READ         5407.74         553.752         11.0867              10.19               
MIX_WRITE    2345.29         240.157         14.3533              13.25               
MIX_READ     2342.65         239.887         11.1033              10.17               
MIX_SUM      4687.94         480.044         12.7283              11.71               

----------------------------------------------------------------------------------- 
w9-QA_60workers_200K_30M_files_mix, cost_time:6H:35M:58S                    
             IOPS            BW(MB/s)        avg_res_time(ms)     avg_proc_time(ms)   
WRITE        4841.97         991.636         12.2533              10.0967             
READ         3732.87         764.49          16.0667              14.4033             
MIX_WRITE    1911.44         391.463         15.9167              13.9                
MIX_READ     1910.73         391.317         15.3533              13.6167             
MIX_SUM      3822.17         782.78          15.635               13.7583             

----------------------------------------------------------------------------------- 
w10-QA_60workers_1024K_1M_Size_file_mix, cost_time:1H:32M:31S                    
             IOPS            BW(MB/s)        avg_res_time(ms)     avg_proc_time(ms)   
WRITE        2286.75         2397.82         26.1367              17.3733             
READ         2057.05         2156.98         29.1633              21.0633             
MIX_WRITE    970.74          1017.9          28.4233              20.61               
MIX_READ     971.96          1019.17         33.2367              25.2167             
MIX_SUM      1942.7          2037.07         30.83                22.9133             

----------------------------------------------------------------------------------- 
w11-QA_60workers_10240K_10M_Size_file_mix, cost_time:1H:2M:21S                     
             IOPS            BW(MB/s)        avg_res_time(ms)     avg_proc_time(ms)   
WRITE        351.36          3684.35         170.743              112.857             
READ         463.98          4865.07         129.313              74.13               
MIX_WRITE    181.99          1908.39         185.35               133.583             
MIX_READ     181.88          1907.17         144.337              89.06               
MIX_SUM      363.87          3815.56         164.843              111.322             

----------------------------------------------------------------------------------- 
w12-QA_60workers_1048576K_1G_Size_file_mix, cost_time:0H:54M:29S                    
             IOPS            BW(MB/s)        avg_res_time(ms)     avg_proc_time(ms)   
WRITE        4.88            5244.88         12283.6              796.11              
READ         8.17            8773.49         7343.07              289.537             
MIX_WRITE    3.08            3309.76         12663.9              908.077             
MIX_READ     3.07            3298.88         6822.43              307.493             
MIX_SUM      6.15            6608.64         9743.18              607.785             

----------------------------------------------------------------------------------- 
w13-QA_90workers_4K_30M_files_mix, cost_time:5H:43M:51S                    
             IOPS            BW(MB/s)        avg_res_time(ms)     avg_proc_time(ms)   
WRITE        8321.29         34.084          10.6733              10.6733             
READ         9075.99         37.1753         9.90667              9.85333             
MIX_WRITE    3224.43         13.2073         18.1733              18.1733             
MIX_READ     3223.7          13.2043         9.60667              9.55333             
MIX_SUM      6448.13         26.4116         13.89                13.8633             

----------------------------------------------------------------------------------- 
w14-QA_90workers_100K_30M_files_mix, cost_time:5H:50M:24S                    
             IOPS            BW(MB/s)        avg_res_time(ms)     avg_proc_time(ms)   
WRITE        6638.6          679.793         13.4167              12.3433             
READ         7174.2          734.637         12.5367              11.6167             
MIX_WRITE    2848.65         291.702         19.08                17.94               
MIX_READ     2847.38         291.571         12.3867              11.43               
MIX_SUM      5696.03         583.273         15.7333              14.685              

----------------------------------------------------------------------------------- 
w15-QA_90workers_200K_30M_files_mix, cost_time:6H:27M:17S                    
             IOPS            BW(MB/s)        avg_res_time(ms)     avg_proc_time(ms)   
WRITE        5517.32         1129.95         16.1767              14.0433             
READ         4825.51         988.266         18.6433              16.97               
MIX_WRITE    2412.23         494.026         20.0233              17.95               
MIX_READ     2410.53         493.676         17.1667              15.38               
MIX_SUM      4822.76         987.702         18.595               16.665              

----------------------------------------------------------------------------------- 
w16-QA_90workers_1024K_1M_Size_file_mix, cost_time:1H:28M:31S                    
             IOPS            BW(MB/s)        avg_res_time(ms)     avg_proc_time(ms)   
WRITE        2749.42         2882.99         32.6367              24.3267             
READ         2716.61         2848.58         33.1233              25.18               
MIX_WRITE    1261.77         1323.06         33.17                25.36               
MIX_READ     1260.83         1322.08         38.08                30.1033             
MIX_SUM      2522.6          2645.14         35.625               27.7317             

----------------------------------------------------------------------------------- 
w17-QA_90workers_10240K_10M_Size_file_mix, cost_time:0H:59M:48S                    
             IOPS            BW(MB/s)        avg_res_time(ms)     avg_proc_time(ms)   
WRITE        441.86          4633.24         203.613              146.33              
READ         618.08          6481.08         145.607              88.1033             
MIX_WRITE    229.29          2404.25         226.43               173.55              
MIX_READ     228.46          2395.61         166.75               109.23              
MIX_SUM      457.75          4799.86         196.59               141.39              

----------------------------------------------------------------------------------- 
w18-QA_90workers_1048576K_1G_Size_file_mix, cost_time:0H:52M:54S                    
             IOPS            BW(MB/s)        avg_res_time(ms)     avg_proc_time(ms)   
WRITE        5.79            6215.07         15550.1              1077.36             
READ         8.92            9568.5          10100.1              395.867             
MIX_WRITE    3.57            3834.26         16124.7              1270.8              
MIX_READ     3.54            3798.35         9215.03              424.67              
MIX_SUM      7.11            7632.61         12669.9              847.737             

----------------------------------------------------------------------------------- 
w19-QA_120workers_4K_30M_files_mix, cost_time:5H:39M:31S                    
             IOPS            BW(MB/s)        avg_res_time(ms)     avg_proc_time(ms)   
WRITE        8870.99         36.3356         13.39                13.39               
READ         10861.7         44.4896         11.04                10.99               
MIX_WRITE    3566.18         14.6071         23.3                 23.3                
MIX_READ     3564            14.5982         10.22                10.16               
MIX_SUM      7130.18         29.2053         16.76                16.73               

----------------------------------------------------------------------------------- 
w20-QA_120workers_100K_30M_files_mix, cost_time:5H:49M:25S                    
             IOPS            BW(MB/s)        avg_res_time(ms)     avg_proc_time(ms)   
WRITE        7035.11         720.395         16.9133              15.81               
READ         8539.16         874.411         14.0433              13.1233             
MIX_WRITE    3174.51         325.07          24.3433              23.2233             
MIX_READ     3175.41         325.162         13.32                12.3567             
MIX_SUM      6349.92         650.232         18.8317              17.79               

----------------------------------------------------------------------------------- 
w21-QA_120workers_200K_30M_files_mix, cost_time:6H:20M:43S                    
             IOPS            BW(MB/s)        avg_res_time(ms)     avg_proc_time(ms)   
WRITE        5936.71         1215.84         20.0867              18.08               
READ         5625.23         1152.05         21.3233              19.6533             
MIX_WRITE    2737.41         560.621         25.1433              23.0967             
MIX_READ     2732.54         559.625         18.5967              16.7933             
MIX_SUM      5469.95         1120.25         21.87                19.945              

----------------------------------------------------------------------------------- 
w22-QA_120workers_1024K_1M_Size_file_mix, cost_time:1H:26M:48S                    
             IOPS            BW(MB/s)        avg_res_time(ms)     avg_proc_time(ms)   
WRITE        3042.73         3190.53         39.3433              31.2733             
READ         3240.65         3398.06         37.02                29.3                
MIX_WRITE    1461.43         1532.42         39.86                32.18               
MIX_READ     1459.29         1530.18         42.2033              34.4067             
MIX_SUM      2920.72         3062.6          41.0317              33.2933             

----------------------------------------------------------------------------------- 
w23-QA_120workers_10240K_10M_Size_file_mix, cost_time:0H:58M:43S                    
             IOPS            BW(MB/s)        avg_res_time(ms)     avg_proc_time(ms)   
WRITE        485.49          5090.78         247.103              191.573             
READ         721.01          7560.35         166.423              106.4               
MIX_WRITE    258.56          2711.11         274.45               220.973             
MIX_READ     259.18          2717.8          189.177              129.63              
MIX_SUM      517.74          5428.91         231.813              175.302             

----------------------------------------------------------------------------------- 
w24-QA_120workers_1048576K_1G_Size_file_mix, cost_time:0H:52M:30S                    
             IOPS            BW(MB/s)        avg_res_time(ms)     avg_proc_time(ms)   
WRITE        6.16            6618.53         19470.7              1419.07             
READ         9.43            10130.3         12720.5              486.747             
MIX_WRITE    3.65            3928.62         20438.5              1707.93             
MIX_READ     3.8             4079.41         11920.9              535.357             
MIX_SUM      7.45            8008.03         16179.7              1121.64             

[WARN]  Task : (w25-1200million_4k_data_filling) status is not finished, but : (terminated), please pay more attention 


[WARN]  Task : (w26-1200million_4k_data_filling) status is not finished, but : (terminated), please pay more attention 


[WARN]  Task : (w27-120million_4k_data_filling) status is not finished, but : (terminated), please pay more attention 


[WARN]  Task : (w28-120million_4k_data_filling) status is not finished, but : (cancelled), please pay more attention 


Task: (w29-120million_4k_data_filling), write total objects: (120000000), cost time: (14195(s)), write speed: (8453.68) 


[WARN]  Task : (w30-QA_120workers_4K_30M_files_mix) status is not finished, but : (cancelled), please pay more attention 


----------------------------------------------------------------------------------- 
w31-QA_120workers_4K_30M_files_mix, cost_time:6H:3M:26S                     
             IOPS            BW(MB/s)        avg_res_time(ms)     avg_proc_time(ms)   
WRITE        5388.65         22.0719         22.1933              22.1933             
READ         11093.4         45.4386         10.81                10.76               
MIX_WRITE    3714.16         15.2132         22.7667              22.7667             
MIX_READ     3711.56         15.2025         9.40333              9.35                
MIX_SUM      7425.72         30.4157         16.085               16.0583             

----------------------------------------------------------------------------------- 
w32-QA_120workers_100K_30M_files_mix, cost_time:5H:27M:24S                    
             IOPS            BW(MB/s)        avg_res_time(ms)     avg_proc_time(ms)   
WRITE        7803.41         799.069         15.2333              14.1267             
READ         8556.41         876.177         14.0167              13.1067             
MIX_WRITE    3406.95         348.871         22.28                21.1367             
MIX_READ     3406.42         348.817         12.8033              11.8367             
MIX_SUM      6813.37         697.688         17.5417              16.4867             

----------------------------------------------------------------------------------- 
w33-QA_120workers_200K_30M_files_mix, cost_time:5H:54M:16S                    
             IOPS            BW(MB/s)        avg_res_time(ms)     avg_proc_time(ms)   
WRITE        6372.15         1305.02         18.6967              16.5867             
READ         5594.51         1145.76         21.4433              19.7367             
MIX_WRITE    2853.54         584.404         23.5533              21.4633             
MIX_READ     2849.95         583.669         18.3933              16.5333             
MIX_SUM      5703.49         1168.07         20.9733              18.9983             

----------------------------------------------------------------------------------- 
w34-QA_120workers_1024K_1M_Size_file_mix, cost_time:1H:20M:49S                    
             IOPS            BW(MB/s)        avg_res_time(ms)     avg_proc_time(ms)   
WRITE        3349.24         3511.92         35.7333              27.55               
READ         3228.21         3385.03         37.1633              29.3633             
MIX_WRITE    1532.84         1607.3          34.9367              27.1433             
MIX_READ     1537.16         1611.83         43.1167              35.1867             
MIX_SUM      3070            3219.13         39.0267              31.165              

----------------------------------------------------------------------------------- 
w35-QA_120workers_10240K_10M_Size_file_mix, cost_time:0H:55M:8S                     
             IOPS            BW(MB/s)        avg_res_time(ms)     avg_proc_time(ms)   
WRITE        537.52          5636.43         223.167              164.657             
READ         738.94          7748.37         162.39               102.293             
MIX_WRITE    251.73          2639.46         276.8                221.483             
MIX_READ     252.38          2646.39         199.35               138.473             
MIX_SUM      504.11          5285.85         238.075              179.978             

----------------------------------------------------------------------------------- 
w36-QA_120workers_1048576K_1G_Size_file_mix, cost_time:0H:50M:14S                    
             IOPS            BW(MB/s)        avg_res_time(ms)     avg_proc_time(ms)   
WRITE        6.91            7414.56         17379.5              1282.79             
READ         9.36            10045           12829.2              436.01              
MIX_WRITE    3.79            4072.14         19156.8              1636.76             
MIX_READ     3.92            4208.96         12083.9              543.213             
MIX_SUM      7.71            8281.1          15620.4              1089.99             

Task: (w37-120million_4k_data_filling), write total objects: (120000000), cost time: (13965(s)), write speed: (8592.91) 


----------------------------------------------------------------------------------- 
w40-QA_DRY_RUN_30workers_4K_30M_files_mix, cost_time:0H:2M:9S                      
             IOPS            BW(MB/s)        avg_res_time(ms)     avg_proc_time(ms)   
WRITE        4098.54         16.7876         6.97333              6.97333             
READ         10856.8         44.4696         2.75667              2.69667             
MIX_WRITE    2143.91         8.78142         7.10667              7.10667             
MIX_READ     5025.76         20.5855         2.87333              2.82                
MIX_SUM      7169.67         29.3669         4.99                 4.96333             

----------------------------------------------------------------------------------- 
w41-QA_DRY_RUN_30workers_100K_30M_files_mix, cost_time:0H:2M:12S                     
             IOPS            BW(MB/s)        avg_res_time(ms)     avg_proc_time(ms)   
WRITE        4688.9          480.144         6.24667              5.12333             
READ         8137.48         833.279         3.68                 2.85333             
MIX_WRITE    1670.89         171.099         8.70667              7.66                
MIX_READ     3881.14         397.428         3.91667              3.04667             
MIX_SUM      5552.03         568.527         6.31167              5.35333             

----------------------------------------------------------------------------------- 
w43-QA_DRY_RUN_30workers_4K_30M_files_mix, cost_time:0H:2M:12S                     
             IOPS            BW(MB/s)        avg_res_time(ms)     avg_proc_time(ms)   
WRITE        6433.48         26.3515         4.53                 4.53                
READ         11056.4         45.2869         2.70667              2.65333             
MIX_WRITE    2145.06         8.78618         7.1                  7.1                 
MIX_READ     5018.76         20.5568         2.88                 2.82667             
MIX_SUM      7163.82         29.343          4.99                 4.96333             

----------------------------------------------------------------------------------- 
w48-QA_DRY_RUN_30workers_4K_30M_files_mix, cost_time:0H:2M:16S                     
             IOPS            BW(MB/s)        avg_res_time(ms)     avg_proc_time(ms)   
WRITE        6500.63         26.6266         4.47333              4.47333             
READ         11065           45.3222         2.70333              2.65333             
MIX_WRITE    2131.74         8.73162         7.17333              7.17333             
MIX_READ     4972.22         20.3662         2.89                 2.83333             
MIX_SUM      7103.96         29.0978         5.03167              5.00333             

----------------------------------------------------------------------------------- 
w49-QA_DRY_RUN_30workers_4K_30M_files_mix, cost_time:0H:2M:14S                     
             IOPS            BW(MB/s)        avg_res_time(ms)     avg_proc_time(ms)   
WRITE        6492.76         26.5944         4.48                 4.48                
READ         11006.1         45.0812         2.71333              2.66                
MIX_WRITE    2126.64         8.71073         7.17333              7.17333             
MIX_READ     4988.68         20.4336         2.89                 2.83333             
MIX_SUM      7115.32         29.1443         5.03167              5.00333             

----------------------------------------------------------------------------------- 
w50-QA_DRY_RUN_30workers_100K_30M_files_mix, cost_time:0H:2M:17S                     
             IOPS            BW(MB/s)        avg_res_time(ms)     avg_proc_time(ms)   
WRITE        4912.96         503.087         5.97                 4.88333             
READ         8085.7          827.976         3.70333              2.89                
MIX_WRITE    1668.04         170.808         8.7                  7.65333             
MIX_READ     3904.94         399.866         3.90333              3.03                
MIX_SUM      5572.98         570.674         6.30167              5.34167             

----------------------------------------------------------------------------------- 
w51-QA_DRY_RUN_30workers_200K_30M_files_mix, cost_time:0H:2M:19S                     
             IOPS            BW(MB/s)        avg_res_time(ms)     avg_proc_time(ms)   
WRITE        3957.27         810.449         7.45333              5.58667             
READ         6894.38         1411.97         4.34333              2.94667             
MIX_WRITE    1386.41         283.936         10.4267              8.61                
MIX_READ     3239.48         663.446         4.74                 3.18                
MIX_SUM      4625.89         947.382         7.58333              5.895               

----------------------------------------------------------------------------------- 
w52-QA_DRY_RUN_30workers_1024K_30M_files_mix, cost_time:0H:2M:18S                     
             IOPS            BW(MB/s)        avg_res_time(ms)     avg_proc_time(ms)   
WRITE        1434.56         1504.25         20.8067              12.1233             
READ         2703.91         2835.25         11.0867              4.41                
MIX_WRITE    601.08          630.281         22.06                14.8167             
MIX_READ     1412.91         1481.54         11.8                 4.75667             
MIX_SUM      2013.99         2111.82         16.93                9.78667             

----------------------------------------------------------------------------------- 
w53-QA_DRY_RUN_30workers_10240K_30M_files_mix, cost_time:0H:2M:33S                     
             IOPS            BW(MB/s)        avg_res_time(ms)     avg_proc_time(ms)   
WRITE        198.32          2079.51         151.25               87.06               
READ         335.44          3517.29         89.4633              27.0367             
MIX_WRITE    89.43           937.714         145.71               96.7367             
MIX_READ     218.16          2287.54         77.7433              25.52               
MIX_SUM      307.59          3225.25         111.727              61.1283             

----------------------------------------------------------------------------------- 
w54-QA_DRY_RUN_30workers_4K_30M_files_mix, cost_time:0H:2M:17S                     
             IOPS            BW(MB/s)        avg_res_time(ms)     avg_proc_time(ms)   
WRITE        6181.75         25.3205         4.71                 4.71                
READ         11059.2         45.2983         2.70667              2.65667             
MIX_WRITE    2117.66         8.67393         7.29333              7.29333             
MIX_READ     4926.28         20.178          2.88                 2.83333             
MIX_SUM      7043.94         28.8519         5.08667              5.06333             

----------------------------------------------------------------------------------- 
w55-QA_DRY_RUN_30workers_100K_30M_files_mix, cost_time:0H:2M:19S                     
             IOPS            BW(MB/s)        avg_res_time(ms)     avg_proc_time(ms)   
WRITE        4950.13         506.893         5.92333              4.83                
READ         8129.49         832.46          3.68333              2.85333             
MIX_WRITE    1650.2          168.981         8.92                 7.87                
MIX_READ     3839.86         393.201         3.92                 3.04                
MIX_SUM      5490.06         562.182         6.42                 5.455               

----------------------------------------------------------------------------------- 
w56-QA_DRY_RUN_30workers_200K_30M_files_mix, cost_time:0H:2M:20S                     
             IOPS            BW(MB/s)        avg_res_time(ms)     avg_proc_time(ms)   
WRITE        4048.56         829.145         7.28                 5.38667             
READ         6835.65         1399.94         4.38333              2.95                
MIX_WRITE    1395.3          285.759         10.3233              8.49333             
MIX_READ     3263.39         668.343         4.72333              3.15333             
MIX_SUM      4658.69         954.102         7.52333              5.82333             

----------------------------------------------------------------------------------- 
w57-QA_DRY_RUN_30workers_1024K_30M_files_mix, cost_time:0H:2M:21S                     
             IOPS            BW(MB/s)        avg_res_time(ms)     avg_proc_time(ms)   
WRITE        1470.29         1541.7          20.3033              11.7467             
READ         2693.39         2824.22         11.1367              4.42333             
MIX_WRITE    602.11          631.362         22.18                14.8933             
MIX_READ     1401.31         1469.38         11.8333              4.77667             
MIX_SUM      2003.42         2100.74         17.0067              9.835               

----------------------------------------------------------------------------------- 
w58-QA_DRY_RUN_30workers_10240K_30M_files_mix, cost_time:0H:2M:35S                     
             IOPS            BW(MB/s)        avg_res_time(ms)     avg_proc_time(ms)   
WRITE        200.65          2103.96         149.527              85.38               
READ         339.92          3564.32         88.26                27.0233             
MIX_WRITE    92.2            966.762         146.957              96.5833             
MIX_READ     208.41          2185.4          78.9067              25.44               
MIX_SUM      300.61          3152.16         112.932              61.0117             
root@node243:~/cosbench# 

&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;</content><author><name>Gavin</name></author><category term="Cosbench" /><summary type="html">概述</summary></entry><entry><title type="html">Delay the first auto start VM in PVE</title><link href="http://172.17.73.80:4000/2021/12/13/PVE_VM_delay_boot/" rel="alternate" type="text/html" title="Delay the first auto start VM in PVE" /><published>2021-12-13T00:00:00+08:00</published><updated>2021-12-13T00:00:00+08:00</updated><id>http://172.17.73.80:4000/2021/12/13/PVE_VM_delay_boot</id><content type="html" xml:base="http://172.17.73.80:4000/2021/12/13/PVE_VM_delay_boot/">&lt;h1 id=&quot;概述&quot;&gt;概述&lt;/h1&gt;

&lt;p&gt;一直以来，认为PVE提供的“延时启动”是针对宿主机完成启动后的XX设定的时间后VM自动启动，直到看到如下链接的内容中：
https://dannyda.com/2020/06/24/how-to-delay-the-first-auto-start-virtual-machinevm-guest-system-in-proxmox-ve-pve/&lt;/p&gt;

&lt;p&gt;明确说明PVE VM boot delay并不是我们所想的：宿主机启动后XX秒再启动VM，而是：定义此VM启动与后续VM启动之间的间隔。说明第一台VM启动，依然存在失败问题（存储尚未ready，VM开始启动）。&lt;/p&gt;

&lt;h1 id=&quot;ui-设定的延时启动&quot;&gt;UI 设定的“延时启动”&lt;/h1&gt;

&lt;p&gt;UI展示VM开机自启动，这里的设置来自qm指令&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;root@node165:/etc/systemd/system/multi-user.target.wants# qm list
      VMID NAME                 STATUS     MEM(MB)    BOOTDISK(GB) PID       
       100 Scaler186            stopped    4096              32.00 0         
       101 scaler182            stopped    131072            64.00 0         
       103 Scaler103            running    131072            64.00 65598     
       106 Scaler106            running    131072            64.00 266948    
root@node165:/etc/systemd/system/multi-user.target.wants# qm set 106 -startup up=300
update VM 106: -startup up=300

root@node165:/etc/systemd/system/multi-user.target.wants#
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;做了上面的变更后，UI对应VM里的启动试验也跟着变（只是证明一下UI上的设定，来自指令qm set vmid -startup up=xx）。&lt;/p&gt;

&lt;h1 id=&quot;如何正确设置vm的启动时延&quot;&gt;如何正确设置VM的启动时延？&lt;/h1&gt;

&lt;h2 id=&quot;方法1使用-startall-onboot-delay-设置&quot;&gt;方法1：使用 –startall-onboot-delay 设置&lt;/h2&gt;

&lt;p&gt;指令参考如下：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;pvenode config set --startall-onboot-delay XXX

--startall-onboot-delay &amp;lt;integer&amp;gt; (0 - 300) ( default = 0 ) Initial delay in seconds, before starting all the Virtual Guests with on-boot enabled.
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;这个参数的设定，上限是300秒，如果想调整成更大的数值，可以修改如下文件(示例设置为400秒):&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;root@node165:/etc/pve# grep -nri 400
nodes/node165/config:1:startall-onboot-delay: 400
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;方法2修改-pve-guestsservice-pve-guests增加sleep&quot;&gt;方法2：修改 pve-guests.service pve-guests，增加sleep&lt;/h2&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;cat /etc/systemd/system/multi-user.target.wants/pve-guests.service pve-guests
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;会看到如下部分的内容（有省略）：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;[Service]
Environment=&quot;PVE_LOG_ID=pve-guests&quot;
ExecStartPre=-/usr/share/pve-manager/helpers/pve-startall-delay
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;在如上内容中，增加如下内容（注意两个ExecStartPre的顺序）：&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;[Service]
Environment=&quot;PVE_LOG_ID=pve-guests&quot;
ExecStartPre=/bin/sleep 400
ExecStartPre=-/usr/share/pve-manager/helpers/pve-startall-delay
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;</content><author><name>Gavin</name></author><category term="PVE" /><category term="proxmox ve" /><summary type="html">概述</summary></entry><entry><title type="html">CentOS中cp -f copy强制覆盖命令无效</title><link href="http://172.17.73.80:4000/2021/07/01/Slove_cp_command_force_overwrite_issue/" rel="alternate" type="text/html" title="CentOS中cp -f copy强制覆盖命令无效" /><published>2021-07-01T00:00:00+08:00</published><updated>2021-07-01T00:00:00+08:00</updated><id>http://172.17.73.80:4000/2021/07/01/Slove_cp_command_force_overwrite_issue</id><content type="html" xml:base="http://172.17.73.80:4000/2021/07/01/Slove_cp_command_force_overwrite_issue/">&lt;h1 id=&quot;概述&quot;&gt;概述&lt;/h1&gt;

&lt;p&gt;今天分几次执行了automation用例，产生不不用的allure需要的json文件，由于部分case执行失败，再次执行了这部分用例，对新产生的json文件覆盖掉旧的，
结果在cp时提示是否要overwrite，由于文件数量很多，不可能每个交互信息都要输入y来确认覆盖，于是就要靠强制覆盖来解决，执行cp -rf时并没有起到预期效果。&lt;/p&gt;

&lt;p&gt;本文记录解决Linux CentOS中cp -f 复制强制覆盖的命令无效的方法。&lt;/p&gt;

&lt;h1 id=&quot;环境&quot;&gt;环境&lt;/h1&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;[root@node179 ~]# cat /etc/redhat-release 
Red Hat Enterprise Linux Server release 7.2 (Maipo)
[root@node179 ~]# 
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h1 id=&quot;现象&quot;&gt;现象&lt;/h1&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;[root@node179 06_30]# cp -i json/* /root/pytest_framework/report/json/
cp: overwrite ‘/root/pytest_framework/report/json/0002c684-9976-416e-8149-ed85c5e38aa8-container.json’? y
cp: overwrite ‘/root/pytest_framework/report/json/001824e6-1cde-4d7d-ae45-02acf4f2d33f-container.json’? y
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;换 -rf，效果一样&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;[root@node179 06_30]# cp -rf json/* /root/pytest_framework/report/json/
cp: overwrite ‘/root/pytest_framework/report/json/0002c684-9976-416e-8149-ed85c5e38aa8-container.json’? y
cp: overwrite ‘/root/pytest_framework/report/json/001824e6-1cde-4d7d-ae45-02acf4f2d33f-container.json’? y
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h1 id=&quot;处理过程&quot;&gt;处理过程&lt;/h1&gt;

&lt;p&gt;网上搜索了一下，看到这么个解释： Linux下默认cp命令是有别名的(alias cp=’cp -i’)，无法在复制时强制覆盖，即使你用 -f 参数也无法强制覆盖文件&lt;/p&gt;

&lt;p&gt;在CentOS里执行alias，信息如下:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;[root@node179 ~]# alias
alias cp='cp -i'
alias egrep='egrep --color=auto'
alias fgrep='fgrep --color=auto'
alias grep='grep --color=auto'
alias l.='ls -d .* --color=auto'
alias ll='ls -l --color=auto'
alias ls='ls --color=auto'
alias mv='mv -i'
alias rm='rm -i'
alias vi='vim'
alias which='alias | /usr/bin/which --tty-only --read-alias --show-dot --show-tilde'
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;果然，cp是被alias过了。&lt;/p&gt;

&lt;h1 id=&quot;推荐的解决方法&quot;&gt;推荐的解决方法&lt;/h1&gt;

&lt;p&gt;下面提供几个从网上找的Linux下cp命令覆盖的方法。&lt;/p&gt;

&lt;p&gt;1)取消cp的alias（放心这不是永久生效）：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;# unalias cp
# cp -rf /test/test_other
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;2)加反斜杠 \cp 执行cp命令时不走alias：（注：推荐这个方法！）&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;# \cp -rf /test/test_other
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;3）另外一个有意思的方法：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;# yes|cp -rf /test/test_other
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;</content><author><name>Gavin</name></author><category term="Linux" /><summary type="html">概述</summary></entry><entry><title type="html">如何知道CPU降频了呢</title><link href="http://172.17.73.80:4000/2021/06/30/How_do_I_know_that_the_CPU_frequency_is_down/" rel="alternate" type="text/html" title="如何知道CPU降频了呢" /><published>2021-06-30T00:00:00+08:00</published><updated>2021-06-30T00:00:00+08:00</updated><id>http://172.17.73.80:4000/2021/06/30/How_do_I_know_that_the_CPU_frequency_is_down</id><content type="html" xml:base="http://172.17.73.80:4000/2021/06/30/How_do_I_know_that_the_CPU_frequency_is_down/">&lt;h1 id=&quot;概述&quot;&gt;概述&lt;/h1&gt;

&lt;p&gt;最近碰到过几次服务器出现CPU降频的问题，其中两次是硬件BIOS固件的bug，不小心踩到了（概率很低，但有幸被我碰到，巨坑），后来从硬件厂商那获取到了高阶版本，刷了高阶版本的固件解决掉了；&lt;/p&gt;

&lt;p&gt;还有一次是设备两路电源线被同事拔掉了一根，只剩下一路了，供电不足，导致CPU主动降频；&lt;/p&gt;

&lt;p&gt;今天RD在tuning performance时，再次碰到了CPU降频问题，问题是tuning performance过程中ganesha 跑到 1000 多 %，很凶，造成服务器机体温度升高，整个Lab平均温度达到31度，增加空调紧急降温后恢复正常。&lt;/p&gt;

&lt;p&gt;由于碰到过多次，本文汇总下如何判断CPU发生了降频，避免忘记（其实今天没看出来哪里降频了，所以才写了此文XD）。&lt;/p&gt;

&lt;h1 id=&quot;查看cpu降频的方法&quot;&gt;查看CPU降频的方法&lt;/h1&gt;

&lt;h2 id=&quot;lscpu&quot;&gt;lscpu&lt;/h2&gt;

&lt;p&gt;&lt;img class=&quot;shadow&quot; src=&quot;/img/in-post/lscpu.png&quot; width=&quot;1200&quot; /&gt;&lt;/p&gt;

&lt;p&gt;如上图所示：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;CPU MHz:               2579.700
CPU max MHz:           3000.0000
CPU min MHz:           800.0000
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;这里有CPU当前HZ（CPU MHz）信息和min MHz（CPU min MHz），如果CPU MHz的值是小于CPU min MHz的值，说明CPU被降频了。&lt;/p&gt;

&lt;h2 id=&quot;atop中查看cruf&quot;&gt;atop中查看cruf&lt;/h2&gt;

&lt;p&gt;借助atop命令（公司产品有安装），查看CPU的curf（ARM平台，华为鲲鹏服务器，这里的值为’？’，不知道为什么【需要打流量？？】，X86是OK的）&lt;/p&gt;

&lt;p&gt;&lt;img class=&quot;shadow&quot; src=&quot;/img/in-post/atop_cruf.png&quot; width=&quot;1200&quot; /&gt;&lt;/p&gt;

&lt;p&gt;如果curf（current frequency）只有几十MHz(正常情况下是XGHz)，CPU铁定是被降频了，此时观察atop中众多process，几乎清一色的只消耗1%的process&lt;/p&gt;

&lt;h1 id=&quot;总结&quot;&gt;总结&lt;/h1&gt;

&lt;p&gt;CPU降频的原因，目前碰到的：&lt;/p&gt;

&lt;p&gt;（1）硬件设备温度过高&lt;/p&gt;

&lt;p&gt;（2）BIOS固件的bug&lt;/p&gt;

&lt;p&gt;（3）供电不足&lt;/p&gt;</content><author><name>Gavin</name></author><category term="Linux" /><summary type="html">概述</summary></entry><entry><title type="html">WebBIOS里取消磁盘的JBOD设置</title><link href="http://172.17.73.80:4000/2021/06/15/WebBIOS_disable_disk_JBOD/" rel="alternate" type="text/html" title="WebBIOS里取消磁盘的JBOD设置" /><published>2021-06-15T00:00:00+08:00</published><updated>2021-06-15T00:00:00+08:00</updated><id>http://172.17.73.80:4000/2021/06/15/WebBIOS_disable_disk_JBOD</id><content type="html" xml:base="http://172.17.73.80:4000/2021/06/15/WebBIOS_disable_disk_JBOD/">&lt;h1 id=&quot;概述&quot;&gt;概述&lt;/h1&gt;

&lt;p&gt;环境之前有使用过storcli或megacli命令开启了JBOD模式，安装系统后始终无法进入系统，grub 引导出问题，BIOS的设置检查了几次，并未发现异常，boot device也是对的，始终无法解决重灌系统后开机问题。
决定更换OS盘（换成其他的SAS盘），在更换后，碰到了本文要描述的问题：存在部分是RAID部分是JBOD盘，计划OS盘做RAID0,但WebBIOS里查看到此盘无法最RAID。&lt;/p&gt;

&lt;p&gt;本文记录如何在WebBIOS取消JBOD模式，仅附图片mark下，避免忘记。&lt;/p&gt;

&lt;h1 id=&quot;处理过程&quot;&gt;处理过程&lt;/h1&gt;

&lt;h2 id=&quot;最初盘的状况&quot;&gt;最初盘的状况&lt;/h2&gt;

&lt;p&gt;&lt;img class=&quot;shadow&quot; src=&quot;/img/in-post/disk_mix_mode.png&quot; width=&quot;1200&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;取消jbod&quot;&gt;取消JBOD&lt;/h2&gt;

&lt;p&gt;开机启动进入WebBIOS，Controller Properties –&amp;gt; ALter+N + 回车，连续三次，进入’Manage JBOD’ 界面，选择对应的JBOD driver，点击’OK’完成取消JBOD mode的设置， 可以按住shift与向下的箭头按钮，多选磁盘的&lt;/p&gt;

&lt;p&gt;&lt;img class=&quot;shadow&quot; src=&quot;/img/in-post/disable_disks_jbod_mode.png&quot; width=&quot;1200&quot; /&gt;&lt;/p&gt;</content><author><name>Gavin</name></author><category term="Linux" /><summary type="html">概述</summary></entry><entry><title type="html">HDD损坏了么？</title><link href="http://172.17.73.80:4000/2021/06/03/is_my_hdd_wreched/" rel="alternate" type="text/html" title="HDD损坏了么？" /><published>2021-06-03T00:00:00+08:00</published><updated>2021-06-03T00:00:00+08:00</updated><id>http://172.17.73.80:4000/2021/06/03/is_my_hdd_wreched</id><content type="html" xml:base="http://172.17.73.80:4000/2021/06/03/is_my_hdd_wreched/">&lt;h1 id=&quot;概述&quot;&gt;概述&lt;/h1&gt;

&lt;p&gt;今天同事使用产品对HDD做分区的时候，发现程序抛异常，寻求帮助。&lt;/p&gt;

&lt;h1 id=&quot;过程&quot;&gt;过程&lt;/h1&gt;

&lt;p&gt;由于是一个新安装OS的环境，对现有的HDD除了操作系统之外都可以做格式化处理，尝试格式化一下，出现了如下错误：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;root@scaler:/home/btadmin# sgdisk -z /dev/sdb
GPT data structures destroyed! You may now partition the disk using fdisk or
other utilities.
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;上面是一个正常分区擦除分区信息的吐出信息，下面是一个异常的：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;root@scaler:/home/btadmin# sgdisk -z /dev/sdd
Warning! Read error 5; strange behavior now likely!
Warning! Read error 5; strange behavior now likely!
Creating new GPT entries.
Warning! GPT main header not overwritten! Error is 5
Warning: The kernel is still using the old partition table.
The new table will be used at the next reboot or after you
run partprobe(8) or kpartx(8)
GPT data structures destroyed! You may now partition the disk using fdisk or
other utilities.
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;尝试分区：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;root@scaler:~# gdisk /dev/sdd
GPT fdisk (gdisk) version 1.0.1

Warning! Read error 5; strange behavior now likely!
Warning! Read error 5; strange behavior now likely!
Partition table scan:
  MBR: not present
  BSD: not present
  APM: not present
  GPT: not present

Creating new GPT entries.

Command (? for help): p  
Disk /dev/sdd: 7811891200 sectors, 3.6 TiB
Logical sector size: 512 bytes
Disk identifier (GUID): 21979075-7523-49C5-A52B-E8055AE1625F
Partition table holds up to 128 entries
First usable sector is 34, last usable sector is 7811891166
Partitions will be aligned on 2048-sector boundaries
Total free space is 2014 sectors (1007.0 KiB)

Number  Start (sector)    End (sector)  Size       Code  Name
   1            2048      7811891166   3.6 TiB     8300  Linux filesystem

Command (? for help): e
b	back up GPT data to a file
c	change a partition's name
d	delete a partition
i	show detailed information on a partition
l	list known partition types
n	add a new partition
o	create a new empty GUID partition table (GPT)
p	print the partition table
q	quit without saving changes
r	recovery and transformation options (experts only)
s	sort partitions
t	change a partition's type code
v	verify disk
w	write table to disk and exit
x	extra functionality (experts only)
?	print this menu

Command (? for help): w

Final checks complete. About to write GPT data. THIS WILL OVERWRITE EXISTING
PARTITIONS!!

Do you want to proceed? (Y/N): y
OK; writing new GUID partition table (GPT) to /dev/sdd.
Unable to save backup partition table! Perhaps the 'e' option on the experts'
menu will resolve this problem.
Warning! An error was reported when writing the partition table! This error
MIGHT be harmless, or the disk might be damaged! Checking it is advisable.

Command (? for help): 
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;从上面可以明显看出sdd这个分区有异常，继续查看vd与pd信息：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;Virtual Drive: 3 (Target Id: 3)
Name                :
RAID Level          : Primary-0, Secondary-0, RAID Level Qualifier-0
Size                : 3.637 TB
Sector Size         : 512
Is VD emulated      : No
Parity Size         : 0
State               : Offline
Strip Size          : 64 KB
Number Of Drives    : 2
Span Depth          : 1
Default Cache Policy: WriteBack, ReadAheadNone, Direct, No Write Cache if Bad BBU
Current Cache Policy: WriteBack, ReadAheadNone, Direct, No Write Cache if Bad BBU
Default Access Policy: Read/Write
Current Access Policy: Read/Write
Disk Cache Policy   : Disabled
Encryption Type     : None
PI type: No PI

Is VD Cached: No
Number of Spans: 1
Span: 0 - Number of PDs: 2

PD: 0 Information
Enclosure Device ID: 8
Slot Number: 5
Drive's position: DiskGroup: 3, Span: 0, Arm: 0
Enclosure position: 1
Device Id: 15
WWN: 5000c5007995214d
Sequence Number: 2
Media Error Count: 0
Other Error Count: 0
Predictive Failure Count: 0
Last Predictive Failure Event Seq Number: 0
PD Type: SATA

Raw Size: 1.819 TB [0xe8e088b0 Sectors]
Non Coerced Size: 1.818 TB [0xe8d088b0 Sectors]
Coerced Size: 1.818 TB [0xe8d00000 Sectors]
Sector Size:  512
Logical Sector Size:  512
Physical Sector Size:  512
Firmware state: Online, Spun Up
Commissioned Spare : No
Emergency Spare : No
Device Firmware Level: SN03
Shield Counter: 0
Successful diagnostics completion on :  N/A
SAS Address(0): 0x50015b207898e72d
Connected Port Number: 0(path0) 
Inquiry Data:             Z1X3E91SST2000NM0033-9ZM175                     SN03    
FDE Capable: Not Capable
FDE Enable: Disable
Secured: Unsecured
Locked: Unlocked
Needs EKM Attention: No
Foreign State: None 
Device Speed: 6.0Gb/s 
Link Speed: 6.0Gb/s 
Media Type: Hard Disk Device
Drive:  Not Certified
Drive Temperature :39C (102.20 F)
PI Eligibility:  No 
Drive is formatted for PI information:  No
PI: No PI
Drive's NCQ setting : N/A
Port-0 :
Port status: Active
Port's Linkspeed: 6.0Gb/s 
Drive has flagged a S.M.A.R.T alert : No




PD: 1 Information
Enclosure Device ID: 8
Slot Number: 6
Drive's position: DiskGroup: 3, Span: 0, Arm: 1
Enclosure position: 1
Device Id: 14
WWN: 5000c500798ecb5a
Sequence Number: 3
Media Error Count: 0
Other Error Count: 0
Predictive Failure Count: 0
Last Predictive Failure Event Seq Number: 0
PD Type: SATA

Raw Size: 1.819 TB [0xe8e088b0 Sectors]
Non Coerced Size: 1.818 TB [0xe8d088b0 Sectors]
Coerced Size: 1.818 TB [0xe8d00000 Sectors]
Sector Size:  512
Logical Sector Size:  512
Physical Sector Size:  512
Firmware state: Failed
Commissioned Spare : Yes
Emergency Spare : Yes
Device Firmware Level: SN03
Shield Counter: 0
Successful diagnostics completion on :  N/A
SAS Address(0): 0x50015b207898e730
Connected Port Number: 0(path0) 
Inquiry Data:             Z1Y2CKNFST2000NM0033-9ZM175                     SN03    
FDE Capable: Not Capable
FDE Enable: Disable
Secured: Unsecured
Locked: Unlocked
Needs EKM Attention: No
Foreign State: None 
Device Speed: 6.0Gb/s 
Link Speed: 6.0Gb/s 
Media Type: Hard Disk Device
Drive:  Not Certified
Drive Temperature : N/A
PI Eligibility:  No 
Drive is formatted for PI information:  No
PI: No PI
Drive's NCQ setting : N/A
Port-0 :
Port status: Active
Port's Linkspeed: 6.0Gb/s 
Drive has flagged a S.M.A.R.T alert : No
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;这里显示VD 3 是Offline状态，且[8:6]这块盘Firmware state为Failed, 要再确认下，VD3对应的是哪个分区：&lt;/p&gt;

&lt;h2 id=&quot;step1-获取raid卡的vendor-id和device-id&quot;&gt;Step1. 获取RAID卡的Vendor Id和Device Id&lt;/h2&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;root@scaler:~# /opt/MegaRAID/MegaCli/MegaCli64 -adpallinfo -aall | grep -Ei 'Vendor Id|Device Id'
Vendor Id       : 1000
Device Id       : 005b
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;step2-获取vd的target-id&quot;&gt;Step2. 获取VD的Target Id&lt;/h2&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;root@scaler:~# /opt/MegaRAID/MegaCli/MegaCli64 -ldpdinfo  aall | grep 'Target Id'
Virtual Drive: 0 (Target Id: 0)
Virtual Drive: 1 (Target Id: 1)
Virtual Drive: 2 (Target Id: 2)
Virtual Drive: 3 (Target Id: 3)
Virtual Drive: 4 (Target Id: 4)
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;step3-获取设备前缀信息&quot;&gt;Step3. 获取设备前缀信息&lt;/h2&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;root@scaler:~# lspci -nd 1000:005b
02:00.0 0104: 1000:005b (rev 05)
root@scaler:~# 
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;这里的02:00.0，就是我们所需的设备前缀信息。&lt;/p&gt;

&lt;h2 id=&quot;step4-根据设备前缀信息以及target-id获取对应分区信息&quot;&gt;Step4. 根据设备前缀信息以及Target Id，获取对应分区信息&lt;/h2&gt;

&lt;p&gt;Linux 命令行操作如下：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;root@scaler:~# cd /dev/disk/by-path
root@scaler:/dev/disk/by-path# ls -l |grep 'pci-0000:02:00.0-scsi-0:2:2:0' | grep -v part | awk '{{print $NF}}' | awk -F'/' '{{print $NF}}' 
sdc
root@scaler:/dev/disk/by-path# ls -l
total 0
lrwxrwxrwx 1 root root  9 Jun  2 16:39 pci-0000:00:1f.2-ata-1 -&amp;gt; ../../sdf
lrwxrwxrwx 1 root root 10 Jun  2 16:39 pci-0000:00:1f.2-ata-1-part1 -&amp;gt; ../../sdf1
lrwxrwxrwx 1 root root 10 Jun  2 16:39 pci-0000:00:1f.2-ata-1-part2 -&amp;gt; ../../sdf2
lrwxrwxrwx 1 root root 10 Jun  2 16:39 pci-0000:00:1f.2-ata-1-part3 -&amp;gt; ../../sdf3
lrwxrwxrwx 1 root root 10 Jun  2 16:39 pci-0000:00:1f.2-ata-1-part4 -&amp;gt; ../../sdf4
lrwxrwxrwx 1 root root 10 Jun  2 16:39 pci-0000:00:1f.2-ata-1-part5 -&amp;gt; ../../sdf5
lrwxrwxrwx 1 root root  9 Jun  2 16:39 pci-0000:00:1f.2-ata-2 -&amp;gt; ../../sdg
lrwxrwxrwx 1 root root 10 Jun  2 16:39 pci-0000:00:1f.2-ata-2-part1 -&amp;gt; ../../sdg1
lrwxrwxrwx 1 root root 10 Jun  2 16:39 pci-0000:00:1f.2-ata-2-part2 -&amp;gt; ../../sdg2
lrwxrwxrwx 1 root root 10 Jun  2 16:39 pci-0000:00:1f.2-ata-2-part3 -&amp;gt; ../../sdg3
lrwxrwxrwx 1 root root 10 Jun  2 16:39 pci-0000:00:1f.2-ata-2-part4 -&amp;gt; ../../sdg4
lrwxrwxrwx 1 root root 10 Jun  2 16:39 pci-0000:00:1f.2-ata-2-part5 -&amp;gt; ../../sdg5
lrwxrwxrwx 1 root root  9 Jun  2 16:50 pci-0000:02:00.0-scsi-0:2:0:0 -&amp;gt; ../../sda
lrwxrwxrwx 1 root root 10 Jun  2 16:50 pci-0000:02:00.0-scsi-0:2:0:0-part1 -&amp;gt; ../../sda1
lrwxrwxrwx 1 root root  9 Jun  2 16:48 pci-0000:02:00.0-scsi-0:2:1:0 -&amp;gt; ../../sdb
lrwxrwxrwx 1 root root 10 Jun  2 16:50 pci-0000:02:00.0-scsi-0:2:1:0-part1 -&amp;gt; ../../sdb1
lrwxrwxrwx 1 root root  9 Jun  2 16:50 pci-0000:02:00.0-scsi-0:2:2:0 -&amp;gt; ../../sdc
lrwxrwxrwx 1 root root 10 Jun  2 16:50 pci-0000:02:00.0-scsi-0:2:2:0-part1 -&amp;gt; ../../sdc1
lrwxrwxrwx 1 root root 10 Jun  2 16:50 pci-0000:02:00.0-scsi-0:2:2:0-part2 -&amp;gt; ../../sdc2
lrwxrwxrwx 1 root root 10 Jun  2 16:50 pci-0000:02:00.0-scsi-0:2:2:0-part3 -&amp;gt; ../../sdc3
lrwxrwxrwx 1 root root 10 Jun  2 16:50 pci-0000:02:00.0-scsi-0:2:2:0-part4 -&amp;gt; ../../sdc4
lrwxrwxrwx 1 root root  9 Jun  2 16:50 pci-0000:02:00.0-scsi-0:2:3:0 -&amp;gt; ../../sdd
lrwxrwxrwx 1 root root  9 Jun  2 16:50 pci-0000:02:00.0-scsi-0:2:4:0 -&amp;gt; ../../sde
lrwxrwxrwx 1 root root 10 Jun  2 16:50 pci-0000:02:00.0-scsi-0:2:4:0-part1 -&amp;gt; ../../sde1
root@scaler:/dev/disk/by-path# 
root@scaler:/dev/disk/by-path# ls -l |grep 'pci-0000:02:00.0-scsi-0:2:3:0' | grep -v part | awk '{{print $NF}}' | awk -F'/' '{{print $NF}}' 
sdd
root@scaler:/dev/disk/by-path# 
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;出现坏盘的，对应RAID组为VD 3，正好是sdd这个分区，说明HDD有损坏了，需要进行更换。&lt;/p&gt;</content><author><name>Gavin</name></author><category term="Linux" /><summary type="html">概述</summary></entry><entry><title type="html">PVE集群给Ubuntu18.04直通GPU</title><link href="http://172.17.73.80:4000/2021/02/23/Pass_through_GPU_to_Ubuntu18_in_PVE_Cluster/" rel="alternate" type="text/html" title="PVE集群给Ubuntu18.04直通GPU" /><published>2021-02-23T00:00:00+08:00</published><updated>2021-02-23T00:00:00+08:00</updated><id>http://172.17.73.80:4000/2021/02/23/Pass_through_GPU_to_Ubuntu18_in_PVE_Cluster</id><content type="html" xml:base="http://172.17.73.80:4000/2021/02/23/Pass_through_GPU_to_Ubuntu18_in_PVE_Cluster/">&lt;h1 id=&quot;配置修改&quot;&gt;配置修改&lt;/h1&gt;

&lt;h2 id=&quot;convergerone侧配置修改&quot;&gt;ConvergerOne侧配置修改&lt;/h2&gt;

&lt;h3 id=&quot;step1-修改etcdefaultgrub&quot;&gt;Step1 修改/etc/default/grub&lt;/h3&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;vi /etc/default/grub&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;在 quiet后面，增加“&lt;strong&gt;intel_iommu=on video=efifb:off,vesafb:off&lt;/strong&gt;”，完整内容如下所示：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;GRUB_CMDLINE_LINUX_DEFAULT=&quot;quiet intel_iommu=on video=efifb:off,vesafb:off 915.modeset=0 nomodeset net.ifnames=1 biosdevname=0&quot;

GRUB_CMDLINE_LINUX=&quot;video=VGA-1:800x600&quot;

GRUB_GFXMODE=800x600

GRUB_GFXPAYLOAD_LINUX=keep
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;说明：&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;iommu开启直通分组&lt;/li&gt;
  &lt;li&gt;efifb:off 禁用efi启动的显示设备&lt;/li&gt;
  &lt;li&gt;vesafb:off 禁用legacy启动的显示设备&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;保存后，执行如下指令更新grub：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;update-grub
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;step-2-加载模块&quot;&gt;Step 2 加载模块&lt;/h3&gt;

&lt;p&gt;编辑 /etc/modules，直接添加以下几个模块：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;vfio
vfio_iommu_type1
vfio_pci
vfio_virqfd
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;step-3-阻止驱动加载&quot;&gt;Step 3 阻止驱动加载&lt;/h3&gt;

&lt;p&gt;因为ConvergetOne启动时会尝试加载显卡驱动，为了避免pve占用显卡，需要阻止pve的显卡驱动加载。&lt;/p&gt;

&lt;h4 id=&quot;31-添加驱动黑名单&quot;&gt;3.1 添加驱动黑名单&lt;/h4&gt;

&lt;p&gt;编辑/etc/modprobe.d/pve-blacklist.conf&lt;/p&gt;

&lt;p&gt;vi /etc/modprobe.d/pve-blacklist.conf&lt;/p&gt;

&lt;p&gt;添加以下内容&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;# block AMD driver

blacklist radeon
blacklist amdgpu

# block NVIDIA driver

blacklist nouveau
blacklist nvidia
blacklist nvidiafb

# block INTEL driver

blacklist snd_hda_intel
blacklist snd_hda_codec_hdmi
blacklist i915
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;编辑/etc/modprobe.d/blacklist.conf，执行如下指令，增加blacklist&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;  echo &quot;blacklist radeon&quot; &amp;gt;&amp;gt; /etc/modprobe.d/blacklist.conf 
  echo &quot;blacklist nouveau&quot; &amp;gt;&amp;gt; /etc/modprobe.d/blacklist.conf 
  echo &quot;blacklist nvidia&quot; &amp;gt;&amp;gt; /etc/modprobe.d/blacklist.conf
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;32-添加显卡到直通设备中&quot;&gt;3.2 添加显卡到直通设备中&lt;/h4&gt;

&lt;p&gt;查看所有pci设备。&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;lspci
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;由于我们已经知道了当前设备用的是什么型号的GPU卡，这里直接过滤：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;root@gpu01:~# lspci |grep -i Tesla
02:00.0 3D controller: NVIDIA Corporation GP102GL [Tesla P40] (rev a1)
root@gpu01:~# 
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;找到了前面的硬件id（上面显示的是&lt;strong&gt;02:00&lt;/strong&gt;），获取核心显卡的硬件id：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;root@gpu01:~# lspci -n -s 02:00
02:00.0 0302: 10de:1b38 (rev a1)
root@gpu01:~# 
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;找到显卡后记下硬件id，形式是&lt;code class=&quot;highlighter-rouge&quot;&gt;xxxx:xxxx&lt;/code&gt;，比如上面的Tesla P40的核心显卡的硬件id是&lt;strong&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;10de:1b38&lt;/code&gt;&lt;/strong&gt;。
编辑&lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/modprobe.d/vfio.conf&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;vi /etc/modprobe.d/vfio.conf
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;添加以下内容注意！把&lt;strong&gt;10de:1b38&lt;/strong&gt;换成你的显卡的硬件id：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;echo &quot;options vfio-pci ids=10de:1b38 disable_vga=1&quot; &amp;gt; /etc/modprobe.d/vfio.conf
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;然后查看内容是否正确：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;root@gpu01:~# cat /etc/modprobe.d/vfio.conf
options vfio-pci ids=10de:1b38 disable_vga=1
root@gpu01:~# 
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;最后执行&lt;code class=&quot;highlighter-rouge&quot;&gt;update-initramfs -u&lt;/code&gt; 生效配置。&lt;/p&gt;

&lt;h3 id=&quot;step-4-重启机器&quot;&gt;Step 4 重启机器&lt;/h3&gt;

&lt;p&gt;重启ConvergerOne宿主机。&lt;/p&gt;

&lt;h3 id=&quot;step-5-安装虚机&quot;&gt;Step 5 安装虚机&lt;/h3&gt;

&lt;p&gt;等待ConvergerOne宿主机重启好，集群恢复健康后，创建Ubuntu18.04的vm，配置参考如下：&lt;/p&gt;

&lt;p&gt;&lt;img class=&quot;shadow&quot; src=&quot;/img/in-post/pve/image-20210223153926661.png&quot; width=&quot;1200&quot; /&gt;&lt;/p&gt;

&lt;p&gt;此时是VM是没有直通GPU设备的。&lt;/p&gt;

&lt;h1 id=&quot;vm侧配置修改&quot;&gt;VM侧配置修改&lt;/h1&gt;

&lt;p&gt;VM OS成功 安装后进行配置文件的修改操作（以下操作以root用户进行修改）。&lt;/p&gt;

&lt;h4 id=&quot;编辑-etcmodprobedkvmconf&quot;&gt;编辑 /etc/modprobe.d/kvm.conf&lt;/h4&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;echo &quot;options kvm ignore_msrs=1 report_ignored_msrs=0&quot; &amp;gt; /etc/modprobe.d/kvm.conf
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h1 id=&quot;安装驱动前准备工作&quot;&gt;安装驱动前准备工作&lt;/h1&gt;

&lt;h2 id=&quot;禁用nouveau驱动&quot;&gt;禁用Nouveau驱动&lt;/h2&gt;

&lt;h3 id=&quot;编辑黑名单&quot;&gt;编辑黑名单&lt;/h3&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;vi /etc/modprobe.d/blacklist-nouveau.conf
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;添加两行语句：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;blacklist nouveau
options nouveau modeset=0
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;更新initramfs&quot;&gt;更新initramfs&lt;/h3&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;update-initramfs -u
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;输出信息参考如下：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;root@vmgpu:~# update-initramfs -u
update-initramfs: Generating /boot/initrd.img-4.15.0-55-generic
root@vmgpu:~# 
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;重启-vm&quot;&gt;重启 VM&lt;/h3&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;reboot
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;验证&quot;&gt;验证&lt;/h3&gt;

&lt;p&gt;终端执行如下指令：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;lsmod | grep nouveau
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;如果没有结果表示禁用成功。&lt;/p&gt;

&lt;h2 id=&quot;安装gccmake&quot;&gt;安装gcc&amp;amp;make&lt;/h2&gt;

&lt;p&gt;由于安装NVIDIA driver需要7.4版本的gcc和make指令，需进行gcc与make的安装。&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;apt-get update
apt-get install gcc 7.4.0
apt-get install make
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;vm增加gpu-pci-e设备&quot;&gt;VM增加GPU PCI-e设备&lt;/h2&gt;

&lt;p&gt;将VM关机，并增加GPU设备：&lt;/p&gt;

&lt;p&gt;&lt;img class=&quot;shadow&quot; src=&quot;/img/in-post/pve/image-20210223160023098.png&quot; width=&quot;1200&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img class=&quot;shadow&quot; src=&quot;/img/in-post/pve/image-20210223160848107.png&quot; width=&quot;1200&quot; /&gt;&lt;/p&gt;

&lt;p&gt;完整的UI展示VM信息参考如下：&lt;/p&gt;

&lt;p&gt;&lt;img class=&quot;shadow&quot; src=&quot;/img/in-post/pve/image-20210223180038078.png&quot; width=&quot;1200&quot; /&gt;&lt;/p&gt;

&lt;p&gt;注意：&lt;/p&gt;

&lt;p&gt;1、不要勾选主GPU，否则VM启动报错：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;/dev/rbd0
kvm: failed to find file '/usr/share/qemu-server/bootsplash.jpg'
kvm: -device vfio-pci,host=0000:02:00.0,id=hostpci0,bus=pci.0,addr=0x10,rombar=0,x-vga=on: vfio 0000:02:00.0: failed getting region info for VGA region index 8: Invalid argument
device does not support requested feature x-vga
TASK ERROR: start failed: command '/usr/bin/kvm -id 100 -name vm100 -chardev 'socket,id=qmp,path=/var/run/qemu-server/100.qmp,server,nowait' -mon 'chardev=qmp,mode=control' -chardev 'socket,id=qmp-event,path=/var/run/qmeventd.sock,reconnect=5' -mon 'chardev=qmp-event,mode=control' -pidfile /var/run/qemu-server/100.pid -daemonize -smbios 'type=1,uuid=6739feef-a51c-4ec4-b24f-e80cb402a832' -smp '8,sockets=2,cores=4,maxcpus=8' -nodefaults -boot 'menu=on,strict=on,reboot-timeout=1000,splash=/usr/share/qemu-server/bootsplash.jpg' -vga none -nographic -cpu 'kvm64,+lahf_lm,+sep,+kvm_pv_unhalt,+kvm_pv_eoi,enforce,kvm=off' -m 4096 -device 'pci-bridge,id=pci.1,chassis_nr=1,bus=pci.0,addr=0x1e' -device 'pci-bridge,id=pci.2,chassis_nr=2,bus=pci.0,addr=0x1f' -device 'vmgenid,guid=9ee6f244-c03d-4e0f-852e-3790f8d09adf' -device 'piix3-usb-uhci,id=uhci,bus=pci.0,addr=0x1.0x2' -device 'usb-tablet,id=tablet,bus=uhci.0,port=1' -device 'vfio-pci,host=0000:02:00.0,id=hostpci0,bus=pci.0,addr=0x10,rombar=0,x-vga=on' -device 'virtio-balloon-pci,id=balloon0,bus=pci.0,addr=0x3' -iscsi 'initiator-name=iqn.1993-08.org.debian:01:2ffe281c6e13' -device 'virtio-scsi-pci,id=scsihw0,bus=pci.0,addr=0x5' -drive 'file=/dev/rbd/rbd/vm-100-disk-0,if=none,id=drive-scsi0,discard=on,format=raw,cache=none,aio=native,detect-zeroes=unmap' -device 'scsi-hd,bus=scsihw0.0,channel=0,scsi-id=0,lun=0,drive=drive-scsi0,id=scsi0,bootindex=100' -netdev 'type=tap,id=net0,ifname=tap100i0,script=/var/lib/qemu-server/pve-bridge,downscript=/var/lib/qemu-server/pve-bridgedown,vhost=on' -device 'virtio-net-pci,mac=B6:5F:BC:F0:3D:9F,netdev=net0,bus=pci.0,addr=0x12,id=net0,bootindex=300' -machine 'type=pc+pve1'' failed: exit code 1
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;2、 不要勾选PCIE-Express选择，否则VM启动报错：&lt;/p&gt;

&lt;p&gt;&lt;img class=&quot;shadow&quot; src=&quot;/img/in-post/pve/image-20210223161023563.png&quot; width=&quot;1200&quot; /&gt;&lt;/p&gt;

&lt;h1 id=&quot;安装驱动&quot;&gt;安装驱动&lt;/h1&gt;

&lt;p&gt;事先准备好NVIDIA的driver，本文以  &lt;strong&gt;NVIDIA-Linux-x86_64-460.32.03.run&lt;/strong&gt; 示例。&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;root@vmgpu:~# chmod a+x NVIDIA-Linux-x86_64-460.32.03.run 
root@vmgpu:~# ./NVIDIA-Linux-x86_64-460.32.03.run 
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;安装过程记录如下：&lt;/p&gt;

&lt;p&gt;忽略gcc版本告警：&lt;/p&gt;

&lt;p&gt;&lt;img class=&quot;shadow&quot; src=&quot;/img/in-post/pve/image-20210223161702180.png&quot; width=&quot;1200&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img class=&quot;shadow&quot; src=&quot;/img/in-post/pve/image-20210223161729108.png&quot; width=&quot;1200&quot; /&gt;&lt;/p&gt;

&lt;p&gt;开始Build kernel modules：&lt;/p&gt;

&lt;p&gt;&lt;img class=&quot;shadow&quot; src=&quot;/img/in-post/pve/image-20210223161755290.png&quot; width=&quot;1200&quot; /&gt;&lt;/p&gt;

&lt;p&gt;出现了warning，直接一路回车就好：&lt;/p&gt;

&lt;p&gt;&lt;img class=&quot;shadow&quot; src=&quot;/img/in-post/pve/image-20210223161825771.png&quot; width=&quot;1200&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img class=&quot;shadow&quot; src=&quot;/img/in-post/pve/image-20210223161834580.png&quot; width=&quot;1200&quot; /&gt;&lt;/p&gt;

&lt;p&gt;install NVIDIA Accolerated Graphics Driver：&lt;/p&gt;

&lt;p&gt;&lt;img class=&quot;shadow&quot; src=&quot;/img/in-post/pve/image-20210223161846564.png&quot; width=&quot;1200&quot; /&gt;&lt;/p&gt;

&lt;p&gt;提示安装成功：&lt;/p&gt;

&lt;p&gt;&lt;img class=&quot;shadow&quot; src=&quot;/img/in-post/pve/image-20210223161930679.png&quot; width=&quot;1200&quot; /&gt;&lt;/p&gt;

&lt;p&gt;重启VM，检查驱动是否被成功安装：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;root@vmgpu:~# lsmod | grep nvidia
nvidia_drm             49152  0
nvidia_modeset       1220608  1 nvidia_drm
nvidia              33988608  1 nvidia_modeset
drm_kms_helper        167936  1 nvidia_drm
drm                   401408  3 drm_kms_helper,nvidia_drm
root@vmgpu:~# 
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;root@vmgpu:~# nvidia-smi 
Tue Feb 23 16:40:19 2021       
+-----------------------------------------------------------------------------+
| NVIDIA-SMI 460.32.03    Driver Version: 460.32.03    CUDA Version: 11.2     |
|-------------------------------+----------------------+----------------------+
| GPU  Name        Persistence-M| Bus-Id        Disp.A | Volatile Uncorr. ECC |
| Fan  Temp  Perf  Pwr:Usage/Cap|         Memory-Usage | GPU-Util  Compute M. |
|                               |                      |               MIG M. |
|===============================+======================+======================|
|   0  Tesla P40           Off  | 00000000:00:10.0 Off |                    0 |
| N/A   28C    P0    50W / 250W |      0MiB / 22919MiB |      3%      Default |
|                               |                      |                  N/A |
+-------------------------------+----------------------+----------------------+
                                                                               
+-----------------------------------------------------------------------------+
| Processes:                                                                  |
|  GPU   GI   CI        PID   Type   Process name                  GPU Memory |
|        ID   ID                                                   Usage      |
|=============================================================================|
|  No running processes found                                                 |
+-----------------------------------------------------------------------------+
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;如下图所示：&lt;/p&gt;

&lt;p&gt;&lt;img class=&quot;shadow&quot; src=&quot;/img/in-post/pve/image-20210223162330661.png&quot; width=&quot;1200&quot; /&gt;&lt;/p&gt;

&lt;p&gt;出现如上信息，表明成功安装了驱动。&lt;/p&gt;

&lt;h1 id=&quot;其他信息&quot;&gt;其他信息&lt;/h1&gt;

&lt;h2 id=&quot;不支援biso类型为ovmf下gpu的直通&quot;&gt;不支援BISO类型为OVMF下GPU的直通&lt;/h2&gt;

&lt;p&gt;更改VM BIOS 类型为OVMF，支持q35，如下图所示：&lt;/p&gt;

&lt;p&gt;&lt;img class=&quot;shadow&quot; src=&quot;/img/in-post/pve/image-20210223173032251.png&quot; width=&quot;1200&quot; /&gt;&lt;/p&gt;

&lt;p&gt;按照上面的部署步骤安装NVIDIA-Linux-x86_64-460.32.03.run：&lt;/p&gt;

&lt;p&gt;&lt;img class=&quot;shadow&quot; src=&quot;/img/in-post/pve/image-20210223173124492.png&quot; width=&quot;1200&quot; /&gt;&lt;/p&gt;

&lt;p&gt;对应log内容：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;   /tmp/selfgz19048/NVIDIA-Linux-x86_64-460.32.03/kernel/nvidia-drm/nvidia-drm-modeset.c: In function '__will_generate_flip_event':
   /tmp/selfgz19048/NVIDIA-Linux-x86_64-460.32.03/kernel/nvidia-drm/nvidia-drm-modeset.c:96:23: warning: unused variable 'primary_plane' [-Wunused-variable]
        struct drm_plane *primary_plane = crtc-&amp;gt;primary;
                          ^~~~~~~~~~~~~
     CC [M]  /tmp/selfgz19048/NVIDIA-Linux-x86_64-460.32.03/kernel/nvidia-drm/nvidia-drm-helper.o
     CC [M]  /tmp/selfgz19048/NVIDIA-Linux-x86_64-460.32.03/kernel/nvidia-drm/nv-pci-table.o
     CC [M]  /tmp/selfgz19048/NVIDIA-Linux-x86_64-460.32.03/kernel/nvidia-drm/nvidia-drm-gem-nvkms-memory.o
     CC [M]  /tmp/selfgz19048/NVIDIA-Linux-x86_64-460.32.03/kernel/nvidia-drm/nvidia-drm-gem-user-memory.o
     CC [M]  /tmp/selfgz19048/NVIDIA-Linux-x86_64-460.32.03/kernel/nvidia-drm/nvidia-drm-gem-dma-buf.o
     CC [M]  /tmp/selfgz19048/NVIDIA-Linux-x86_64-460.32.03/kernel/nvidia-drm/nvidia-drm-format.o
   ld -r -o /tmp/selfgz19048/NVIDIA-Linux-x86_64-460.32.03/kernel/nvidia/nv-interface.o /tmp/selfgz19048/NVIDIA-Linux-x86_64-460.32.03/kernel/nvidia/nv-frontend.o /tmp/selfgz19048/NVIDIA-Linux-x86_64-460.32.03/kernel/nvidia/nv.o /tmp/selfgz19048/NVIDIA-Linux-x86_64-460.32.03/kernel/nvidia/nv-pci.o /tmp/selfgz19048/NVIDIA-Linux-x86_64-460.32.03/kernel/nvidia/nv-acpi.o /tmp/selfgz19048/NVIDIA-Linux-x86_
   64-460.32.03/kernel/nvidia/nv-cray.o /tmp/selfgz19048/NVIDIA-Linux-x86_64-460.32.03/kernel/nvidia/nv-dma.o /tmp/selfgz19048/NVIDIA-Linux-x86_64-460.32.03/kernel/nvidia/nv-i2c.o /tmp/selfgz19048/NVIDIA-Linux-x86_64-460.32.03/kernel/nvidia/nv-mmap.o /tmp/selfgz19048/NVIDIA-Linux-x86_64-460.32.03/kernel/nvidia/nv-p2p.o /tmp/selfgz19048/NVIDIA-Linux-x86_64-460.32.03/kernel/nvidia/nv-pat.o /tmp/selfgz19048/NVIDIA-Linux-x86_64-460.32.03/kernel/nvidia/nv-procfs.o /tmp/selfgz19048/NVIDIA-Linux-x86_64-460.32.03/kernel/nvidia/nv-usermap.o /tmp/selfgz19048/NVIDIA-Linux-x86_64-460.32.03/kernel/nvidia/nv-vm.o /tmp/selfgz19048/NVIDIA-Linux-x86_64-460.32.03/kernel/nvidia/nv-vtophys.o /tmp/selfgz19048/NVIDIA-Linux-x86_64-460.32.03/kernel/nvidia/os-interface.o /tmp/selfgz19048/NVIDIA-Linux-x86_64-460.32.03/kernel/nvidia/os-mlock.o /tmp/selfgz19048/NVIDIA-Linux-x86_64-460.32.03/kernel/nvidia/os-pci.o /tmp/selfgz19048/NVIDIA-Linux-x86_64-460.32.03/kernel/nvidia/os-registry.o /tmp/selfgz19048/NVIDIA-Linux-x86_64-460.32.03/kernel
   /nvidia/os-usermap.o /tmp/selfgz19048/NVIDIA-Linux-x86_64-460.32.03/kernel/nvidia/nv-modeset-interface.o /tmp/selfgz19048/NVIDIA-Linux-x86_64-460.32.03/kernel/nvidia/nv-pci-table.o /tmp/selfgz19048/NVIDIA-Linux-x86_64-460.32.03/kernel/nvidia/nv-kthread-q.o /tmp/selfgz19048/NVIDIA-Linux-x86_64-460.32.03/kernel/nvidia/nv-memdbg.o /tmp/selfgz19048/NVIDIA-Linux-x86_64-460.32.03/kernel/nvidia/nv-ibmnpu.o /tmp/selfgz19048/NVIDIA-Linux-x86_64-460.32.03/kernel/nvidia/nv-report-err.o /tmp/selfgz19048/NVIDIA-Linux-x86_64-460.32.03/kernel/nvidia/nv-rsync.o /tmp/selfgz19048/NVIDIA-Linux-x86_64-460.32.03/kernel/nvidia/nv-msi.o /tmp/selfgz19048/NVIDIA-Linux-x86_64-460.32.03/kernel/nvidia/nv-caps.o /tmp/selfgz19048/NVIDIA-Linux-x86_64-460.32.03/kernel/nvidia/nv_uvm_interface.o /tmp/selfgz19048/NVIDIA-Linux-x86_64-460.32.03/kernel/nvidia/nvlink_linux.o /tmp/selfgz19048/NVIDIA-Linux-x86_64-460.32.03/kernel/nvidia/nvlink_caps.o /tmp/selfgz19048/NVIDIA-Linux-x86_64-460.32.03/kernel/nvidia/linux_nvswitch.o /tmp/selfgz19048/NVIDI
   A-Linux-x86_64-460.32.03/kernel/nvidia/procfs_nvswitch.o
   ld -r -o /tmp/selfgz19048/NVIDIA-Linux-x86_64-460.32.03/kernel/nvidia-modeset/nv-modeset-interface.o /tmp/selfgz19048/NVIDIA-Linux-x86_64-460.32.03/kernel/nvidia-modeset/nvidia-modeset-linux.o /tmp/selfgz19048/NVIDIA-Linux-x86_64-460.32.03/kernel/nvidia-modeset/nv-kthread-q.o
     LD [M]  /tmp/selfgz19048/NVIDIA-Linux-x86_64-460.32.03/kernel/nvidia.o
     LD [M]  /tmp/selfgz19048/NVIDIA-Linux-x86_64-460.32.03/kernel/nvidia-uvm.o
     LD [M]  /tmp/selfgz19048/NVIDIA-Linux-x86_64-460.32.03/kernel/nvidia-modeset.o
     LD [M]  /tmp/selfgz19048/NVIDIA-Linux-x86_64-460.32.03/kernel/nvidia-drm.o
     Building modules, stage 2.
     MODPOST 4 modules
     CC      /tmp/selfgz19048/NVIDIA-Linux-x86_64-460.32.03/kernel/nvidia-drm.mod.o
     CC      /tmp/selfgz19048/NVIDIA-Linux-x86_64-460.32.03/kernel/nvidia-modeset.mod.o
     CC      /tmp/selfgz19048/NVIDIA-Linux-x86_64-460.32.03/kernel/nvidia-uvm.mod.o
     CC      /tmp/selfgz19048/NVIDIA-Linux-x86_64-460.32.03/kernel/nvidia.mod.o
     LD [M]  /tmp/selfgz19048/NVIDIA-Linux-x86_64-460.32.03/kernel/nvidia-drm.ko
     LD [M]  /tmp/selfgz19048/NVIDIA-Linux-x86_64-460.32.03/kernel/nvidia.ko
     LD [M]  /tmp/selfgz19048/NVIDIA-Linux-x86_64-460.32.03/kernel/nvidia-uvm.ko
     LD [M]  /tmp/selfgz19048/NVIDIA-Linux-x86_64-460.32.03/kernel/nvidia-modeset.ko
   make[1]: Leaving directory '/usr/src/linux-headers-4.15.0-55-generic'
-&amp;gt; done.
-&amp;gt; Kernel module compilation complete.
-&amp;gt; Unable to determine if Secure Boot is enabled: No such file or directory
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;gpu卡供电不足导致成功安装驱动后无法使用gpu卡&quot;&gt;GPU卡供电不足导致成功安装驱动后无法使用GPU卡&lt;/h2&gt;

&lt;p&gt;对应VM kern.log片断信息如下：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;Feb 23 08:23:46 gpu01 kernel: [   12.954627] [drm] [nvidia-drm] [GPU ID 0x00000010] Loading driver
Feb 23 08:23:46 gpu01 kernel: [   12.954628] [drm] Initialized nvidia-drm 0.0.0 20160202 for 0000:00:10.0 on minor 1
Feb 23 08:23:46 gpu01 kernel: [   13.025196] EXT4-fs (sda2): mounted filesystem with ordered data mode. Opts: (null)
Feb 23 08:23:46 gpu01 kernel: [   13.111410] audit: type=1400 audit(1614068624.068:2): apparmor=&quot;STATUS&quot; operation=&quot;profile_load&quot; profile=&quot;unconfined&quot; name=&quot;/usr/bin/lxc-start&quot; pid=735 comm=&quot;apparmor_parser&quot;
Feb 23 08:23:46 gpu01 kernel: [   13.112890] audit: type=1400 audit(1614068624.072:3): apparmor=&quot;STATUS&quot; operation=&quot;profile_load&quot; profile=&quot;unconfined&quot; name=&quot;/usr/bin/man&quot; pid=736 comm=&quot;apparmor_parser&quot;
Feb 23 08:23:46 gpu01 kernel: [   13.112893] audit: type=1400 audit(1614068624.072:4): apparmor=&quot;STATUS&quot; operation=&quot;profile_load&quot; profile=&quot;unconfined&quot; name=&quot;man_filter&quot; pid=736 comm=&quot;apparmor_parser&quot;
Feb 23 08:23:46 gpu01 kernel: [   13.112895] audit: type=1400 audit(1614068624.072:5): apparmor=&quot;STATUS&quot; operation=&quot;profile_load&quot; profile=&quot;unconfined&quot; name=&quot;man_groff&quot; pid=736 comm=&quot;apparmor_parser&quot;
Feb 23 08:23:46 gpu01 kernel: [   13.113310] audit: type=1400 audit(1614068624.072:6): apparmor=&quot;STATUS&quot; operation=&quot;profile_load&quot; profile=&quot;unconfined&quot; name=&quot;/usr/lib/snapd/snap-confine&quot; pid=737 comm=&quot;apparmor_parser&quot;
Feb 23 08:23:46 gpu01 kernel: [   13.113312] audit: type=1400 audit(1614068624.072:7): apparmor=&quot;STATUS&quot; operation=&quot;profile_load&quot; profile=&quot;unconfined&quot; name=&quot;/usr/lib/snapd/snap-confine//mount-namespace-capture-helper&quot; pid=737 comm=&quot;apparmor_parser&quot;
Feb 23 08:23:46 gpu01 kernel: [   13.114956] audit: type=1400 audit(1614068624.072:8): apparmor=&quot;STATUS&quot; operation=&quot;profile_load&quot; profile=&quot;unconfined&quot; name=&quot;/usr/sbin/tcpdump&quot; pid=739 comm=&quot;apparmor_parser&quot;
Feb 23 08:23:46 gpu01 kernel: [   13.116269] audit: type=1400 audit(1614068624.080:9): apparmor=&quot;STATUS&quot; operation=&quot;profile_load&quot; profile=&quot;unconfined&quot; name=&quot;lxc-container-default&quot; pid=733 comm=&quot;apparmor_parser&quot;
Feb 23 08:23:46 gpu01 kernel: [   13.116272] audit: type=1400 audit(1614068624.080:10): apparmor=&quot;STATUS&quot; operation=&quot;profile_load&quot; profile=&quot;unconfined&quot; name=&quot;lxc-container-default-cgns&quot; pid=733 comm=&quot;apparmor_parser&quot;
Feb 23 08:23:46 gpu01 kernel: [   13.116277] audit: type=1400 audit(1614068624.080:11): apparmor=&quot;STATUS&quot; operation=&quot;profile_load&quot; profile=&quot;unconfined&quot; name=&quot;lxc-container-default-with-mounting&quot; pid=733 comm=&quot;apparmor_parser&quot;
Feb 23 08:23:46 gpu01 kernel: [   15.853079] new mount options do not match the existing superblock, will be ignored
Feb 23 08:24:46 gpu01 kernel: [   77.010198] random: crng init done
Feb 23 08:24:46 gpu01 kernel: [   77.010218] random: 7 urandom warning(s) missed due to ratelimiting
Feb 23 08:25:00 gpu01 kernel: [   90.796257] NVRM: GPU 0000:00:10.0: GPU does not have the necessary power cables connected.
Feb 23 08:25:00 gpu01 kernel: [   90.825600] NVRM: GPU 0000:00:10.0: RmInitAdapter failed! (0x25:0x1c:1262)
Feb 23 08:25:00 gpu01 kernel: [   90.825801] NVRM: GPU 0000:00:10.0: rm_init_adapter failed, device minor number 0
Feb 23 08:25:00 gpu01 kernel: [   91.062551] NVRM: GPU 0000:00:10.0: GPU does not have the necessary power cables connected.
Feb 23 08:25:00 gpu01 kernel: [   91.092368] NVRM: GPU 0000:00:10.0: RmInitAdapter failed! (0x25:0x1c:1262)
Feb 23 08:25:00 gpu01 kernel: [   91.092560] NVRM: GPU 0000:00:10.0: rm_init_adapter failed, device minor number 0
Feb 23 08:25:15 gpu01 kernel: [  105.451286] NVRM: GPU 0000:00:10.0: GPU does not have the necessary power cables connected.
Feb 23 08:25:15 gpu01 kernel: [  105.451804] NVRM: GPU 0000:00:10.0: RmInitAdapter failed! (0x25:0x1c:1262)
Feb 23 08:25:15 gpu01 kernel: [  105.452011] NVRM: GPU 0000:00:10.0: rm_init_adapter failed, device minor number 0
Feb 23 08:25:15 gpu01 kernel: [  105.718690] NVRM: GPU 0000:00:10.0: GPU does not have the necessary power cables connected.
Feb 23 08:25:15 gpu01 kernel: [  105.719179] NVRM: GPU 0000:00:10.0: RmInitAdapter failed! (0x25:0x1c:1262)
Feb 23 08:25:15 gpu01 kernel: [  105.719362] NVRM: GPU 0000:00:10.0: rm_init_adapter failed, device minor number 0
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;解决方法：&lt;/p&gt;

&lt;p&gt;拆机箱，将Tesla P40这块GPU的两根电源线都接上，之前是只接了一根电源线。&lt;/p&gt;</content><author><name>Gavin</name></author><category term="Linux" /><category term="PVE" /><category term="GPU" /><category term="Pass through" /><summary type="html">配置修改</summary></entry><entry><title type="html">ps_mem:报告Linux内存用量的指令</title><link href="http://172.17.73.80:4000/2021/02/19/ps_mem/" rel="alternate" type="text/html" title="ps_mem:报告Linux内存用量的指令" /><published>2021-02-19T00:00:00+08:00</published><updated>2021-02-19T00:00:00+08:00</updated><id>http://172.17.73.80:4000/2021/02/19/ps_mem</id><content type="html" xml:base="http://172.17.73.80:4000/2021/02/19/ps_mem/">&lt;h1 id=&quot;概述&quot;&gt;概述&lt;/h1&gt;

&lt;p&gt;今天偶然发现一个指令：ps_mem&lt;/p&gt;

&lt;p&gt;ps_mem 是一个可以帮助我们精确获取 Linux 中各个程序核心内存使用情况的简单 python 脚本。虽然在 Linux 上有很多可用于查看内存使用情况的工具，比如 free、vmstat、smem、top、htop、atop等，但这个工具和其它的区别在于其精确显示核心内存使用情况。
ps_mem会分别计算一个程序私有内存总量和共享内存总量，并以更准确的方式给出了总的内存使用量，显示系统中哪些程序正在占用多少的内存。&lt;/p&gt;

&lt;h1 id=&quot;操作实例&quot;&gt;操作实例&lt;/h1&gt;

&lt;h2 id=&quot;帮助&quot;&gt;帮助&lt;/h2&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;[root@node161 ~]# ps_mem -h
ps_mem.py - Show process memory usage

-h                                 Show this help
-w &amp;lt;N&amp;gt;                             Measure and show process memory every N seconds
-p &amp;lt;pid&amp;gt;[,pid2,...pidN]            Only show memory usage PIDs in the specified list
-s, --show-cmdline                 Show complete program path with options

&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;示例1&quot;&gt;示例1&lt;/h2&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;[root@node161 ~]# ps_mem
 Private  +   Shared  =  RAM used	Program 

  4.0 KiB +  12.0 KiB =  16.0 KiB	acpid
112.0 KiB +  13.0 KiB = 125.0 KiB	agetty
124.0 KiB +  27.0 KiB = 151.0 KiB	ipmievd
  4.0 KiB + 164.5 KiB = 168.5 KiB	lvmetad
184.0 KiB +  20.5 KiB = 204.5 KiB	rpc.rquotad
204.0 KiB +  33.0 KiB = 237.0 KiB	atd
184.0 KiB +  55.0 KiB = 239.0 KiB	auditd
196.0 KiB +  49.0 KiB = 245.0 KiB	rpc.idmapd
240.0 KiB +  31.5 KiB = 271.5 KiB	crond
196.0 KiB + 127.5 KiB = 323.5 KiB	rpcbind
328.0 KiB +  33.5 KiB = 361.5 KiB	ntpd
352.0 KiB +  14.5 KiB = 366.5 KiB	iscsi-scstd
316.0 KiB +  85.0 KiB = 401.0 KiB	gssproxy
568.0 KiB +  69.5 KiB = 637.5 KiB	zed
532.0 KiB + 105.5 KiB = 637.5 KiB	smartd
412.0 KiB + 335.0 KiB = 747.0 KiB	avahi-daemon (2)
692.0 KiB +  91.0 KiB = 783.0 KiB	systemd-udevd
696.0 KiB +  87.5 KiB = 783.5 KiB	nscd
660.0 KiB + 192.5 KiB = 852.5 KiB	dbus-daemon
824.0 KiB +  52.5 KiB = 876.5 KiB	irqbalance
924.0 KiB + 106.0 KiB =   1.0 MiB	rpc.mountd
992.0 KiB + 106.5 KiB =   1.1 MiB	rpc.statd
  1.1 MiB +  86.5 KiB =   1.1 MiB	master
  1.1 MiB + 110.0 KiB =   1.2 MiB	qmgr
  1.2 MiB +  87.0 KiB =   1.3 MiB	stunnel
128.0 KiB +   1.3 MiB =   1.4 MiB	cleanupd
136.0 KiB +   1.3 MiB =   1.4 MiB	smbd-notifyd
  1.5 MiB +  46.5 KiB =   1.5 MiB	rsyslogd
  1.5 MiB + 111.0 KiB =   1.6 MiB	pickup
  1.9 MiB +  39.0 KiB =   2.0 MiB	systemd-logind
  2.1 MiB + 209.5 KiB =   2.3 MiB	ctdb_eventd
  2.3 MiB + 487.5 KiB =   2.8 MiB	su (4)
  2.3 MiB + 601.5 KiB =   2.8 MiB	ctdb_recovered
  2.6 MiB + 352.0 KiB =   3.0 MiB	sudo (2)
  2.8 MiB + 567.0 KiB =   3.4 MiB	multipathd
  2.4 MiB +   1.3 MiB =   3.7 MiB	nmbd
  3.6 MiB + 127.0 KiB =   3.7 MiB	systemd
  3.4 MiB + 316.0 KiB =   3.8 MiB	polkitd
  1.6 MiB +   3.1 MiB =   4.7 MiB	smbd
  4.4 MiB + 405.0 KiB =   4.8 MiB	tmux (2)
  6.1 MiB + 501.0 KiB =   6.6 MiB	tuned
  1.5 MiB +   6.7 MiB =   8.2 MiB	winbindd (4)
  8.4 MiB +  12.6 MiB =  21.0 MiB	systemd-journald
 22.4 MiB +  79.5 KiB =  22.5 MiB	gmond
 23.1 MiB +  78.5 KiB =  23.2 MiB	memcached
 24.4 MiB + 275.5 KiB =  24.7 MiB	python2.7
 30.1 MiB +   2.6 MiB =  32.7 MiB	bash (89)
 37.1 MiB +   1.7 MiB =  38.8 MiB	ctdbd
 12.2 MiB +  50.0 MiB =  62.2 MiB	ezs3-agent.py
 68.7 MiB + 306.0 KiB =  69.0 MiB	davserver
 69.9 MiB + 951.0 KiB =  70.8 MiB	csmonitord
 73.9 MiB + 314.0 KiB =  74.2 MiB	ezfs-recycle-fl
 72.7 MiB +   2.4 MiB =  75.2 MiB	radosgw
 74.3 MiB + 920.5 KiB =  75.2 MiB	ezsnapsched.py
 77.1 MiB + 921.5 KiB =  78.0 MiB	bt-pool-reweigh
 81.5 MiB + 964.5 KiB =  82.4 MiB	bt-recovery-qos
 84.7 MiB +   1.2 MiB =  85.9 MiB	eziscsi-rbd-cle
 85.4 MiB +   1.2 MiB =  86.6 MiB	eziscsid.py
 85.8 MiB + 975.0 KiB =  86.7 MiB	bt-ipmi-agent.p
 86.5 MiB +   1.0 MiB =  87.5 MiB	ezfs-agent
 87.1 MiB + 653.5 KiB =  87.7 MiB	atop (2)
 88.1 MiB + 918.0 KiB =  89.0 MiB	ezqosd
120.0 MiB + 468.0 KiB = 120.5 MiB	ceph-mgr
103.2 MiB +  19.4 MiB = 122.6 MiB	sshd (86)
136.2 MiB +   1.1 MiB = 137.3 MiB	ezs3-smart-moni
139.1 MiB +   1.6 MiB = 140.7 MiB	ezrpcd
 11.1 MiB + 156.6 MiB = 167.8 MiB	ezmonitord
202.0 MiB +  17.6 MiB = 219.6 MiB	ssh (213)
266.3 MiB +   8.5 MiB = 274.8 MiB	httpd (12)
501.0 MiB +  35.4 MiB = 536.3 MiB	ezs3-bucket-log (9)
544.1 MiB + 312.5 KiB = 544.4 MiB	ceph-mon
 75.7 GiB +  14.8 MiB =  75.7 GiB	ceph-osd (12)
---------------------------------
                         79.3 GiB
=================================
[root@node161 ~]#
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;说明：&lt;/p&gt;

&lt;p&gt;最后一列输出中，括号里显示的，是对应进程名称的数量，确认一下：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;[root@node161 ~]# ps -ef |grep sshd | grep -v grep | wc -l
86
[root@node161 ~]# ps -ef |grep ceph-osd | grep -v grep | wc -l
12
[root@node161 ~]# ps -ef |grep bash | grep -v grep | wc -l
89
[root@node161 ~]# 
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;输出中打印出command-line&quot;&gt;输出中打印出command line&lt;/h2&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;[root@node161 ~]# ps_mem -s
 Private  +   Shared  =  RAM used	Program 

  4.0 KiB +  12.0 KiB =  16.0 KiB	/usr/sbin/acpid
  4.0 KiB + 118.0 KiB = 122.0 KiB	avahi-daemon: chroot helper
 96.0 KiB +  27.0 KiB = 123.0 KiB	/usr/sbin/ipmievd sel daemon pidfile=/var/run/ipmievd.pid
112.0 KiB +  13.0 KiB = 125.0 KiB	/sbin/agetty --noclear tty1 linux
  4.0 KiB + 164.5 KiB = 168.5 KiB	/usr/sbin/lvmetad -f
184.0 KiB +  20.5 KiB = 204.5 KiB	rpc.rquotad
204.0 KiB +  33.0 KiB = 237.0 KiB	/usr/sbin/atd -f
。。。。。。 中间信息省略 。。。。。。
 86.6 MiB +   1.0 MiB =  87.6 MiB	/usr/bin/python2 /usr/local/bin/ezfs-agent start
 88.2 MiB + 937.0 KiB =  89.1 MiB	/usr/bin/python2 /usr/local/bin/ezqosd start
110.0 MiB + 330.0 KiB = 110.4 MiB	/usr/bin/atop -a -R -w /var/log/atop/atop_20210219 600
109.7 MiB +   1.1 MiB = 110.8 MiB	/usr/bin/python2 /usr/local/bin/ezs3-agent.py start
101.0 MiB +  12.7 MiB = 113.7 MiB	sshd: root@notty     (77)
121.8 MiB + 477.0 KiB = 122.2 MiB	/usr/bin/ceph-mgr -f --cluster ceph --id ojzrm --setuser root --setgroup root
136.3 MiB +   1.1 MiB = 137.4 MiB	/usr/bin/python2 /usr/local/bin/ezs3-smart-monitor.py start
139.1 MiB +   1.6 MiB = 140.7 MiB	/usr/bin/python2 /usr/local/bin/ezrpcd start
230.2 MiB +   2.6 MiB = 232.8 MiB	(wsgi:ezs3admin -DFOREGROUND
320.4 MiB +   1.9 MiB = 322.3 MiB	/usr/bin/python2 /usr/local/bin/ezmonitord start
500.9 MiB +  33.3 MiB = 534.2 MiB	/usr/bin/python2 /usr/local/bin/ezs3-bucket-logging-agent.py start (9)
562.3 MiB + 315.5 KiB = 562.6 MiB	/usr/bin/ceph-mon -f --cluster ceph --id ojzrm --setuser root --setgroup root
  4.4 GiB + 980.0 KiB =   4.4 GiB	/usr/bin/ceph-osd -f --cluster ceph --id 2 --setuser root --setgroup root
  4.5 GiB +   1.1 MiB =   4.5 GiB	/usr/bin/ceph-osd -f --cluster ceph --id 10 --setuser root --setgroup root
  4.5 GiB +   1.1 MiB =   4.5 GiB	/usr/bin/ceph-osd -f --cluster ceph --id 4 --setuser root --setgroup root
  4.7 GiB +   1.0 MiB =   4.7 GiB	/usr/bin/ceph-osd -f --cluster ceph --id 6 --setuser root --setgroup root
  4.9 GiB + 985.0 KiB =   4.9 GiB	/usr/bin/ceph-osd -f --cluster ceph --id 8 --setuser root --setgroup root
  5.4 GiB + 988.0 KiB =   5.4 GiB	/usr/bin/ceph-osd -f --cluster ceph --id 0 --setuser root --setgroup root
  5.7 GiB +   1.0 MiB =   5.7 GiB	/usr/bin/ceph-osd -f --cluster ceph --id 11 --setuser root --setgroup root
  6.4 GiB +   1.3 MiB =   6.4 GiB	/usr/bin/ceph-osd -f --cluster ceph --id 9 --setuser root --setgroup root
  7.5 GiB +   1.0 MiB =   7.5 GiB	/usr/bin/ceph-osd -f --cluster ceph --id 7 --setuser root --setgroup root
  7.7 GiB +   1.1 MiB =   7.7 GiB	/usr/bin/ceph-osd -f --cluster ceph --id 5 --setuser root --setgroup root
  8.7 GiB +   1.1 MiB =   8.7 GiB	/usr/bin/ceph-osd -f --cluster ceph --id 1 --setuser root --setgroup root
  9.0 GiB +   1.1 MiB =   9.0 GiB	/usr/bin/ceph-osd -f --cluster ceph --id 3 --setuser root --setgroup root
---------------------------------
                         77.2 GiB
=================================
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;只显示特定的-pid-列表的内存使用情况&quot;&gt;只显示特定的 PID 列表的内存使用情况&lt;/h2&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;[root@node161 ~]# ps_mem -p 6646
 Private  +   Shared  =  RAM used	Program 

  6.4 GiB +   1.2 MiB =   6.4 GiB	ceph-osd
---------------------------------
                          6.4 GiB
=================================
[root@node161 ~]# 
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;每-n-秒打印进程内存&quot;&gt;每 N 秒打印进程内存&lt;/h2&gt;

&lt;p&gt;以下命令每5秒报告一次内存使用情况&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;[root@node161 ~]# ps_mem -p 6646 -w 5
 Private  +   Shared  =  RAM used	Program 

  6.4 GiB +   1.2 MiB =   6.4 GiB	ceph-osd
---------------------------------
                          6.4 GiB
=================================
  6.4 GiB +   1.2 MiB =   6.4 GiB	ceph-osd
---------------------------------
                          6.4 GiB
=================================
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;</content><author><name>Gavin</name></author><category term="Linux" /><summary type="html">概述</summary></entry><entry><title type="html">CentOS6.5 testlink-1.9.10升级到1.9.20</title><link href="http://172.17.73.80:4000/2020/12/29/upgrade_testlink_from_1.9.10_to_1.9.20/" rel="alternate" type="text/html" title="CentOS6.5 testlink-1.9.10升级到1.9.20" /><published>2020-12-29T00:00:00+08:00</published><updated>2020-12-29T00:00:00+08:00</updated><id>http://172.17.73.80:4000/2020/12/29/upgrade_testlink_from_1.9.10_to_1.9.20</id><content type="html" xml:base="http://172.17.73.80:4000/2020/12/29/upgrade_testlink_from_1.9.10_to_1.9.20/">&lt;h1 id=&quot;概述&quot;&gt;概述&lt;/h1&gt;

&lt;p&gt;Lab使用的testlink版本是1.9.10，运行在CentOS6.5上，应大家要求，对testlink进行升级，升级到官方最新1.9.20版本&lt;/p&gt;

&lt;h1 id=&quot;实践&quot;&gt;实践&lt;/h1&gt;

&lt;h2 id=&quot;设置本地源&quot;&gt;设置本地源&lt;/h2&gt;

&lt;h2 id=&quot;备份本地源&quot;&gt;备份本地源&lt;/h2&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;cd /etc/yum.repos.d/;mkdir backup_repo; mv *.repo  mirrors-rpmforge* backup_repo/&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;修改源&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;vi redhat.repo
[rhel6-media]
name=local
baseurl=file:///mnt/cdrom
gpgcheck=0
enabled=1
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;上传镜像并挂载&quot;&gt;上传镜像并挂载&lt;/h2&gt;

&lt;p&gt;上传镜像 ‘rhel-server-6.6-x86_64-dvd.iso’, 并挂载&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;cd /mnt;mkdir cdrom;mount /dev/sr0 /mnt/cdrom/&lt;/code&gt;&lt;/p&gt;

&lt;h2 id=&quot;使用本地源&quot;&gt;使用本地源&lt;/h2&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;yum clean all;yum makecache&lt;/code&gt;&lt;/p&gt;

&lt;h2 id=&quot;卸载旧版php&quot;&gt;卸载旧版php&lt;/h2&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;yum remove php-common&lt;/code&gt;&lt;/p&gt;

&lt;h2 id=&quot;安装rpm升级包&quot;&gt;安装rpm升级包&lt;/h2&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;rpm -Uvh https://mirror.webtatic.com/yum/el6/latest.rpm&lt;/code&gt;&lt;/p&gt;

&lt;h2 id=&quot;安装php56&quot;&gt;安装php5.6&lt;/h2&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;yum install -y php56w php56w-opcache php56w-xml php56w-mcrypt php56w-gd php56w-devel php56w-mysql php56w-intl php56w-mbstring --skip-broken&lt;/code&gt;&lt;/p&gt;

&lt;h2 id=&quot;查看php版本&quot;&gt;查看php版本&lt;/h2&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;[root@localhost mnt]# php -v
PHP 5.6.40 (cli) (built: Jan 12 2019 09:19:57) 
Copyright (c) 1997-2016 The PHP Group
Zend Engine v2.6.0, Copyright (c) 1998-2016 Zend Technologies
    with Zend OPcache v7.0.6-dev, Copyright (c) 1999-2016, by Zend Technologies
[root@localhost mnt]# 
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;升级mysql-55-到-mysql-56&quot;&gt;升级mysql 5.5 到 mysql 5.6&lt;/h2&gt;

&lt;h3 id=&quot;查看升级前版本&quot;&gt;查看升级前版本&lt;/h3&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;[root@localhost mnt]# yum info mysql-server
Loaded plugins: fastestmirror, refresh-packagekit, security
Loading mirror speeds from cached hostfile
 * webtatic: us-east.repo.webtatic.com
Installed Packages
Name        : mysql-server
Arch        : x86_64
Version     : 5.5.38
Release     : 1.el6.remi
Size        : 45 M
Repo        : installed
From repo   : remi
Summary     : The MySQL server and related files
URL         : http://www.mysql.com
License     : GPLv2 with exceptions and LGPLv2 and BSD
Description : MySQL is a multi-user, multi-threaded SQL database server. MySQL is a
            : client/server implementation consisting of a server daemon (mysqld)
            : and many different client programs and libraries. This package contains
            : the MySQL server and some accompanying files and directories.

[root@localhost mnt]# 
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;卸载旧版本mysql&quot;&gt;卸载旧版本mysql&lt;/h3&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;yum remove mysql mysql-server&lt;/code&gt;&lt;/p&gt;

&lt;h3 id=&quot;卸载mysql-client&quot;&gt;卸载mysql-client&lt;/h3&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;yum remove mysql-client&lt;/code&gt;&lt;/p&gt;

&lt;h3 id=&quot;卸载mysql-devel&quot;&gt;卸载mysql-devel&lt;/h3&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;yum remove mysql-devel&lt;/code&gt;&lt;/p&gt;

&lt;h3 id=&quot;添加mysql的yum安装库&quot;&gt;添加MySQL的yum安装库&lt;/h3&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;wget http://dev.mysql.com/get/mysql-community-release-el6-5.noarch.rpm
rpm -ivh mysql-community-release-el6-5.noarch.rpm
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;yum list | grep mysql&lt;/code&gt;, 这样很多更新的MySQL安装包就都有了。&lt;/p&gt;

&lt;p&gt;如有必要，运行下面的命令确保yum安装库是最新的：&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;yum update mysql-community-release&lt;/code&gt;&lt;/p&gt;

&lt;h3 id=&quot;安装mysql&quot;&gt;安装mysql&lt;/h3&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;yum install mysql-server&lt;/code&gt;&lt;/p&gt;

&lt;h3 id=&quot;启动数据库&quot;&gt;启动数据库&lt;/h3&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/init.d/mysqld start&lt;/code&gt;&lt;/p&gt;

&lt;h3 id=&quot;修复mysql&quot;&gt;修复mysql&lt;/h3&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;mysql_upgrade -uroot -pp@ssw0rd&lt;/code&gt;&lt;/p&gt;

&lt;h2 id=&quot;安装testlink-1920&quot;&gt;安装testlink-1.9.20&lt;/h2&gt;

&lt;h3 id=&quot;解压testlink-1920&quot;&gt;解压testlink-1.9.20&lt;/h3&gt;
&lt;p&gt;略&lt;/p&gt;

&lt;h3 id=&quot;备份旧版testlink数据库&quot;&gt;备份旧版testlink数据库&lt;/h3&gt;

&lt;h4 id=&quot;先备份后导入备份库&quot;&gt;先备份，后导入备份库&lt;/h4&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;mysql -uroot -pp@ssw0rd&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;create database testlink_bak;&lt;/code&gt;&lt;/p&gt;

&lt;h4 id=&quot;导出旧库数据&quot;&gt;导出旧库数据&lt;/h4&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;mysqldump -uroot -pp@ssw0rd testlink &amp;gt; testlink_backup.sql&lt;/code&gt;&lt;/p&gt;

&lt;h4 id=&quot;导入到备份数据库中&quot;&gt;导入到备份数据库中&lt;/h4&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;mysql -uroot -pp@ssw0rd testlink_bak &amp;lt; testlink_backup.sql&lt;/code&gt;&lt;/p&gt;

&lt;h4 id=&quot;将旧testlink-db切换到testlink_bak&quot;&gt;将旧testlink db切换到testlink_bak&lt;/h4&gt;

&lt;p&gt;Step1. 修改config_db.conf，并重启httpd服务&lt;/p&gt;

&lt;p&gt;Step2. 尝试访问旧版testlink报错&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;[root@localhost logs]# mysql -ubigtera -p111111 testlink_bak
Warning: Using a password on the command line interface can be insecure.
ERROR 1044 (42000): Access denied for user 'bigtera'@'localhost' to database 'testlink_bak'
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;mysql -uroot -pp@ssw0rd testlink_bak
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;执行&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;GRANT ALL PRIVILEGES ON *.* TO 'bigtera'@'localhost' IDENTIFIED BY '111111';
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;ui-安装新testlink&quot;&gt;UI 安装新testlink&lt;/h3&gt;

&lt;h4 id=&quot;安装新版testlink&quot;&gt;安装新版testlink&lt;/h4&gt;

&lt;p&gt;如果不先修复mysql，在安装过程中会报错：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;TestLink setup will now attempt to setup the database:

Creating connection to Database Server:OK!

Database testlink_20 does not exist.
Will attempt to create:
Creating database `testlink_20`:OK!

 ============================================================================== 
 DB Access Error - debug_print_backtrace() OUTPUT START 
 ATTENTION: Enabling more debug info will produce path disclosure weakness (CWE-200) 
            Having this additional Information could be useful for reporting 
            issue to development TEAM. 
 ============================================================================== 
#0  database-&amp;gt;exec_query() called at [/var/www/html/testlink-1.9.20/install/installUtils.php:571]
#1  _mysql_assign_grants() called at [/var/www/html/testlink-1.9.20/install/installUtils.php:311]
#2  create_user_for_db() called at [/var/www/html/testlink-1.9.20/install/installNewDB.php:420]
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;创建账户时：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;CREATE USER 'bigtera'@'localhost' IDENTIFIED BY '111111';

ERROR 1558 (HY000): Column count of mysql.user is wrong. Expected 43, found 42. Created with MySQL 50538, now running 50650. Please use mysql_upgrade to fix this error.
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;执行sql&quot;&gt;执行sql&lt;/h4&gt;

&lt;p&gt;先修改，再执行：&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;mysql -uroot -pp@ssw0rd testlink_20 &amp;lt; /var/www/html/testlink-1.9.20/install/sql/mysql/testlink_create_udf0.sql&lt;/code&gt;&lt;/p&gt;

&lt;h4 id=&quot;修改新版testlink-db指向testlink这个db&quot;&gt;修改新版testlink db，指向testlink这个db&lt;/h4&gt;

&lt;p&gt;需要重启httpd服务&lt;/p&gt;

&lt;h4 id=&quot;ui访问新版testlink&quot;&gt;UI访问新版testlink&lt;/h4&gt;

&lt;p&gt;提示要升级db，执行：&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;mysql -uroot -pp@ssw0rd testlink&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;然后执行下面操作：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;alter table platforms add enable_on_design tinyint(1) unsigned NOT NULL default '0';
alter table platforms add enable_on_execution tinyint(1) unsigned NOT NULL default '1';

CREATE OR REPLACE VIEW /*prefix*/latest_exec_by_testplan
AS SELECT tcversion_id, testplan_id, MAX(id) AS id
FROM /*prefix*/executions
GROUP BY tcversion_id,testplan_id;

CREATE TABLE /*prefix*/testplan_platforms (
  id int(10) unsigned NOT NULL auto_increment,
  testplan_id int(10) unsigned NOT NULL,
  platform_id int(10) unsigned NOT NULL,
  active tinyint(1) NOT NULL default '1',
  PRIMARY KEY (id),
  UNIQUE KEY /*prefix*/idx_testplan_platforms(testplan_id,platform_id)
) DEFAULT CHARSET=utf8 COMMENT='Connects a testplan with platforms';


CREATE TABLE /*prefix*/testcase_platforms (
  id int(10) unsigned NOT NULL AUTO_INCREMENT,
  testcase_id int(10) unsigned NOT NULL DEFAULT '0',
  tcversion_id int(10) unsigned NOT NULL DEFAULT '0',
  platform_id int(10) unsigned NOT NULL DEFAULT '0',
  PRIMARY KEY (id),
  UNIQUE KEY idx01_testcase_platform (testcase_id,tcversion_id,platform_id),
  KEY idx02_testcase_platform (tcversion_id)
) DEFAULT CHARSET=utf8;

CREATE OR REPLACE VIEW /*prefix*/tcversions_without_platforms
AS SELECT
   NHTCV.parent_id AS testcase_id,
   NHTCV.id AS id
FROM /*prefix*/nodes_hierarchy NHTCV
WHERE NHTCV.node_type_id = 4 AND
NOT(EXISTS(SELECT 1 FROM /*prefix*/testcase_platforms TCPL
           WHERE TCPL.tcversion_id = NHTCV.id));
           
CREATE TABLE /*prefix*/baseline_l1l2_context (
  id int(10) unsigned NOT NULL AUTO_INCREMENT,
  testplan_id int(10) unsigned NOT NULL DEFAULT '0',
  platform_id int(10) unsigned NOT NULL DEFAULT '0',
  being_exec_ts timestamp NOT NULL,
  end_exec_ts timestamp NOT NULL,
  creation_ts timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (id),
  UNIQUE KEY udx1 (testplan_id,platform_id,creation_ts)
) DEFAULT CHARSET=utf8;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;然后执行如下操作，升级testlink db&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;mysql -uroot -pp@ssw0rd testlink &amp;lt; /var/www/html/testlink-1.9.20/install/sql/alter_tables/1.9.10/mysql/DB.1.9.10/step1/db_data_update.sql


mysql -uroot -pp@ssw0rd testlink &amp;lt; /var/www/html/testlink-1.9.20/install/sql/alter_tables/1.9.11/mysql/DB.1.9.11/step1/db_schema_update.sql
mysql -uroot -pp@ssw0rd testlink &amp;lt; /var/www/html/testlink-1.9.20/install/sql/alter_tables/1.9.11/mysql/DB.1.9.11/stepZ/z_final_step.sql

mysql -uroot -pp@ssw0rd testlink &amp;lt; /var/www/html/testlink-1.9.20/install/sql/alter_tables/1.9.12/mysql/DB.1.9.12/step1/db_schema_update.sql
mysql -uroot -pp@ssw0rd testlink &amp;lt; /var/www/html/testlink-1.9.20/install/sql/alter_tables/1.9.12/mysql/DB.1.9.12/stepZ/z_final_step.sql


mysql -uroot -pp@ssw0rd testlink &amp;lt; /var/www/html/testlink-1.9.20/install/sql/alter_tables/1.9.13/mysql/DB.1.9.13/step1/db_schema_update.sql
mysql -uroot -pp@ssw0rd testlink &amp;lt; /var/www/html/testlink-1.9.20/install/sql/alter_tables/1.9.13/mysql/DB.1.9.13/stepZ/z_final_step.sql


mysql -uroot -pp@ssw0rd testlink &amp;lt; /var/www/html/testlink-1.9.20/install/sql/alter_tables/1.9.14/mysql/DB.1.9.14/step1/db_schema_update.sql
mysql -uroot -pp@ssw0rd testlink &amp;lt; /var/www/html/testlink-1.9.20/install/sql/alter_tables/1.9.14/mysql/DB.1.9.14/stepZ/z_final_step.sql


mysql -uroot -pp@ssw0rd testlink &amp;lt; /var/www/html/testlink-1.9.20/install/sql/alter_tables/1.9.15/mysql/DB.1.9.15/step1/db_schema_update.sql
mysql -uroot -pp@ssw0rd testlink &amp;lt; /var/www/html/testlink-1.9.20/install/sql/alter_tables/1.9.15/mysql/DB.1.9.15/stepZ/z_final_step.sql


mysql -uroot -pp@ssw0rd testlink &amp;lt; /var/www/html/testlink-1.9.20/install/sql/alter_tables/1.9.16/mysql/DB.1.9.16/step1/db_schema_update.sql
mysql -uroot -pp@ssw0rd testlink &amp;lt; /var/www/html/testlink-1.9.20/install/sql/alter_tables/1.9.16/mysql/DB.1.9.16/stepZ/z_final_step.sql

mysql -uroot -pp@ssw0rd testlink &amp;lt; /var/www/html/testlink-1.9.20/install/sql/alter_tables/1.9.17/mysql/DB.1.9.17/step1/db_schema_update.sql
mysql -uroot -pp@ssw0rd testlink &amp;lt; /var/www/html/testlink-1.9.20/install/sql/alter_tables/1.9.17/mysql/DB.1.9.17/stepZ/z_final_step.sql


mysql -uroot -pp@ssw0rd testlink &amp;lt; /var/www/html/testlink-1.9.20/install/sql/alter_tables/1.9.18/mysql/DB.1.9.18/step1/db_schema_update.sql
mysql -uroot -pp@ssw0rd testlink &amp;lt; /var/www/html/testlink-1.9.20/install/sql/alter_tables/1.9.18/mysql/DB.1.9.18/stepZ/z_final_step.sql


mysql -uroot -pp@ssw0rd testlink &amp;lt; /var/www/html/testlink-1.9.20/install/sql/alter_tables/1.9.19/mysql/DB.1.9.19/step1/db_schema_update.sql
mysql -uroot -pp@ssw0rd testlink &amp;lt; /var/www/html/testlink-1.9.20/install/sql/alter_tables/1.9.19/mysql/DB.1.9.19/stepZ/z_final_step.sql


mysql -uroot -pp@ssw0rd testlink &amp;lt; /var/www/html/testlink-1.9.20/install/sql/alter_tables/1.9.20/mysql/DB.1.9.20/step1/db_schema_update.sql
mysql -uroot -pp@ssw0rd testlink &amp;lt; /var/www/html/testlink-1.9.20/install/sql/alter_tables/1.9.20/mysql/DB.1.9.20/stepZ/z_final_step.sql
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;至此，升级结束，可以删除旧版本testlink，重命名新版本testlink，并使用UI访问新版本testlink。&lt;/p&gt;</content><author><name>Gavin</name></author><category term="Linux" /><category term="shell" /><summary type="html">概述</summary></entry><entry><title type="html">基于Cobbler自动部署OS与使用指</title><link href="http://172.17.73.80:4000/2020/10/09/Cobbler-based_automatic_install_OS_and_usage_guide/" rel="alternate" type="text/html" title="基于Cobbler自动部署OS与使用指" /><published>2020-10-09T00:00:00+08:00</published><updated>2020-10-09T00:00:00+08:00</updated><id>http://172.17.73.80:4000/2020/10/09/Cobbler-based_automatic_install_OS_and_usage_guide</id><content type="html" xml:base="http://172.17.73.80:4000/2020/10/09/Cobbler-based_automatic_install_OS_and_usage_guide/">&lt;h1 id=&quot;ip规划&quot;&gt;IP规划&lt;/h1&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;分类&lt;/th&gt;
      &lt;th&gt;IP&lt;/th&gt;
      &lt;th&gt;netmask&lt;/th&gt;
      &lt;th&gt;gateway&lt;/th&gt;
      &lt;th&gt;说明&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt;172.17.75.236&lt;/td&gt;
      &lt;td&gt;255.255.252.0&lt;/td&gt;
      &lt;td&gt;172.17.75.254&lt;/td&gt;
      &lt;td&gt;cobbler manager地址&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;cobbler&lt;/td&gt;
      &lt;td&gt;172.10.0.1&lt;/td&gt;
      &lt;td&gt;255.255.255.0&lt;/td&gt;
      &lt;td&gt;172.10.0.255&lt;/td&gt;
      &lt;td&gt;cobbler dhcp server地址(domain-name-servers)，&lt;strong&gt;对应ESXi PXE网络&lt;/strong&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt;10.16.172.236&lt;/td&gt;
      &lt;td&gt;255.255.255.0&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt;cobbler挂载外部ISO镜像地址，也可使用cobbler manager地址&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;DHCP&lt;/td&gt;
      &lt;td&gt;172.10.0.0&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt;DHCP server的subnet&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt;255.255.255.0&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt;DHCP option routers&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt;172.10.0.254&lt;/td&gt;
      &lt;td&gt;DHCP option subnet-mask&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt;172.10.0.100~172.10.0.200&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt;DHCP range dynamic-bootp&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;说明：&lt;/p&gt;

&lt;p&gt;​    cobbler必须要有PXE网络，同时推荐OS分区空间要&amp;gt;= 300G,或额外增加一个分区用于ISO挂载使用。只所以占用空间，更多是因为cobbler repo sync后将镜像中文件复制一份出来，建议删除repo，并增加定时任务清理存在的repo，以期保证空间的充足。&lt;/p&gt;

&lt;h1 id=&quot;部署cobbler&quot;&gt;部署cobbler&lt;/h1&gt;

&lt;h2 id=&quot;查看系统信息&quot;&gt;查看系统信息&lt;/h2&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;[root@cobbler-236 ~]# cat /etc/redhat-release
CentOS Linux release 7.6.1810 (Core) 
[root@cobbler-236 ~]# uname -r
3.10.0-957.el7.x86_64
[root@cobbler-236 ~]# hostname -I
172.17.75.236 
[root@cobbler-236 ~]# 
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;配置ip&quot;&gt;配置IP&lt;/h2&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;[root@cobbler-236 network-scripts]# pwd
/etc/sysconfig/network-scripts
[root@cobbler-236 network-scripts]# ls ifcfg-ens*
ifcfg-ens160  ifcfg-ens192
[root@cobbler-236 network-scripts]# cat ifcfg-ens160 
TYPE=Ethernet
PROXY_METHOD=none
BROWSER_ONLY=no
BOOTPROTO=static
DEFROUTE=yes
IPV4_FAILURE_FATAL=no
IPV6INIT=yes
IPV6_AUTOCONF=yes
IPV6_DEFROUTE=yes
IPV6_FAILURE_FATAL=no
IPV6_ADDR_GEN_MODE=stable-privacy
NAME=ens160
UUID=fad33a53-af8c-48dd-9cb9-46565a8cac98
DEVICE=ens160
ONBOOT=yes
IPADDR0=172.17.75.236
PREFIX=24
DNS1=8.8.8.8
DNS2=114.114.114.114
GATEWAY0=172.17.75.254
[root@cobbler-236 network-scripts]# cat ifcfg-ens192 
TYPE=Ethernet
PROXY_METHOD=none
BROWSER_ONLY=no
BOOTPROTO=none
DEFROUTE=yes
IPV4_FAILURE_FATAL=no
IPV6INIT=yes
IPV6_AUTOCONF=yes
IPV6_DEFROUTE=yes
IPV6_FAILURE_FATAL=no
IPV6_ADDR_GEN_MODE=stable-privacy
NAME=ens192
DEVICE=ens192
ONBOOT=yes
IPADDR=172.10.0.1
PREFIX=24
[root@cobbler-236 network-scripts]# 
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;重启网络服务，并查看ip地址:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;[root@cobbler-236 network-scripts]# systemctl restart network.service
[root@cobbler-236 network-scripts]# ip a
1: lo: &amp;lt;LOOPBACK,UP,LOWER_UP&amp;gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host 
       valid_lft forever preferred_lft forever
2: ens160: &amp;lt;BROADCAST,MULTICAST,UP,LOWER_UP&amp;gt; mtu 1500 qdisc mq state UP group default qlen 1000
    link/ether 00:50:56:9e:8c:1e brd ff:ff:ff:ff:ff:ff
    inet 172.17.75.236/16 brd 172.17.255.255 scope global noprefixroute ens160
       valid_lft forever preferred_lft forever
    inet6 fe80::4d94:54dc:9eb2:2864/64 scope link noprefixroute 
       valid_lft forever preferred_lft forever
3: ens192: &amp;lt;BROADCAST,MULTICAST,UP,LOWER_UP&amp;gt; mtu 1500 qdisc mq state UP group default qlen 1000
    link/ether 00:50:56:9e:07:2b brd ff:ff:ff:ff:ff:ff
    inet 172.10.0.1/24 brd 172.10.0.255 scope global noprefixroute ens192
       valid_lft forever preferred_lft forever
    inet6 fe80::ddb7:d654:f5be:b66a/64 scope link noprefixroute 
       valid_lft forever preferred_lft forever
[root@cobbler-236 network-scripts]# 
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;配置-ssh&quot;&gt;配置 ssh&lt;/h2&gt;

&lt;p&gt;默认 ssh_config 启用了 DNS 解析，导致每次远程 ssh 时都特别慢&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;[root@cobbler-236 ~]# sed -i 's%#UseDNS yes%UseDNS no%' /etc/ssh/sshd_config
[root@cobbler-236 ~]# service sshd restart
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;关闭防火墙selinux等&quot;&gt;关闭防火墙、selinux等&lt;/h2&gt;

&lt;h3 id=&quot;关闭防火墙&quot;&gt;关闭防火墙&lt;/h3&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;systemctl stop firewalld.service        # 停止firewall
systemctl disable firewalld.service     # 禁止firewall开机启动
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;关闭selinux&quot;&gt;关闭SELinux&lt;/h3&gt;

&lt;p&gt;编辑/etc/selinux/config文件，将SELINUX的值设置为disabled，下次开机SELinux就不会启动了。接着再执行如下命令,注意 setenforce 后面有空格:&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;setenforce 0&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;查看SELinux状态,执行getenforce命令, Disabled 表示已经关闭了。&lt;/p&gt;

&lt;h2 id=&quot;安装wget&quot;&gt;安装wget&lt;/h2&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;yum -y install wget
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;安装epel源&quot;&gt;安装epel源&lt;/h2&gt;

&lt;p&gt;cobbler由epel源提供，所以需要事先配置epel的yum源。&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;wget -O /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-7.repo&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;这里使用的是阿里的epel源，你也可以直接 &lt;code class=&quot;highlighter-rouge&quot;&gt;yum install epel-release&lt;/code&gt;&lt;/p&gt;

&lt;h2 id=&quot;新增一个分区增加iso自动挂载&quot;&gt;新增一个分区，增加ISO自动挂载&lt;/h2&gt;

&lt;p&gt;手动创建一个空的目录/var/www/cobbler，此时新增一个300~500G大小的分区（假如分区是sdb，以此为示例），执行 &lt;code class=&quot;highlighter-rouge&quot;&gt;msfs -t xfs /dev/sdb&lt;/code&gt;，并将该分区挂载到这个目录:&lt;/p&gt;

&lt;p&gt;1) &lt;code class=&quot;highlighter-rouge&quot;&gt;mkfs.xfs /dev/sdb&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;2) &lt;code class=&quot;highlighter-rouge&quot;&gt;mount /dev/sdb /var/www/cobbler/&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;3) &lt;code class=&quot;highlighter-rouge&quot;&gt;使用blkid获取uuid&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;用于/etc/fstab文件的编辑,比如：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;[root@cobbler-236 ~]# blkid 
/dev/mapper/centos-root: UUID=&quot;f43b464c-78b9-4877-9c9b-72c5f01eb69d&quot; TYPE=&quot;xfs&quot; 
/dev/sda2: UUID=&quot;bwMXPE-QMkC-gbwC-vCxn-q7W0-HCss-RBsmtK&quot; TYPE=&quot;LVM2_member&quot; 
/dev/sdb: UUID=&quot;eaa27ae0-63bd-4d9e-a683-35d785269848&quot; TYPE=&quot;xfs&quot; 
/dev/sda1: UUID=&quot;5d3aa690-2d88-45c3-b647-1efe372980b6&quot; TYPE=&quot;xfs&quot; 
/dev/mapper/centos-swap: UUID=&quot;cfcd9e7b-2b02-45fc-a097-21c3f871ea92&quot; TYPE=&quot;swap&quot; 
/dev/mapper/centos-home: UUID=&quot;82402837-18a5-471f-87f9-d50eb73914df&quot; TYPE=&quot;xfs&quot; 
[root@cobbler-236 ~]# 
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;10.16.172.101:/vol/share/Builds/buildwindow/ /mnt/buildwindow nfs rsize=8192,wsize=8192,timeo=14,intr
UUID=eaa27ae0-63bd-4d9e-a683-35d785269848  /var/www/cobbler        xfs     defaults        0 2
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;安装cobbler&quot;&gt;安装cobbler&lt;/h2&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;yum -y install cobbler cobbler-web pykickstart debmirror httpd dhcp tftp-server xinetd syslinux&lt;/code&gt;&lt;/p&gt;

&lt;h2 id=&quot;启动相关服务并设置开机自启&quot;&gt;启动相关服务并设置开机自启&lt;/h2&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;systemctl start httpd
systemctl enable httpd
systemctl start cobblerd
systemctl enable cobblerd
systemctl start rsyncd
systemctl enable rsyncd
# systemctl enable dhcpd
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;检查cobbler配置&quot;&gt;检查cobbler配置&lt;/h2&gt;

&lt;p&gt;通过cobbler自带的命令检查，而后逐一按提示解决。&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;cobbler check&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;出现如下提示信息：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;[root@cobbler-236 ~]# cobbler check
The following are potential configuration items that you may want to fix:

1 : The 'server' field in /etc/cobbler/settings must be set to something other than localhost, or kickstarting features will not work.  This should be a resolvable hostname or IP for the boot server as reachable by all machines that will use it.
2 : For PXE to be functional, the 'next_server' field in /etc/cobbler/settings must be set to something other than 127.0.0.1, and should match the IP of the boot server on the PXE network.
3 : SELinux is enabled. Please review the following wiki page for details on ensuring cobbler works correctly in your SELinux environment:
    https://github.com/cobbler/cobbler/wiki/Selinux
4 : change 'disable' to 'no' in /etc/xinetd.d/tftp
5 : Some network boot-loaders are missing from /var/lib/cobbler/loaders, you may run 'cobbler get-loaders' to download them, or, if you only want to handle x86/x86_64 netbooting, you may ensure that you have installed a *recent* version of the syslinux package installed and can ignore this message entirely.  Files in this directory, should you want to support all architectures, should include pxelinux.0, menu.c32, elilo.efi, and yaboot. The 'cobbler get-loaders' command is the easiest way to resolve these requirements.
6 : comment out 'dists' on /etc/debmirror.conf for proper debian support
7 : comment out 'arches' on /etc/debmirror.conf for proper debian support
8 : The default password used by the sample templates for newly installed machines (default_password_crypted in /etc/cobbler/settings) is still set to 'cobbler' and should be changed, try: &quot;openssl passwd -1 -salt 'random-phrase-here' 'your-password-here'&quot; to generate new one
9 : fencing tools were not found, and are required to use the (optional) power management features. install cman or fence-agents to use them

Restart cobblerd and then run 'cobbler sync' to apply changes.
[root@cobbler-236 ~]# 
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;如上各问题的解决方法如下所示：&lt;/p&gt;

&lt;p&gt;1、修改/etc/cobbler/settings文件，将默认server的127.0.0.1替换为本机IP地址(cobbler地址)&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;sed -i 's#^server: 127.0.0.1#server: 172.10.0.1#' /etc/cobbler/settings&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;2、修改/etc/cobbler/settings文件，将默认next_server的127.0.0.1替换为本机IP地址&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;sed -i 's#^next_server: 127.0.0.1#next_server: 172.10.0.1#' /etc/cobbler/settings&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;3、将/etc/xinetd.d/tftp中disable改为no&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;disable = no&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;4、执行 &lt;code class=&quot;highlighter-rouge&quot;&gt;cobbler get-loaders&lt;/code&gt; 命令即可&lt;/p&gt;

&lt;p&gt;可能会出现timeout，没关系，多执行几次，直到成功为止（会出现TASK COMPLETE）。&lt;/p&gt;

&lt;p&gt;5、注释/etc/debmirror.conf文件中的@dists=”sid”;一行&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;sed -i 's/@dists=&quot;sid&quot;;/#@dists=&quot;sid&quot;;/' /etc/debmirror.conf&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;6、注释/etc/debmirror.conf文件中的@arches=”i386”;一行&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;sed -i 's/@arches=&quot;i386&quot;;/#@arches=&quot;i386&quot;;/' /etc/debmirror.conf&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;7、 防止循环装系统，适用于服务器第一启动项是PXE启动。
&lt;code class=&quot;highlighter-rouge&quot;&gt;sed -i 's/pxe_just_once: 0/pxe_just_once: 1/' /etc/cobbler/settings&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;8、设置新系统默认的root密码&lt;/p&gt;

&lt;p&gt;执行  &lt;code class=&quot;highlighter-rouge&quot;&gt;openssl passwd -1 -salt $(openssl rand -hex 4)&lt;/code&gt; 生成密码，并用其替换/etc/cobbler/settings文件中default_password_crypted参数的值；&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;[root@cobbler-236 ~]# openssl passwd -1 -salt $(openssl rand -hex 4)
Password: 
$1$2a25cee5$NK/O/uGlcl3tue7mc/Iy5/
[root@cobbler-236 ~]# 
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;vi /etc/cobbler/settings

default_password_crypted: &quot;$1$2a25cee5$NK/O/uGlcl3tue7mc/Iy5/&quot;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;安装其他包&quot;&gt;安装其他包&lt;/h2&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;yum -y install fence-agents
yum -y install perl-JSON-PP
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;重启cobblerd并同步检查&quot;&gt;重启cobblerd并同步检查&lt;/h2&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;systemctl restart cobblerd
cobbler sync
cobbler check
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;如果出现如下信息，表明check ok：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;[root@cobbler-236 ~]# cobbler check
No configuration problems found.  All systems go.
[root@cobbler-236 ~]# 
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;通过cobbler来管理dhcp&quot;&gt;通过cobbler来管理dhcp&lt;/h2&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;[root@cobbler-236 ~]# sed -i 's#manage_dhcp: 0#manage_dhcp: 1#' /etc/cobbler/settings
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;配置dhcp服务&quot;&gt;配置DHCP服务&lt;/h2&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;vi /etc/cobbler/dhcp.template&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;subnet 172.10.0.0 netmask 255.255.255.0 {
     option routers             172.10.0.254;
     option domain-name-servers 172.10.0.1;
     option subnet-mask         255.255.255.0;
     range dynamic-bootp        172.10.0.100 172.10.0.200;
     default-lease-time         21600;
     max-lease-time             43200;
     next-server                $next_server;
     class &quot;pxeclients&quot; {
          match if substring (option vendor-class-identifier, 0, 9) = &quot;PXEClient&quot;;
          if option pxe-system-type = 00:02 {
                  filename &quot;ia64/elilo.efi&quot;;
          } else if option pxe-system-type = 00:06 {
                  filename &quot;grub/grub-x86.efi&quot;;
          } else if option pxe-system-type = 00:07 {
                  filename &quot;grub/grub-x86_64.efi&quot;;
          } else if option pxe-system-type = 00:09 {
                  filename &quot;grub/grub-x86_64.efi&quot;;
          } else {
                  filename &quot;pxelinux.0&quot;;
          }
     }

}
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;然后重启cobbler服务并同步配置&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;systemctl restart cobblerd
cobbler sync
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h1 id=&quot;部署nginx&quot;&gt;部署Nginx&lt;/h1&gt;

&lt;h2 id=&quot;安装nginx&quot;&gt;安装Nginx&lt;/h2&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;yum -y install nginx&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;安装的版本为：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;[root@cobbler-236 ~]# nginx -v
nginx version: nginx/1.16.1
[root@cobbler-236 ~]# 
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;如果要卸载的话，执行 &lt;code class=&quot;highlighter-rouge&quot;&gt;yum -y remove nginx  &lt;/code&gt;&lt;/p&gt;

&lt;h2 id=&quot;设置开机启动&quot;&gt;设置开机启动&lt;/h2&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;systemctl enable nginx&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;其他指令参考如下：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;service nginx start      # 启动 nginx 服务
service nginx stop       # 停止 nginx 服务
service nginx restart    # 重启 nginx 服务
service nginx reload     # 重新加载配置，一般是在修改过 nginx 配置文件时使用。
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;配置nginx&quot;&gt;配置Nginx&lt;/h2&gt;

&lt;p&gt;由于Nginx默认使用80端口，而80端口又被cobbler web占用，需要修改Nginx的默认端口，以及Nginx的其他配置，下文结束修改/etc/nginx/nginx.conf。&lt;/p&gt;

&lt;h3 id=&quot;1-修改nginx启用账号&quot;&gt;1. 修改Nginx启用账号&lt;/h3&gt;

&lt;p&gt;默认是nginx这个账号启用nginx服务的，需要改成root&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;user root;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;2-修改默认端口&quot;&gt;2. 修改默认端口&lt;/h3&gt;

&lt;p&gt;下面改成81：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;        listen       81 default_server;
        listen       [::]:81 default_server;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;​&lt;/p&gt;

&lt;h3 id=&quot;3-指定location&quot;&gt;3. 指定location&lt;/h3&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;        location / {
            root /var/www/html;
            autoindex on;
        }
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;同时，执行如下命令：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;cd /var/www
rm -rf html
ln -s /var/lib/tftpboot /var/www/html
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;/etc/nginx/nginx.conf内容参考如下：&lt;/p&gt;

&lt;p&gt;&lt;img class=&quot;shadow&quot; src=&quot;/img/in-post/cobbler/image-20200927163055922.png&quot; width=&quot;1200&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;4-autoinitsh配置文件的存放&quot;&gt;4. autoinit.sh配置文件的存放&lt;/h3&gt;

&lt;p&gt;将autoinit.sh脚本，复制到 /var/lib/tftpboot/netconf/目录下：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;cp autoinit.sh /var/lib/tftpboot/netconf/
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h1 id=&quot;手动安装实践&quot;&gt;手动安装实践&lt;/h1&gt;

&lt;h2 id=&quot;安装centos7&quot;&gt;安装CentOS7&lt;/h2&gt;

&lt;h3 id=&quot;1-导入镜像&quot;&gt;1. 导入镜像：&lt;/h3&gt;

&lt;p&gt;以官方CentOS为示例，先在cobbler对应vm上挂载iso，然后ssh到后端执行：&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;mount /dev/cdrom  /mnt/&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;在导入期间，可以在后端查看导入进程信息：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;[root@cobbler-236 ~]# ps -ef |grep rsync
root      4661     1  0 Sep13 ?        00:00:00 /usr/bin/rsync --daemon --no-detach
root     14477 12531 21 23:09 ?        00:00:02 rsync -a /mnt/ /var/www/cobbler/ks_mirror/centos-7-x86_64 --progress
root     14478 14477  0 23:09 ?        00:00:00 rsync -a /mnt/ /var/www/cobbler/ks_mirror/centos-7-x86_64 --progress
root     14479 14478 35 23:09 ?        00:00:04 rsync -a /mnt/ /var/www/cobbler/ks_mirror/centos-7-x86_64 --progress
root     14497 12822  0 23:10 pts/3    00:00:00 grep --color=auto rsync
[root@cobbler-236 ~]# 
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;如果rsync进程消失，表明import结束：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;[root@localhost network-scripts]# ps -ef | grep rsync
root      4854     1  0 Sep16 ?        00:00:00 /usr/bin/rsync --daemon --no-detach
root     11284  9927  0 11:12 pts/0    00:00:00 grep --color=auto rsync
[root@localhost network-scripts]# 
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;导入完成后生成的文件夹&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;[root@cobbler-236 ks_mirror]# pwd
/var/www/cobbler/ks_mirror
[root@cobbler-236 ks_mirror]# ll
total 0
drwxrwxr-x  8 root root 254 Nov 26  2018 centos-7-x86_64
drwxr-xr-x. 2 root root  62 Sep 17 11:12 config
[root@cobbler-236 ks_mirror]# 
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;2-编辑kickstart文件&quot;&gt;2. 编辑kickstart文件&lt;/h3&gt;

&lt;p&gt;vi /var/lib/cobbler/kickstarts/CentOS-7-x86_64.cfg&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;# Centos7
# This kickstart file should only be used with EL &amp;gt; 5 and/or Fedora &amp;gt; 7.
# For older versions please use the sample.ks kickstart file.
 
#platform=x86, AMD64, or Intel EM64T
# System authorization information
auth --useshadow --passalgo=sha512
# System bootloader configuration
bootloader --location=mbr
# Partition clearing information
clearpart --all --initlabel
# Use text mode install
text
# Firewall configuration
firewall --disable
# Run the Setup Agent on first boot
firstboot --disable
ignoredisk --only-use=sda
# System keyboard
keyboard us
# System language
lang en_US
# Use network installation
url --url=$tree
# If any cobbler repo definitions were referenced in the kickstart profile, include them here.
$yum_repo_stanza
# Network information
$SNIPPET('network_config')
# Reboot after installation
reboot
 
#Root password
rootpw --iscrypted $default_password_crypted
# SELinux configuration
selinux --disabled
# Do not configure the X Window System
skipx
# System timezone
timezone Asia/Shanghai
# Install OS instead of upgrade
install
# Clear the Master Boot Record
zerombr
# Allow anaconda to partition the system as needed
part /boot --fstype=&quot;xfs&quot; --size=300 --ondisk=sda
part swap --fstype=&quot;swap&quot; --size=2048 --ondisk=sda
part / --fstype=&quot;xfs&quot; --grow --size=1 --ondisk=sda
 
%pre
 
$SNIPPET('log_ks_pre')
$SNIPPET('kickstart_start')
$SNIPPET('pre_install_network_config')
# Enable installation monitoring
$SNIPPET('pre_anamon')
%end
 
 
%packages
 
@^minimal
@core
kexec-tools
%end
 
 
%post
 
systemctl disable postfix.service
%end
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;3-修改kickstart文件为自定义的centos-7-x86_64cfg&quot;&gt;3. 修改kickstart文件为自定义的CentOS-7-x86_64.cfg&lt;/h3&gt;

&lt;p&gt;cobbler profile edit –name=CentOS-7-x86_64 –kickstart=/var/lib/cobbler/kickstarts/CentOS-7-x86_64.cfg&lt;/p&gt;

&lt;p&gt;用cobbler profile report查看，Kickstart前后信息已经改变&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;[root@cobbler-236 kickstarts]# cobbler profile report
Name                           : centos-7-x86_64
TFTP Boot Files                : {}
Comment                        : 
DHCP Tag                       : default
Distribution                   : centos-7-x86_64
Enable gPXE?                   : 0
Enable PXE Menu?               : 1
Fetchable Files                : {}
Kernel Options                 : {}
Kernel Options (Post Install)  : {}
Kickstart                      : /var/lib/cobbler/kickstarts/sample_end.ks
Kickstart Metadata             : {}
Management Classes             : []
Management Parameters          : &amp;lt;&amp;lt;inherit&amp;gt;&amp;gt;
Name Servers                   : []
Name Servers Search Path       : []
Owners                         : ['admin']
Parent Profile                 : 
Internal proxy                 : 
Red Hat Management Key         : &amp;lt;&amp;lt;inherit&amp;gt;&amp;gt;
Red Hat Management Server      : &amp;lt;&amp;lt;inherit&amp;gt;&amp;gt;
Repos                          : []
Server Override                : &amp;lt;&amp;lt;inherit&amp;gt;&amp;gt;
Template Files                 : {}
Virt Auto Boot                 : 1
Virt Bridge                    : xenbr0
Virt CPUs                      : 2
Virt Disk Driver Type          : raw
Virt File Size(GB)             : 5
Virt Path                      : 
Virt RAM (MB)                  : 4096
Virt Type                      : kvm

[root@cobbler-236 kickstarts]# cobbler profile edit --name=CentOS-7-x86_64 --kickstart=/var/lib/cobbler/kickstarts/CentOS-7-x86_64.cfg
[root@cobbler-236 kickstarts]# cobbler profile report
Name                           : CentOS-7-x86_64
TFTP Boot Files                : {}
Comment                        : 
DHCP Tag                       : default
Distribution                   : centos-7-x86_64
Enable gPXE?                   : 0
Enable PXE Menu?               : 1
Fetchable Files                : {}
Kernel Options                 : {}
Kernel Options (Post Install)  : {}
Kickstart                      : /var/lib/cobbler/kickstarts/CentOS-7-x86_64.cfg
Kickstart Metadata             : {}
Management Classes             : []
Management Parameters          : &amp;lt;&amp;lt;inherit&amp;gt;&amp;gt;
Name Servers                   : []
Name Servers Search Path       : []
Owners                         : ['admin']
Parent Profile                 : 
Internal proxy                 : 
Red Hat Management Key         : &amp;lt;&amp;lt;inherit&amp;gt;&amp;gt;
Red Hat Management Server      : &amp;lt;&amp;lt;inherit&amp;gt;&amp;gt;
Repos                          : []
Server Override                : &amp;lt;&amp;lt;inherit&amp;gt;&amp;gt;
Template Files                 : {}
Virt Auto Boot                 : 1
Virt Bridge                    : xenbr0
Virt CPUs                      : 2
Virt Disk Driver Type          : raw
Virt File Size(GB)             : 5
Virt Path                      : 
Virt RAM (MB)                  : 4096
Virt Type                      : kvm

[root@cobbler-236 kickstarts]# 
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;4-重启xinetd服务&quot;&gt;4. 重启xinetd服务&lt;/h3&gt;

&lt;p&gt;systemctl restart xinetd&lt;/p&gt;

&lt;h3 id=&quot;5-安装系统系统后自动设定ip地址&quot;&gt;5. 安装系统系统后，自动设定IP地址&lt;/h3&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;[root@cobbler-236 ~]# cobbler system add --name=CentOS-7-x86_64 --mac=00:50:56:9e:ee:2e  --profile=CentOS-7-X86_64  --ip-address=172.17.73.76 --subnet=255.255.252.0 --gateway=172.17.75.254 --interface=eth0 --static=1 --hostname=wyz_au01 --name-servers=&quot;114.114.114.114 8.8.8.8&quot;
[root@cobbler-236 ~]# cobbler system list
   CentOS-7-x86_64
[root@cobbler-236 ~]# cobbler sync
task started: 2020-09-17_165512_sync

&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;网络组bond：&lt;/p&gt;

&lt;p&gt;4个网口：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;cobbler system edit --name=CentOS-7-x86_64 --profile=CentOS-7-X86_64 --interface=eth0 --mac=00:50:56:9e:ee:2e --interface-type=bond_slave --interface-master=bond0
cobbler system edit --name=CentOS-7-x86_64 --profile=CentOS-7-X86_64 --interface=eth1 --mac=00:50:56:9e:ee:2e --interface-type=bond_slave --interface-master=bond0
cobbler system edit --name=CentOS-7-x86_64 --profile=CentOS-7-X86_64 --interface=bond0 --interface-type=bond --bonding-opts=&quot;mode=active-backup miimon=100&quot; --ip-address=172.17.73.76 --subnet=255.255.252.0 --gateway=172.17.75.254 --static=1

cobbler system edit --name=CentOS-7-x86_64 --profile=CentOS-7-X86_64 --interface=eth2 --mac=00:50:56:9e:cc:0c --interface-type=bond_slave --interface-master=bond1
cobbler system edit --name=CentOS-7-x86_64 --profile=CentOS-7-X86_64 --interface=eth3 --mac=00:50:56:9e:cc:0c --interface-type=bond_slave --interface-master=bond1
cobbler system edit --name=CentOS-7-x86_64 --profile=CentOS-7-X86_64 --interface=bond1 --interface-type=bond --bonding-opts=&quot;mode=active-backup miimon=100&quot; --ip-address=10.1.1.76 --subnet=255.255.255.0 --static=1
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;2个网口：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;cobbler system edit --name=CentOS-7-x86_64 --profile=CentOS-7-X86_64 --interface=eth0 --mac=00:50:56:9e:ee:2e --interface-type=bond_slave --interface-master=bond0
cobbler system edit --name=CentOS-7-x86_64 --profile=CentOS-7-X86_64 --interface=eth1 --mac=00:50:56:9e:cc:0c --interface-type=bond_slave --interface-master=bond1
cobbler system edit --name=CentOS-7-x86_64 --profile=CentOS-7-X86_64 --interface=bond0 --interface-type=bond --bonding-opts=&quot;mode=active-backup miimon=100&quot; --ip-address=172.17.73.76 --subnet=255.255.252.0 --gateway=172.17.75.254 --static=1
cobbler system edit --name=CentOS-7-x86_64 --profile=CentOS-7-X86_64 --interface=bond1 --interface-type=bond --bonding-opts=&quot;mode=active-backup miimon=100&quot; --ip-address=10.1.1.76 --subnet=255.255.255.0 --static=1
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;说明：&lt;/p&gt;

&lt;p&gt;​    上面bond信息仅供参考，并未执行成功，即未正常形成bond关系。&lt;/p&gt;

&lt;p&gt;安装参考：&lt;/p&gt;

&lt;p&gt;https://blog.csdn.net/admin_root1/article/details/84965608&lt;/p&gt;

&lt;h2 id=&quot;ububtu-安装&quot;&gt;Ububtu 安装&lt;/h2&gt;

&lt;p&gt;这个以我们产品为示例。&lt;/p&gt;

&lt;h3 id=&quot;1-挂载镜像&quot;&gt;1. 挂载镜像&lt;/h3&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;cd /var/www/cobbler/ks_mirror
mkdir Scaler-8.0-latest
mount /mnt/buildwindow/xenial/virtualstor_scaler_8.0/builds/2020-09-25_00_33_00/VirtualStor\ Scaler-v8.0-413-xenial~202009250033~5f910ea.iso /var/www/cobbler/ks_mirror/Scaler-8.0-latest
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;2-导入镜像&quot;&gt;2. 导入镜像&lt;/h3&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;cobbler import --path=/var/www/cobbler/ks_mirror/Scaler-8.0-latest --name=Scaler-8.0-latest-x86_64  --arch=x86_64
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;3-新增system-config&quot;&gt;3. 新增system config&lt;/h3&gt;

&lt;p&gt;&lt;img class=&quot;shadow&quot; src=&quot;/img/in-post/cobbler/image-20200925172717405.png&quot; width=&quot;1200&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img class=&quot;shadow&quot; src=&quot;/img/in-post/cobbler/image-20200925172726750.png&quot; width=&quot;1200&quot; /&gt;&lt;/p&gt;

&lt;p&gt;00:50:56:9e:4c:12 是被安装系统所在VM的PXE网络对应的mac地址&lt;/p&gt;

&lt;p&gt;&lt;img class=&quot;shadow&quot; src=&quot;/img/in-post/cobbler/image-20200925172807485.png&quot; width=&quot;1200&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img class=&quot;shadow&quot; src=&quot;/img/in-post/cobbler/image-20200925172816714.png&quot; width=&quot;1200&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img class=&quot;shadow&quot; src=&quot;/img/in-post/cobbler/image-20200925172829380.png&quot; width=&quot;1200&quot; /&gt;&lt;/p&gt;

&lt;p&gt;其他页面未截图，表明使用默认设置。&lt;/p&gt;

&lt;p&gt;然后重启vm，自动进入安装界面。&lt;/p&gt;

&lt;h1 id=&quot;自动化安装脚本的使用&quot;&gt;自动化安装脚本的使用&lt;/h1&gt;

&lt;h2 id=&quot;必要的安装包&quot;&gt;必要的安装包&lt;/h2&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;yum -y install python3
yum -y install python3-pip
yum -y install vim
yum -y install nfs-utils
yum -y install net-tools
yum -y install tmux
pip3 install pyVmomi
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;相关脚本模板准备&quot;&gt;相关脚本/模板准备&lt;/h2&gt;

&lt;p&gt;对于Ubuntu Scaler，无需任何手工干预，其preseed文件目前是自动生成，存放于 &lt;code class=&quot;highlighter-rouge&quot;&gt;/var/lib/tftpboot/netconf&lt;/code&gt;对应版本（安装脚本&lt;strong&gt;PXE_MAP&lt;/strong&gt;处定义的版本信息）目录下，参考如下：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;[root@cobbler-236 netconf]# ls -l
total 8
drwxr-xr-x 2 root root 4096 Oct  3 18:15 8.0
drwxr-xr-x 3 root root   31 Sep 29 16:06 8.0_centos
-rwxr-xr-x 1 root root  405 Sep 27 10:59 autoinit.sh
[root@cobbler-236 netconf]# 
[root@cobbler-236 netconf]# ls -lR
.:
total 8
drwxr-xr-x 2 root root 4096 Oct  3 18:15 8.0
drwxr-xr-x 3 root root   31 Sep 29 16:06 8.0_centos
-rwxr-xr-x 1 root root  405 Sep 27 10:59 autoinit.sh

./8.0:
total 68
-rw-r--r-- 1 root root 557 Oct  2 22:09 interfaces_cobbler-80
-rw-r--r-- 1 root root 555 Oct  9 16:02 interfaces_pytest-80-11
-rw-r--r-- 1 root root 555 Oct  9 16:02 interfaces_pytest-80-12
-rw-r--r-- 1 root root 555 Oct  9 16:02 interfaces_pytest-80-13
-rw-r--r-- 1 root root 555 Oct  9 16:02 interfaces_pytest-80-14
-rw-r--r-- 1 root root 555 Oct  9 16:02 interfaces_pytest-80-15
-rw-r--r-- 1 root root 555 Oct  9 16:02 interfaces_pytest-80-16
-rw-r--r-- 1 root root 555 Oct  9 16:02 interfaces_pytest-80-17
-rw-r--r-- 1 root root 555 Oct  9 16:02 interfaces_pytest-80-18
-rw-r--r-- 1 root root 555 Oct  9 16:02 interfaces_pytest-80-19
-rw-r--r-- 1 root root 555 Oct  9 16:02 interfaces_pytest-80-20
-rw-r--r-- 1 root root 555 Oct  9 16:02 interfaces_pytest-80-21
-rw-r--r-- 1 root root 555 Oct  9 16:02 interfaces_pytest-80-22
-rw-r--r-- 1 root root 555 Oct  9 16:02 interfaces_pytest-80-23
-rw-r--r-- 1 root root 555 Oct  9 16:02 interfaces_pytest-80-24
-rw-r--r-- 1 root root 555 Oct  9 16:02 interfaces_pytest-80-25
-rw-r--r-- 1 root root 555 Oct  9 16:02 interfaces_pytest-80-26

./8.0_centos:
total 0
drwxr-xr-x 2 root root 84 Sep 29 16:06 cobbler-centos-80

./8.0_centos/cobbler-centos-80:
total 16
-rw-r--r-- 1 root root 206 Oct  9 16:37 ifcfg-bond0
-rw-r--r-- 1 root root 165 Oct  9 16:37 ifcfg-bond1
-rw-r--r-- 1 root root  79 Oct  9 16:37 ifcfg-ens160
-rw-r--r-- 1 root root  79 Oct  9 16:37 ifcfg-ens192
[root@cobbler-236 netconf]#
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;而对于CentOS Scaler来说，需要先将 &lt;code class=&quot;highlighter-rouge&quot;&gt;centos-ezs3-auto-8.0.ks&lt;/code&gt; 这个模板，事先存放在&lt;code class=&quot;highlighter-rouge&quot;&gt;/var/lib/cobbler/templates&lt;/code&gt;目录下，当前ks文件，仅支持8.0的CentOS下Scaler的安装，如果将来有其他版本的CentOS，可能需要额外调整安装脚本/新增ks文件。&lt;/p&gt;

&lt;h2 id=&quot;vm配置文件准备&quot;&gt;VM配置文件准备&lt;/h2&gt;

&lt;p&gt;参考示例如下（可以在“vms”中以{}形式，增加其他节点信息）：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;{
    &quot;ostype&quot;:&quot;ubuntu&quot;,
    &quot;version&quot;:&quot;8.0&quot;,
    &quot;isopath&quot;:&quot;latest&quot;,
    &quot;vmyesno&quot;:&quot;yes&quot;,
    &quot;esxuser&quot;:&quot;root&quot;,
    &quot;esxpass&quot;:&quot;p@ssw0rd&quot;,
    &quot;disknum&quot;:2,
    &quot;disksize&quot;:50,
    &quot;osdisk&quot;:&quot;yes&quot;,
    &quot;osdisksize&quot;:60,
    &quot;vms&quot;:[
        {
            &quot;hostname&quot;:&quot;cobbler-80&quot;,
            &quot;esxhost&quot;:&quot;172.17.75.184&quot;,
            &quot;datastore&quot;:&quot;rdqa02&quot;,
            &quot;os_disk&quot;:&quot;/dev/sda&quot;,
            &quot;disknum&quot;:6,
            &quot;disksize&quot;:30,
            &quot;netconf&quot;:[
                {
                    &quot;iface&quot;:&quot;bond0&quot;,
                    &quot;slave&quot;:[
                        &quot;ens160&quot;
                    ],
                    &quot;bond_mode&quot;:&quot;active-backup&quot;,
                    &quot;address&quot;:&quot;172.17.73.81&quot;,
                    &quot;netmask&quot;:&quot;255.255.252.0&quot;,
                    &quot;gateway&quot;:&quot;172.17.75.254&quot;,
                    &quot;dns-nameservers&quot;:&quot;114.114.114.114&quot;
                },
                {
                    &quot;iface&quot;:&quot;bond1&quot;,
                    &quot;slave&quot;:[
                        &quot;ens192&quot;
                    ],
                    &quot;bond_mode&quot;:&quot;active-backup&quot;,
                    &quot;address&quot;:&quot;1.1.1.81&quot;,
                    &quot;netmask&quot;:&quot;255.255.255.0&quot;
                }
            ]
        }
    ]
}
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;对于配置文件中版本信息：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;    &quot;8.0&quot;: {
        &quot;buildpath&quot;:     &quot;xenial/virtualstor_scaler_8.0/&quot;,
        &quot;pxeint&quot;:        [&quot;ens160&quot;, &quot;ens192&quot;, &quot;ens224&quot;]
    },
    &quot;8.0_centos&quot;: {
        &quot;buildpath&quot;:     &quot;centos7/virtualstor_scaler_8.0/&quot;,
        &quot;pxeint&quot;:        [&quot;ens160&quot;, &quot;ens192&quot;, &quot;ens224&quot;]
    },
    &quot;8.0_converger1&quot;: {
        &quot;buildpath&quot;:     &quot;buster/virtualstor_converger_one_1.0/&quot;,
        &quot;pxeint&quot;:        [&quot;ens160&quot;, &quot;ens192&quot;, &quot;ens224&quot;]
    }
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;8.0 表示版本为8.0的Ubuntu类型的Scaler&lt;/li&gt;
  &lt;li&gt;8.0_centos 表示版本为8.0的CentOS类型的Scaler&lt;/li&gt;
  &lt;li&gt;8.0_converger1 表示版本为8.0的ConvergerOne&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;上述值目前写死在code中，所以json格式的配置文件中&lt;code class=&quot;highlighter-rouge&quot;&gt;&quot;version&quot;:&lt;/code&gt;的取值要去适配自己要安装的什么产品类型的ISO。&lt;/p&gt;

&lt;h1 id=&quot;其他&quot;&gt;其他&lt;/h1&gt;

&lt;p&gt;如何判断ks文件有效性&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;# yum install pykickstart
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;After installing the package, you can validate a Kickstart file using the following command:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;$ ksvalidator /path/to/kickstart.ks
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;参考：&lt;/p&gt;

&lt;p&gt;https://docs.centos.org/en-US/centos/install-guide/Kickstart2/&lt;/p&gt;</content><author><name>Gavin</name></author><category term="cobbler" /><summary type="html">IP规划</summary></entry></feed>