<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="4.0.0">Jekyll</generator><link href="http://172.17.73.80:4000/feed.xml" rel="self" type="application/atom+xml" /><link href="http://172.17.73.80:4000/" rel="alternate" type="text/html" /><updated>2020-06-03T17:03:02+08:00</updated><id>http://172.17.73.80:4000/feed.xml</id><title type="html">Gavin Blog</title><subtitle>关于软件测试, 与你一起发现更大的世界</subtitle><entry><title type="html">gzip vs bzip2 vs xz vs pbzip2 性能对比</title><link href="http://172.17.73.80:4000/2020/06/03/gzip-vs-bzip2-vs-xz-vs-pbzip2-performance-comparison/" rel="alternate" type="text/html" title="gzip vs bzip2 vs xz vs pbzip2 性能对比" /><published>2020-06-03T00:00:00+08:00</published><updated>2020-06-03T00:00:00+08:00</updated><id>http://172.17.73.80:4000/2020/06/03/gzip-vs-bzip2-vs-xz-vs-pbzip2-performance-comparison</id><content type="html" xml:base="http://172.17.73.80:4000/2020/06/03/gzip-vs-bzip2-vs-xz-vs-pbzip2-performance-comparison/">&lt;h1 id=&quot;概述&quot;&gt;概述&lt;/h1&gt;

&lt;p&gt;两天前，简单写了篇bzip2 与 pbzip2 压缩哪个更快，当时是处于使用esrally压测Elastic search性能，并没有太多的关注几种压缩工具的性能如何。本文介绍常用的几种压缩命令，分别汇总出各个命令的压缩&amp;amp;解压缩全方面性能对比。&lt;/p&gt;

&lt;h1 id=&quot;准备工作&quot;&gt;准备工作&lt;/h1&gt;

&lt;p&gt;看了下gzip，bzip2，pbzip2，xz这4个命令的help信息，帮助信息比较相似：&lt;/p&gt;

&lt;p&gt;&lt;img class=&quot;shadow&quot; src=&quot;/img/in-post/compress_help.png&quot; width=&quot;1200&quot; /&gt;&lt;/p&gt;

&lt;p&gt;准备了一个测试文件方便测试：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;root@node244:/mnt/disk/compress_test# ll
total 557704
drwxr-xr-x 2 root root      4096 Jun  3 10:34 ./
drwxr-xr-x 5 root root      4096 Jun  3 10:32 ../
-rw-r--r-- 1 root root 571073631 Jun  3 10:33 ceph-client.radosgw.0.log
root@node244:/mnt/disk/compress_test# 
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;结合各个命令的help信息，可以使用简单的shell命令来完成测试工作，例如：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;for i in {1..9}; do echo &quot;============================  Compress Level $i  ===========================&quot;; echo &quot; ----- Compress -----&quot;; time gzip -k -f -$i ceph-client.radosgw.0.log; echo &quot; ----- Compress info -----&quot;; gzip -l -v ceph-client.radosgw.0.log.gz; echo &quot;-----  Uncompress -----&quot;; time gzip -d -f ceph-client.radosgw.0.log.gz; done
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h1 id=&quot;测试过程&quot;&gt;测试过程&lt;/h1&gt;

&lt;h2 id=&quot;gzip-压缩与解压缩&quot;&gt;gzip 压缩与解压缩&lt;/h2&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;root@node244:/mnt/disk/compress_test# for i in {1..9}; do echo &quot;============================  Compress Level $i  ===========================&quot;; echo &quot; ----- Compress -----&quot;; time gzip -k -f -$i ceph-client.radosgw.0.log; echo &quot; ----- Compress info -----&quot;; gzip -l -v ceph-client.radosgw.0.log.gz; echo &quot;-----  Uncompress -----&quot;; time gzip -d -f ceph-client.radosgw.0.log.gz; done
============================  Compress Level 1  ===========================
 ----- Compress -----

real	0m3.389s
user	0m3.261s
sys	0m0.128s
 ----- Compress info -----
method  crc     date  time           compressed        uncompressed  ratio uncompressed_name
defla d30eafa2 Jun  3 10:33            27542300           571073631  95.2% ceph-client.radosgw.0.log
-----  Uncompress -----

real	0m2.502s
user	0m1.962s
sys	0m0.472s
============================  Compress Level 2  ===========================
 ----- Compress -----

real	0m3.385s
user	0m3.257s
sys	0m0.128s
 ----- Compress info -----
method  crc     date  time           compressed        uncompressed  ratio uncompressed_name
defla d30eafa2 Jun  3 10:33            27158636           571073631  95.2% ceph-client.radosgw.0.log
-----  Uncompress -----

real	0m2.782s
user	0m1.893s
sys	0m0.444s
============================  Compress Level 3  ===========================
 ----- Compress -----

real	0m3.407s
user	0m3.262s
sys	0m0.144s
 ----- Compress info -----
method  crc     date  time           compressed        uncompressed  ratio uncompressed_name
defla d30eafa2 Jun  3 10:33            26820084           571073631  95.3% ceph-client.radosgw.0.log
-----  Uncompress -----

real	0m2.403s
user	0m1.919s
sys	0m0.417s
============================  Compress Level 4  ===========================
 ----- Compress -----

real	0m4.302s
user	0m4.150s
sys	0m0.152s
 ----- Compress info -----
method  crc     date  time           compressed        uncompressed  ratio uncompressed_name
defla d30eafa2 Jun  3 10:33            22196434           571073631  96.1% ceph-client.radosgw.0.log
-----  Uncompress -----

real	0m2.413s
user	0m1.914s
sys	0m0.433s
============================  Compress Level 5  ===========================
 ----- Compress -----

real	0m4.385s
user	0m4.237s
sys	0m0.149s
 ----- Compress info -----
method  crc     date  time           compressed        uncompressed  ratio uncompressed_name
defla d30eafa2 Jun  3 10:33            20643438           571073631  96.4% ceph-client.radosgw.0.log
-----  Uncompress -----

real	0m2.370s
user	0m1.937s
sys	0m0.349s
============================  Compress Level 6  ===========================
 ----- Compress -----

real	0m5.298s
user	0m5.142s
sys	0m0.156s
 ----- Compress info -----
method  crc     date  time           compressed        uncompressed  ratio uncompressed_name
defla d30eafa2 Jun  3 10:33            19503464           571073631  96.6% ceph-client.radosgw.0.log
-----  Uncompress -----

real	0m2.367s
user	0m1.910s
sys	0m0.400s
============================  Compress Level 7  ===========================
 ----- Compress -----

real	0m5.518s
user	0m5.402s
sys	0m0.116s
 ----- Compress info -----
method  crc     date  time           compressed        uncompressed  ratio uncompressed_name
defla d30eafa2 Jun  3 10:33            19396724           571073631  96.6% ceph-client.radosgw.0.log
-----  Uncompress -----

real	0m2.435s
user	0m1.842s
sys	0m0.486s
============================  Compress Level 8  ===========================
 ----- Compress -----

real	0m6.961s
user	0m6.853s
sys	0m0.108s
 ----- Compress info -----
method  crc     date  time           compressed        uncompressed  ratio uncompressed_name
defla d30eafa2 Jun  3 10:33            18411146           571073631  96.8% ceph-client.radosgw.0.log
-----  Uncompress -----

real	0m2.480s
user	0m1.884s
sys	0m0.399s
============================  Compress Level 9  ===========================
 ----- Compress -----

real	0m7.233s
user	0m7.077s
sys	0m0.156s
 ----- Compress info -----
method  crc     date  time           compressed        uncompressed  ratio uncompressed_name
defla d30eafa2 Jun  3 10:33            18186392           571073631  96.8% ceph-client.radosgw.0.log
-----  Uncompress -----

real	0m2.877s
user	0m1.820s
sys	0m0.456s
root@node244:/mnt/disk/compress_test# 
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;bzip2的压缩与解压缩&quot;&gt;bzip2的压缩与解压缩&lt;/h2&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;root@node244:/mnt/disk/compress_test# for i in {1..9}; do echo &quot;============================  Compress Level $i  ===========================&quot;; echo &quot; ----- Compress -----&quot;; time bzip2 -k -f -v -$i ceph-client.radosgw.0.log ceph-client.radosgw.0.log.bz2; echo &quot;-----  Uncompress -----&quot;; time bzip2 -d -f ceph-client.radosgw.0.log.bz2; done
============================  Compress Level 1  ===========================
 ----- Compress -----
  ceph-client.radosgw.0.log:     28.266:1,  0.283 bits/byte, 96.46% saved, 571073631 in, 20203523 out.
bzip2: Input file ceph-client.radosgw.0.log.bz2 already has .bz2 suffix.

real	1m14.986s
user	1m14.115s
sys	0m0.212s
-----  Uncompress -----

real	0m8.986s
user	0m7.820s
sys	0m0.492s
============================  Compress Level 2  ===========================
 ----- Compress -----
  ceph-client.radosgw.0.log:     34.344:1,  0.233 bits/byte, 97.09% saved, 571073631 in, 16627875 out.
bzip2: Input file ceph-client.radosgw.0.log.bz2 already has .bz2 suffix.

real	1m26.956s
user	1m25.741s
sys	0m0.232s
-----  Uncompress -----

real	0m8.858s
user	0m8.241s
sys	0m0.488s
============================  Compress Level 3  ===========================
 ----- Compress -----
  ceph-client.radosgw.0.log:     37.331:1,  0.214 bits/byte, 97.32% saved, 571073631 in, 15297380 out.
bzip2: Input file ceph-client.radosgw.0.log.bz2 already has .bz2 suffix.

real	1m35.014s
user	1m34.232s
sys	0m0.140s
-----  Uncompress -----

real	0m9.019s
user	0m8.451s
sys	0m0.512s
============================  Compress Level 4  ===========================
 ----- Compress -----
  ceph-client.radosgw.0.log:     38.943:1,  0.205 bits/byte, 97.43% saved, 571073631 in, 14664242 out.
bzip2: Input file ceph-client.radosgw.0.log.bz2 already has .bz2 suffix.

real	1m41.031s
user	1m40.805s
sys	0m0.160s
-----  Uncompress -----

real	0m9.702s
user	0m8.491s
sys	0m0.596s
============================  Compress Level 5  ===========================
 ----- Compress -----
  ceph-client.radosgw.0.log:     40.177:1,  0.199 bits/byte, 97.51% saved, 571073631 in, 14214101 out.
bzip2: Input file ceph-client.radosgw.0.log.bz2 already has .bz2 suffix.

real	1m46.857s
user	1m46.109s
sys	0m0.172s
-----  Uncompress -----

real	0m9.378s
user	0m8.565s
sys	0m0.536s
============================  Compress Level 6  ===========================
 ----- Compress -----
  ceph-client.radosgw.0.log:     41.332:1,  0.194 bits/byte, 97.58% saved, 571073631 in, 13816797 out.
bzip2: Input file ceph-client.radosgw.0.log.bz2 already has .bz2 suffix.

real	1m50.821s
user	1m50.619s
sys	0m0.196s
-----  Uncompress -----

real	0m9.688s
user	0m8.611s
sys	0m0.556s
============================  Compress Level 7  ===========================
 ----- Compress -----
  ceph-client.radosgw.0.log:     41.987:1,  0.191 bits/byte, 97.62% saved, 571073631 in, 13601242 out.
bzip2: Input file ceph-client.radosgw.0.log.bz2 already has .bz2 suffix.

real	1m55.011s
user	1m54.842s
sys	0m0.168s
-----  Uncompress -----

real	0m9.197s
user	0m8.560s
sys	0m0.575s
============================  Compress Level 8  ===========================
 ----- Compress -----
  ceph-client.radosgw.0.log:     42.637:1,  0.188 bits/byte, 97.65% saved, 571073631 in, 13393739 out.
bzip2: Input file ceph-client.radosgw.0.log.bz2 already has .bz2 suffix.

real	2m0.052s
user	1m59.319s
sys	0m0.100s
-----  Uncompress -----

real	0m9.232s
user	0m8.650s
sys	0m0.516s
============================  Compress Level 9  ===========================
 ----- Compress -----
  ceph-client.radosgw.0.log:     43.064:1,  0.186 bits/byte, 97.68% saved, 571073631 in, 13261043 out.
bzip2: Input file ceph-client.radosgw.0.log.bz2 already has .bz2 suffix.

real	2m1.284s
user	2m1.072s
sys	0m0.204s
-----  Uncompress -----

real	0m9.246s
user	0m8.667s
sys	0m0.512s
root@node244:/mnt/disk/compress_test# 
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;pbzip2的压缩与解压缩&quot;&gt;pbzip2的压缩与解压缩&lt;/h2&gt;

&lt;p&gt;由于担心不同CPU并发影响测试效果，这里指定了CPU个数为24个，在不带-p参数情况下，默认32个，当前环境虽然有32cores，但并不是每次都能全部参与，有时候是32，有时候是29，有时候是26，所以这里指定一个更低值，确保每次执行都使用相同cores的CPU数。&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;@node244:/mnt/disk/compress_test# for i in {1..9}; do echo &quot;============================  Compress Level $i  ===========================&quot;; echo &quot; ----- Compress -----&quot;; time pbzip2 -k -f -v -p24 -$i ceph-client.radosgw.0.log; echo &quot;----- Uncompress -----&quot;; time pbzip2 -p24 -d -f ceph-client.radosgw.0.log.bz2; done
============================  Compress Level 1  ===========================
 ----- Compress -----
Parallel BZIP2 v1.1.9     - by: Jeff Gilchrist [http://compression.ca]
[Apr. 13, 2014]               (uses libbzip2 by Julian Seward)
Major contributions: Yavor Nikolov &amp;lt;nikolov.javor+pbzip2@gmail.com&amp;gt;

         # CPUs: 24
 BWT Block Size: 100 KB
File Block Size: 900 KB
 Maximum Memory: 100 MB
-------------------------------------------
         File #: 1 of 1
     Input Name: ceph-client.radosgw.0.log
    Output Name: ceph-client.radosgw.0.log.bz2

     Input Size: 571073631 bytes
Compressing data...
    Output Size: 20251314 bytes
-------------------------------------------

     Wall Clock: 5.553146 seconds

real	0m5.557s
user	2m10.868s
sys	0m0.600s
----- Uncompress -----

real	0m0.675s
user	0m11.626s
sys	0m0.710s
============================  Compress Level 2  ===========================
 ----- Compress -----
Parallel BZIP2 v1.1.9     - by: Jeff Gilchrist [http://compression.ca]
[Apr. 13, 2014]               (uses libbzip2 by Julian Seward)
Major contributions: Yavor Nikolov &amp;lt;nikolov.javor+pbzip2@gmail.com&amp;gt;

         # CPUs: 24
 BWT Block Size: 200 KB
File Block Size: 900 KB
 Maximum Memory: 100 MB
-------------------------------------------
         File #: 1 of 1
     Input Name: ceph-client.radosgw.0.log
    Output Name: ceph-client.radosgw.0.log.bz2

     Input Size: 571073631 bytes
Compressing data...
    Output Size: 17034671 bytes
-------------------------------------------

     Wall Clock: 6.295284 seconds

real	0m6.299s
user	2m28.521s
sys	0m0.892s
----- Uncompress -----

real	0m0.706s
user	0m12.163s
sys	0m0.780s
============================  Compress Level 3  ===========================
 ----- Compress -----
Parallel BZIP2 v1.1.9     - by: Jeff Gilchrist [http://compression.ca]
[Apr. 13, 2014]               (uses libbzip2 by Julian Seward)
Major contributions: Yavor Nikolov &amp;lt;nikolov.javor+pbzip2@gmail.com&amp;gt;

         # CPUs: 24
 BWT Block Size: 300 KB
File Block Size: 900 KB
 Maximum Memory: 100 MB
-------------------------------------------
         File #: 1 of 1
     Input Name: ceph-client.radosgw.0.log
    Output Name: ceph-client.radosgw.0.log.bz2

     Input Size: 571073631 bytes
Compressing data...
    Output Size: 15336308 bytes
-------------------------------------------

     Wall Clock: 7.094542 seconds

real	0m7.098s
user	2m46.324s
sys	0m1.328s
----- Uncompress -----

real	0m1.047s
user	0m12.899s
sys	0m0.723s
============================  Compress Level 4  ===========================
 ----- Compress -----
Parallel BZIP2 v1.1.9     - by: Jeff Gilchrist [http://compression.ca]
[Apr. 13, 2014]               (uses libbzip2 by Julian Seward)
Major contributions: Yavor Nikolov &amp;lt;nikolov.javor+pbzip2@gmail.com&amp;gt;

         # CPUs: 24
 BWT Block Size: 400 KB
File Block Size: 900 KB
 Maximum Memory: 100 MB
-------------------------------------------
         File #: 1 of 1
     Input Name: ceph-client.radosgw.0.log
    Output Name: ceph-client.radosgw.0.log.bz2

     Input Size: 571073631 bytes
Compressing data...
    Output Size: 15289111 bytes
-------------------------------------------

     Wall Clock: 7.390034 seconds

real	0m7.393s
user	2m53.305s
sys	0m1.428s
----- Uncompress -----

real	0m0.738s
user	0m13.124s
sys	0m0.806s
============================  Compress Level 5  ===========================
 ----- Compress -----
Parallel BZIP2 v1.1.9     - by: Jeff Gilchrist [http://compression.ca]
[Apr. 13, 2014]               (uses libbzip2 by Julian Seward)
Major contributions: Yavor Nikolov &amp;lt;nikolov.javor+pbzip2@gmail.com&amp;gt;

         # CPUs: 24
 BWT Block Size: 500 KB
File Block Size: 900 KB
 Maximum Memory: 100 MB
-------------------------------------------
         File #: 1 of 1
     Input Name: ceph-client.radosgw.0.log
    Output Name: ceph-client.radosgw.0.log.bz2

     Input Size: 571073631 bytes
Compressing data...
    Output Size: 14424635 bytes
-------------------------------------------

     Wall Clock: 7.929576 seconds

real	0m7.933s
user	3m5.904s
sys	0m1.616s
----- Uncompress -----

real	0m0.783s
user	0m14.003s
sys	0m0.780s
============================  Compress Level 6  ===========================
 ----- Compress -----
Parallel BZIP2 v1.1.9     - by: Jeff Gilchrist [http://compression.ca]
[Apr. 13, 2014]               (uses libbzip2 by Julian Seward)
Major contributions: Yavor Nikolov &amp;lt;nikolov.javor+pbzip2@gmail.com&amp;gt;

         # CPUs: 24
 BWT Block Size: 600 KB
File Block Size: 900 KB
 Maximum Memory: 100 MB
-------------------------------------------
         File #: 1 of 1
     Input Name: ceph-client.radosgw.0.log
    Output Name: ceph-client.radosgw.0.log.bz2

     Input Size: 571073631 bytes
Compressing data...
    Output Size: 14320561 bytes
-------------------------------------------

     Wall Clock: 8.235693 seconds

real	0m8.240s
user	3m12.339s
sys	0m2.512s
----- Uncompress -----

real	0m0.770s
user	0m13.975s
sys	0m0.789s
============================  Compress Level 7  ===========================
 ----- Compress -----
Parallel BZIP2 v1.1.9     - by: Jeff Gilchrist [http://compression.ca]
[Apr. 13, 2014]               (uses libbzip2 by Julian Seward)
Major contributions: Yavor Nikolov &amp;lt;nikolov.javor+pbzip2@gmail.com&amp;gt;

         # CPUs: 24
 BWT Block Size: 700 KB
File Block Size: 900 KB
 Maximum Memory: 100 MB
-------------------------------------------
         File #: 1 of 1
     Input Name: ceph-client.radosgw.0.log
    Output Name: ceph-client.radosgw.0.log.bz2

     Input Size: 571073631 bytes
Compressing data...
    Output Size: 14284009 bytes
-------------------------------------------

     Wall Clock: 8.463171 seconds

real	0m8.467s
user	3m17.862s
sys	0m2.209s
----- Uncompress -----

real	0m0.828s
user	0m14.793s
sys	0m0.932s
============================  Compress Level 8  ===========================
 ----- Compress -----
Parallel BZIP2 v1.1.9     - by: Jeff Gilchrist [http://compression.ca]
[Apr. 13, 2014]               (uses libbzip2 by Julian Seward)
Major contributions: Yavor Nikolov &amp;lt;nikolov.javor+pbzip2@gmail.com&amp;gt;

         # CPUs: 24
 BWT Block Size: 800 KB
File Block Size: 900 KB
 Maximum Memory: 100 MB
-------------------------------------------
         File #: 1 of 1
     Input Name: ceph-client.radosgw.0.log
    Output Name: ceph-client.radosgw.0.log.bz2

     Input Size: 571073631 bytes
Compressing data...
    Output Size: 14161949 bytes
-------------------------------------------

     Wall Clock: 9.343830 seconds

real	0m9.348s
user	3m37.798s
sys	0m3.541s
----- Uncompress -----

real	0m0.844s
user	0m15.348s
sys	0m0.937s
============================  Compress Level 9  ===========================
 ----- Compress -----
Parallel BZIP2 v1.1.9     - by: Jeff Gilchrist [http://compression.ca]
[Apr. 13, 2014]               (uses libbzip2 by Julian Seward)
Major contributions: Yavor Nikolov &amp;lt;nikolov.javor+pbzip2@gmail.com&amp;gt;

         # CPUs: 24
 BWT Block Size: 900 KB
File Block Size: 900 KB
 Maximum Memory: 100 MB
-------------------------------------------
         File #: 1 of 1
     Input Name: ceph-client.radosgw.0.log
    Output Name: ceph-client.radosgw.0.log.bz2

     Input Size: 571073631 bytes
Compressing data...
    Output Size: 13295516 bytes
-------------------------------------------

     Wall Clock: 10.434447 seconds

real	0m10.438s
user	4m3.675s
sys	0m4.175s
----- Uncompress -----

real	0m0.796s
user	0m15.991s
sys	0m0.911s
root@node244:/mnt/disk/compress_test#
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;xz的压缩与解压缩&quot;&gt;xz的压缩与解压缩&lt;/h2&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;root@node244:/mnt/disk/compress_test# for i in {0..9}; do echo &quot;============================  Compress Level $i  ===========================&quot;; echo &quot; ----- Compress -----&quot;; rm -rf *.xz; time xz -k -f -v -$i ceph-client.radosgw.0.log; echo &quot; ----- Compress info -----&quot;; xz -l -v ceph-client.radosgw.0.log.xz; echo &quot;----- Uncompress -----&quot;; time xz -d -f ceph-client.radosgw.0.log.xz; done
============================  Compress Level 0  ===========================
 ----- Compress -----
ceph-client.radosgw.0.log (1/1)
  100 %        17.9 MiB / 544.6 MiB = 0.033    71 MiB/s       0:07             

real	0m7.703s
user	0m7.567s
sys	0m0.136s
 ----- Compress info -----
ceph-client.radosgw.0.log.xz (1/1)
  Streams:            1
  Blocks:             1
  Compressed size:    17.9 MiB (18,732,968 B)
  Uncompressed size:  544.6 MiB (571,073,631 B)
  Ratio:              0.033
  Check:              CRC64
  Stream padding:     0 B
  Streams:
    Stream    Blocks      CompOffset    UncompOffset        CompSize      UncompSize  Ratio  Check      Padding
         1         1               0               0      18,732,968     571,073,631  0.033  CRC64            0
  Blocks:
    Stream     Block      CompOffset    UncompOffset       TotalSize      UncompSize  Ratio  Check
         1         1              12               0      18,732,928     571,073,631  0.033  CRC64
----- Uncompress -----

real	0m2.886s
user	0m1.895s
sys	0m0.444s
============================  Compress Level 1  ===========================
 ----- Compress -----
ceph-client.radosgw.0.log (1/1)
  100 %        17.2 MiB / 544.6 MiB = 0.032    56 MiB/s       0:09             

real	0m9.666s
user	0m9.514s
sys	0m0.152s
 ----- Compress info -----
ceph-client.radosgw.0.log.xz (1/1)
  Streams:            1
  Blocks:             1
  Compressed size:    17.2 MiB (18,010,756 B)
  Uncompressed size:  544.6 MiB (571,073,631 B)
  Ratio:              0.032
  Check:              CRC64
  Stream padding:     0 B
  Streams:
    Stream    Blocks      CompOffset    UncompOffset        CompSize      UncompSize  Ratio  Check      Padding
         1         1               0               0      18,010,756     571,073,631  0.032  CRC64            0
  Blocks:
    Stream     Block      CompOffset    UncompOffset       TotalSize      UncompSize  Ratio  Check
         1         1              12               0      18,010,716     571,073,631  0.032  CRC64
----- Uncompress -----

real	0m2.282s
user	0m1.719s
sys	0m0.496s
============================  Compress Level 2  ===========================
 ----- Compress -----
ceph-client.radosgw.0.log (1/1)
  100 %        16.3 MiB / 544.6 MiB = 0.030    45 MiB/s       0:12             

real	0m12.128s
user	0m11.964s
sys	0m0.164s
 ----- Compress info -----
ceph-client.radosgw.0.log.xz (1/1)
  Streams:            1
  Blocks:             1
  Compressed size:    16.3 MiB (17,065,980 B)
  Uncompressed size:  544.6 MiB (571,073,631 B)
  Ratio:              0.030
  Check:              CRC64
  Stream padding:     0 B
  Streams:
    Stream    Blocks      CompOffset    UncompOffset        CompSize      UncompSize  Ratio  Check      Padding
         1         1               0               0      17,065,980     571,073,631  0.030  CRC64            0
  Blocks:
    Stream     Block      CompOffset    UncompOffset       TotalSize      UncompSize  Ratio  Check
         1         1              12               0      17,065,940     571,073,631  0.030  CRC64
----- Uncompress -----

real	0m2.277s
user	0m1.694s
sys	0m0.517s
============================  Compress Level 3  ===========================
 ----- Compress -----
ceph-client.radosgw.0.log (1/1)
  100 %        16.1 MiB / 544.6 MiB = 0.030    32 MiB/s       0:16             

real	0m16.986s
user	0m16.778s
sys	0m0.208s
 ----- Compress info -----
ceph-client.radosgw.0.log.xz (1/1)
  Streams:            1
  Blocks:             1
  Compressed size:    16.1 MiB (16,899,448 B)
  Uncompressed size:  544.6 MiB (571,073,631 B)
  Ratio:              0.030
  Check:              CRC64
  Stream padding:     0 B
  Streams:
    Stream    Blocks      CompOffset    UncompOffset        CompSize      UncompSize  Ratio  Check      Padding
         1         1               0               0      16,899,448     571,073,631  0.030  CRC64            0
  Blocks:
    Stream     Block      CompOffset    UncompOffset       TotalSize      UncompSize  Ratio  Check
         1         1              12               0      16,899,408     571,073,631  0.030  CRC64
----- Uncompress -----

real	0m2.252s
user	0m1.664s
sys	0m0.532s
============================  Compress Level 4  ===========================
 ----- Compress -----
ceph-client.radosgw.0.log (1/1)
  100 %        16.4 MiB / 544.6 MiB = 0.030    17 MiB/s       0:31             

real	0m31.449s
user	0m31.220s
sys	0m0.228s
 ----- Compress info -----
ceph-client.radosgw.0.log.xz (1/1)
  Streams:            1
  Blocks:             1
  Compressed size:    16.4 MiB (17,154,260 B)
  Uncompressed size:  544.6 MiB (571,073,631 B)
  Ratio:              0.030
  Check:              CRC64
  Stream padding:     0 B
  Streams:
    Stream    Blocks      CompOffset    UncompOffset        CompSize      UncompSize  Ratio  Check      Padding
         1         1               0               0      17,154,260     571,073,631  0.030  CRC64            0
  Blocks:
    Stream     Block      CompOffset    UncompOffset       TotalSize      UncompSize  Ratio  Check
         1         1              12               0      17,154,220     571,073,631  0.030  CRC64
----- Uncompress -----

real	0m2.349s
user	0m1.868s
sys	0m0.412s
============================  Compress Level 5  ===========================
 ----- Compress -----
ceph-client.radosgw.0.log (1/1)
  100 %        15.6 MiB / 544.6 MiB = 0.029    12 MiB/s       0:45             

real	0m45.585s
user	0m45.152s
sys	0m0.420s
 ----- Compress info -----
ceph-client.radosgw.0.log.xz (1/1)
  Streams:            1
  Blocks:             1
  Compressed size:    15.6 MiB (16,360,932 B)
  Uncompressed size:  544.6 MiB (571,073,631 B)
  Ratio:              0.029
  Check:              CRC64
  Stream padding:     0 B
  Streams:
    Stream    Blocks      CompOffset    UncompOffset        CompSize      UncompSize  Ratio  Check      Padding
         1         1               0               0      16,360,932     571,073,631  0.029  CRC64            0
  Blocks:
    Stream     Block      CompOffset    UncompOffset       TotalSize      UncompSize  Ratio  Check
         1         1              12               0      16,360,892     571,073,631  0.029  CRC64
----- Uncompress -----

real	0m2.398s
user	0m1.851s
sys	0m0.488s
============================  Compress Level 6  ===========================
 ----- Compress -----
ceph-client.radosgw.0.log (1/1)
  100 %        15.1 MiB / 544.6 MiB = 0.028   7.1 MiB/s       1:17             

real	1m17.152s
user	1m16.763s
sys	0m0.388s
 ----- Compress info -----
ceph-client.radosgw.0.log.xz (1/1)
  Streams:            1
  Blocks:             1
  Compressed size:    15.1 MiB (15,786,352 B)
  Uncompressed size:  544.6 MiB (571,073,631 B)
  Ratio:              0.028
  Check:              CRC64
  Stream padding:     0 B
  Streams:
    Stream    Blocks      CompOffset    UncompOffset        CompSize      UncompSize  Ratio  Check      Padding
         1         1               0               0      15,786,352     571,073,631  0.028  CRC64            0
  Blocks:
    Stream     Block      CompOffset    UncompOffset       TotalSize      UncompSize  Ratio  Check
         1         1              12               0      15,786,312     571,073,631  0.028  CRC64
----- Uncompress -----

real	0m2.302s
user	0m1.752s
sys	0m0.487s
============================  Compress Level 7  ===========================
 ----- Compress -----
ceph-client.radosgw.0.log (1/1)
  100 %        15.1 MiB / 544.6 MiB = 0.028   6.7 MiB/s       1:20             

real	1m20.962s
user	1m20.478s
sys	0m0.460s
 ----- Compress info -----
ceph-client.radosgw.0.log.xz (1/1)
  Streams:            1
  Blocks:             1
  Compressed size:    15.1 MiB (15,862,848 B)
  Uncompressed size:  544.6 MiB (571,073,631 B)
  Ratio:              0.028
  Check:              CRC64
  Stream padding:     0 B
  Streams:
    Stream    Blocks      CompOffset    UncompOffset        CompSize      UncompSize  Ratio  Check      Padding
         1         1               0               0      15,862,848     571,073,631  0.028  CRC64            0
  Blocks:
    Stream     Block      CompOffset    UncompOffset       TotalSize      UncompSize  Ratio  Check
         1         1              12               0      15,862,808     571,073,631  0.028  CRC64
----- Uncompress -----

real	0m2.368s
user	0m1.803s
sys	0m0.497s
============================  Compress Level 8  ===========================
 ----- Compress -----
ceph-client.radosgw.0.log (1/1)
  100 %        15.4 MiB / 544.6 MiB = 0.028   6.4 MiB/s       1:25             

real	1m25.153s
user	1m24.488s
sys	0m0.660s
 ----- Compress info -----
ceph-client.radosgw.0.log.xz (1/1)
  Streams:            1
  Blocks:             1
  Compressed size:    15.4 MiB (16,130,916 B)
  Uncompressed size:  544.6 MiB (571,073,631 B)
  Ratio:              0.028
  Check:              CRC64
  Stream padding:     0 B
  Streams:
    Stream    Blocks      CompOffset    UncompOffset        CompSize      UncompSize  Ratio  Check      Padding
         1         1               0               0      16,130,916     571,073,631  0.028  CRC64            0
  Blocks:
    Stream     Block      CompOffset    UncompOffset       TotalSize      UncompSize  Ratio  Check
         1         1              12               0      16,130,876     571,073,631  0.028  CRC64
----- Uncompress -----

real	0m2.359s
user	0m1.768s
sys	0m0.535s
============================  Compress Level 9  ===========================
 ----- Compress -----
ceph-client.radosgw.0.log (1/1)
  100 %        15.7 MiB / 544.6 MiB = 0.029   5.9 MiB/s       1:32             

real	1m32.645s
user	1m31.211s
sys	0m1.424s
 ----- Compress info -----
ceph-client.radosgw.0.log.xz (1/1)
  Streams:            1
  Blocks:             1
  Compressed size:    15.7 MiB (16,510,384 B)
  Uncompressed size:  544.6 MiB (571,073,631 B)
  Ratio:              0.029
  Check:              CRC64
  Stream padding:     0 B
  Streams:
    Stream    Blocks      CompOffset    UncompOffset        CompSize      UncompSize  Ratio  Check      Padding
         1         1               0               0      16,510,384     571,073,631  0.029  CRC64            0
  Blocks:
    Stream     Block      CompOffset    UncompOffset       TotalSize      UncompSize  Ratio  Check
         1         1              12               0      16,510,344     571,073,631  0.029  CRC64
----- Uncompress -----

real	0m2.394s
user	0m1.763s
sys	0m0.500s
root@node244:/mnt/disk/compress_test# 
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h1 id=&quot;测试结果&quot;&gt;测试结果&lt;/h1&gt;

&lt;h2 id=&quot;compressed-size&quot;&gt;Compressed Size&lt;/h2&gt;

&lt;p&gt;Unit:bytes&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;&lt;strong&gt;Compress Level&lt;/strong&gt;&lt;/th&gt;
      &lt;th&gt;&lt;strong&gt;gzip&lt;/strong&gt;&lt;/th&gt;
      &lt;th&gt;&lt;strong&gt;bzip2&lt;/strong&gt;&lt;/th&gt;
      &lt;th&gt;&lt;strong&gt;pbzip2&lt;/strong&gt;&lt;/th&gt;
      &lt;th&gt;&lt;strong&gt;xz&lt;/strong&gt;&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;0&lt;/td&gt;
      &lt;td&gt;-&lt;/td&gt;
      &lt;td&gt;-&lt;/td&gt;
      &lt;td&gt;-&lt;/td&gt;
      &lt;td&gt;18,732,968&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;1&lt;/td&gt;
      &lt;td&gt;27542300&lt;/td&gt;
      &lt;td&gt;20203523&lt;/td&gt;
      &lt;td&gt;20251314&lt;/td&gt;
      &lt;td&gt;18,010,756&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2&lt;/td&gt;
      &lt;td&gt;27158636&lt;/td&gt;
      &lt;td&gt;16627875&lt;/td&gt;
      &lt;td&gt;17034671&lt;/td&gt;
      &lt;td&gt;17,065,980&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;3&lt;/td&gt;
      &lt;td&gt;26820084&lt;/td&gt;
      &lt;td&gt;15297380&lt;/td&gt;
      &lt;td&gt;15336308&lt;/td&gt;
      &lt;td&gt;16,899,448&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;4&lt;/td&gt;
      &lt;td&gt;22196434&lt;/td&gt;
      &lt;td&gt;14664242&lt;/td&gt;
      &lt;td&gt;15289111&lt;/td&gt;
      &lt;td&gt;17,154,260&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;5&lt;/td&gt;
      &lt;td&gt;20643438&lt;/td&gt;
      &lt;td&gt;14214101&lt;/td&gt;
      &lt;td&gt;14424635&lt;/td&gt;
      &lt;td&gt;16,360,932&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;6&lt;/td&gt;
      &lt;td&gt;19503464&lt;/td&gt;
      &lt;td&gt;13816797&lt;/td&gt;
      &lt;td&gt;14320561&lt;/td&gt;
      &lt;td&gt;15,786,352&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;7&lt;/td&gt;
      &lt;td&gt;19396724&lt;/td&gt;
      &lt;td&gt;13601242&lt;/td&gt;
      &lt;td&gt;14284009&lt;/td&gt;
      &lt;td&gt;15,862,848&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;8&lt;/td&gt;
      &lt;td&gt;18411146&lt;/td&gt;
      &lt;td&gt;13393739&lt;/td&gt;
      &lt;td&gt;14161949&lt;/td&gt;
      &lt;td&gt;16,130,916&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;9&lt;/td&gt;
      &lt;td&gt;18186392&lt;/td&gt;
      &lt;td&gt;13261043&lt;/td&gt;
      &lt;td&gt;13295516&lt;/td&gt;
      &lt;td&gt;16,510,384&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h2 id=&quot;compression-time&quot;&gt;Compression Time&lt;/h2&gt;

&lt;p&gt;先从压缩时间开始，下列图表显示了从1到9的每个压缩级别完成压缩所花费的时间。&lt;/p&gt;

&lt;p&gt;Unit: seconds&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;&lt;strong&gt;Compress Level&lt;/strong&gt;&lt;/th&gt;
      &lt;th&gt;&lt;strong&gt;gzip&lt;/strong&gt;&lt;/th&gt;
      &lt;th&gt;&lt;strong&gt;bzip2&lt;/strong&gt;&lt;/th&gt;
      &lt;th&gt;&lt;strong&gt;pbzip2&lt;/strong&gt;&lt;/th&gt;
      &lt;th&gt;&lt;strong&gt;xz&lt;/strong&gt;&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;0&lt;/td&gt;
      &lt;td&gt;-&lt;/td&gt;
      &lt;td&gt;-&lt;/td&gt;
      &lt;td&gt;-&lt;/td&gt;
      &lt;td&gt;0m7.703s&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;1&lt;/td&gt;
      &lt;td&gt;0m3.389s&lt;/td&gt;
      &lt;td&gt;1m14.986s&lt;/td&gt;
      &lt;td&gt;0m5.557s&lt;/td&gt;
      &lt;td&gt;0m9.666s&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2&lt;/td&gt;
      &lt;td&gt;0m3.385s&lt;/td&gt;
      &lt;td&gt;1m26.956s&lt;/td&gt;
      &lt;td&gt;0m6.299s&lt;/td&gt;
      &lt;td&gt;0m12.128s&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;3&lt;/td&gt;
      &lt;td&gt;0m3.407s&lt;/td&gt;
      &lt;td&gt;1m35.014s&lt;/td&gt;
      &lt;td&gt;0m7.098s&lt;/td&gt;
      &lt;td&gt;0m16.986s&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;4&lt;/td&gt;
      &lt;td&gt;0m4.302s&lt;/td&gt;
      &lt;td&gt;1m41.031s&lt;/td&gt;
      &lt;td&gt;0m7.393s&lt;/td&gt;
      &lt;td&gt;0m31.449s&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;5&lt;/td&gt;
      &lt;td&gt;0m4.385s&lt;/td&gt;
      &lt;td&gt;1m46.857s&lt;/td&gt;
      &lt;td&gt;0m7.933s&lt;/td&gt;
      &lt;td&gt;0m45.585s&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;6&lt;/td&gt;
      &lt;td&gt;0m5.298s&lt;/td&gt;
      &lt;td&gt;1m50.821s&lt;/td&gt;
      &lt;td&gt;0m8.240s&lt;/td&gt;
      &lt;td&gt;1m17.152s&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;7&lt;/td&gt;
      &lt;td&gt;0m5.518s&lt;/td&gt;
      &lt;td&gt;1m55.011s&lt;/td&gt;
      &lt;td&gt;0m8.467s&lt;/td&gt;
      &lt;td&gt;1m20.962s&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;8&lt;/td&gt;
      &lt;td&gt;0m6.961s&lt;/td&gt;
      &lt;td&gt;2m0.052s&lt;/td&gt;
      &lt;td&gt;0m9.348s&lt;/td&gt;
      &lt;td&gt;1m25.153s&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;9&lt;/td&gt;
      &lt;td&gt;0m7.233s&lt;/td&gt;
      &lt;td&gt;2m1.284s&lt;/td&gt;
      &lt;td&gt;0m10.438s&lt;/td&gt;
      &lt;td&gt;1m32.645s&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;&lt;img class=&quot;shadow&quot; src=&quot;/img/in-post/compression_time.png&quot; width=&quot;1200&quot; /&gt;&lt;/p&gt;

&lt;p&gt;从折线图可以看出，随着压缩级别的提高，bzip2需要花费更长的时间才能完成，pbzip2和gzip的变化不大，而压缩级别为3后，xz的增长非常明显。&lt;/p&gt;

&lt;h2 id=&quot;compression-ratio&quot;&gt;Compression Ratio&lt;/h2&gt;

&lt;p&gt;Unit: %&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;&lt;strong&gt;Compress Level&lt;/strong&gt;&lt;/th&gt;
      &lt;th&gt;&lt;strong&gt;gzip&lt;/strong&gt;&lt;/th&gt;
      &lt;th&gt;&lt;strong&gt;bzip2&lt;/strong&gt;&lt;/th&gt;
      &lt;th&gt;&lt;strong&gt;pbzip2&lt;/strong&gt;&lt;/th&gt;
      &lt;th&gt;&lt;strong&gt;xz&lt;/strong&gt;&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;0&lt;/td&gt;
      &lt;td&gt;-&lt;/td&gt;
      &lt;td&gt;-&lt;/td&gt;
      &lt;td&gt;-&lt;/td&gt;
      &lt;td&gt;3.3&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;1&lt;/td&gt;
      &lt;td&gt;4.8&lt;/td&gt;
      &lt;td&gt;3.54&lt;/td&gt;
      &lt;td&gt;3.55&lt;/td&gt;
      &lt;td&gt;3.3&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2&lt;/td&gt;
      &lt;td&gt;4.8&lt;/td&gt;
      &lt;td&gt;2.91&lt;/td&gt;
      &lt;td&gt;2.98&lt;/td&gt;
      &lt;td&gt;3.0&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;3&lt;/td&gt;
      &lt;td&gt;4.7&lt;/td&gt;
      &lt;td&gt;2.68&lt;/td&gt;
      &lt;td&gt;2.69&lt;/td&gt;
      &lt;td&gt;3.0&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;4&lt;/td&gt;
      &lt;td&gt;3.9&lt;/td&gt;
      &lt;td&gt;2.57&lt;/td&gt;
      &lt;td&gt;2.68&lt;/td&gt;
      &lt;td&gt;3.0&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;5&lt;/td&gt;
      &lt;td&gt;3.6&lt;/td&gt;
      &lt;td&gt;2.49&lt;/td&gt;
      &lt;td&gt;2.53&lt;/td&gt;
      &lt;td&gt;2.9&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;6&lt;/td&gt;
      &lt;td&gt;3.4&lt;/td&gt;
      &lt;td&gt;2.42&lt;/td&gt;
      &lt;td&gt;2.51&lt;/td&gt;
      &lt;td&gt;2.8&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;7&lt;/td&gt;
      &lt;td&gt;3.4&lt;/td&gt;
      &lt;td&gt;2.38&lt;/td&gt;
      &lt;td&gt;2.50&lt;/td&gt;
      &lt;td&gt;2.8&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;8&lt;/td&gt;
      &lt;td&gt;3.2&lt;/td&gt;
      &lt;td&gt;2.35&lt;/td&gt;
      &lt;td&gt;2.48&lt;/td&gt;
      &lt;td&gt;2.8&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;9&lt;/td&gt;
      &lt;td&gt;3.2&lt;/td&gt;
      &lt;td&gt;2.32&lt;/td&gt;
      &lt;td&gt;2.33&lt;/td&gt;
      &lt;td&gt;2.9&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;&lt;img class=&quot;shadow&quot; src=&quot;/img/in-post/compression_ratio.png&quot; width=&quot;1200&quot; /&gt;&lt;/p&gt;

&lt;p&gt;compression ratio，越小越好，比如说源文件大小是100MiB，ratio为5%，则压缩后文件大小为5MiB。&lt;/p&gt;

&lt;p&gt;从折线图看到趋势是：压缩级别越高，压缩率越低，说明文件被压缩的更小了。在这种情况下，xz始终提供比较平稳的压缩率（但从压缩时间图所示，xz在压缩级别3之后花费更长的时间才能获得这个效果），紧跟其后的是pbzip2和bzip2，gzip在压缩级别为3后，压缩率有所下降。&lt;/p&gt;

&lt;h2 id=&quot;compression-speed&quot;&gt;Compression Speed&lt;/h2&gt;

&lt;p&gt;Unit:MiB/s&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;&lt;strong&gt;Compress Level&lt;/strong&gt;&lt;/th&gt;
      &lt;th&gt;&lt;strong&gt;gzip&lt;/strong&gt;&lt;/th&gt;
      &lt;th&gt;&lt;strong&gt;bzip2&lt;/strong&gt;&lt;/th&gt;
      &lt;th&gt;&lt;strong&gt;pbzip2&lt;/strong&gt;&lt;/th&gt;
      &lt;th&gt;&lt;strong&gt;xz&lt;/strong&gt;&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;0&lt;/td&gt;
      &lt;td&gt;-&lt;/td&gt;
      &lt;td&gt;-&lt;/td&gt;
      &lt;td&gt;-&lt;/td&gt;
      &lt;td&gt;70.702&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;1&lt;/td&gt;
      &lt;td&gt;160.702&lt;/td&gt;
      &lt;td&gt;7.263&lt;/td&gt;
      &lt;td&gt;98.006&lt;/td&gt;
      &lt;td&gt;56.344&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2&lt;/td&gt;
      &lt;td&gt;160.892&lt;/td&gt;
      &lt;td&gt;6.263&lt;/td&gt;
      &lt;td&gt;86.461&lt;/td&gt;
      &lt;td&gt;44.906&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;3&lt;/td&gt;
      &lt;td&gt;159.853&lt;/td&gt;
      &lt;td&gt;5.732&lt;/td&gt;
      &lt;td&gt;76.728&lt;/td&gt;
      &lt;td&gt;32.063&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;4&lt;/td&gt;
      &lt;td&gt;126.597&lt;/td&gt;
      &lt;td&gt;5.391&lt;/td&gt;
      &lt;td&gt;73.667&lt;/td&gt;
      &lt;td&gt;17.318&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;5&lt;/td&gt;
      &lt;td&gt;124.200&lt;/td&gt;
      &lt;td&gt;5.097&lt;/td&gt;
      &lt;td&gt;68.652&lt;/td&gt;
      &lt;td&gt;11.947&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;6&lt;/td&gt;
      &lt;td&gt;102.797&lt;/td&gt;
      &lt;td&gt;4.914&lt;/td&gt;
      &lt;td&gt;66.094&lt;/td&gt;
      &lt;td&gt;7.059&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;7&lt;/td&gt;
      &lt;td&gt;98.698&lt;/td&gt;
      &lt;td&gt;4.735&lt;/td&gt;
      &lt;td&gt;64.322&lt;/td&gt;
      &lt;td&gt;6.727&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;8&lt;/td&gt;
      &lt;td&gt;78.239&lt;/td&gt;
      &lt;td&gt;4.536&lt;/td&gt;
      &lt;td&gt;58.260&lt;/td&gt;
      &lt;td&gt;6.396&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;9&lt;/td&gt;
      &lt;td&gt;75.296&lt;/td&gt;
      &lt;td&gt;4.490&lt;/td&gt;
      &lt;td&gt;52.176&lt;/td&gt;
      &lt;td&gt;5.879&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;&lt;img class=&quot;shadow&quot; src=&quot;/img/in-post/compression_speed.png&quot; width=&quot;1200&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;decompression-time&quot;&gt;Decompression Time&lt;/h2&gt;

&lt;p&gt;Unit: seconds&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;Decompress Level&lt;/th&gt;
      &lt;th&gt;&lt;strong&gt;gzip&lt;/strong&gt;&lt;/th&gt;
      &lt;th&gt;&lt;strong&gt;bzip2&lt;/strong&gt;&lt;/th&gt;
      &lt;th&gt;&lt;strong&gt;pbzip2&lt;/strong&gt;&lt;/th&gt;
      &lt;th&gt;&lt;strong&gt;xz&lt;/strong&gt;&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;0&lt;/td&gt;
      &lt;td&gt;-&lt;/td&gt;
      &lt;td&gt;-&lt;/td&gt;
      &lt;td&gt;-&lt;/td&gt;
      &lt;td&gt;0m2.886s&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;1&lt;/td&gt;
      &lt;td&gt;0m2.502s&lt;/td&gt;
      &lt;td&gt;0m8.986s&lt;/td&gt;
      &lt;td&gt;0m0.675s&lt;/td&gt;
      &lt;td&gt;0m2.282s&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2&lt;/td&gt;
      &lt;td&gt;0m2.782s&lt;/td&gt;
      &lt;td&gt;0m8.858s&lt;/td&gt;
      &lt;td&gt;0m0.706s&lt;/td&gt;
      &lt;td&gt;0m2.277s&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;3&lt;/td&gt;
      &lt;td&gt;0m2.403s&lt;/td&gt;
      &lt;td&gt;0m9.019s&lt;/td&gt;
      &lt;td&gt;0m1.047s&lt;/td&gt;
      &lt;td&gt;0m2.252s&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;4&lt;/td&gt;
      &lt;td&gt;0m2.413s&lt;/td&gt;
      &lt;td&gt;0m9.702s&lt;/td&gt;
      &lt;td&gt;0m0.738s&lt;/td&gt;
      &lt;td&gt;0m2.349s&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;5&lt;/td&gt;
      &lt;td&gt;0m2.370s&lt;/td&gt;
      &lt;td&gt;0m9.378s&lt;/td&gt;
      &lt;td&gt;0m0.783s&lt;/td&gt;
      &lt;td&gt;0m2.398s&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;6&lt;/td&gt;
      &lt;td&gt;0m2.367s&lt;/td&gt;
      &lt;td&gt;0m9.688s&lt;/td&gt;
      &lt;td&gt;0m0.770s&lt;/td&gt;
      &lt;td&gt;0m2.302s&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;7&lt;/td&gt;
      &lt;td&gt;0m2.435s&lt;/td&gt;
      &lt;td&gt;0m9.197s&lt;/td&gt;
      &lt;td&gt;0m0.828s&lt;/td&gt;
      &lt;td&gt;0m2.368s&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;8&lt;/td&gt;
      &lt;td&gt;0m2.480s&lt;/td&gt;
      &lt;td&gt;0m9.232s&lt;/td&gt;
      &lt;td&gt;0m0.844s&lt;/td&gt;
      &lt;td&gt;0m2.359s&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;9&lt;/td&gt;
      &lt;td&gt;0m2.877s&lt;/td&gt;
      &lt;td&gt;0m9.246s&lt;/td&gt;
      &lt;td&gt;0m0.796s&lt;/td&gt;
      &lt;td&gt;0m2.394s&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;&lt;img class=&quot;shadow&quot; src=&quot;/img/in-post/decompression_time.png&quot; width=&quot;1200&quot; /&gt;&lt;/p&gt;

&lt;p&gt;由于数值比较小，从折线图上直接看不出什么效果，从表格中可以看出，当文件的压缩级别越高，解压相应的压缩文件耗时越低。xz的解压缩时间几乎是一条直线，非常平稳，gbip2次之，当gbzip2解压比xz更快。&lt;/p&gt;

&lt;p&gt;从Compression time, Compression Ratio，结合当前的Decompress Time看，总体上推荐gbzip2进行文件的压缩与解压缩操作。&lt;/p&gt;

&lt;h2 id=&quot;decompression-speed&quot;&gt;Decompression Speed&lt;/h2&gt;

&lt;p&gt;Unit: MiB/s&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;Decompress Level&lt;/th&gt;
      &lt;th&gt;&lt;strong&gt;gzip&lt;/strong&gt;&lt;/th&gt;
      &lt;th&gt;&lt;strong&gt;bzip2&lt;/strong&gt;&lt;/th&gt;
      &lt;th&gt;&lt;strong&gt;pbzip2&lt;/strong&gt;&lt;/th&gt;
      &lt;th&gt;&lt;strong&gt;xz&lt;/strong&gt;&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;0&lt;/td&gt;
      &lt;td&gt;-&lt;/td&gt;
      &lt;td&gt;-&lt;/td&gt;
      &lt;td&gt;-&lt;/td&gt;
      &lt;td&gt;6.202&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;1&lt;/td&gt;
      &lt;td&gt;10.498&lt;/td&gt;
      &lt;td&gt;2.144&lt;/td&gt;
      &lt;td&gt;28.612&lt;/td&gt;
      &lt;td&gt;7.537&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2&lt;/td&gt;
      &lt;td&gt;9.310&lt;/td&gt;
      &lt;td&gt;1.790&lt;/td&gt;
      &lt;td&gt;23.011&lt;/td&gt;
      &lt;td&gt;7.159&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;3&lt;/td&gt;
      &lt;td&gt;10.644&lt;/td&gt;
      &lt;td&gt;1.618&lt;/td&gt;
      &lt;td&gt;13.970&lt;/td&gt;
      &lt;td&gt;7.149&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;4&lt;/td&gt;
      &lt;td&gt;8.773&lt;/td&gt;
      &lt;td&gt;1.441&lt;/td&gt;
      &lt;td&gt;19.757&lt;/td&gt;
      &lt;td&gt;6.982&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;5&lt;/td&gt;
      &lt;td&gt;8.307&lt;/td&gt;
      &lt;td&gt;1.445&lt;/td&gt;
      &lt;td&gt;17.569&lt;/td&gt;
      &lt;td&gt;6.505&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;6&lt;/td&gt;
      &lt;td&gt;7.858&lt;/td&gt;
      &lt;td&gt;1.360&lt;/td&gt;
      &lt;td&gt;17.737&lt;/td&gt;
      &lt;td&gt;6.560&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;7&lt;/td&gt;
      &lt;td&gt;7.598&lt;/td&gt;
      &lt;td&gt;1.410&lt;/td&gt;
      &lt;td&gt;16.452&lt;/td&gt;
      &lt;td&gt;6.558&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;8&lt;/td&gt;
      &lt;td&gt;7.080&lt;/td&gt;
      &lt;td&gt;1.384&lt;/td&gt;
      &lt;td&gt;16.002&lt;/td&gt;
      &lt;td&gt;6.528&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;9&lt;/td&gt;
      &lt;td&gt;6.028&lt;/td&gt;
      &lt;td&gt;1.368&lt;/td&gt;
      &lt;td&gt;15.929&lt;/td&gt;
      &lt;td&gt;6.558&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;&lt;img class=&quot;shadow&quot; src=&quot;/img/in-post/decompression_speed.png&quot; width=&quot;1200&quot; /&gt;&lt;/p&gt;

&lt;h1 id=&quot;性能差异和比较&quot;&gt;性能差异和比较&lt;/h1&gt;

&lt;p&gt;默认情况下，当未指定压缩级别时，gzip 使用 -6，bzip2 和 pbzip2 使用 -9，xz 使用 -6。&lt;/p&gt;

&lt;p&gt;根据测试结果，原因非常明确：对于 gzip 和 xz -6 作为默认压缩方法提供良好的压缩级别，但完成时间不会太长，损失一个平衡点，因为较高的压缩级别需要更长的时间来处理压缩。另一方面，pbzip2 最好使用默认压缩级别为 9，如手册页中建议的那样，此处的结果证实了这一点，压缩比增加，但所采用的时间几乎相同，在级别 1 到 9 之间相差不到一秒；但反观bzip2，使用不同的压缩级别，压缩耗时还是有蛮大幅度变化的。&lt;/p&gt;

&lt;p&gt;一般来说，xz 达到最佳压缩级别，非常的平稳，然后是 bzip2和pbzip2，然后是 gzip。为了达到更好的压缩，但是xz通常需要最长的完成，其次是pbzip2，然后是gzip，最差的是bzip2，耗时太久。&lt;/p&gt;

&lt;p&gt;xz 的默认压缩级别为 6，而 pbzip2 在压缩级别 9 时仅花费比 gzip 稍长一点的时间，并且压缩量更好，而 pbzip2 和 xz 之间的差异小于 pbzip2 和 gzip 之间的差异，因此 pbzip2 成为压缩的优先选择。&lt;/p&gt;

&lt;p&gt;根据这些测试结果，pbzip2是压缩的良好中间地带，gzip只是压缩的更快一点，而xz可能并不真正值得使用，尤其使用更高的文件压缩级别（&amp;gt;=6），因为它需要更长的时间来完成压缩操作。&lt;/p&gt;

&lt;p&gt;然而，使用 bzip2 解压缩比 xz 或 gzip 或 pbzip2 需要更长的时间，xz 处于解压缩文件的良好中间地带，而 gbzip2 则是解压缩最快的。&lt;/p&gt;

&lt;h1 id=&quot;选择哪种压缩方式&quot;&gt;选择哪种压缩方式？&lt;/h1&gt;

&lt;p&gt;那么我该选择哪种压缩/解压缩方式？这完全取决于应用目的了，需要因地制宜选择所需的压缩/解压缩方法。&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;如果是交互式的压缩文件，可以使用pxz，这个指令可以看到压缩进度；&lt;/li&gt;
  &lt;li&gt;如果只是想尽可能快的压缩和解压缩文件，很少考虑压缩比情况下，gzip是一个很好的选择；&lt;/li&gt;
  &lt;li&gt;如果只想要一个更好的压缩比，以节约磁盘空间，并愿意话费更多的时间去加压缩它，那么xz只比较好的选择，其次是pbzip2&lt;/li&gt;
&lt;/ul&gt;</content><author><name>Gavin</name></author><category term="gzip" /><category term="bzip2" /><category term="pbzip2" /><category term="xz" /><summary type="html">概述</summary></entry><entry><title type="html">esrally实战</title><link href="http://172.17.73.80:4000/2020/06/02/esrally-practice/" rel="alternate" type="text/html" title="esrally实战" /><published>2020-06-02T00:00:00+08:00</published><updated>2020-06-02T00:00:00+08:00</updated><id>http://172.17.73.80:4000/2020/06/02/esrally-practice</id><content type="html" xml:base="http://172.17.73.80:4000/2020/06/02/esrally-practice/">&lt;h1 id=&quot;更改pip源&quot;&gt;更改pip源&lt;/h1&gt;

&lt;p&gt;考虑到使用esrally官方数据进行工具熟悉，需要下载一些json文件，而这些json文件又比较大，使用国外的源会下载很久，所以需要先更改pip源，详细操作方法，参考：https://gavin-wang-note.github.io/2020/05/05/change-pip-install-source/&lt;/p&gt;

&lt;h1 id=&quot;install&quot;&gt;install&lt;/h1&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;pip install --upgrade pip
pip3 install esrally
esrally configure
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;其中，esrally configure选择默认，一路下去就好：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;root@node244:~# esrally configure

    ____        ____
   / __ \____ _/ / /_  __
  / /_/ / __ `/ / / / / /
 / _, _/ /_/ / / / /_/ /
/_/ |_|\__,_/_/_/\__, /
                /____/

Running simple configuration. Run the advanced configuration with:

  esrally configure --advanced-config

* Setting up benchmark root directory in /root/.rally/benchmarks
* Setting up benchmark source directory in /root/.rally/benchmarks/src/elasticsearch

Configuration successfully written to /root/.rally/rally.ini. Happy benchmarking!

More info about Rally:

* Type esrally --help
* Read the documentation at https://esrally.readthedocs.io/en/1.4.1/
* Ask a question on the forum at https://discuss.elastic.co/c/elasticsearch/rally
root@node244:~# 

&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;执行pip3 install esrally时，报错：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;Successfully built py-cpuinfo thespian tabulate psutil pyrsistent
ERROR: awscli 1.18.21 has requirement botocore==1.15.21, but you'll have botocore 1.13.50 which is incompatible.
ERROR: awscli 1.18.21 has requirement s3transfer&amp;lt;0.4.0,&amp;gt;=0.3.0, but you'll have s3transfer 0.2.1 which is incompatible.
Installing collected packages: MarkupSafe, Jinja2, py-cpuinfo, elasticsearch, pyrsistent, attrs, zipp, importlib-metadata, jsonschema, thespian, tabulate, psutil, botocore, s3transfer, boto3, esrally
  Attempting uninstall: psutil
    Found existing installation: psutil 3.4.2
ERROR: Cannot uninstall 'psutil'. It is a distutils installed project and thus we cannot accurately determine which files belong to it which would lead to only a partial uninstall.
root@node244:~# 

&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;解决方法：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;root@node244:~# dpkg -l | grep psutil
ii  python-psutil                   3.4.2-1ubuntu0.1                           amd64        module providing convenience functions for managing processes
ii  python3-psutil                  3.4.2-1ubuntu0.1                           amd64        module providing convenience functions for managing processes (Python3)

apt-get remove python3-psutil

&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h1 id=&quot;安装git&quot;&gt;安装git&lt;/h1&gt;

&lt;p&gt;忽略。&lt;/p&gt;

&lt;h1 id=&quot;安装kibana&quot;&gt;安装kibana&lt;/h1&gt;

&lt;p&gt;由于ES版本是7.6.0，所以要使用7.6.0版本的kibana，两者版本一定要一一对应。&lt;/p&gt;

&lt;p&gt;直接从官网下载源码，放在ES集群的任意一个节点，或者非ES节点，进入config目录，修改kibana.yml&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;root@node76:~/kibana-7.6.0-linux-x86_64/config# ll
total 20
drwxrwxr-x  2 root root 4096 May 28 17:00 ./
drwxr-xr-x 13 root root 4096 May 26 09:42 ../
-rw-r--r--  1 root root 3009 Feb  6 08:47 apm.js
-rw-r--r--  1 root root 5944 May 28 17:00 kibana.yml
root@node76:~/kibana-7.6.0-linux-x86_64/config#
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;增加如下内容：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;i18n.locale: &quot;zh-CN&quot;			                        # kibana默认文字是英文，变更成中文
server.port: 5601		        		                # 浏览器访问端口
server.host: &quot;0.0.0.0&quot;	                		        # 对外的服务地址
elasticsearch.hosts: [&quot;http://10.16.172.75:9200&quot;]       # 这里为你的elasticsearch集群的地址
kibana.index: &quot;.kibana&quot;                                 # 开启此选项
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;在tmux中，启动kibana：&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;root@node76:~/kibana-7.6.0-linux-x86_64# ./bin/kibana --allow-root&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;看看output是否无异常，然后通过浏览器，可以正常访问5601端口了：&lt;/p&gt;

&lt;p&gt;&lt;img class=&quot;shadow&quot; src=&quot;/img/in-post/esrally/kibina-view.png&quot; width=&quot;1200&quot; /&gt;&lt;/p&gt;

&lt;h1 id=&quot;如何创建自定义的track&quot;&gt;如何创建自定义的track&lt;/h1&gt;

&lt;h2 id=&quot;获取产品index信息&quot;&gt;获取产品index信息&lt;/h2&gt;

&lt;p&gt;由于产品在启用ES时，radosgw会创建出来一个index，命名格式如下：&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;rgw-pool_name-xxx&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;其中，pool_name为当前S3 pool的名称，xxx为一串随机字母和数字组合体，比如：rgw-default-0185294c。&lt;/p&gt;

&lt;p&gt;知道了产品创建的index，通过Chrome插件elastic head，成功查询出该index的index information：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;{
    &quot;state&quot;: &quot;open&quot;,
    &quot;settings&quot;: {
        &quot;index&quot;: {
            &quot;creation_date&quot;: &quot;1590482452838&quot;,
            &quot;number_of_shards&quot;: &quot;6&quot;,
            &quot;number_of_replicas&quot;: &quot;1&quot;,
            &quot;uuid&quot;: &quot;ETvwijSKRjyyF93yeQ4PgA&quot;,
            &quot;version&quot;: {
                &quot;created&quot;: &quot;7060099&quot;
            },
            &quot;provided_name&quot;: &quot;rgw-default-0185294c&quot;
        }
    },
    &quot;mappings&quot;: {
        &quot;_doc&quot;: {
            &quot;properties&quot;: {
                &quot;bucket&quot;: {
                    &quot;type&quot;: &quot;keyword&quot;
                },
                &quot;owner&quot;: {
                    &quot;properties&quot;: {
                        &quot;id&quot;: {
                            &quot;type&quot;: &quot;text&quot;,
                            &quot;fields&quot;: {
                                &quot;keyword&quot;: {
                                    &quot;ignore_above&quot;: 256,
                                    &quot;type&quot;: &quot;keyword&quot;
                                }
                            }
                        },
                        &quot;display_name&quot;: {
                            &quot;type&quot;: &quot;text&quot;,
                            &quot;fields&quot;: {
                                &quot;keyword&quot;: {
                                    &quot;ignore_above&quot;: 256,
                                    &quot;type&quot;: &quot;keyword&quot;
                                }
                            }
                        }
                    }
                },
                &quot;instance&quot;: {
                    &quot;type&quot;: &quot;keyword&quot;
                },
                &quot;meta&quot;: {
                    &quot;properties&quot;: {
                        &quot;expires&quot;: {
                            &quot;type&quot;: &quot;keyword&quot;
                        },
                        &quot;storage_class&quot;: {
                            &quot;type&quot;: &quot;keyword&quot;
                        },
                        &quot;content_encoding&quot;: {
                            &quot;type&quot;: &quot;keyword&quot;
                        },
                        &quot;cache_control&quot;: {
                            &quot;type&quot;: &quot;keyword&quot;
                        },
                        &quot;mtime&quot;: {
                            &quot;type&quot;: &quot;date&quot;
                        },
                        &quot;content_language&quot;: {
                            &quot;type&quot;: &quot;keyword&quot;
                        },
                        &quot;custom-date&quot;: {
                            &quot;type&quot;: &quot;nested&quot;,
                            &quot;properties&quot;: {
                                &quot;name&quot;: {
                                    &quot;type&quot;: &quot;keyword&quot;
                                },
                                &quot;value&quot;: {
                                    &quot;type&quot;: &quot;date&quot;
                                }
                            }
                        },
                        &quot;content_type&quot;: {
                            &quot;type&quot;: &quot;keyword&quot;
                        },
                        &quot;custom-int&quot;: {
                            &quot;type&quot;: &quot;nested&quot;,
                            &quot;properties&quot;: {
                                &quot;name&quot;: {
                                    &quot;type&quot;: &quot;keyword&quot;
                                },
                                &quot;value&quot;: {
                                    &quot;type&quot;: &quot;long&quot;
                                }
                            }
                        },
                        &quot;custom-string&quot;: {
                            &quot;type&quot;: &quot;nested&quot;,
                            &quot;properties&quot;: {
                                &quot;name&quot;: {
                                    &quot;type&quot;: &quot;keyword&quot;
                                },
                                &quot;value&quot;: {
                                    &quot;type&quot;: &quot;keyword&quot;
                                }
                            }
                        },
                        &quot;size&quot;: {
                            &quot;type&quot;: &quot;long&quot;
                        },
                        &quot;content_disposition&quot;: {
                            &quot;type&quot;: &quot;keyword&quot;
                        },
                        &quot;etag&quot;: {
                            &quot;type&quot;: &quot;keyword&quot;
                        },
                        &quot;tail_tag&quot;: {
                            &quot;type&quot;: &quot;text&quot;,
                            &quot;fields&quot;: {
                                &quot;keyword&quot;: {
                                    &quot;ignore_above&quot;: 256,
                                    &quot;type&quot;: &quot;keyword&quot;
                                }
                            }
                        }
                    }
                },
                &quot;permissions&quot;: {
                    &quot;type&quot;: &quot;text&quot;,
                    &quot;fields&quot;: {
                        &quot;keyword&quot;: {
                            &quot;ignore_above&quot;: 256,
                            &quot;type&quot;: &quot;keyword&quot;
                        }
                    }
                },
                &quot;name&quot;: {
                    &quot;type&quot;: &quot;keyword&quot;
                },
                &quot;versioned_epoch&quot;: {
                    &quot;type&quot;: &quot;long&quot;
                }
            }
        }
    },
    &quot;aliases&quot;: [
        
    ],
    &quot;primary_terms&quot;: {
        &quot;0&quot;: 2,
        &quot;1&quot;: 2,
        &quot;2&quot;: 3,
        &quot;3&quot;: 2,
        &quot;4&quot;: 2,
        &quot;5&quot;: 2
    },
    &quot;in_sync_allocations&quot;: {
        &quot;0&quot;: [
            &quot;2_0-lXLvSbyExIEMJzL1lA&quot;,
            &quot;KPvnjrHgSy-AjEWVxj8sOA&quot;
        ],
        &quot;1&quot;: [
            &quot;Hls3ybkQRRG8775SV-7rsA&quot;,
            &quot;iZOWaQZ4TBCXYwazPSo38g&quot;
        ],
        &quot;2&quot;: [
            &quot;hP40oioMSUOjOS8-NlWB2w&quot;,
            &quot;Hef19xB1Ru2J9zbeDmZ4PQ&quot;
        ],
        &quot;3&quot;: [
            &quot;jwu4T-z2RvKrupWGam4QWw&quot;,
            &quot;ThRg4-UESYqwo5iKYzzJ4A&quot;
        ],
        &quot;4&quot;: [
            &quot;a8R3KMiyRTenLI5jDC2wrw&quot;,
            &quot;4e5LfW6SRPWyTkXU0xQPbQ&quot;
        ],
        &quot;5&quot;: [
            &quot;6xcWh3JTTVGc8eHwChkmfw&quot;,
            &quot;_Bzi1GwAS4G3J5kESmRMDw&quot;
        ]
    }
}
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;重点关注“mappings”里的内容，其他信息不用关心。&lt;/p&gt;

&lt;h2 id=&quot;根据产品index信息构造自定义indexjson&quot;&gt;根据产品index信息，构造自定义index.json&lt;/h2&gt;

&lt;p&gt;有了上面的mappings信息，就可以自定义track所需要的index了：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;root@node244:~/my_esrally_data/tracks/bigtera# ll
total 48
drwxr-xr-x 4 root root  4096 May 27 18:28 ./
drwxr-xr-x 3 root root  4096 May 27 10:07 ../
drwxr-xr-x 2 root root  4096 May 27 18:04 challenges/
-rw-r--r-- 1 root root    44 May 26 14:50 files.txt
-rw-r--r-- 1 root root  3559 May 27 17:51 index.json
drwxr-xr-x 2 root root  4096 May 27 15:14 operations/
-rw-r--r-- 1 root root  3224 May 26 14:50 README.md
-rw-r--r-- 1 root root   745 May 27 17:58 track.json
-rw-r--r-- 1 root root  3736 May 26 14:50 track.py
root@node244:~/my_esrally_data/tracks/bigtera# 
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;自定义的index信息如下：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;root@node244:~/my_esrally_data/tracks/bigtera# cat index.json 
{
  &quot;settings&quot;: {
    &quot;index.number_of_shards&quot;: ,
    &quot;index.number_of_replicas&quot;: ,
    &quot;index.store.type&quot;: &quot;&quot;,
    &quot;index.requests.cache.enable&quot;: false
  },
  &quot;mappings&quot;: {
    &quot;_source&quot;: {
      &quot;enabled&quot;: 
    },
    &quot;properties&quot;: {
        &quot;bucket&quot;: {
            &quot;type&quot;: &quot;keyword&quot;
            },
        &quot;owner&quot;: {
            &quot;properties&quot;: {
            &quot;id&quot;: {
                &quot;type&quot;: &quot;text&quot;,
                &quot;fields&quot;: {
                    &quot;keyword&quot;: {
                       &quot;ignore_above&quot;: 256,
                       &quot;type&quot;: &quot;keyword&quot;
                    }
                }
            },
            &quot;display_name&quot;: {
                &quot;type&quot;: &quot;text&quot;,
                &quot;fields&quot;: {
                    &quot;keyword&quot;: {
                        &quot;ignore_above&quot;: 256,
                        &quot;type&quot;: &quot;keyword&quot;
                        }
                     }
                 }
             }
        },
        &quot;instance&quot;: {
            &quot;type&quot;: &quot;keyword&quot;
        },
        &quot;meta&quot;: {
            &quot;properties&quot;: {
            &quot;expires&quot;: {
                &quot;type&quot;: &quot;keyword&quot;
                },
            &quot;storage_class&quot;: {
                &quot;type&quot;: &quot;keyword&quot;
                },
            &quot;content_encoding&quot;: {
                &quot;type&quot;: &quot;keyword&quot;
                },
             &quot;cache_control&quot;: {
                 &quot;type&quot;: &quot;keyword&quot;
                },
            &quot;mtime&quot;: {
                &quot;type&quot;: &quot;date&quot;
                },
            &quot;content_language&quot;: {
                &quot;type&quot;: &quot;keyword&quot;
                },
            &quot;custom-date&quot;: {
                &quot;type&quot;: &quot;nested&quot;,
                &quot;properties&quot;: {
                    &quot;name&quot;: {
                        &quot;type&quot;: &quot;keyword&quot;
                        },
                    &quot;value&quot;: {
                         &quot;type&quot;: &quot;date&quot;
                        }
                 }
             },
             &quot;content_type&quot;: {
                 &quot;type&quot;: &quot;keyword&quot;
                 },
             &quot;custom-int&quot;: {
                 &quot;type&quot;: &quot;nested&quot;,
                 &quot;properties&quot;: {
                     &quot;name&quot;: {
                         &quot;type&quot;: &quot;keyword&quot;
                     },
                     &quot;value&quot;: {
                          &quot;type&quot;: &quot;long&quot;
                     }
                 }
             },
             &quot;custom-string&quot;: {
                 &quot;type&quot;: &quot;nested&quot;,
                 &quot;properties&quot;: {
                     &quot;name&quot;: {
                         &quot;type&quot;: &quot;keyword&quot;
                         },
                      &quot;value&quot;: {
                          &quot;type&quot;: &quot;keyword&quot;
                          }
                  }
             },
            &quot;size&quot;: {
                &quot;type&quot;: &quot;long&quot;
                },
            &quot;content_disposition&quot;: {
                &quot;type&quot;: &quot;keyword&quot;
                },
            &quot;etag&quot;: {
                &quot;type&quot;: &quot;keyword&quot;
                },
            &quot;tail_tag&quot;: {
                &quot;type&quot;: &quot;text&quot;,
                &quot;fields&quot;: {
                    &quot;keyword&quot;: {
                        &quot;ignore_above&quot;: 256,
                        &quot;type&quot;: &quot;keyword&quot;
                        }
                }
            }
   }
},
    &quot;permissions&quot;: {
        &quot;type&quot;: &quot;text&quot;,
        &quot;fields&quot;: {
            &quot;keyword&quot;: {
                &quot;ignore_above&quot;: 256,
                &quot;type&quot;: &quot;keyword&quot;
                }
        }
    },
    &quot;name&quot;: {
        &quot;type&quot;: &quot;keyword&quot;
        },
    &quot;versioned_epoch&quot;: {
        &quot;type&quot;: &quot;long&quot;
        }
    }
  }
}
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;根据index信息构造测试数据&quot;&gt;根据index信息，构造测试数据&lt;/h2&gt;

&lt;p&gt;有了index了，如何给esrally构造数据呢？依然使用elastic head插件，查询出产品生产的index里的数据（前提条件是写了部分数据，哪怕几条也行，可以通过cosbench写，也可以自己写个脚本put s3 object），如下图所示：&lt;/p&gt;

&lt;p&gt;&lt;img class=&quot;shadow&quot; src=&quot;/img/in-post/esrally/es_head_view.png&quot; width=&quot;1200&quot; /&gt;&lt;/p&gt;

&lt;p&gt;图中，可以看出，从“bucket开始，就是当前index的字段信息，没有子键值项；&lt;/p&gt;

&lt;p&gt;owner.id，owner.display_nane，这说明owner是一级key，id 和 display_nane是二级key&lt;/p&gt;

&lt;p&gt;meta.custom-string.name 和 meta.custom-string.value, 这说明meta是一级key， custom-string是二级key，name和value是三级key&lt;/p&gt;

&lt;p&gt;分析到这里，就会知道，esrally工具需要什么样的数据结构的数据，一个完整的数据结构如下：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;{
    &quot;bucket&quot;: &quot;bucket01&quot;,
    &quot;owner&quot;: {
        &quot;id&quot;: &quot;user01&quot;,
        &quot;display_name&quot;: &quot;user01&quot;
    },
    &quot;instance&quot;: &quot;&quot;,
    &quot;meta&quot;: {
        &quot;expires&quot;: &quot;&quot;,
        &quot;storage_class&quot;: &quot;&quot;,
        &quot;content_encoding&quot;: &quot;&quot;,
        &quot;mtime&quot;: &quot;2020-05-27T03:14:57.855Z&quot;,
        &quot;content_language&quot;: &quot;&quot;,
        &quot;custom-date&quot;: {
            &quot;name&quot;: &quot;&quot;,
            &quot;value&quot;: &quot;&quot;
        },
        &quot;content_type&quot;: &quot;application/octet-stream&quot;,
        &quot;custom-int&quot;: {
            &quot;name&quot;: &quot;&quot;,
            &quot;value&quot;: &quot;&quot;
        },
        &quot;custom-string&quot;: {
            &quot;name&quot;: &quot;7385228445730524&quot;,
            &quot;value&quot;: &quot;8590745273515960&quot;
        },
        &quot;size&quot;: &quot;10&quot;,
        &quot;content_disposition&quot;: &quot;&quot;,
        &quot;etag&quot;: &quot;e7b4c2f4a8153de9c7a070e5d6550ab1&quot;,
        &quot;tail_tag&quot;: &quot;a3a5cefd-376d-421b-9080-08b98962e7c1.4520.681216&quot;
    },
    &quot;permissions&quot;: &quot;&quot;,
    &quot;name&quot;: &quot;25_1590549297.82&quot;,
    &quot;versioned_epoch&quot;: &quot;0&quot;
}
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;比如上面的custom-int 和custom-date，可以不需要，我只需要custom-string类型的信息，那就可以忽略掉这两个键值，只生成必须的字典信息即可，参考如下:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;root@node244:~/my_esrally_data/data/bigtera# cat documents-2.json | head -n 6
{&quot;name&quot;: &quot;83_0916035289.68&quot;, &quot;bucket&quot;: &quot;bucket01&quot;, &quot;instance&quot;: &quot;null&quot;, &quot;meta&quot;: {&quot;custom-string&quot;: {&quot;name&quot;: &quot;2427603943521294&quot;, &quot;value&quot;: &quot;6309708009398746&quot;}, &quot;mtime&quot;: &quot;2020-05-22T55:60:03.465Z&quot;, &quot;etag&quot;: &quot;e7b834f4a0650de9c7a070e5d8446ab1&quot;, &quot;content_type&quot;: &quot;application/octet-stream&quot;, &quot;tail_tag&quot;: &quot;a3a5cefd-376d-421b-2627-08b32656e7c1.4520.354058&quot;, &quot;size&quot;: &quot;315&quot;}, &quot;owner&quot;: {&quot;display_name&quot;: &quot;user01&quot;, &quot;id&quot;: &quot;user01&quot;}, &quot;versioned_epoch&quot;: &quot;0&quot;}
{&quot;name&quot;: &quot;83_0916035289.68&quot;, &quot;bucket&quot;: &quot;bucket01&quot;, &quot;instance&quot;: &quot;null&quot;, &quot;meta&quot;: {&quot;custom-string&quot;: {&quot;name&quot;: &quot;2427603943521294&quot;, &quot;value&quot;: &quot;6309708009398746&quot;}, &quot;mtime&quot;: &quot;2020-05-22T55:60:03.465Z&quot;, &quot;etag&quot;: &quot;e7b834f4a0650de9c7a070e5d8446ab1&quot;, &quot;content_type&quot;: &quot;application/octet-stream&quot;, &quot;tail_tag&quot;: &quot;a3a5cefd-376d-421b-2627-08b32656e7c1.4520.354058&quot;, &quot;size&quot;: &quot;315&quot;}, &quot;owner&quot;: {&quot;display_name&quot;: &quot;user01&quot;, &quot;id&quot;: &quot;user01&quot;}, &quot;versioned_epoch&quot;: &quot;0&quot;}
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;这里产生的数据，通过python script来生成（没使用thread pool并发，后期改进，目前生成一千五百万笔记录，不到3分钟），script 内容参考如下：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;root@node244:~# cat write_json_data.py 
#!/usr/bin/env python

import os
import sys
from random import choice
from string import digits
from string import ascii_lowercase


def rand_low_ascii(length=10):
    return ''.join([choice(ascii_lowercase) for i in xrange(length)])


def rand_alpha(length=9):
    return ''.join([choice(digits) for i in xrange(length)])


def json_data():
    src = {&quot;bucket&quot;:&quot;bucket01&quot;,&quot;owner&quot;:{&quot;id&quot;:&quot;user01&quot;,&quot;display_name&quot;:&quot;user01&quot;},&quot;instance&quot;:&quot;null&quot;,&quot;meta&quot;:{&quot;mtime&quot;:&quot;2020-05-2{}T{}:{}:{}.{}Z&quot;.format(rand_alpha(1), rand_alpha(2), rand_alpha(2), rand_alpha(2), rand_alpha(3)),&quot;content_type&quot;:&quot;application/octet-stream&quot;,&quot;custom-string&quot;:{&quot;name&quot;:&quot;{}&quot;.format(rand_alpha(16)),&quot;value&quot;:&quot;{}&quot;.format(rand_alpha(16))},&quot;size&quot;:&quot;{}&quot;.format(rand_alpha(3)),&quot;etag&quot;:&quot;e7b{}f4a{}de9c7a070e5d{}ab1&quot;.format(rand_alpha(3), rand_alpha(4), rand_alpha(4)),&quot;tail_tag&quot;:&quot;a3a5cefd-376d-421b-{}-08b{}e7c1.4520.{}&quot;.format(rand_alpha(4), rand_alpha(5), rand_alpha(6))},&quot;name&quot;:&quot;{}_{}.{}&quot;.format(rand_alpha(2), rand_alpha(10), rand_alpha(2)),&quot;versioned_epoch&quot;:&quot;0&quot;}

    return src


def write_data(src):
    with open(&quot;./documents-2.json&quot;, 'a') as f:
        # replace ' to &quot;
        new_str = str(src).replace(&quot;'&quot;, '&quot;')
        f.write(new_str)
        f.write('\n')


if __name__ == '__main__':
    for i in xrange(15000000):
        src = json_data()
        write_data(src)
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;修改esrally配置文件&quot;&gt;修改esrally配置文件&lt;/h2&gt;

&lt;p&gt;有构造数据的脚本了，通过修改esrally的配置文件以及track.json，读取指定目录下指定文件，共同完成一个rally job的运行。&lt;/p&gt;

&lt;h3 id=&quot;修改trackjson&quot;&gt;修改track.json&lt;/h3&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;root@node244:~/my_esrally_data/tracks/bigtera# cat track.json 
{\% \import &quot;rally.helpers&quot; as rally with context \%}
{
  &quot;version&quot;: 2,
  &quot;description&quot;: &quot;POIs from bigtera&quot;,
  &quot;data-url&quot;: &quot;/root/my_esrally_data/tracks/bigtera/index.json&quot;,
  &quot;indices&quot;: [
    {
      &quot;name&quot;: &quot;bigtera&quot;,
      &quot;body&quot;: &quot;index.json&quot;
    }
  ],
  &quot;corpora&quot;: [
    {
      &quot;name&quot;: &quot;bigtera&quot;,
      &quot;base-url&quot;: &quot;/root/my_esrally_data/tracks/bigtera/index.json&quot;,
      &quot;documents&quot;: [
        {
          &quot;source-file&quot;: &quot;documents-2.json.bz2&quot;,
          &quot;document-count&quot;: 761377675,
          &quot;compressed-bytes&quot;: 36309135809,
          &quot;uncompressed-bytes&quot;: 333483421650
        }
      ]
    }
  ],
  &quot;operations&quot;: [
    
  ],
  &quot;challenges&quot;: [
    
  ]
}
root@node244:~/my_esrally_data/tracks/bigtera#
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;主要修改点：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;data-url： 这个是自定义的index文件的位置&lt;/li&gt;
  &lt;li&gt;name： 请填写为待创建的index名称&lt;/li&gt;
  &lt;li&gt;source-file: 务必填写为压缩后的bz2文件名称，如 “documents-2.json.bz2”&lt;/li&gt;
  &lt;li&gt;document-count: 未压缩文件的行数，不能有错，如 761377675&lt;/li&gt;
  &lt;li&gt;compressed-bytes: documents-2.json文件压缩后的字节数，不能有错，如36309135809&lt;/li&gt;
  &lt;li&gt;uncompressed-bytes:  documents-2.json文件未压缩时的字节数，不能有错，如333483421650&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;修改-rally目录下rallyini文件&quot;&gt;修改 .rally目录下rally.ini文件&lt;/h3&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;root@node244:~/.rally# cat rally.ini 
[meta]
config.version = 17

[system]
env.name = local

[node]
root.dir = /root/.rally/benchmarks
src.root.dir = /root/.rally/benchmarks/src

[source]
remote.repo.url = https://github.com/elastic/elasticsearch.git
elasticsearch.src.subdir = elasticsearch

[benchmarks]
# local.dataset.cache = /root/.rally/benchmarks/data
# local.dataset.cache = /root/my_esrally_data/data
local.dataset.cache = /mnt/sata/700million
# local.dataset.cache = /mnt/sata/100million

[reporting]
datastore.type = in-memory
datastore.host = 
datastore.port = 
datastore.secure = False
datastore.user = 
datastore.password = 

[tracks]
default.url = https://github.com/elastic/rally-tracks

[teams]
default.url = https://github.com/elastic/rally-teams

[defaults]
preserve_benchmark_candidate = False

[distributions]
release.cache = true

root@node244:~/.rally# 

&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;[benchmarks]标签下，有个参数local.dataset.cache，这个路径是要运行当前track所需要的原始数据文件：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;root@node244:~/.rally# cd /mnt/sata/700million
root@node244:/mnt/sata/700million# ls -lR
.:
total 361125600
drwxr-xr-x 2 root root         4096 May 29 21:33 bigtera

./bigtera:
total 361125928
-rw-r--r-- 1 root root 333483421650 May 29 14:09 documents-2.json
-rw-r--r-- 1 root root  36309135809 May 29 11:05 documents-2.json.bz2
-rw-r--r-- 1 root root       342932 May 29 21:51 documents-2.json.offset
root@node244:/mnt/sata/700million# 
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;其中，documents-2.json.offset为esrally工具运行时自动产生的，如下是运行时屏显信息：&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;[INFO] Preparing file offset table for [/root/my_esrally_data/data/bigtera/documents-2.json] ...&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;另外，bigtera为对应要创建的index名称，这个在track.json中有定义，所有的数据源，要放在与index同名的目录下。&lt;/p&gt;

&lt;h3 id=&quot;修改challenges&quot;&gt;修改challenges&lt;/h3&gt;

&lt;p&gt;可以参考官方示例，构造自己需要的challenges，如下challenges为参考了genonames的示例:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;root@node244:~/my_esrally_data/tracks/bigtera/challenges# cat default.json 
    {
      &quot;name&quot;: &quot;append-no-conflicts&quot;,
      &quot;description&quot;: &quot;Indexes the whole document corpus using Elasticsearch default settings. We only adjust the number of replicas as we benchmark a single node cluster and Rally will only start the benchmark if the cluster turns green. Document ids are unique so all index operations are append only. After that a couple of queries are run.&quot;,
      &quot;default&quot;: true,
      &quot;schedule&quot;: [
        {
          &quot;operation&quot;: &quot;delete-index&quot;
        },
        {
          &quot;operation&quot;: {
            &quot;operation-type&quot;: &quot;create-index&quot;,
            &quot;settings&quot;: \{\{index_settings | default(\{\}) | tojson}}
          }
        },
        {
          &quot;name&quot;: &quot;check-cluster-health&quot;,
          &quot;operation&quot;: {
            &quot;operation-type&quot;: &quot;cluster-health&quot;,
            &quot;index&quot;: &quot;bigtera&quot;,
            &quot;request-params&quot;: {
              &quot;wait_for_status&quot;: &quot;&quot;,
              &quot;wait_for_no_relocating_shards&quot;: &quot;true&quot;
            }
          }
        },
        {
          &quot;operation&quot;: &quot;index-append&quot;,
          &quot;warmup-time-period&quot;: 120,
          &quot;clients&quot;: 
        },
        {
          &quot;name&quot;: &quot;refresh-after-index&quot;,
          &quot;operation&quot;: &quot;refresh&quot;
        }
        ]
    },
    {
      &quot;name&quot;: &quot;append-no-conflicts-index-only&quot;,
      &quot;description&quot;: &quot;Indexes the whole document corpus using Elasticsearch default settings. We only adjust the number of replicas as we benchmark a single node cluster and Rally will only start the benchmark if the cluster turns green. Document ids are unique so all index operations are append only.&quot;,
      &quot;schedule&quot;: [
        {
          &quot;operation&quot;: &quot;delete-index&quot;
        },
        {
          &quot;operation&quot;: {
            &quot;operation-type&quot;: &quot;create-index&quot;,
            &quot;settings&quot;: \{\{index_settings | default(\{\}) | tojson}}
          }
        },
        {
          &quot;name&quot;: &quot;check-cluster-health&quot;,
          &quot;operation&quot;: {
            &quot;operation-type&quot;: &quot;cluster-health&quot;,
            &quot;index&quot;: &quot;bigtera&quot;,
            &quot;request-params&quot;: {
              &quot;wait_for_status&quot;: &quot;&quot;,
              &quot;wait_for_no_relocating_shards&quot;: &quot;true&quot;
            }
          }
        },
        {
          &quot;operation&quot;: &quot;index-append&quot;,
          &quot;warmup-time-period&quot;: 120,
          &quot;clients&quot;: 
        },
        {
          &quot;operation&quot;: {
            &quot;operation-type&quot;: &quot;force-merge&quot;,
            &quot;request-timeout&quot;: 7200
          }
        },
        {
          &quot;name&quot;: &quot;wait-until-merges-finish&quot;,
          &quot;operation&quot;: {
            &quot;operation-type&quot;: &quot;index-stats&quot;,
            &quot;index&quot;: &quot;_all&quot;,
            &quot;condition&quot;: {
              &quot;path&quot;: &quot;_all.total.merges.current&quot;,
              &quot;expected-value&quot;: 0
            },
            &quot;retry-until-success&quot;: true,
            &quot;include-in-reporting&quot;: false
          }
        }
      ]
    }
root@node244:~/my_esrally_data/tracks/bigtera/challenges# 
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;说明：&lt;/p&gt;

&lt;p&gt;​    如果只想跑”append-no-conflicts-index-only”下的向index中追加数据，可以删除”schedule”: []中的除了”operation”: “index-append”这个{}，这样就只剩这个operation了。&lt;/p&gt;

&lt;h3 id=&quot;修改operations&quot;&gt;修改operations&lt;/h3&gt;

&lt;p&gt;参考如下所示：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;root@node244:~/my_esrally_data/tracks/bigtera/operations# cat default.json 
    { 
      &quot;name&quot;: &quot;index-append&quot;,
      &quot;operation-type&quot;: &quot;bulk&quot;,
      &quot;bulk-size&quot;: ,
      &quot;ingest-percentage&quot;: 
    },
    { 
      &quot;name&quot;: &quot;index-update&quot;,
      &quot;operation-type&quot;: &quot;bulk&quot;,
      &quot;bulk-size&quot;: ,
      &quot;ingest-percentage&quot;: ,
      &quot;conflicts&quot;: &quot;&quot;,
      &quot;on-conflict&quot;: &quot;&quot;,
      &quot;conflict-probability&quot;: ,
      &quot;recency&quot;: 
    },
    { 
      &quot;name&quot;: &quot;default&quot;,
      &quot;operation-type&quot;: &quot;search&quot;,
      &quot;body&quot;: {
        &quot;query&quot;: {
          &quot;match_all&quot;: {}
        }
      }   
    },
    {
      &quot;name&quot;: &quot;term&quot;,
      &quot;operation-type&quot;: &quot;search&quot;,
      &quot;body&quot;: {
        &quot;query&quot;: {
          &quot;term&quot;: {
            &quot;meta.etag&quot;: &quot;9b7cabc0dbbdf9708cvtazfylkjkqaum&quot;
          }
        }
      }
    },
    {
      &quot;name&quot;: &quot;phrase&quot;,
      &quot;operation-type&quot;: &quot;search&quot;,
      &quot;body&quot;: {
        &quot;query&quot;: {
          &quot;match_phrase&quot;: {
            &quot;name&quot;: &quot;2_4409197807.1&quot;
          }
        }
      }
    }
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h1 id=&quot;使用技巧&quot;&gt;使用技巧&lt;/h1&gt;

&lt;h2 id=&quot;运行时携带参数&quot;&gt;运行时携带参数&lt;/h2&gt;

&lt;p&gt;执行&lt;code class=&quot;highlighter-rouge&quot;&gt;esrally -h&lt;/code&gt;，查看具体的帮助信息，以及官方示例中的readme.md文档。&lt;/p&gt;

&lt;p&gt;比如下列这个示例：&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;esrally  --pipeline=benchmark-only --target-hosts=10.16.172.243:9200 --track=geonames  --challenge=append-no-conflicts-index-only --track-params=&quot;bulk_size:1,bulk_indexing_clients:2&quot;&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;指定了只跑append-no-conflicts-index-only这个challenge，同时指定了bulk_size和bulk_indexing_clients，当然，可以携带其他参数了，比如&lt;code class=&quot;highlighter-rouge&quot;&gt;number_of_replicas&lt;/code&gt; 和 &lt;code class=&quot;highlighter-rouge&quot;&gt;number_of_shards&lt;/code&gt;，参考如下：&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;esrally --pipeline=benchmark-only --track-path=/root/my_esrally_data/tracks/bigtera --target-hosts=10.16.172.76:9200 --offline --report-file=/root/my_esrally_data/report/427112_1Mmetadata_6shards_1rep.json --challenge=append-no-conflicts-index-only --track-params=&quot;number_of_shards:6,number_of_replicas:1&quot;&lt;/code&gt;&lt;/p&gt;

&lt;h2 id=&quot;esrally日志的查看&quot;&gt;esrally日志的查看&lt;/h2&gt;

&lt;p&gt;在esrally运行时，可以查看日志文件，来帮助定位工具运行中碰到的问题。&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;root@node244:~# cd .rally/logs/
root@node244:~/.rally/logs# ll
total 51520
drwxr-xr-x 2 root root     4096 Jun  2 11:03 ./
drwxr-xr-x 4 root root     4096 Jun  2 11:03 ../
-rw-r--r-- 1 root root 52740698 Jun  2 13:54 rally.log
root@node244:~/.rally/logs# 
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;</content><author><name>Gavin</name></author><category term="esrally" /><summary type="html">更改pip源</summary></entry><entry><title type="html">bzip2 vs pbzip2 性能对比</title><link href="http://172.17.73.80:4000/2020/06/01/bzip2_vs_pbzip2/" rel="alternate" type="text/html" title="bzip2 vs pbzip2 性能对比" /><published>2020-06-01T00:00:00+08:00</published><updated>2020-06-01T00:00:00+08:00</updated><id>http://172.17.73.80:4000/2020/06/01/bzip2_vs_pbzip2</id><content type="html" xml:base="http://172.17.73.80:4000/2020/06/01/bzip2_vs_pbzip2/">&lt;h1 id=&quot;概述&quot;&gt;概述&lt;/h1&gt;

&lt;p&gt;近期使用esrally进行Elastic Search性能压测，使用script产生了原始数据，这些原始数据需要被压缩成bz2格式，如果原文件大小很大，压缩起来就非常耗时。本文介绍几种bzip2压缩操作，观察耗时情况。&lt;/p&gt;

&lt;h1 id=&quot;准备测试数据&quot;&gt;准备测试数据&lt;/h1&gt;

&lt;p&gt;准备10万笔记录，看看压缩耗时如何：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;root@node244:/mnt/disk/esrally_data/test# time wc -l documents-2.json 
100000 documents-2.json

real	0m0.025s
user	0m0.005s
sys	0m0.020s
root@node244:/mnt/disk/esrally_data/test# cat documents-2.json | head -n 1
{&quot;name&quot;: &quot;08_9837907241.49&quot;, &quot;bucket&quot;: &quot;bucket01&quot;, &quot;instance&quot;: &quot;null&quot;, &quot;meta&quot;: {&quot;custom-string&quot;: {&quot;name&quot;: &quot;1597699173358823&quot;, &quot;value&quot;: &quot;5714268441146127&quot;}, &quot;mtime&quot;: &quot;2020-05-26T19:21:32.598Z&quot;, &quot;etag&quot;: &quot;e7b647f4a3959de9c7a070e5d3093ab1&quot;, &quot;content_type&quot;: &quot;application/octet-stream&quot;, &quot;tail_tag&quot;: &quot;a3a5cefd-376d-421b-3110-08b41412e7c1.4520.862976&quot;, &quot;size&quot;: &quot;760&quot;}, &quot;owner&quot;: {&quot;display_name&quot;: &quot;user01&quot;, &quot;id&quot;: &quot;user01&quot;}, &quot;versioned_epoch&quot;: &quot;0&quot;}
root@node244:/mnt/disk/esrally_data/test# 
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h1 id=&quot;压缩验证&quot;&gt;压缩验证&lt;/h1&gt;

&lt;h2 id=&quot;使用默认的bzip2压缩指令&quot;&gt;使用默认的bzip2压缩指令&lt;/h2&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;root@node244:/mnt/disk/esrally_data/test# time bzip2 -k documents-2.json documents-2.json.bz2
bzip2: Input file documents-2.json.bz2 already has .bz2 suffix.

real	0m8.482s
user	0m8.454s
sys	0m0.028s
root@node244:/mnt/disk/esrally_data/test# ll
total 47444
drwxr-xr-x 2 root root     4096 Jun  2 16:01 ./
drwxr-xr-x 5 root root     4096 Jun  2 15:55 ../
-rw-r--r-- 1 root root 43800000 Jun  2 15:55 documents-2.json
-rw-r--r-- 1 root root  4769476 Jun  2 15:55 documents-2.json.bz2
root@node244:/mnt/disk/esrally_data/test# 
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;bzip2-使用--1-参数&quot;&gt;bzip2 使用 -1 参数&lt;/h2&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;root@node244:/mnt/disk/esrally_data/test# time bzip2 -k -1 documents-2.json documents-2.json.bz2
bzip2: Input file documents-2.json.bz2 already has .bz2 suffix.

real	0m5.411s
user	0m5.390s
sys	0m0.020s
root@node244:/mnt/disk/esrally_data/test# ll
total 48020
drwxr-xr-x 2 root root     4096 Jun  2 16:03 ./
drwxr-xr-x 5 root root     4096 Jun  2 15:55 ../
-rw-r--r-- 1 root root 43800000 Jun  2 15:55 documents-2.json
-rw-r--r-- 1 root root  5357900 Jun  2 15:55 documents-2.json.bz2
root@node244:/mnt/disk/esrally_data/test# 
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;bzip2-使用--9-参数&quot;&gt;bzip2 使用 -9 参数&lt;/h2&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;root@node244:/mnt/disk/esrally_data/test# time bzip2 -k -9 documents-2.json documents-2.json.bz2
bzip2: Input file documents-2.json.bz2 already has .bz2 suffix.

real	0m8.053s
user	0m8.049s
sys	0m0.004s
root@node244:/mnt/disk/esrally_data/test#
root@node244:/mnt/disk/esrally_data/test# ll
total 47444
drwxr-xr-x 2 root root     4096 Jun  2 16:10 ./
drwxr-xr-x 5 root root     4096 Jun  2 15:55 ../
-rw-r--r-- 1 root root 43800000 Jun  2 15:55 documents-2.json
-rw-r--r-- 1 root root  4769476 Jun  2 15:55 documents-2.json.bz2
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;pbzip2&quot;&gt;pbzip2&lt;/h2&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;root@node244:/mnt/disk/esrally_data/test# time pbzip2 documents-2.json -z -k -1 -f  &amp;gt; documents-2.json.bz2

real	0m0.449s
user	0m9.834s
sys	0m0.096s
root@node244:/mnt/disk/esrally_data/test# ll
total 48028
drwxr-xr-x 2 root root     4096 Jun  2 16:09 ./
drwxr-xr-x 5 root root     4096 Jun  2 15:55 ../
-rw-r--r-- 1 root root 43800000 Jun  2 15:55 documents-2.json
-rw-r--r-- 1 root root  5366033 Jun  2 15:55 documents-2.json.bz2
root@node244:/mnt/disk/esrally_data/test# 
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;根据pbzip2的help信息，这里没有携带-p参数，默认会自己根据当前硬件CPU核数，计算使用多少路并发，默认32&lt;/p&gt;

&lt;h1 id=&quot;bzip2-vs-pbzip2性能对比&quot;&gt;bzip2 vs pbzip2性能对比&lt;/h1&gt;

&lt;p&gt;使用 Compression Level -9, 压缩比率最大，但耗时会比 -1 要久，此选项是默认选项；&lt;/p&gt;

&lt;p&gt;使用pzip2进行压缩，多并发情况下，压缩耗时明显要比bzip2 -1 要快。&lt;/p&gt;

&lt;p&gt;孰优孰略，一目了然。&lt;/p&gt;

&lt;p&gt;BTW，由于pbzip2只能压缩文件，不能对目录进行压缩，所以如果想使用pbzip2压缩目录，则需要借助tar工具。&lt;/p&gt;</content><author><name>Gavin</name></author><category term="bzip2" /><category term="pbzip2" /><summary type="html">概述</summary></entry><entry><title type="html">Linux下统计行数性能对比</title><link href="http://172.17.73.80:4000/2020/05/28/get-line-no-performace-compare/" rel="alternate" type="text/html" title="Linux下统计行数性能对比" /><published>2020-05-28T00:00:00+08:00</published><updated>2020-05-28T00:00:00+08:00</updated><id>http://172.17.73.80:4000/2020/05/28/get-line-no-performace-compare</id><content type="html" xml:base="http://172.17.73.80:4000/2020/05/28/get-line-no-performace-compare/">&lt;h1 id=&quot;概述&quot;&gt;概述&lt;/h1&gt;

&lt;p&gt;这次使用esrally进行elastic search性能测试，构造了产品自己生成的索引所需要的数据，由于数据比较大，行数有700million+，统计行数碰到了问题，主要是时间问题，统计太耗时，所以，想知道哪个统计效率更高。&lt;/p&gt;

&lt;p&gt;本文介绍几种方法，以100million行数的文件，在Linux下统计文件行数，对比下统计性能如何。&lt;/p&gt;

&lt;h1 id=&quot;准备工作&quot;&gt;准备工作&lt;/h1&gt;

&lt;p&gt;准备一个100million行数的文件：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;root@host75:~/tmp# ll
total 3018132
drwxr-xr-x 2 root root       4096 May 28 17:39 ./
drwx------ 4 root root       4096 May 28 17:38 ../
-rw-r--r-- 1 root root 3090550784 May 28 17:39 documents-2.json
root@host75:~/tmp# du -sh *
3.3G	documents-2.json
root@host75:~/tmp# cat documents-2.json | head -n 2
{&quot;name&quot;: &quot;50_9213603372.65&quot;, &quot;bucket&quot;: &quot;bucket01&quot;, &quot;instance&quot;: &quot;null&quot;, &quot;meta&quot;: {&quot;custom-string&quot;: {&quot;name&quot;: &quot;1729620399787334&quot;, &quot;value&quot;: &quot;9600528609211706&quot;}, &quot;mtime&quot;: &quot;2020-05-25T18:26:36.457Z&quot;, &quot;etag&quot;: &quot;e7b592f4a6232de9c7a070e5d7456ab1&quot;, &quot;content_type&quot;: &quot;application/octet-stream&quot;, &quot;tail_tag&quot;: &quot;a3a5cefd-376d-421b-6085-08b56886e7c1.4520.288519&quot;, &quot;size&quot;: &quot;972&quot;}, &quot;owner&quot;: {&quot;display_name&quot;: &quot;user01&quot;, &quot;id&quot;: &quot;user01&quot;}, &quot;versioned_epoch&quot;: &quot;0&quot;}
{&quot;name&quot;: &quot;39_1283951288.80&quot;, &quot;bucket&quot;: &quot;bucket01&quot;, &quot;instance&quot;: &quot;null&quot;, &quot;meta&quot;: {&quot;custom-string&quot;: {&quot;name&quot;: &quot;5902405182780371&quot;, &quot;value&quot;: &quot;6086948407181992&quot;}, &quot;mtime&quot;: &quot;2020-05-28T12:22:37.787Z&quot;, &quot;etag&quot;: &quot;e7b351f4a7411de9c7a070e5d2381ab1&quot;, &quot;content_type&quot;: &quot;application/octet-stream&quot;, &quot;tail_tag&quot;: &quot;a3a5cefd-376d-421b-7442-08b70241e7c1.4520.567559&quot;, &quot;size&quot;: &quot;152&quot;}, &quot;owner&quot;: {&quot;display_name&quot;: &quot;user01&quot;, &quot;id&quot;: &quot;user01&quot;}, &quot;versioned_epoch&quot;: &quot;0&quot;}
root@host75:~/tmp# 
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h1 id=&quot;统计行数性能比较&quot;&gt;统计行数性能比较&lt;/h1&gt;

&lt;h2 id=&quot;使用wc统计&quot;&gt;使用wc统计&lt;/h2&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;root@host75:~/tmp# time wc -l documents-2.json 
100000000 documents-2.json

real	0m9.857s
user	0m2.767s
sys	0m7.041s
root@host75:~/tmp#
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;awk&quot;&gt;awk&lt;/h2&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;root@host75:~/tmp# time awk '{print NR}' documents-2.json | tail -n1
100000000

real	1m16.523s
user	1m5.944s
sys	0m14.584s
root@host75:~/tmp# 
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;root@host75:~/tmp# time awk 'END{print NR}' documents-2.json 
100000000

real	0m43.118s
user	0m32.708s
sys	0m10.395s
root@host75:~/tmp#
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;grep--awk-结合&quot;&gt;grep &amp;amp; awk 结合&lt;/h2&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;root@host75:~/tmp# time grep -n &quot;&quot; documents-2.json | awk '' | tail -n1
100000000:{&quot;name&quot;: &quot;23_1479119854.64&quot;, &quot;bucket&quot;: &quot;bucket01&quot;, &quot;instance&quot;: &quot;null&quot;, &quot;meta&quot;: {&quot;custom-string&quot;: {&quot;name&quot;: &quot;6389993698492958&quot;, &quot;value&quot;: &quot;9869611550099604&quot;}, &quot;mtime&quot;: &quot;2020-05-29T13:24:30.042Z&quot;, &quot;etag&quot;: &quot;e7b195f4a3730de9c7a070e5d5762ab1&quot;, &quot;content_type&quot;: &quot;application/octet-stream&quot;, &quot;tail_tag&quot;: &quot;a3a5cefd-376d-421b-7964-08b62339e7c1.4520.381771&quot;, &quot;size&quot;: &quot;819&quot;}, &quot;owner&quot;: {&quot;display_name&quot;: &quot;user01&quot;, &quot;id&quot;: &quot;user01&quot;}, &quot;versioned_epoch&quot;: &quot;0&quot;}

real	1m31.090s
user	1m21.797s
sys	2m8.774s
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;sed&quot;&gt;sed&lt;/h2&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;root@host75:~/tmp# time sed -n '$=' documents-2.json 
100000000

real	0m23.395s
user	0m13.503s
sys	0m9.891s
root@host75:~/tmp# 
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;cat&quot;&gt;cat&lt;/h2&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;root@host75:~/tmp# time cat documents-2.json | wc -l
100000000

real	0m22.773s
user	0m3.910s
sys	0m31.834s
root@host75:~/tmp# 
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;说明：&lt;/p&gt;

&lt;p&gt;这个方法不建议使用，比较考验CPU能力。&lt;/p&gt;

&lt;h1 id=&quot;总结&quot;&gt;总结&lt;/h1&gt;

&lt;p&gt;由于被统计的文件的数据结构不一样，上述命令统计出来的性能也会有一些差异。本文示例的文档，统计效果比较好的方法是：&lt;/p&gt;

&lt;p&gt;wc -l 优于 cat 优于 sed 优于 awk 优于 grep&lt;/p&gt;

&lt;p&gt;具体哪个统计方法适合当前被统计文档，可以适当的使用一部分数据作为统计效果看看哪个更优，然后再做抉择使用哪个方法。&lt;/p&gt;</content><author><name>Gavin</name></author><category term="Linux" /><summary type="html">概述</summary></entry><entry><title type="html">Linux开机启动，进入welcome to emergency mode</title><link href="http://172.17.73.80:4000/2020/05/21/boot_machine_met_welcome_to_emergency_mode/" rel="alternate" type="text/html" title="Linux开机启动，进入welcome to emergency mode" /><published>2020-05-21T00:00:00+08:00</published><updated>2020-05-21T00:00:00+08:00</updated><id>http://172.17.73.80:4000/2020/05/21/boot_machine_met_welcome_to_emergency_mode</id><content type="html" xml:base="http://172.17.73.80:4000/2020/05/21/boot_machine_met_welcome_to_emergency_mode/">&lt;h1 id=&quot;概述&quot;&gt;概述&lt;/h1&gt;

&lt;p&gt;Ubuntu 18.04系统, 执行reboot -f后，网络不通，通过IPMI console查看，发现出现 ‘welcome to emergency mode!’，详细信息如下图所示：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;welcome to emergency mode! after logging in, type &quot;journalctl -xb&quot; to view system logs，
&quot;systemctl reboot&quot; to reboot ，&quot;systemctl default&quot; to try again to boot into default mode.
give root password for maintenance(Control-D)
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;img class=&quot;shadow&quot; src=&quot;/img/in-post/welcome_to_emergency_mode.png&quot; width=&quot;1200&quot; /&gt;&lt;/p&gt;

&lt;h1 id=&quot;问题解决&quot;&gt;问题解决&lt;/h1&gt;

&lt;p&gt;按照提示操作：Control-D， systemctl reboot 命令后，依然如此。&lt;/p&gt;

&lt;p&gt;考虑到当时产品有停用过ES(ElasticSearch)，由于存在bug，导致ES对应存储挂载点并没有被umount掉，更没有更新/etc/fstab，但是自己使用gdisk命令，重新格式化了这个分区，并dd擦写了上面的部分数据。可能是这个原因, 导致重启系统出现此界面。&lt;/p&gt;

&lt;p&gt;想到这里，开始动手检查/etc/fstab内容，果然是有对应一条ES mount 记录：&lt;/p&gt;

&lt;p&gt;&lt;img class=&quot;shadow&quot; src=&quot;/img/in-post/es_disk_mount_point.png&quot; width=&quot;1200&quot; /&gt;&lt;/p&gt;

&lt;p&gt;删除掉它，并重启机器。&lt;/p&gt;

&lt;h1 id=&quot;小结&quot;&gt;小结&lt;/h1&gt;

&lt;p&gt;报这个错误多数情况下是因为/etc/fstab文件的错误。注意一下是不是加载了外部硬盘、存储器或者是网络共享空间，在重启时没有加载上导致的。&lt;/p&gt;</content><author><name>Gavin</name></author><category term="Linux" /><summary type="html">概述</summary></entry><entry><title type="html">控制keepalive VIP漂移范围</title><link href="http://172.17.73.80:4000/2020/05/21/keepalive-contro_VIP_floating_range/" rel="alternate" type="text/html" title="控制keepalive VIP漂移范围" /><published>2020-05-21T00:00:00+08:00</published><updated>2020-05-21T00:00:00+08:00</updated><id>http://172.17.73.80:4000/2020/05/21/keepalive-contro_VIP_floating_range</id><content type="html" xml:base="http://172.17.73.80:4000/2020/05/21/keepalive-contro_VIP_floating_range/">&lt;h1 id=&quot;概述&quot;&gt;概述&lt;/h1&gt;

&lt;p&gt;产品有配置keepalive功能，但该功能目前仅通过priority来控制VIP在不同节点间漂移，此处的不同节点，是集群内部的所有节点。&lt;/p&gt;

&lt;p&gt;我们先看看下各个节点（以3节点为例），keepalive.conf内容信息，参考如下：&lt;/p&gt;

&lt;p&gt;== node243&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;root@node243:/etc/keepalived# cat keepalived.conf 
global_defs {
    vrrp_version 3
}

vrrp_instance VRRP0 {
    state BACKUP
#   Specify the network interface to which the virtual address is assigned
    interface enp5s0f0
    virtual_router_id 89
#   Set the value of priority lower on the backup server than on the master server
    priority 3
    advert_int 0.4
    track_interface {
        bond1
    }
    virtual_ipaddress {
        12.7.3.89
    }
}
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;== node244&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;root@node244:/var/log# cat /etc/keepalived/keepalived.conf 
global_defs {
    vrrp_version 3
}

vrrp_instance VRRP0 {
    state BACKUP
#   Specify the network interface to which the virtual address is assigned
    interface enp5s0f0
    virtual_router_id 89
#   Set the value of priority lower on the backup server than on the master server
    priority 2
    advert_int 0.4
    track_interface {
        bond1
    }
    virtual_ipaddress {
        12.7.3.89
    }
}
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;== node245&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;root@node245:/etc/keepalived# cat keepalived.conf 
global_defs {
    vrrp_version 3
}

vrrp_instance VRRP0 {
    state BACKUP
#   Specify the network interface to which the virtual address is assigned
    interface bond0
    virtual_router_id 89
#   Set the value of priority lower on the backup server than on the master server
    priority 1
    advert_int 0.4
    track_interface {
        bond1
    }
    virtual_ipaddress {
        12.7.3.89
    }
}
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;通过上面的配置文件，可以看出来，各个节点间的priority值不一样，仅仅是通过priority来控制VIP的漂移。&lt;/p&gt;

&lt;p&gt;讲到这里，问题来了，如果客户生产环境因预算不足，只能有2个节点物理设备，按照产品部署要求，&amp;gt;=3个节点，势必会需要一台VM作为仲裁节点（不承担任何业务数据，仅启用ceph-mon参与mon election用），那就不能讲这台VM纳入keepalive VIP漂移范围了，即keepalive VIP不能落到这台VM上。&lt;/p&gt;

&lt;h1 id=&quot;改进&quot;&gt;改进&lt;/h1&gt;

&lt;p&gt;问题已经清晰了，那么，如何控制VIP，落在指定的设备节点上呢？&lt;/p&gt;

&lt;p&gt;通过查询一些资料，更改keepalive.conf配置文件信息，可以达到预期效果：&lt;/p&gt;

&lt;h2 id=&quot;更改后的keepaliveconf信息&quot;&gt;更改后的keepalive.conf信息&lt;/h2&gt;

&lt;p&gt;== node243&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;root@node243:/etc/keepalived# cat keepalived.conf 
global_defs {
   notification_email {
   root@localhost
   }
   notification_email_from keepalived@localhost
   smtp_server 127.0.0.1
   smtp_connect_timeout 30
   router_id node243                    #主调度器的主机名
   vrrp_mcast_group4 224.26.1.1             #发送心跳信息的组播地址
    
}

vrrp_instance VI_1 {
    state MASTER                            #主调度器的初始角色
    interface enp5s0f0                      #虚拟IP工作的网卡接口
    virtual_router_id 89                    #虚拟路由的ID
    priority 100                            #主调度器的选举优先级
    advert_int 1
    virtual_ipaddress {
        12.7.3.89                     #虚拟IP
    }
}

virtual_server 12.7.3.89 80 {         #LVS配置段，VIP
    delay_loop 6
    lb_algo rr                              #调度算法轮询
    lb_kind DR                              #工作模式DR
    nat_mask 255.255.252.0
#    persistence_timeout 50                  #持久连接，在测试时需要注释，否则会在设置的时间内把请求都调度到一台RS服务器上面
    protocol TCP
    sorry_server 127.0.0.1 80               #Sorry server的服务器地址及端口
    real_server 12.7.3.243 80 { 
        weight 1 
        HTTP_GET {                          #健康状态检测方法
            url {
              path /
              status_code 200               #状态判定规则
            }
            connect_timeout 1
            nb_get_retry 3
            delay_before_retry 1
        }
    }

    real_server 12.7.3.244 80 {
        weight 1
        HTTP_GET {
            url {
              path /
                status_code 200
            }
            connect_timeout 1
            nb_get_retry 3
            delay_before_retry 1
        }
    }
}
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;== node244&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;root@node244:/etc/keepalived# cat keepalived.conf 
global_defs {
   notification_email {
   root@localhost
   }
   notification_email_from keepalived@localhost
   smtp_server 127.0.0.1
   smtp_connect_timeout 30
   router_id node244                #备份调度器的主机名
   vrrp_mcast_group4 224.26.1.1         #这个组播地址需与集群内的其他主机相同

}

vrrp_instance VI_1 {
    state BACKUP                        #初始角色，备份服务器需设置为BACKUP
    interface enp5s0f0
    virtual_router_id 89                #虚拟路由的ID一定要和集群内的其他主机相同
    priority 90                         #选举优先级，要比主调度器地一些
    advert_int 1
    virtual_ipaddress {
        12.7.3.89
    }
}
                #余下配置和主服务器相同
virtual_server 12.7.3.89 80 {
    delay_loop 6
    lb_algo rr
    lb_kind DR
    nat_mask 255.255.252.0
#    persistence_timeout 50              
    protocol TCP
    sorry_server 127.0.0.1 80

    real_server 12.7.3.243 80 {
        weight 1
        HTTP_GET {
            url {
              path /
              status_code 200
            }
            connect_timeout 1
            nb_get_retry 3
            delay_before_retry 1
        }
    }

    real_server 12.7.3.244 80 {
        weight 1
        HTTP_GET {
            url {
              path /
                status_code 200
            }
            connect_timeout 1
            nb_get_retry 3
            delay_before_retry 1
        }
    }
}
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;== node245&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;root@node245:/etc/keepalived# cat keepalived.conf 
global_defs {}
root@node245:/etc/keepalived# 
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;验证效果&quot;&gt;验证效果&lt;/h2&gt;

&lt;h3 id=&quot;重启所有节点的keepalive服务&quot;&gt;重启所有节点的keepalive服务&lt;/h3&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;root@node245:/etc/keepalived# onnode -p all 'systemctl restart keepalived.service'
root@node245:/etc/keepalived# 
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;检查syslog，是否有keepalive日常日志，以及keepalive进程是否存在。如果都没有问题，说明keepalive启动正常。&lt;/p&gt;

&lt;h3 id=&quot;检查vip落在哪个node上&quot;&gt;检查VIP落在哪个node上&lt;/h3&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;root@node243:/etc/keepalived# ip a | grep '12.7.3.89'
    inet 12.7.3.89/32 scope global enp5s0f0
root@node243:/etc/keepalived# 

&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;说明当前VIP 12.7.3.89落在node243上，这个也符合keepalive.conf中的设定（priority=100，另外一个是90，最后一个node没有）&lt;/p&gt;

&lt;h3 id=&quot;停用node243的keepalive服务&quot;&gt;停用node243的keepalive服务&lt;/h3&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;root@node243:/etc/keepalived# systemctl stop keepalived.service 
root@node243:/etc/keepalived# ip a | grep '12.7.3.89'
root@node243:/etc/keepalived# 
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;再次检查vip落在哪个node上&quot;&gt;再次检查VIP落在哪个node上&lt;/h3&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;root@node243:/etc/keepalived# ip a | grep '12.7.3.89'
root@node243:/etc/keepalived# 

&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;root@node244:/etc/keepalived# ip a | grep '12.7.3.89'
    inet 12.7.3.89/32 scope global enp5s0f0
root@node244:/etc/keepalived# 
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;root@node245:/etc/keepalived# ip a | grep '12.7.3.89'
root@node245:/etc/keepalived# 
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;停用node244的keepalive服务&quot;&gt;停用node244的keepalive服务&lt;/h3&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;root@node244:/etc/keepalived# systemctl stop keepalived.service 
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;再次检查vip落在哪个node上-1&quot;&gt;再次检查VIP落在哪个node上&lt;/h3&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;root@node243:/etc/keepalived# ip a | grep '12.7.3.89'
root@node243:/etc/keepalived# 
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;root@node244:/etc/keepalived# ip a | grep '12.7.3.89'
root@node244:/etc/keepalived# 
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;root@node245:/etc/keepalived# ip a | grep '12.7.3.89'
root@node245:/etc/keepalived# 
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h1 id=&quot;结语&quot;&gt;结语&lt;/h1&gt;

&lt;p&gt;至此，通过上述验证方法，可以控制住keepalive的VIP漂移到哪些指定的host上。&lt;/p&gt;</content><author><name>Gavin</name></author><category term="keepalive" /><summary type="html">概述</summary></entry><entry><title type="html">Jenkins部署pipeline并发执行pytest自动化用例</title><link href="http://172.17.73.80:4000/2020/05/13/pipeline-parallel-job/" rel="alternate" type="text/html" title="Jenkins部署pipeline并发执行pytest自动化用例" /><published>2020-05-13T00:00:00+08:00</published><updated>2020-05-13T00:00:00+08:00</updated><id>http://172.17.73.80:4000/2020/05/13/pipeline-parallel-job</id><content type="html" xml:base="http://172.17.73.80:4000/2020/05/13/pipeline-parallel-job/">&lt;h1 id=&quot;概述&quot;&gt;概述&lt;/h1&gt;

&lt;p&gt;目前现有自动化用例数比较多了，在free style jenkins project中顺次执行，耗时1天左右，很明显，耗时太久，急需用例能够并发执行，从而实现节约时间。&lt;/p&gt;

&lt;p&gt;本文介绍如何通过pipeline project，实现现有用例执行流程的改造，实现并发执行。&lt;/p&gt;

&lt;h1 id=&quot;改造涉及内容&quot;&gt;改造涉及内容&lt;/h1&gt;

&lt;p&gt;针对当前automation project，需要做如下内容调整：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;(1) run.py中，提取出reboot client，生成pylint数据操作&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;(2) Jenkins节点中email-templates发送email内容groovy脚本调整&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;(3) 测试代码config目录下autotest.conf，含有多个，命名格式为autotest_ip.conf&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;(4) 测试代码jenkins目录下生成build properties文件，以及rsync脚本要做修改，主要是路径问题&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;说明：&lt;/p&gt;

&lt;p&gt;第(1)点： 以前用例是顺次执行的，只需要执行一次，一旦调整成并发后，存在每个执行node均会执行一次的情况；&lt;/p&gt;

&lt;p&gt;第(3)点： 每个执行用例的集群节点，需要mv autotest_ip.conf为autotest.conf&lt;/p&gt;

&lt;p&gt;第(4)点:  free style与pipeline的jenkins project，所需要的workspace与jobspace是不一样的&lt;/p&gt;

&lt;h1 id=&quot;需要jenkins安装的插件&quot;&gt;需要Jenkins安装的插件&lt;/h1&gt;

&lt;p&gt;Warnings，pipeline相关插件，具体安装本文忽略。&lt;/p&gt;

&lt;h1 id=&quot;改造过程&quot;&gt;改造过程&lt;/h1&gt;

&lt;h2 id=&quot;流程示意图&quot;&gt;流程示意图&lt;/h2&gt;

&lt;p&gt;&lt;img class=&quot;shadow&quot; src=&quot;/img/in-post/pipeline_project_parallel_circuit.png&quot; width=&quot;800&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;jenkins-project配置&quot;&gt;Jenkins project配置&lt;/h2&gt;

&lt;p&gt;&lt;img class=&quot;shadow&quot; src=&quot;/img/in-post/pipeline_project_config1.png&quot; width=&quot;1200&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img class=&quot;shadow&quot; src=&quot;/img/in-post/pipeline_project_config2.png&quot; width=&quot;1200&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img class=&quot;shadow&quot; src=&quot;/img/in-post/pipeline_project_config3.png&quot; width=&quot;1200&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img class=&quot;shadow&quot; src=&quot;/img/in-post/pipeline_project_config4.png&quot; width=&quot;1200&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img class=&quot;shadow&quot; src=&quot;/img/in-post/pipeline_project_config5.png&quot; width=&quot;1200&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img class=&quot;shadow&quot; src=&quot;/img/in-post/pipeline_project_config6.png&quot; width=&quot;1200&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;pipelint-jenkinsfile&quot;&gt;pipelint Jenkinsfile&lt;/h2&gt;

&lt;p&gt;新增了Jenlinsfile，具体内容示例参考如下：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;err&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;groovy&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;ip_list&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;IPS&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;split&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;','&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;ips_size&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ip_list&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;size&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt;

&lt;span class=&quot;kt&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cluster1_ip&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ip_list&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;][&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cluster2_ip&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ip_list&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;][&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;

&lt;span class=&quot;kt&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cluster_ip&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;${cluster1_ip} ${cluster2_ip}&quot;&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;pipeline&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;agent&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;any&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;options&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;timestamps&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;stages&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;cm&quot;&gt;/* IP check */&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;stage&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;IP Cheeck&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;agent&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;label&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;master&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;steps&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                    &lt;span class=&quot;n&quot;&gt;script&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                            &lt;span class=&quot;n&quot;&gt;sh&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&quot;&quot;
                                if [[ ${ips_size} != 6 ]]; then
                                    echo &quot;IPS is not enough, but give (${ips_size}) nodes to run case&quot;
                                    exit 1
                                fi
                            &quot;&quot;&quot;&lt;/span&gt;
                            &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
                       &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

        &lt;span class=&quot;cm&quot;&gt;/* Install VM by PVE */&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;stage&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Initialize&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;agent&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;label&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;master&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;steps&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                    &lt;span class=&quot;n&quot;&gt;script&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                            &lt;span class=&quot;n&quot;&gt;sh&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&quot;&quot;
                            #!/bin/bash -xe
                            echo &quot;Call batch_install_vs.py to install ISO.&quot;
                            sshpass -p 1 ssh -p 22 17.1.1.235 -l root \${BAT_INSTALL}
                            &quot;&quot;&quot;&lt;/span&gt;
                        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
                &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

        &lt;span class=&quot;cm&quot;&gt;/* Get code */&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;stage&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Checkout&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;agent&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;label&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;master&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;steps&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                    &lt;span class=&quot;n&quot;&gt;retry&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                        &lt;span class=&quot;n&quot;&gt;timeout&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;activity:&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;time:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;60&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;unit:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'MINUTES'&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                            &lt;span class=&quot;n&quot;&gt;checkout&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;([&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;$class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'GitSCM'&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;
                                &lt;span class=&quot;nl&quot;&gt;branches:&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;name:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;GIT_BRANCH&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]],&lt;/span&gt;
                                &lt;span class=&quot;nl&quot;&gt;browser:&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;$class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'GitLab'&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;repoUrl:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;GIT_WEB&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;version:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'12.8'&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;],&lt;/span&gt;
                                &lt;span class=&quot;nl&quot;&gt;doGenerateSubmoduleConfigurations:&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;
                                &lt;span class=&quot;nl&quot;&gt;extensions:&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;
                                    &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;$class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'CleanBeforeCheckout'&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;deleteUntrackedNestedRepositories:&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;],&lt;/span&gt;
                                    &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;$class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'SubmoduleOption'&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;recursiveSubmodules:&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;],&lt;/span&gt;
                                    &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;$class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'GitLFSPull'&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;],&lt;/span&gt;
                                    &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;$class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'PruneStaleBranch'&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
                                &lt;span class=&quot;o&quot;&gt;],&lt;/span&gt;
                                &lt;span class=&quot;nl&quot;&gt;submoduleCfg:&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[],&lt;/span&gt;
                                &lt;span class=&quot;nl&quot;&gt;userRemoteConfigs:&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;url:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;GIT_URL&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]]&lt;/span&gt;
                            &lt;span class=&quot;o&quot;&gt;])&lt;/span&gt;
                        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
                    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
                &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

        &lt;span class=&quot;cm&quot;&gt;/* scp code to nodes */&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;stage&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Scp&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;agent&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;label&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;master&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;steps&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                    &lt;span class=&quot;n&quot;&gt;script&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;                            
                            &lt;span class=&quot;n&quot;&gt;sh&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&quot;&quot;
                            #!/bin/bash -xe
                            cd \${WORK_SPACE};
                            rm -rf build.properties;
                            rm -rf report;
                            cd jenkins;
                            chmod a+x *;
                            for each_ip in ${cluster_ip}
                                do
                                    echo &quot;Scp code to node : \${each_ip}&quot;
                                    ssh-keygen -f '/var/lib/jenkins/.ssh/known_hosts' -R \${each_ip};
                                    ./rsync_pytest.sh \${WORK_SPACE} \${each_ip} root p@ssw0rd
                                    sleep 1
                                done
                            &quot;&quot;&quot;&lt;/span&gt;
                        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
                    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

        &lt;span class=&quot;c1&quot;&gt;// Parallel Stage&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;stage&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'Parallel Stage'&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;failFast&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;parallel&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;stage&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'Run test case on Cluster1'&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                    &lt;span class=&quot;n&quot;&gt;steps&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                        &lt;span class=&quot;n&quot;&gt;script&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                            &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                                &lt;span class=&quot;n&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Run test case on node : ${cluster1_ip}&quot;&lt;/span&gt;
                                &lt;span class=&quot;n&quot;&gt;sh&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;sshpass -p p@ssw0rd ssh -p 22 -l root ${cluster1_ip} \'cd ${CODE_DIR};python run.py -t testcase/Function_Test/case_02_Accounts/test_02_account_ad.py\'&quot;&lt;/span&gt;
                            &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;catch&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;err&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;){&lt;/span&gt;
                                &lt;span class=&quot;n&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;${err}&quot;&lt;/span&gt;
                                &lt;span class=&quot;n&quot;&gt;sh&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'exit 1'&lt;/span&gt;
                            &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
                        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;


                    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
                &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;stage&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'Run test case on Cluster2'&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                    &lt;span class=&quot;n&quot;&gt;steps&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                        &lt;span class=&quot;n&quot;&gt;script&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                            &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                                &lt;span class=&quot;n&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Run test case on node : ${cluster2_ip}&quot;&lt;/span&gt;
                                &lt;span class=&quot;n&quot;&gt;sh&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;sshpass -p p@ssw0rd ssh -p 22 -l root ${cluster2_ip} \'cd ${CODE_DIR};cp config/autotest_106.config config/autotest.config;python run.py -t testcase/Function_Test/case_02_Accounts/test_03_account_ldap.py\'&quot;&lt;/span&gt;

                            &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;catch&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;err&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;){&lt;/span&gt;
                                &lt;span class=&quot;n&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;${err}&quot;&lt;/span&gt;
                                &lt;span class=&quot;n&quot;&gt;sh&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'exit 1'&lt;/span&gt;
                            &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
                        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
                    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
                &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
                &lt;span class=&quot;cm&quot;&gt;/*
                stage('Run test case on Cluster3 : ${cluster3_ip}') {
                    steps {
                        script {
                            try {
                                echo &quot;Run test case on node : ${cluster3_ip}&quot;
                                sh &quot;sshpass -p p@ssw0rd ssh -p 22 -l root 172.17.75.96 uname -r&quot;
                            }catch(err){
                                echo &quot;${err}&quot;
                                sh 'exit 1'
                            }
                        }


                    }
                }
                stage('Run test case on Cluster4 : ${cluster4_ip}') {
                    steps {
                        script {
                            try {
                                echo &quot;Run test case on node : ${cluster4_ip}&quot;
                                sh &quot;sshpass -p p@ssw0rd ssh -p 22 -l root 172.17.75.96 uname -r&quot;
                            }catch(err){
                                echo &quot;${err}&quot;
                                sh 'exit 1'
                            }
                        }


                    }
                }
                stage('Run test case on Cluster5 : ${cluster5_ip}') {
                    steps {
                        script {
                            try {
                                echo &quot;Run test case on node : ${cluster5_ip}&quot;
                                sh &quot;sshpass -p p@ssw0rd ssh -p 22 -l root 172.17.75.96 uname -r&quot;
                            }catch(err){
                                echo &quot;${err}&quot;
                                sh 'exit 1'
                            }
                        }


                    }
                }
                */&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;cm&quot;&gt;/* Merge report */&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;stage&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Merge Report&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;agent&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;label&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;master&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;steps&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;script&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                        &lt;span class=&quot;n&quot;&gt;sh&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&quot;&quot;
                        #!/bin/bash -xe
                        cd \${WORK_SPACE}/jenkins;
                        for each_ip in ${cluster_ip}
                            do
                                echo &quot;Scp report from : (\${each_ip}) to jenkins node&quot;
                                ./rsync_report.sh \${each_ip} root p@ssw0rd \${REPORT_DIR} \${WORK_SPACE} \${JOB_SPACE};
                                ./jenkins_build_properties.sh \${WORK_SPACE}
                            done
                        &quot;&quot;&quot;&lt;/span&gt;
                    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;


        &lt;span class=&quot;n&quot;&gt;stage&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Allure Report&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;agent&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;label&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;master&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;steps&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;script&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                    &lt;span class=&quot;n&quot;&gt;allure&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;([&lt;/span&gt;
                            &lt;span class=&quot;nl&quot;&gt;includeProperties:&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;
                            &lt;span class=&quot;nl&quot;&gt;jdk:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;''&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;
                            &lt;span class=&quot;nl&quot;&gt;properties:&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[],&lt;/span&gt;
                            &lt;span class=&quot;nl&quot;&gt;reportBuildPolicy:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'ALWAYS'&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;
                            &lt;span class=&quot;nl&quot;&gt;results:&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;path:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'report/json'&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]]&lt;/span&gt;
                       &lt;span class=&quot;o&quot;&gt;])&lt;/span&gt;
                    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
                &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

        &lt;span class=&quot;cm&quot;&gt;/* Publish Cobertura Coverage Report */&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;stage&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Publish Cobertura Coverage Report&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;agent&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;label&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;master&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;steps&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;script&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                       &lt;span class=&quot;n&quot;&gt;cobertura&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;([&lt;/span&gt;
                               &lt;span class=&quot;nl&quot;&gt;autoUpdateHealth:&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;
                               &lt;span class=&quot;nl&quot;&gt;autoUpdateStability:&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;
                               &lt;span class=&quot;nl&quot;&gt;coberturaReportFile:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'report/coverage.xml'&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;
                               &lt;span class=&quot;nl&quot;&gt;conditionalCoverageTargets:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'70, 0, 0'&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;
                               &lt;span class=&quot;nl&quot;&gt;failUnhealthy:&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;
                               &lt;span class=&quot;nl&quot;&gt;failUnstable:&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;
                               &lt;span class=&quot;nl&quot;&gt;lineCoverageTargets:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'80, 0, 0'&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;
                               &lt;span class=&quot;nl&quot;&gt;maxNumberOfBuilds:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;
                               &lt;span class=&quot;nl&quot;&gt;methodCoverageTargets:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'80, 0, 0'&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;
                               &lt;span class=&quot;nl&quot;&gt;onlyStable:&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;
                               &lt;span class=&quot;nl&quot;&gt;sourceEncoding:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'ASCII'&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;
                               &lt;span class=&quot;nl&quot;&gt;zoomCoverageChart:&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;false&lt;/span&gt;
                       &lt;span class=&quot;o&quot;&gt;])&lt;/span&gt;
                    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
                &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

        &lt;span class=&quot;cm&quot;&gt;/* Generate pylint Report */&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;stage&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'Code Quality Check'&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;agent&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;label&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;master&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;steps&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;script&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                    &lt;span class=&quot;n&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Run pylint code style check&quot;&lt;/span&gt;
        		    &lt;span class=&quot;c1&quot;&gt;// Ignore pylint comments via &quot;-d C&quot;&lt;/span&gt;
                    &lt;span class=&quot;cm&quot;&gt;/*
        		    sh &quot;&quot;&quot;
        		    	. .venv/bin/activate
        			    pylint -d C -f parseable ${SOURCE_ROOT} --exit-zero | tee ${PYLINT_REPORT}
        		    &quot;&quot;&quot;
                    */&lt;/span&gt;
                &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
        	&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

        	&lt;span class=&quot;n&quot;&gt;post&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; 
                &lt;span class=&quot;n&quot;&gt;always&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; 
                       &lt;span class=&quot;c1&quot;&gt;// Requires Warnings plugin since Violations plugin is deprecated&lt;/span&gt;
        			   &lt;span class=&quot;c1&quot;&gt;// http://wiki.jenkins-ci.org/x/G4CGAQ&lt;/span&gt;
        			   &lt;span class=&quot;n&quot;&gt;warnings&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;canComputeNew:&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;canResolveRelativePaths:&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;canRunOnFailed:&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;categoriesPattern:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;''&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;defaultEncoding:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;''&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;excludePattern:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;''&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;healthy:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;''&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;includePattern:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;''&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;messagesPattern:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;''&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;parserConfigurations:&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;parserName:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'PyLint'&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;pattern:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;report/pylint.out&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]],&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;unHealthy:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;''&lt;/span&gt;
                &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

        &lt;span class=&quot;cm&quot;&gt;/* Send Email */&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;stage&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Send Email&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;agent&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;label&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;master&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;steps&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;script&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                        &lt;span class=&quot;cm&quot;&gt;/*
                        build_status = sh (
                            script: &quot;&quot;&quot;curl http://127.0.0.1:8080/job/${JOB_NAME}/lastBuild/api/json | json_pp | grep result | sed 's/   \&quot;result&quot; : \&quot;//g' | sed 's/&quot;,//g'&quot;&quot;&quot;,
                            returnStdout: true
                            ).trim()
                        echo &quot;build status  ${build_status}&quot;
                       */&lt;/span&gt;
                        &lt;span class=&quot;n&quot;&gt;emailext&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;([&lt;/span&gt;
                                &lt;span class=&quot;nl&quot;&gt;attachLog:&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;
                                &lt;span class=&quot;nl&quot;&gt;attachmentsPattern:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'report/cgi_response_elapsed_time.txt,report/pytest_autotest.log.gz'&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;
                                &lt;span class=&quot;nl&quot;&gt;body:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'${SCRIPT, template=&quot;allure-pipeline-report.groovy&quot;}'&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;
                                &lt;span class=&quot;nl&quot;&gt;compressLog:&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;
                                &lt;span class=&quot;nl&quot;&gt;postsendScript:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'$DEFAULT_POSTSEND_SCRIPT'&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;
                                &lt;span class=&quot;nl&quot;&gt;presendScript:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'$DEFAULT_PRESEND_SCRIPT'&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;
                                &lt;span class=&quot;nl&quot;&gt;replyTo:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'$PROJECT_DEFAULT_REPLYTO'&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;
                                &lt;span class=&quot;nl&quot;&gt;subject:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'${JOB_NAME} - ${BUILD_DISPLAY_NAME}'&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;
                                &lt;span class=&quot;nl&quot;&gt;to:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'user01@bigtera.com.cn user02@bigtera.com.cn user03@bigtera.com.cn'&lt;/span&gt;
                       &lt;span class=&quot;o&quot;&gt;])&lt;/span&gt;
                    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
                &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;email-template&quot;&gt;email template&lt;/h2&gt;

&lt;p&gt;Jenkins server处，对应的email template内容参考如下:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;jenkins@ubuntu-16:~/email-templates$ cat allure-pipeline-report.groovy 
&amp;lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.1//EN&quot; &quot;http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd&quot;&amp;gt;
&amp;lt;style type=&quot;text/css&quot;&amp;gt;
/*base css*/
    body
    {
      margin: 0px;
      padding: 15px;
    }

    body, td, th
    {
      font-family: &quot;Lucida Grande&quot;, &quot;Lucida Sans Unicode&quot;, Helvetica, Arial, Tahoma, sans-serif;
      font-size: 10pt;
    }

    th
    {
      text-align: left;
    }

    h1
    {
      margin-top: 0px;
    }
    a
    {
      color:#4a72af
    }
/*div styles*/

.status{background-color:&amp;lt;%= 
            build.result.toString() == &quot;SUCCESS&quot; ? 'green' : 'red' %&amp;gt;;font-size:28px;font-weight:bold;color:white;width:720px;height:52px;margin-bottom:18px;text-align:center;vertical-align:middle;border-collapse:collapse;background-repeat:no-repeat}
.status .info{color:white!important;text-shadow:0 -1px 0 rgba(0,0,0,0.3);font-size:32px;line-height:36px;padding:8px 0}
&amp;lt;/style&amp;gt;
&amp;lt;body&amp;gt;
&amp;lt;div class=&quot;content round_border&quot;&amp;gt;
                &amp;lt;div class=&quot;status&quot;&amp;gt;
                        &amp;lt;p class=&quot;info&quot;&amp;gt;pytest automation build &amp;lt;%= build.result.toString().toLowerCase() %&amp;gt;&amp;lt;/p&amp;gt;
                &amp;lt;/div&amp;gt;
                &amp;lt;!-- status --&amp;gt;
                        &amp;lt;table&amp;gt;
                                &amp;lt;tbody&amp;gt;
                                        &amp;lt;tr&amp;gt;
                                                &amp;lt;th&amp;gt;Project:&amp;lt;/th&amp;gt;
                                                &amp;lt;td&amp;gt;${project.name}&amp;lt;/td&amp;gt;
                                        &amp;lt;/tr&amp;gt;
                                        &amp;lt;tr&amp;gt;
                                                &amp;lt;th&amp;gt;Build ${build.displayName}:&amp;lt;/th&amp;gt;
                                                &amp;lt;td&amp;gt;&amp;lt;a
                                                        href=&quot;${rooturl}${build.url}&quot;&amp;gt;${rooturl}${build.url}&amp;lt;/a&amp;gt;&amp;lt;/td&amp;gt;
                                        &amp;lt;/tr&amp;gt;
                                        &amp;lt;tr&amp;gt;
                                                &amp;lt;th&amp;gt;Product Version:&amp;lt;/th&amp;gt;
                                                &amp;lt;td&amp;gt;&amp;lt;%=build.environment['PRODUCT_VERSION']%&amp;gt;&amp;lt;/td&amp;gt;
                                        &amp;lt;/tr&amp;gt;
                                        &amp;lt;tr&amp;gt;
                                                &amp;lt;th&amp;gt;Date of build:&amp;lt;/th&amp;gt;
                                                &amp;lt;td&amp;gt;${it.timestampString}&amp;lt;/td&amp;gt;
                                        &amp;lt;/tr&amp;gt;
                                        &amp;lt;tr&amp;gt;
                                                &amp;lt;th&amp;gt;Build duration:&amp;lt;/th&amp;gt;
                                                &amp;lt;td&amp;gt;${build.durationString}&amp;lt;/td&amp;gt;
                                        &amp;lt;/tr&amp;gt;
                                        &amp;lt;tr&amp;gt;
                                                &amp;lt;td colspan=&quot;2&quot;&amp;gt;&amp;amp;nbsp;&amp;lt;/td&amp;gt;
                                        &amp;lt;/tr&amp;gt;
                                &amp;lt;/tbody&amp;gt;

                        &amp;lt;/table&amp;gt;
                &amp;lt;!-- main --&amp;gt;
        &amp;lt;% def artifacts = build.artifacts
            if(artifacts != null &amp;amp;&amp;amp; artifacts.size() &amp;gt; 0) { %&amp;gt;

                        &amp;lt;b&amp;gt;Build Artifacts:&amp;lt;/b&amp;gt;
                        &amp;lt;ul&amp;gt;
            &amp;lt;%          artifacts.each() { f -&amp;gt; %&amp;gt;
                &amp;lt;li&amp;gt;&amp;lt;a href=&quot;${rooturl}${build.url}artifact/${f}&quot;&amp;gt;${f}&amp;lt;/a&amp;gt;&amp;lt;/li&amp;gt;
            &amp;lt;%          } %&amp;gt;
                        &amp;lt;/ul&amp;gt;
        &amp;lt;% } %&amp;gt;
  &amp;lt;!-- artifacts --&amp;gt;

&amp;lt;% 
  lastAllureReportBuildAction = build.getAction(ru.yandex.qatools.allure.jenkins.AllureReportBuildAction.class)
  lastAllureBuildAction = build.getAction(ru.yandex.qatools.allure.jenkins.AllureBuildAction.class)

  if (lastAllureReportBuildAction) {
    allureResultsUrl = &quot;${rooturl}${build.url}allure&quot;
    allureLastBuildSuccessRate = String.format(&quot;%.2f&quot;, lastAllureReportBuildAction.getPassedCount() * 100f / lastAllureReportBuildAction.getTotalCount())
  }
%&amp;gt;

&amp;lt;%
pylintResultsUrl = &quot;${build.environment['JOB_URL']}warnings50/trendGraph&quot;
coberturaResultsUrl = &quot;${rooturl}${build.url}cobertura&quot;
%&amp;gt;

&amp;lt;% if (lastAllureReportBuildAction) { %&amp;gt;
&amp;lt;h2&amp;gt;Allure Results&amp;lt;/h2&amp;gt;
&amp;lt;table&amp;gt;
            &amp;lt;tbody&amp;gt;
                        &amp;lt;tr&amp;gt;
                            &amp;lt;th&amp;gt;Total Allure tests run:&amp;lt;/th&amp;gt;
                            &amp;lt;td&amp;gt;&amp;lt;a href=&quot;${allureResultsUrl}&quot;&amp;gt;${lastAllureReportBuildAction.getTotalCount()}&amp;lt;/a&amp;gt;&amp;lt;/td&amp;gt;
                        &amp;lt;/tr&amp;gt;
                        &amp;lt;tr&amp;gt;
                            &amp;lt;th&amp;gt;&amp;lt;span style=&quot;color: #000000; background-color: #ffff00;&quot;&amp;gt;Failed:&amp;lt;/span&amp;gt;&amp;lt;/th&amp;gt;
                            &amp;lt;td&amp;gt;&amp;lt;span style=&quot;color: #000000; background-color: #ffff00;&quot;&amp;gt;${lastAllureReportBuildAction.getFailedCount()} &amp;lt;/span&amp;gt;&amp;lt;/td&amp;gt;
                        &amp;lt;/tr&amp;gt;
                        &amp;lt;tr&amp;gt;
                            &amp;lt;th&amp;gt;&amp;lt;span style=&quot;color: #000000; background-color: #008000;&quot;&amp;gt;Passed:&amp;lt;/span&amp;gt;&amp;lt;/th&amp;gt;
                            &amp;lt;td&amp;gt;&amp;lt;span style=&quot;color: #000000; background-color: #008000;&quot;&amp;gt;${lastAllureReportBuildAction.getPassedCount()} &amp;lt;/span&amp;gt;&amp;lt;/td&amp;gt;
                        &amp;lt;/tr&amp;gt;
                        &amp;lt;tr&amp;gt;
                            &amp;lt;th&amp;gt;&amp;lt;span style=&quot;color: #000000; background-color: #3366ff;&quot;&amp;gt;Skipped:&amp;lt;/span&amp;gt;&amp;lt;/th&amp;gt;
                            &amp;lt;td&amp;gt;&amp;lt;span style=&quot;color: #000000; background-color: #3366ff;&quot;&amp;gt;${lastAllureReportBuildAction.getSkipCount()} &amp;lt;/span&amp;gt;&amp;lt;/td&amp;gt;
                        &amp;lt;/tr&amp;gt;
                        &amp;lt;tr&amp;gt;
                            &amp;lt;th&amp;gt;&amp;lt;span style=&quot;color: #000000; background-color: #ff0000;&quot;&amp;gt;Broken:&amp;lt;/span&amp;gt;&amp;lt;/th&amp;gt;
                            &amp;lt;td&amp;gt;&amp;lt;span style=&quot;color: #000000; background-color: #ff0000;&quot;&amp;gt;${lastAllureReportBuildAction.getBrokenCount()} &amp;lt;/span&amp;gt;&amp;lt;/td&amp;gt;
                        &amp;lt;/tr&amp;gt;
                        &amp;lt;tr&amp;gt;
                            &amp;lt;th&amp;gt;Success rate: &amp;lt;/th&amp;gt;
                            &amp;lt;td&amp;gt;${allureLastBuildSuccessRate}%  &amp;lt;/td&amp;gt;
                        &amp;lt;/tr&amp;gt;

            &amp;lt;/tbody&amp;gt;
&amp;lt;/table&amp;gt;

&amp;lt;br&amp;gt;
&amp;lt;img lazymap=&quot;${allureResultsUrl}/graphMap&quot; src=&quot;${allureResultsUrl}/graph&quot; alt=&quot;Allure results trend&quot;/&amp;gt;
&amp;lt;/br&amp;gt;

&amp;lt;br&amp;gt;
&amp;lt;font size=4&amp;gt;&amp;lt;b&amp;gt;&amp;amp;nbsp;&amp;amp;nbsp;&amp;amp;nbsp;&amp;amp;nbsp;&amp;amp;nbsp;&amp;amp;nbsp;&amp;amp;nbsp;&amp;amp;nbsp;&amp;amp;nbsp;&amp;amp;nbsp;&amp;amp;nbsp;&amp;amp;nbsp;Pylint history trend&amp;lt;/b&amp;gt;&amp;lt;/font&amp;gt;
&amp;lt;/br&amp;gt;
&amp;lt;br&amp;gt;
&amp;lt;img src=&quot;${pylintResultsUrl}/png?url=PRIORITY&quot;/&amp;gt;
&amp;lt;/br&amp;gt;

&amp;lt;br&amp;gt;
&amp;lt;font size=4&amp;gt;&amp;lt;b&amp;gt;&amp;amp;nbsp;&amp;amp;nbsp;&amp;amp;nbsp;&amp;amp;nbsp;&amp;amp;nbsp;&amp;amp;nbsp;&amp;amp;nbsp;&amp;amp;nbsp;&amp;amp;nbsp;&amp;amp;nbsp;&amp;amp;nbsp;&amp;amp;nbsp;&amp;amp;nbsp;Code Coverage history trend&amp;lt;/b&amp;gt;&amp;lt;/font&amp;gt;
&amp;lt;/br&amp;gt;
&amp;lt;br&amp;gt;
&amp;lt;img lazymap=&quot;${coberturaResultsUrl}/graphMap&quot; src=&quot;${coberturaResultsUrl}/graph&quot;/&amp;gt;
&amp;lt;/br&amp;gt;
&amp;lt;% } %&amp;gt;                  
  &amp;lt;!-- content --&amp;gt;
  &amp;lt;!-- bottom message --&amp;gt;
&amp;lt;/body&amp;gt;
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;运行效果&quot;&gt;运行效果&lt;/h2&gt;

&lt;p&gt;Jenkins pipeline project流程图：&lt;/p&gt;

&lt;p&gt;&lt;img class=&quot;shadow&quot; src=&quot;/img/in-post/pipeline_Process_rendering.png&quot; width=&quot;1200&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Jenkins send email效果图：&lt;/p&gt;

&lt;p&gt;&lt;img class=&quot;shadow&quot; src=&quot;/img/in-post/pipeline_send_email1.png&quot; width=&quot;1200&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img class=&quot;shadow&quot; src=&quot;/img/in-post/pipeline_send_email2.png&quot; width=&quot;1200&quot; /&gt;&lt;/p&gt;</content><author><name>Gavin</name></author><category term="Jenkins" /><category term="pipeline" /><category term="pytest" /><summary type="html">概述</summary></entry><entry><title type="html">API获取Jenkins构建信息</title><link href="http://172.17.73.80:4000/2020/05/08/get-jenkins-information/" rel="alternate" type="text/html" title="API获取Jenkins构建信息" /><published>2020-05-08T00:00:00+08:00</published><updated>2020-05-08T00:00:00+08:00</updated><id>http://172.17.73.80:4000/2020/05/08/get-jenkins-information</id><content type="html" xml:base="http://172.17.73.80:4000/2020/05/08/get-jenkins-information/">&lt;h1 id=&quot;概述&quot;&gt;概述&lt;/h1&gt;

&lt;p&gt;Jenkins 的 REST API 可以从外部调用 Jenkins 实例，一些库例如 jenkins-rest 和 java-client-api 封装了相关 API，可以在 Java 中操作 Jenkins。&lt;/p&gt;

&lt;h1 id=&quot;详述&quot;&gt;详述&lt;/h1&gt;

&lt;p&gt;本文参考jenkins-rest库，将API根据获取的资源类型不同分为6个类别。&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;&lt;strong&gt;API类型&lt;/strong&gt;&lt;/th&gt;
      &lt;th&gt;&lt;strong&gt;说明&lt;/strong&gt;&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;JobsAP&lt;/td&gt;
      &lt;td&gt;任务管理（任务信息、创建、修改）&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;OBPluginManagerAPI&lt;/td&gt;
      &lt;td&gt;插件管理（插件信息、安装插件）&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;QueueAPI&lt;/td&gt;
      &lt;td&gt;任务队列相关（队列状态）&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;StatisticsAPI&lt;/td&gt;
      &lt;td&gt;Jenkins统计信息&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;CrumbIssuerAPI&lt;/td&gt;
      &lt;td&gt;系统哈希值信息（用于防御CSRF攻击）&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;SystemAPI&lt;/td&gt;
      &lt;td&gt;Jenkins系统状态（版本、路径）&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h2 id=&quot;术语定义&quot;&gt;术语定义&lt;/h2&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;&lt;strong&gt;名词&lt;/strong&gt;&lt;/th&gt;
      &lt;th&gt;&lt;strong&gt;说明&lt;/strong&gt;&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;job&lt;/td&gt;
      &lt;td&gt;任务&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;payload&lt;/td&gt;
      &lt;td&gt;在POST请求中提交的数据&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;{optionalFolderPath}&lt;/td&gt;
      &lt;td&gt;可选参数：任务所在目录的路径&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;{project_name}&lt;/td&gt;
      &lt;td&gt;必须参数：任务名称&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;注意:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;在 GET/POST 时需要附加 HTTP 认证才能访问 API&lt;/li&gt;
  &lt;li&gt;本文使用的数据结构可以在 jenkins-rest/domain 中查看详细定义&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;jobs-相关-api&quot;&gt;Jobs 相关 API&lt;/h2&gt;

&lt;h3 id=&quot;job-info-获取任务信息&quot;&gt;job-info 获取任务信息&lt;/h3&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;GET http://127.0.0.1:8080/{optionalFolderPath}job/{project_name}/api/json&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;返回类型：JobInfo&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;字段&lt;/th&gt;
      &lt;th&gt;类型&lt;/th&gt;
      &lt;th&gt;说明&lt;/th&gt;
      &lt;th&gt; &lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;description&lt;/td&gt;
      &lt;td&gt;String&lt;/td&gt;
      &lt;td&gt;描述&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;name&lt;/td&gt;
      &lt;td&gt;String&lt;/td&gt;
      &lt;td&gt;项目名称&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;url&lt;/td&gt;
      &lt;td&gt;boolean&lt;/td&gt;
      &lt;td&gt;路径&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;buildable&lt;/td&gt;
      &lt;td&gt;String&lt;/td&gt;
      &lt;td&gt;是否可构建&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;builds&lt;/td&gt;
      &lt;td&gt;List&lt;BuildInfo&gt;&lt;/BuildInfo&gt;&lt;/td&gt;
      &lt;td&gt;构建记录&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;lastBuild&lt;/td&gt;
      &lt;td&gt;BuildInfo&lt;/td&gt;
      &lt;td&gt;上次构建记录&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;……&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h3 id=&quot;build-info-获取构筑信息&quot;&gt;build-info 获取构筑信息&lt;/h3&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;GET http://127.0.0.1:8080/{optionalFolderPath}job/{project_name}/{number}/api/json&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;返回类型：BuildInfo&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;字段&lt;/th&gt;
      &lt;th&gt;类型&lt;/th&gt;
      &lt;th&gt;说明&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;artifacts&lt;/td&gt;
      &lt;td&gt;List&lt;Artifact&gt;&lt;/Artifact&gt;&lt;/td&gt;
      &lt;td&gt;artifacts&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;actions&lt;/td&gt;
      &lt;td&gt;Lis&lt;Action&gt;&lt;/Action&gt;&lt;/td&gt;
      &lt;td&gt;actions&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;building&lt;/td&gt;
      &lt;td&gt;boolean	路径&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;description&lt;/td&gt;
      &lt;td&gt;String&lt;/td&gt;
      &lt;td&gt;描述&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;……&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h3 id=&quot;create-使用-xml-文件创建任务&quot;&gt;create 使用 XML 文件创建任务&lt;/h3&gt;

&lt;p&gt;从 XML 文件中加载任务配置并创建任务&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;POST http://127.0.0.1:8080/createItem&lt;/code&gt;&lt;/p&gt;

&lt;h4 id=&quot;参数&quot;&gt;参数&lt;/h4&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;key&lt;/th&gt;
      &lt;th&gt;value&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;name	任务名称&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;payload	XML配置文件&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;返回类型：RequestStatus&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;字段&lt;/th&gt;
      &lt;th&gt;类型&lt;/th&gt;
      &lt;th&gt;说明&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;value&lt;/td&gt;
      &lt;td&gt;Boolean&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;errors&lt;/td&gt;
      &lt;td&gt;List&lt;Error&gt;&lt;/Error&gt;&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h3 id=&quot;get-config-获取任务配置文件&quot;&gt;get-config 获取任务配置文件&lt;/h3&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;GET http://127.0.0.1:8080/{optionalFolderPath}job/{project_name}/config.xml&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;返回类型： String&lt;/p&gt;

&lt;h3 id=&quot;update-config-更新任务配置文件&quot;&gt;update-config 更新任务配置文件&lt;/h3&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;POST http://127.0.0.1:8080/{optionalFolderPath}job/{project_name}/config.xml&lt;/code&gt;&lt;/p&gt;

&lt;h4 id=&quot;参数-1&quot;&gt;参数&lt;/h4&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;字段&lt;/th&gt;
      &lt;th&gt;说明&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;payload&lt;/td&gt;
      &lt;td&gt;XML配置文件&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;返回类型：Boolean&lt;/p&gt;

&lt;h3 id=&quot;get-description-获取任务描述&quot;&gt;get-description 获取任务描述&lt;/h3&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;GET http://127.0.0.1:8080/{optionalFolderPath}job/{project_name}/description&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;返回类型：String&lt;/p&gt;

&lt;h3 id=&quot;set-description-设置任务描述&quot;&gt;set-description 设置任务描述&lt;/h3&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;POST http://127.0.0.1:8080/{optionalFolderPath}job/{project_name}/description&lt;/code&gt;&lt;/p&gt;

&lt;h4 id=&quot;参数-2&quot;&gt;参数&lt;/h4&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;key&lt;/th&gt;
      &lt;th&gt;value&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;description&lt;/td&gt;
      &lt;td&gt;描述&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;返回类型：Boolean&lt;/p&gt;

&lt;h3 id=&quot;delete-删除任务&quot;&gt;delete 删除任务&lt;/h3&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;POST http://127.0.0.1:8080/{optionalFolderPath}job/{project_name}/doDelete&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;返回类型：RequestStatus&lt;/p&gt;

&lt;h3 id=&quot;enable允许任务&quot;&gt;enable允许任务&lt;/h3&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;POST http://127.0.0.1:8080/{optionalFolderPath}job/{project_name}/enable&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;返回类型：Boolean&lt;/p&gt;

&lt;h3 id=&quot;disable-禁止任务&quot;&gt;disable 禁止任务&lt;/h3&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;POST http://127.0.0.1:8080/{optionalFolderPath}job/{project_name}/disable&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;返回类型：Boolean&lt;/p&gt;

&lt;h3 id=&quot;build-构建&quot;&gt;build 构建&lt;/h3&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;POST http://127.0.0.1:8080/{optionalFolderPath}job/{project_name}/build&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;返回类型： IntegerResponse&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;字段&lt;/th&gt;
      &lt;th&gt;类型&lt;/th&gt;
      &lt;th&gt;说明&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;value&lt;/td&gt;
      &lt;td&gt;Integer&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;errors&lt;/td&gt;
      &lt;td&gt;List&lt;Error&gt;&lt;/Error&gt;&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h3 id=&quot;build-with-params--使用参数创建任务&quot;&gt;build-with-params  使用参数创建任务&lt;/h3&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;POST http://127.0.0.1:8080/{optionalFolderPath}job/{project_name}/buildWithParameters&lt;/code&gt;&lt;/p&gt;

&lt;h4 id=&quot;参数-3&quot;&gt;参数&lt;/h4&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;key&lt;/th&gt;
      &lt;th&gt;value&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;payload&lt;/td&gt;
      &lt;td&gt;Map&amp;lt;String, List&lt;String&gt;&amp;gt; properties&lt;/String&gt;&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;返回类型： IntegerResponse&lt;/p&gt;

&lt;h3 id=&quot;last-build-number-获取上次构建序号&quot;&gt;last-build-number 获取上次构建序号&lt;/h3&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;GET http://127.0.0.1:8080/{optionalFolderPath}job/{project_name}/lastBuild/buildNumber&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;返回类型：Integer&lt;/p&gt;

&lt;h3 id=&quot;last-build-timestamp-获取上次构建时间戳&quot;&gt;last-build-timestamp 获取上次构建时间戳&lt;/h3&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;GET http://127.0.0.1:8080/{optionalFolderPath}job/{project_name}/lastBuild/buildTimestamp&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;返回类型：String&lt;/p&gt;

&lt;h3 id=&quot;progressive-text-获取构建控制台输出&quot;&gt;progressive-text 获取构建控制台输出&lt;/h3&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;GET http://127.0.0.1:8080/{optionalFolderPath}job/{project_name}/lastBuild/logText/progressiveText&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;返回类型：ProgressiveText&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;字段&lt;/th&gt;
      &lt;th&gt;类型&lt;/th&gt;
      &lt;th&gt;说明&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;text&lt;/td&gt;
      &lt;td&gt;String&lt;/td&gt;
      &lt;td&gt;控制台输出&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;size&lt;/td&gt;
      &lt;td&gt;Integer&lt;/td&gt;
      &lt;td&gt;字数&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;hasMoreData&lt;/td&gt;
      &lt;td&gt;Boolean&lt;/td&gt;
      &lt;td&gt;是否有更多数据&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h3 id=&quot;crumbissuer-系统哈希值信息用于防御csrf攻击&quot;&gt;CrumbIssuer 系统哈希值信息（用于防御CSRF攻击）&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;CrumbIssuerApi&lt;/li&gt;
  &lt;li&gt;path: /crumbIssuer/api/xml&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;crumb&quot;&gt;crumb&lt;/h4&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;GET http://127.0.0.1:8080/crumbIssuer/api/xml?{key}={value}&lt;/code&gt;&lt;/p&gt;

&lt;h5 id=&quot;参数-4&quot;&gt;参数&lt;/h5&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;key&lt;/th&gt;
      &lt;th&gt;value&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;xpath&lt;/td&gt;
      &lt;td&gt;concat(//crumbRequestField,”:”,//crumb)&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;返回类型：Crumb&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;字段&lt;/th&gt;
      &lt;th&gt;类型&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;value&lt;/td&gt;
      &lt;td&gt;String&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;errors&lt;/td&gt;
      &lt;td&gt;List&lt;Error&gt;&lt;/Error&gt;&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h3 id=&quot;pluginmanager-插件管理插件信息安装插件&quot;&gt;PluginManager 插件管理（插件信息、安装插件）&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;PluginManagerApi&lt;/li&gt;
  &lt;li&gt;path: /pluginManager&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;plugins-插件列表&quot;&gt;plugins 插件列表&lt;/h4&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;GET http://127.0.0.1:8080/pluginManager/api/json&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;返回类型：List&lt;Plugin&gt;&lt;/Plugin&gt;&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;字段&lt;/th&gt;
      &lt;th&gt;类型&lt;/th&gt;
      &lt;th&gt;说明&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;active&lt;/td&gt;
      &lt;td&gt;Boolean&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;backupVersion	String&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;bundled&lt;/td&gt;
      &lt;td&gt;Boolean&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;deleted&lt;/td&gt;
      &lt;td&gt;Boolean&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;downgradable&lt;/td&gt;
      &lt;td&gt;Boolean&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;enabled&lt;/td&gt;
      &lt;td&gt;Boolean&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;longName&lt;/td&gt;
      &lt;td&gt;String&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;……&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h3 id=&quot;installnecessaryplugins-安装插件&quot;&gt;installNecessaryPlugins 安装插件&lt;/h3&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;POST http://127.0.0.1:8080/pluginManager/installNecessaryPlugins&lt;/code&gt;&lt;/p&gt;

&lt;h4 id=&quot;参数-5&quot;&gt;参数&lt;/h4&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;payload: &amp;lt;jenkins&amp;gt;&amp;lt;install plugin=&quot;{pluginID}&quot;/&amp;gt;&amp;lt;/jenkins&amp;gt;&lt;/code&gt;&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;字段&lt;/th&gt;
      &lt;th&gt;说明&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;{pluginID}&lt;/td&gt;
      &lt;td&gt;要安装的插件ID&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;返回类型：RequestStatus&lt;/p&gt;

&lt;h3 id=&quot;queue-任务队列相关队列状态&quot;&gt;Queue 任务队列相关（队列状态）&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;QueueApi&lt;/li&gt;
  &lt;li&gt;path: /queue&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;queue-所有任务队列信息&quot;&gt;queue 所有任务队列信息&lt;/h4&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;GET http://127.0.0.1:8080/queue/api/json&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;返回类型：List&lt;QueueItem&gt;&lt;/QueueItem&gt;&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;字段&lt;/th&gt;
      &lt;th&gt;类型&lt;/th&gt;
      &lt;th&gt;说明&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;blocked&lt;/td&gt;
      &lt;td&gt;Boolean&lt;/td&gt;
      &lt;td&gt;是否阻塞&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;buildable&lt;/td&gt;
      &lt;td&gt;Boolean&lt;/td&gt;
      &lt;td&gt;是否可构建&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;id&lt;/td&gt;
      &lt;td&gt;Integer&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;inQueueSince&lt;/td&gt;
      &lt;td&gt;Long&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;params&lt;/td&gt;
      &lt;td&gt;Map&amp;lt;String, String&amp;gt;&lt;/td&gt;
      &lt;td&gt;任务参数&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;task&lt;/td&gt;
      &lt;td&gt;Task&lt;/td&gt;
      &lt;td&gt;Task中包含任务名称和URL&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;……&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h3 id=&quot;item-任务队列信息&quot;&gt;item 任务队列信息&lt;/h3&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;GET http://127.0.0.1:8080/queue/item/{queueId}/api/json&lt;/code&gt;&lt;/p&gt;

&lt;h4 id=&quot;参数-6&quot;&gt;参数&lt;/h4&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;字段&lt;/th&gt;
      &lt;th&gt;说明&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;{queueId}&lt;/td&gt;
      &lt;td&gt;任务队列ID&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;返回类型：QueueItem&lt;/p&gt;

&lt;h3 id=&quot;cancel-取消任务队列-&quot;&gt;cancel 取消任务队列 |&lt;/h3&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;POST http://127.0.0.1:8080/cancelItem?id={id}&lt;/code&gt;&lt;/p&gt;

&lt;h4 id=&quot;参数-7&quot;&gt;参数&lt;/h4&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;字段&lt;/th&gt;
      &lt;th&gt;说明&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;{id}&lt;/td&gt;
      &lt;td&gt;任务队列ID&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;返回类型：RequestStatus&lt;/p&gt;

&lt;h3 id=&quot;statistics-统计信息&quot;&gt;Statistics 统计信息&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;StatisticsApi&lt;/li&gt;
  &lt;li&gt;path: /&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;overall-load&quot;&gt;overall-load&lt;/h4&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;GET http://127.0.0.1:8080/overallLoad/api/json&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;返回类型：OverallLoad&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;字段&lt;/th&gt;
      &lt;th&gt;类型&lt;/th&gt;
      &lt;th&gt;说明&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;availableExecutors&lt;/td&gt;
      &lt;td&gt;Map&amp;lt;String, String&amp;gt;&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;busyExecutors&lt;/td&gt;
      &lt;td&gt;Map&amp;lt;String, String&amp;gt;&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;connectingExecutors&lt;/td&gt;
      &lt;td&gt;Map&amp;lt;String, String&amp;gt;&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;definedExecutors&lt;/td&gt;
      &lt;td&gt;Map&amp;lt;String, String&amp;gt;&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;idleExecutors&lt;/td&gt;
      &lt;td&gt;Map&amp;lt;String, String&amp;gt;&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;onlineExecutors&lt;/td&gt;
      &lt;td&gt;Map&amp;lt;String, String&amp;gt;&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;queueLength&lt;/td&gt;
      &lt;td&gt;Map&amp;lt;String, String&amp;gt;&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;totalExecutors&lt;/td&gt;
      &lt;td&gt;Map&amp;lt;String, String&amp;gt;&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;totalQueueLength&lt;/td&gt;
      &lt;td&gt;Map&amp;lt;String, String&amp;gt;&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h4 id=&quot;system-系统信息&quot;&gt;System 系统信息&lt;/h4&gt;

&lt;ul&gt;
  &lt;li&gt;path: /&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;返回类型：SystemInfo&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;字段&lt;/th&gt;
      &lt;th&gt;类型&lt;/th&gt;
      &lt;th&gt;说明&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;hudsonVersion&lt;/td&gt;
      &lt;td&gt;String&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;jenkinsVersion&lt;/td&gt;
      &lt;td&gt;String&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;jenkinsSession&lt;/td&gt;
      &lt;td&gt;String&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;instanceIdentity&lt;/td&gt;
      &lt;td&gt;String&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;sshEndpoint&lt;/td&gt;
      &lt;td&gt;String&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;server&lt;/td&gt;
      &lt;td&gt;String&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h1 id=&quot;举几个例子&quot;&gt;举几个例子&lt;/h1&gt;

&lt;h2 id=&quot;获取jenkins-job状态&quot;&gt;获取jenkins job状态&lt;/h2&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;oot@node248:~# curl http://172.12.12.234:8080/job/pytest_7.0/lastBuild/api/xml --user jenkins:1&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;结果示例如下:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;&amp;lt;freeStyleBuild _class='hudson.model.FreeStyleBuild'&amp;gt;&amp;lt;action _class='hudson.model.CauseAction'&amp;gt;&amp;lt;cause _class='hudson.model.Cause$UserIdCause'&amp;gt;&amp;lt;shortDescription&amp;gt;Started by user jenkins&amp;lt;/shortDescription&amp;gt;&amp;lt;userId&amp;gt;jenkins&amp;lt;/userId&amp;gt;&amp;lt;userName&amp;gt;jenkins&amp;lt;/userName&amp;gt;&amp;lt;/cause&amp;gt;&amp;lt;/action&amp;gt;&amp;lt;action&amp;gt;&amp;lt;/action&amp;gt;&amp;lt;action _class='hudson.plugins.git.util.BuildData'&amp;gt;&amp;lt;buildsByBranchName&amp;gt;&amp;lt;refsremotesoriginmaster _class='hudson.plugins.git.util.Build'&amp;gt;&amp;lt;buildNumber&amp;gt;68&amp;lt;/buildNumber&amp;gt;&amp;lt;marked&amp;gt;&amp;lt;SHA1&amp;gt;6388b644c4405a31611f179dca6c1e485ad92aa5&amp;lt;/SHA1&amp;gt;&amp;lt;branch&amp;gt;&amp;lt;SHA1&amp;gt;6388b644c4405a31611f179dca6c1e485ad92aa5&amp;lt;/SHA1&amp;gt;&amp;lt;name&amp;gt;refs/remotes/origin/master&amp;lt;/name&amp;gt;&amp;lt;/branch&amp;gt;&amp;lt;/marked&amp;gt;&amp;lt;revision&amp;gt;&amp;lt;SHA1&amp;gt;6388b644c4405a31611f179dca6c1e485ad92aa5&amp;lt;/SHA1&amp;gt;&amp;lt;branch&amp;gt;&amp;lt;SHA1&amp;gt;6388b644c4405a31611f179dca6c1e485ad92aa5&amp;lt;/SHA1&amp;gt;&amp;lt;name&amp;gt;refs/remotes/origin/master&amp;lt;/name&amp;gt;&amp;lt;/branch&amp;gt;&amp;lt;/revision&amp;gt;&amp;lt;/refsremotesoriginmaster&amp;gt;&amp;lt;/buildsByBranchName&amp;gt;&amp;lt;lastBuiltRevision&amp;gt;&amp;lt;SHA1&amp;gt;6388b644c4405a31611f179dca6c1e485ad92aa5&amp;lt;/SHA1&amp;gt;&amp;lt;branch&amp;gt;&amp;lt;SHA1&amp;gt;6388b644c4405a31611f179dca6c1e485ad92aa5&amp;lt;/SHA1&amp;gt;&amp;lt;name&amp;gt;refs/remotes/origin/master&amp;lt;/name&amp;gt;&amp;lt;/branch&amp;gt;&amp;lt;/lastBuiltRevision&amp;gt;&amp;lt;remoteUrl&amp;gt;git@10.1.12.10:yunzeng_wang/pytest_framework.git&amp;lt;/remoteUrl&amp;gt;&amp;lt;scmName&amp;gt;&amp;lt;/scmName&amp;gt;&amp;lt;/action&amp;gt;&amp;lt;action _class='hudson.plugins.git.GitTagAction'&amp;gt;&amp;lt;/action&amp;gt;&amp;lt;action&amp;gt;&amp;lt;/action&amp;gt;&amp;lt;action&amp;gt;&amp;lt;/action&amp;gt;&amp;lt;action&amp;gt;&amp;lt;/action&amp;gt;&amp;lt;action&amp;gt;&amp;lt;/action&amp;gt;&amp;lt;action&amp;gt;&amp;lt;/action&amp;gt;&amp;lt;action&amp;gt;&amp;lt;/action&amp;gt;&amp;lt;action _class='hudson.plugins.violations.ViolationsBuildAction'&amp;gt;&amp;lt;/action&amp;gt;&amp;lt;action&amp;gt;&amp;lt;/action&amp;gt;&amp;lt;action&amp;gt;&amp;lt;/action&amp;gt;&amp;lt;action&amp;gt;&amp;lt;/action&amp;gt;&amp;lt;artifact&amp;gt;&amp;lt;displayPath&amp;gt;allure-report.zip&amp;lt;/displayPath&amp;gt;&amp;lt;fileName&amp;gt;allure-report.zip&amp;lt;/fileName&amp;gt;&amp;lt;relativePath&amp;gt;allure-report.zip&amp;lt;/relativePath&amp;gt;&amp;lt;/artifact&amp;gt;&amp;lt;building&amp;gt;false&amp;lt;/building&amp;gt;&amp;lt;displayName&amp;gt;#68&amp;lt;/displayName&amp;gt;&amp;lt;duration&amp;gt;87155647&amp;lt;/duration&amp;gt;&amp;lt;estimatedDuration&amp;gt;85209450&amp;lt;/estimatedDuration&amp;gt;&amp;lt;fullDisplayName&amp;gt;pytest_7.0 #68&amp;lt;/fullDisplayName&amp;gt;&amp;lt;id&amp;gt;68&amp;lt;/id&amp;gt;&amp;lt;keepLog&amp;gt;false&amp;lt;/keepLog&amp;gt;&amp;lt;number&amp;gt;68&amp;lt;/number&amp;gt;&amp;lt;queueId&amp;gt;343&amp;lt;/queueId&amp;gt;&amp;lt;result&amp;gt;UNSTABLE&amp;lt;/result&amp;gt;&amp;lt;timestamp&amp;gt;1588762417068&amp;lt;/timestamp&amp;gt;&amp;lt;url&amp;gt;http://172.12.12.234:8080/job/pytest_7.0/68/&amp;lt;/url&amp;gt;&amp;lt;builtOn&amp;gt;&amp;lt;/builtOn&amp;gt;&amp;lt;changeSet _class='hudson.plugins.git.GitChangeSetList'&amp;gt;&amp;lt;kind&amp;gt;git&amp;lt;/kind&amp;gt;&amp;lt;/changeSet&amp;gt;&amp;lt;culprit&amp;gt;&amp;lt;absoluteUrl&amp;gt;http://172.12.12.234:8080/user/shengdan061&amp;lt;/absoluteUrl&amp;gt;&amp;lt;fullName&amp;gt;shengdan061&amp;lt;/fullName&amp;gt;&amp;lt;/culprit&amp;gt;&amp;lt;culprit&amp;gt;&amp;lt;absoluteUrl&amp;gt;http://172.12.12.234:8080/user/yunzeng_wang&amp;lt;/absoluteUrl&amp;gt;&amp;lt;fullName&amp;gt;yunzeng_wang&amp;lt;/fullName&amp;gt;&amp;lt;/culprit&amp;gt;&amp;lt;/freeStyleBuild&amp;gt;root@node248:~#
root@node248:~#
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;获取某一个构建版本号为56的构建结果&quot;&gt;获取某一个构建版本号为56的构建结果&lt;/h2&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;curl http://172.12.12.234:8080/job/pytest_7.0/56/api/xml --user jenkins:1&lt;/code&gt;&lt;/p&gt;

&lt;h2 id=&quot;获取最后一次构建的版本号&quot;&gt;获取最后一次构建的版本号：&lt;/h2&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;curl http://172.12.12.234:8080/job/pytest_7.0/lastBuild/buildNumber --user jenkins:1&lt;/code&gt;&lt;/p&gt;

&lt;h2 id=&quot;获取某个项目所有构建版本号的结果&quot;&gt;获取某个项目所有构建版本号的结果&lt;/h2&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;curl http://172.12.12.234:8080/job/pytest_7.0/api/xml --user jenkins:1&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;说明：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;以上pytest_7.0为项目名称，jenkins:1是访问jenkins server的账号和密码&lt;/li&gt;
&lt;/ul&gt;</content><author><name>Gavin</name></author><category term="Jenkins" /><summary type="html">概述</summary></entry><entry><title type="html">Megacli详解</title><link href="http://172.17.73.80:4000/2020/05/06/megacli-guide/" rel="alternate" type="text/html" title="Megacli详解" /><published>2020-05-06T00:00:00+08:00</published><updated>2020-05-06T00:00:00+08:00</updated><id>http://172.17.73.80:4000/2020/05/06/megacli-guide</id><content type="html" xml:base="http://172.17.73.80:4000/2020/05/06/megacli-guide/">&lt;h1 id=&quot;概述&quot;&gt;概述&lt;/h1&gt;

&lt;p&gt;通常，我们使用的DELL/HP/IBM三家的机架式PC级服务器阵列卡是从LSI的卡OEM出来的，DELL和IBM两家的阵列卡原生程度较高， 没有做太多封装，可以用原厂提供的阵列卡管理工具进行监控；而HP的阵列卡一般都做过封装了，因此需要使用自身特有的管理工具来监控。
本文以几种常用的阵列卡为例，展示其阵列卡及硬盘监控的方法。&lt;/p&gt;

&lt;p&gt;DELL SAS 6/iR卡，全称LSI Logic SAS1068E，只支持RAID 0, RAID 1, RAID 1+0, 不支持RAID 5等高级RAID特性，不支持阵列卡电池。
DELL PERC PERC H700卡，全称LSI Logic MegaRAID SAS 2108，支持各种RAID级别及高级特性，可选配阵列卡电池。
DELL PERC H310 Mini卡 ，全称LSI Logic / Symbios Logic MegaRAID SAS 2008，支持常见RAID级别，不支持高级RAID特性，不支持阵列卡电池。
IBM ServeRAID M5014 SAS/SATA Controller卡，全称LSI Logic / Symbios Logic MegaRAID SAS 2108，支持各种RAID级别及高级特性，可选配阵列卡电池。
IBM ServeRAID-MR10i SAS/SATA Controller卡，全称LSI Logic / Symbios Logic MegaRAID SAS 1078，支持常见RAID级别，不支持高级RAID特性，可选配阵列卡电池，这个卡其实和DELL的PERC 6/i卡是一样的，都是基于LSI MegaRAID SAS 1078基础上OEM出来的。&lt;/p&gt;

&lt;p&gt;上面是几种常见的阵列卡型号，更多的可以自行查看官方的技术手册。
下面我们要继续的是，这些阵列卡以及硬盘如何监控，阵列卡的管理也请查看官方技术手册，不在本文讨论范畴。
一般地，支持RAID 5的卡，我们称其为阵列卡，都可以使用LSI官方提供的MegaCli工具来管理，而不支持RAID 5的卡，我们称其为SAS卡，使用lsiutil工具来管理。HP的服务器使用其特有的hpacucli工具来管理。&lt;/p&gt;

&lt;h1 id=&quot;工具概述&quot;&gt;工具概述&lt;/h1&gt;

&lt;h2 id=&quot;megacli工具&quot;&gt;&lt;strong&gt;MegaCli工具&lt;/strong&gt;&lt;/h2&gt;

&lt;h3 id=&quot;megacli--adpallinfo--aall--查看阵列卡信息&quot;&gt;MegaCli -adpallinfo -aall — 查看阵列卡信息&lt;/h3&gt;

&lt;p&gt;-a 参数指定阵列卡的编号，一般服务器上只会配一个阵列卡，因此我们通常指定为 -a0（阵列卡适配器编号，从0开始） 即可，主要关注下面几个信息：&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;&lt;strong&gt;状态值&lt;/strong&gt;&lt;/th&gt;
      &lt;th&gt;&lt;strong&gt;对应含义&lt;/strong&gt;&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;Product Name : PERC  H710 Mini&lt;/td&gt;
      &lt;td&gt;阵列卡名称&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;FW Package Build:  21.2.0-0007&lt;/td&gt;
      &lt;td&gt;阵列卡firmware版本号，版本如果太低，建议升级以提高稳定性及性能&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;BBU : Present&lt;/td&gt;
      &lt;td&gt;是否有配BBU电池&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h3 id=&quot;megacli--cfgdsply--aall--查看阵列配置&quot;&gt;MegaCli -cfgdsply -aall — 查看阵列配置&lt;/h3&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;&lt;strong&gt;状态值&lt;/strong&gt;&lt;/th&gt;
      &lt;th&gt;&lt;strong&gt;对应含义&lt;/strong&gt;&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;Memory: 512MB&lt;/td&gt;
      &lt;td&gt;阵列卡cache大小，2的N次方，如果不是，说明阵列卡有异常&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Number of dedicated  Hotspares: 0&lt;/td&gt;
      &lt;td&gt;阵列是否有专用/独享热备盘（如果有多个逻辑磁盘组/disk group，则可以指定一个硬盘用于全局热备，那么该disk group上的专用热备盘数量为0也不用担心），除了RAID  1/RAID 1+0一般不指定热备盘以外，其他几个阵列级别建议都要指定热备盘&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;State : Optimal&lt;/td&gt;
      &lt;td&gt;阵列状态，如果不是 Optimal 就要关注了&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Current Cache  Policy: WriteBack, ReadAheadNone, Direct, Write Cache OK if Bad BBU&lt;/td&gt;
      &lt;td&gt;阵列读写cache策略，建议写策略设置为FORCE WB，最起码是WB，预读策略可以关掉，意义不大，几乎没影响&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Disk Cache Policy :  Disabled&lt;/td&gt;
      &lt;td&gt;硬盘cache策略，建议关闭，防止意外时数据丢失&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Current Power  Savings Policy: None&lt;/td&gt;
      &lt;td&gt;节电策略，建议关闭&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Media Error Count:  0&lt;/td&gt;
      &lt;td&gt;三个错误计数器，任何一个值大于100就要立刻引起关注，尤其要关注起增长速度。1T以上SATA盘，计数值不够精确，可能所有盘上该值都会大于0，一般重启就会重新清0，如果重启后还是大于0的话，赶紧报修吧。SAS盘的计数值则比较准确。&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Other Error Count:  0&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Predictive Failure  Count: 0&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Firmware state:  Online, Spun Up&lt;/td&gt;
      &lt;td&gt;查看硬盘状态，如果是unconfigured表示该硬盘未分配加入到阵列中；如果是  unconfigured(bad)表示该盘不但是未分配，而且还坏了，正是“出师未捷身先死”；如果是failed，表示该盘故障无法识别；如果是  rebuilding，表示该盘正在重建数据&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h3 id=&quot;megacli--adpbbucmd--aall--查看阵列卡电池信息&quot;&gt;MegaCli -adpbbucmd -aall — 查看阵列卡电池信息&lt;/h3&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;&lt;strong&gt;状态值&lt;/strong&gt;&lt;/th&gt;
      &lt;th&gt;&lt;strong&gt;对应含义&lt;/strong&gt;&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;Temperature: 39 C&lt;/td&gt;
      &lt;td&gt;查看电池温度，如果相比上一次查看高出不少，就需要关注了，或者可以根据经验设置一个基线值&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Battery State:  Optimal&lt;/td&gt;
      &lt;td&gt;电池状态，如果不是为Optimal，就需要关注了&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Charger Status:  Complete&lt;/td&gt;
      &lt;td&gt;电池充放电状态&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;isSOHGood: Yes&lt;/td&gt;
      &lt;td&gt;电池状态，如果不是为Yes，需要关注&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Relative State of  Charge: 93 %&lt;/td&gt;
      &lt;td&gt;当前电量，当电量低于15%，或者电池坏掉时，默认都会将写策略从WB改成WT，除非设定为FORCE WB策略&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Max Error = 0 %&lt;/td&gt;
      &lt;td&gt;电池是否有错误信息&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Next Learn time:  Tue Oct 14 22:06:50 2014&lt;/td&gt;
      &lt;td&gt;电池充放电时间，注意这是美国时间。另外，新的阵列卡电池很多改成电容式的了，也就不需要重复充放电了&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h2 id=&quot;lsiutil工具&quot;&gt;lsiutil工具&lt;/h2&gt;

&lt;p&gt;lsiutil有交互和非交互两种方式，作为监控，我们肯定选择非交互模式。想要使用交互模式的，可以根据非交互模式自行练习。&lt;/p&gt;

&lt;h3 id=&quot;lsiutil--p-1--a-201200--查看硬盘计数器&quot;&gt;lsiutil -p 1 -a 20,12,0,0 — 查看硬盘计数器&lt;/h3&gt;

&lt;p&gt;Invalid DWord Count 2,563 — 任何一个值大于0，都需要引起关注&lt;/p&gt;

&lt;p&gt;Running Disparity Error Count 2,366&lt;/p&gt;

&lt;p&gt;Loss of DWord Synch Count 0&lt;/p&gt;

&lt;p&gt;Phy Reset Problem Count 0&lt;/p&gt;

&lt;h3 id=&quot;lsiutil--p-1--a-211000--查看逻辑卷状态&quot;&gt;lsiutil -p 1 -a 21,1,0,0,0 — 查看逻辑卷状态&lt;/h3&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;&lt;strong&gt;状态值&lt;/strong&gt;&lt;/th&gt;
      &lt;th&gt;&lt;strong&gt;对应含义&lt;/strong&gt;&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;Volume State:  optimal, enabled&lt;/td&gt;
      &lt;td&gt;逻辑卷健康状况&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Volume draws from  Hot Spare Pools: 0&lt;/td&gt;
      &lt;td&gt;是否有热备&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Volume Size 139392  MB, 2 Members&lt;/td&gt;
      &lt;td&gt;由几块硬盘组成&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Primary is PhysDisk  1 (Bus 0 Target 9)&lt;/td&gt;
      &lt;td&gt;物理硬盘1&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Secondary is  PhysDisk 0 (Bus 0 Target 3)&lt;/td&gt;
      &lt;td&gt;物理硬盘0&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h3 id=&quot;lsiutil--p-1--a-212000--查看物理硬盘状态&quot;&gt;lsiutil -p 1 -a 21,2,0,0,0 — 查看物理硬盘状态&lt;/h3&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;&lt;strong&gt;状态值&lt;/strong&gt;&lt;/th&gt;
      &lt;th&gt;&lt;strong&gt;对应含义&lt;/strong&gt;&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;PhysDisk 0 is Bus 0  Target 3&lt;/td&gt;
      &lt;td&gt;编号&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;PhysDisk State:  online&lt;/td&gt;
      &lt;td&gt;状态&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Error Count 13,  Last Error: Command = 28h, Key = 3, ASC/ASCQ = 11h/00h&lt;/td&gt;
      &lt;td&gt;错误计数器，大于0的话，就需要引起关注&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h2 id=&quot;hpacucli工具&quot;&gt;hpacucli工具&lt;/h2&gt;

&lt;p&gt;hpacucli工具查看阵列、硬盘、电池信息，其实就只要一条指令：&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;hpacucli ctrl all show config detail — 查看阵列详细信息、配置&lt;/strong&gt;&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;&lt;strong&gt;状态值&lt;/strong&gt;&lt;/th&gt;
      &lt;th&gt;&lt;strong&gt;对应含义&lt;/strong&gt;&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;Controller Status:  OK&lt;/td&gt;
      &lt;td&gt;阵列卡状态&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Firmware Version:  1.18&lt;/td&gt;
      &lt;td&gt;firmware版本，太低了建议升级，以提高稳定性及性能&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Cache Board  Present: True&lt;/td&gt;
      &lt;td&gt;是否配备了cache模块&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Cache Status: OK&lt;/td&gt;
      &lt;td&gt;cache模块状态&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Cache Ratio: 100%  Read / 0% Write&lt;/td&gt;
      &lt;td&gt;cache策略，此处只有读cache，不用于写cache，因为没有bbu电池，见下方结果&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Drive Write Cache:  Disabled&lt;/td&gt;
      &lt;td&gt;关闭磁盘cache&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Total Cache Size:  256 MB&lt;/td&gt;
      &lt;td&gt;cache大小&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Total Cache Memory  Available: 208 MB&lt;/td&gt;
      &lt;td&gt;实际可用cache大小，和理论cache大小不一样，说明cache模块可能有问题&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;No-Battery Write  Cache: Disabled&lt;/td&gt;
      &lt;td&gt;关闭FORCEWB策略&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Battery/Capacitor  Count: 0&lt;/td&gt;
      &lt;td&gt;阵列卡BBU电池数量为0，也就是没有BBU模块&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Battery/Capacitor  Status: Failed (Replace Batteries)&lt;/td&gt;
      &lt;td&gt;阵列卡BBU电池状态，这里显示是错误状态，需要及时更换&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Array: A&lt;/td&gt;
      &lt;td&gt;第一个乌列阵列，编号从A开始，依次是A、B、C&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Status: OK&lt;/td&gt;
      &lt;td&gt;物理阵列状态&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Logical Drive: 1&lt;/td&gt;
      &lt;td&gt;第一个逻辑卷，编号从1开始&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Fault Tolerance:  RAID 5&lt;/td&gt;
      &lt;td&gt;第一个逻辑卷的阵列级别&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Status: OK&lt;/td&gt;
      &lt;td&gt;第一个逻辑卷状态&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Caching: Enabled&lt;/td&gt;
      &lt;td&gt;第一个逻辑卷是否启用了cache策略&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;physicaldrive  1I:1:1&lt;/td&gt;
      &lt;td&gt;第一块物理硬盘，编号从1开始&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Status: OK&lt;/td&gt;
      &lt;td&gt;第一块物理硬盘状态&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Firmware Revision:  HPDA&lt;/td&gt;
      &lt;td&gt;第一块物理硬盘firmware，如果太低，也需要及时升级，HP的硬盘每个批次都有不同的firmware&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h1 id=&quot;megacli实践&quot;&gt;Megacli实践&lt;/h1&gt;

&lt;h2 id=&quot;查看有风险的盘&quot;&gt;查看有风险的盘&lt;/h2&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;/opt/MegaRAID/MegaCli/MegaCli64 -LDPDinfo -A0 |grep &quot;Device Id&quot; |awk '{print $3}' |xargs -I {} smartctl -a -d megaraid,{} /dev/sdc |grep -Ei &quot;^187|^188|^197|^198|Reallocated_Sector_Ct&quot; | xargs -I{} echo {}&lt;/code&gt;&lt;/p&gt;

&lt;h2 id=&quot;查看磁盘的smart信息&quot;&gt;查看磁盘的smart信息&lt;/h2&gt;

&lt;p&gt;如果磁盘在RAID卡上：&lt;/p&gt;

&lt;p&gt;（1）先获取磁盘的device id&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;/opt/MegaRAID/MegaCli/MegaCli64 PDList aall&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;这里的输出，会有ES信息，同时还会有device id&lt;/p&gt;

&lt;p&gt;（2）根据device id，查询smart信息&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;smartctl -a -d megaraid,11 /dev/sdc&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;这里的11就是磁盘的device id，哪怕后面的/dev/sdc不存在，获取是这颗磁盘不属于sdc，也能输出正确的信息，只要device id是正确的就行。&lt;/p&gt;

&lt;p&gt;如果不在RAID卡上，直接&lt;code class=&quot;highlighter-rouge&quot;&gt;smartctl -a /dev/sdc&lt;/code&gt;&lt;/p&gt;

&lt;h2 id=&quot;手工配置初始化&quot;&gt;手工配置初始化&lt;/h2&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;/opt/MegaRAID/MegaCli/MegaCli64 -LDInit -start –L0 -a0         # 快速初始化

/opt/MegaRAID/MegaCli/MegaCli64 -LDInit -start -full –L0 -a0     # 完全初始化

/opt/MegaRAID/MegaCli/MegaCli64 -LDInit -progdsply -L0 -a0      # 显示初始化的进度

/opt/MegaRAID/MegaCli/MegaCli64 -LDInit -abort -L0 -a0        # 结束完全初始化

/opt/MegaRAID/MegaCli/MegaCli64 -LDBI -Abort -LALL -aALL # 忽略初始化

/opt/MegaRAID/MegaCli/MegaCli64 -LDBI -ProgDsply -LALL -aALL
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;设置raid-cache&quot;&gt;设置RAID cache&lt;/h2&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;/opt/MegaRAID/MegaCli/MegaCli64 -ldinfo -l1 -a0

/opt/MegaRAID/MegaCli/MegaCli64 -ldsetprop cached -l1 -a0

/opt/MegaRAID/MegaCli/MegaCli64 -ldinfo -l1 -a0

&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;显示rebuid进度&quot;&gt;显示Rebuid进度&lt;/h2&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;/opt/MegaRAID/MegaCli/MegaCli64 -PDRbld -ShowProg -physdrv[20:2] -aALL&lt;/code&gt;&lt;/p&gt;

&lt;h2 id=&quot;查看e-s&quot;&gt;查看E S&lt;/h2&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;/opt/MegaRAID/MegaCli/MegaCli64 -PDList -aAll -NoLog | grep -Ei &quot;(enclosure|slot)&quot;&lt;/code&gt;&lt;/p&gt;

&lt;h2 id=&quot;查看所有硬盘的状态&quot;&gt;查看所有硬盘的状态&lt;/h2&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;/opt/MegaRAID/MegaCli/MegaCli64 -PDList -aAll -NoLog &lt;/code&gt;&lt;/p&gt;

&lt;p&gt;如果有热备，则 Firmware State会显示为hotspace&lt;/p&gt;

&lt;h2 id=&quot;查看copyback进度&quot;&gt;查看copyback进度&lt;/h2&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;/opt/MegaRAID/MegaCli/MegaCli64 -PDCpyBk -ShowProg -PhysDrv[33:3] -a0&lt;/code&gt;&lt;/p&gt;

&lt;h2 id=&quot;查看所有virtual-disk的状态&quot;&gt;查看所有Virtual Disk的状态&lt;/h2&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;/opt/MegaRAID/MegaCli/MegaCli64 -LdPdInfo -aAll -NoLog&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;RAID Level对应关系：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;RAID Level : Primary-1, Secondary-0, RAID Level Qualifier-0	RAID 1
RAID Level : Primary-0, Secondary-0, RAID Level Qualifier-0	RAID 0
RAID Level : Primary-5, Secondary-0, RAID Level Qualifier-3	RAID 5
RAID Level : Primary-1, Secondary-3, RAID Level Qualifier-0	RAID 10

&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;在线做raid&quot;&gt;在线做Raid&lt;/h2&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;/opt/MegaRAID/MegaCli/MegaCli64 -CfgLdAdd -r0 [0:11] WB NORA Direct CachedBadBBU -strpsz64 -a0 -NoLog
/opt/MegaRAID/MegaCli/MegaCli64 -CfgLdAdd -r5 [12:2,12:3,12:4,12:5,12:6,12:7] WB Direct -a0 
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;让硬盘led灯闪烁定位&quot;&gt;让硬盘LED灯闪烁（定位）&lt;/h2&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;    1、  MegaCli  -AdpSetProp UseDiskActivityforLocate -1 -a0 
    2、  MegaCli  -PdLocate  -start  –physdrv[E:S]  -a0  让硬盘LED灯闪烁
    3、  MegaCli  -PdLocate  -stopt  –physdrv[E:S]  -a0 停掉硬盘LED灯
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;清除foreign状态&quot;&gt;清除Foreign状态&lt;/h2&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;/opt/MegaRAID/MegaCli/MegaCli64 -CfgForeign -Clear -a0&lt;/code&gt;&lt;/p&gt;

&lt;h2 id=&quot;查看raid阵列中掉线的盘&quot;&gt;查看RAID阵列中掉线的盘&lt;/h2&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;/opt/MegaRAID/MegaCli/MegaCli64 -pdgetmissing -a0&lt;/code&gt;&lt;/p&gt;

&lt;h2 id=&quot;替换坏掉的模块&quot;&gt;替换坏掉的模块&lt;/h2&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;/opt/MegaRAID/MegaCli/MegaCli64 -pdreplacemissing -physdrv[12:10] -Array5 -row0 -a0&lt;/code&gt;&lt;/p&gt;

&lt;h2 id=&quot;手动开启rebuid&quot;&gt;手动开启rebuid&lt;/h2&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;/opt/MegaRAID/MegaCli/MegaCli64 -pdrbld -start -physdrv[12:10] -a0&lt;/code&gt;&lt;/p&gt;

&lt;h2 id=&quot;设置hotspare&quot;&gt;设置HotSpare&lt;/h2&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;/opt/MegaRAID/MegaCli/MegaCli64 -pdhsp -set [-Dedicated [-Array2]] [-EnclAffinity] [-nonRevertible] -PhysDrv[4:11] -a0
/opt/MegaRAID/MegaCli/MegaCli64 -pdhsp -set [-EnclAffinity] [-nonRevertible] -PhysDrv[32：1}] -a0
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;关闭rebuild&quot;&gt;关闭Rebuild&lt;/h2&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;/opt/MegaRAID/MegaCli/MegaCli64 -AdpAutoRbld -Dsbl -a0&lt;/code&gt;&lt;/p&gt;

&lt;h2 id=&quot;设置rebuild的速率&quot;&gt;设置rebuild的速率&lt;/h2&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;/opt/MegaRAID/MegaCli/MegaCli64 -AdpSetProp RebuildRate -30 -a0&lt;/code&gt;&lt;/p&gt;

&lt;h2 id=&quot;查看raid组成员&quot;&gt;查看RAID组成员&lt;/h2&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;/opt/MegaRAID/MegaCli/MegaCli64  -LdPdInfo -aAll&lt;/code&gt;&lt;/p&gt;

&lt;h2 id=&quot;强制修改raid卡由write-through到write-back-方法&quot;&gt;强制修改RAID卡由write through到write back 方法&lt;/h2&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;opt/MegaRAID/MegaCli/MegaCli64 -LDSetProp CachedBadBBU -Lall -aALL&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;一般在没有BBU情况下， 要执行如下命令进行修改：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;/opt/MegaRAID/MegaCli/MegaCli64 -ldsetprop WB -lall -aall;

/opt/MegaRAID/MegaCli/MegaCli64 -LDSetProp CachedBadBBU -Lall -aALL;

/opt/MegaRAID/MegaCli/MegaCli64 ldinfo lall aall
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;查raid卡信息&quot;&gt;查raid卡信息&lt;/h2&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;/opt/MegaRAID/MegaCli/MegaCli64 -AdpAllInfo -aALL&lt;/code&gt;&lt;/p&gt;

&lt;h2 id=&quot;查看电池信息&quot;&gt;查看电池信息&lt;/h2&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;/opt/MegaRAID/MegaCli/MegaCli64 -AdpBbuCmd -aAll&lt;/code&gt;&lt;/p&gt;

&lt;h2 id=&quot;查看raid卡日志&quot;&gt;查看raid卡日志&lt;/h2&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;/opt/MegaRAID/MegaCli/MegaCli64 -FwTermLog -Dsply -aALL&lt;/code&gt;&lt;/p&gt;

&lt;h2 id=&quot;显示适配器个数&quot;&gt;显示适配器个数&lt;/h2&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;/opt/MegaRAID/MegaCli/MegaCli64 -adpCount&lt;/code&gt;&lt;/p&gt;

&lt;h2 id=&quot;显示适配器时间&quot;&gt;显示适配器时间&lt;/h2&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;/opt/MegaRAID/MegaCli/MegaCli64 -AdpGetTime –aALL&lt;/code&gt;&lt;/p&gt;

&lt;h2 id=&quot;显示所有适配器信息&quot;&gt;显示所有适配器信息&lt;/h2&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;/opt/MegaRAID/MegaCli/MegaCli64 -AdpAllInfo -aAll&lt;/code&gt;&lt;/p&gt;

&lt;h2 id=&quot;显示所有逻辑磁盘组信息&quot;&gt;显示所有逻辑磁盘组信息&lt;/h2&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;/opt/MegaRAID/MegaCli/MegaCli64 -LDInfo -LALL -aAll &lt;/code&gt;&lt;/p&gt;

&lt;h2 id=&quot;显示所有的物理信息&quot;&gt;显示所有的物理信息&lt;/h2&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;/opt/MegaRAID/MegaCli/MegaCli64 -PDList -aAll&lt;/code&gt;&lt;/p&gt;

&lt;h2 id=&quot;查看充电状态&quot;&gt;查看充电状态&lt;/h2&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;/opt/MegaRAID/MegaCli/MegaCli64 -AdpBbuCmd -GetBbuStatus -aALL |grep 'Charger Status'&lt;/code&gt;&lt;/p&gt;

&lt;h2 id=&quot;显示bbu状态信息&quot;&gt;显示BBU状态信息&lt;/h2&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;/opt/MegaRAID/MegaCli/MegaCli64 -AdpBbuCmd -GetBbuStatus -aALL&lt;/code&gt;&lt;/p&gt;

&lt;h2 id=&quot;显示bbu容量信息&quot;&gt;显示BBU容量信息&lt;/h2&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;/opt/MegaRAID/MegaCli/MegaCli64 -AdpBbuCmd -GetBbuCapacityInfo -aALL&lt;/code&gt;&lt;/p&gt;

&lt;h2 id=&quot;显示bbu设计参数&quot;&gt;显示BBU设计参数&lt;/h2&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;/opt/MegaRAID/MegaCli/MegaCli64 -AdpBbuCmd -GetBbuDesignInfo -aALL&lt;/code&gt;&lt;/p&gt;

&lt;h2 id=&quot;显示当前bbu属性&quot;&gt;显示当前BBU属性&lt;/h2&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;/opt/MegaRAID/MegaCli/MegaCli64 -AdpBbuCmd -GetBbuProperties -aALL&lt;/code&gt;&lt;/p&gt;

&lt;h2 id=&quot;显示raid卡型号raid设置disk相关信息&quot;&gt;显示Raid卡型号，Raid设置，Disk相关信息&lt;/h2&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;/opt/MegaRAID/MegaCli/MegaCli64-cfgdsply -aALL&lt;/code&gt;&lt;/p&gt;

&lt;h2 id=&quot;磁盘状态的变化从拔盘到插盘的过程中&quot;&gt;磁盘状态的变化，从拔盘，到插盘的过程中&lt;/h2&gt;

&lt;p&gt;Device             : Normal –&amp;gt; Damage –&amp;gt; Rebuild –&amp;gt; Normal&lt;/p&gt;

&lt;p&gt;Virtual Drive      : Optimal –&amp;gt; Degraded –&amp;gt; Degraded –&amp;gt; Optimal&lt;/p&gt;

&lt;p&gt;Physical Drive     : Online –&amp;gt; Failed Unconfigured –&amp;gt; Rebuild –&amp;gt; Online&lt;/p&gt;

&lt;h2 id=&quot;查看物理磁盘状态&quot;&gt;查看物理磁盘状态&lt;/h2&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;/opt/MegaRAID/MegaCli/MegaCli64 -PDRbld -ShowProg -PhysDrv [Enclosure Device ID:Slot Number] -a0&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;Rebuild 中的物理磁盘状态中会显示：”Firmware state: Rebuild”&lt;/p&gt;

&lt;h2 id=&quot;以文本进度条样式显示-rebuild-进度&quot;&gt;以文本进度条样式显示 Rebuild 进度&lt;/h2&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;/opt/MegaRAID/MegaCli/MegaCli64-pdrbld -progdsply -physdrv[E:S] -aALL&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;屏幕显示类似下面的内容：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;Rebuild progress of physical drives...
Enclosure:Slot         Percent Complete           Time Elps
     032 :05   #######################87 %################*******  01:59:07

&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;查看-raid-卡-rebuild-参数&quot;&gt;查看 RAID 卡 Rebuild 参数&lt;/h2&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;/opt/MegaRAID/MegaCli/MegaCli64-AdpAllinfo -aALL | grep -i rebuild&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;返回结果类似下面这样&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;Rebuild Rate                             : 30%
Auto Rebuild                             : Enabled
Rebuild Rate                             : Yes
Force Rebuild                            : Yes
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;设置-raid-卡-rebuild-比例为60&quot;&gt;设置 RAID 卡 Rebuild 比例为60%&lt;/h2&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;/opt/MegaRAID/MegaCli/MegaCli64-AdpSetProp { RebuildRate -60} -aALL&lt;/code&gt;&lt;/p&gt;

&lt;h2 id=&quot;删除全局热备&quot;&gt;删除全局热备&lt;/h2&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;/opt/MegaRAID/MegaCli/MegaCli64-PDHSP -Rmv -PhysDrv[E:S] -a0&lt;/code&gt;&lt;/p&gt;

&lt;h2 id=&quot;将物理盘下线和上线&quot;&gt;将物理盘下线和上线&lt;/h2&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;/opt/MegaRAID/MegaCli/MegaCli64 -PDOffline/Online -PhysDrv [E:S] -a0&lt;/code&gt;&lt;/p&gt;

&lt;h2 id=&quot;在线添加磁盘&quot;&gt;在线添加磁盘&lt;/h2&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;/opt/MegaRAID/MegaCli/MegaCli64-LDRecon -Start -r5 -Add -PhysDrv[E:S] -L1 -a0&lt;/code&gt;&lt;/p&gt;

&lt;h2 id=&quot;删除阵列&quot;&gt;删除阵列&lt;/h2&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;/opt/MegaRAID/MegaCli/MegaCli64 -CfgLdDel -L1 -a0&lt;/code&gt;&lt;/p&gt;

&lt;h2 id=&quot;查看磁盘缓存策略&quot;&gt;查看磁盘缓存策略&lt;/h2&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;/opt/MegaRAID/MegaCli/MegaCli64-LDGetProp -DskCache -LALL -aALL&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;or&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;/opt/MegaRAID/MegaCli/MegaCli64 -LDGetProp -Cache -LALL -aALL&lt;/code&gt;&lt;/p&gt;

&lt;h2 id=&quot;查看raid卡event-log&quot;&gt;查看raid卡event log&lt;/h2&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;/opt/MegaRAID/MegaCli/MegaCli64 -AdpEventLog -GetEvents -f event.log -A0&lt;/code&gt;&lt;/p&gt;

&lt;h2 id=&quot;查看megacli的log&quot;&gt;查看Megacli的log&lt;/h2&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;/opt/MegaRAID/MegaCli/MegaCli64 -fwtermlog -dsply -aALL&lt;/code&gt; ，关注里面的error/fail/warn等多个关键字&lt;/p&gt;

&lt;h2 id=&quot;查看raid卡时间&quot;&gt;查看raid卡时间&lt;/h2&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;/opt/MegaRAID/MegaCli/MegaCli64 -AdpGetTime -A0 ; date&lt;/code&gt;&lt;/p&gt;</content><author><name>Gavin</name></author><category term="Megacli" /><summary type="html">概述</summary></entry><entry><title type="html">更改pip&amp;amp;easy_install默认安装源</title><link href="http://172.17.73.80:4000/2020/05/05/change-pip-install-source/" rel="alternate" type="text/html" title="更改pip&amp;easy_install默认安装源" /><published>2020-05-05T00:00:00+08:00</published><updated>2020-05-05T00:00:00+08:00</updated><id>http://172.17.73.80:4000/2020/05/05/change-pip-install-source</id><content type="html" xml:base="http://172.17.73.80:4000/2020/05/05/change-pip-install-source/">&lt;h1 id=&quot;概述&quot;&gt;概述&lt;/h1&gt;

&lt;p&gt;pip默认安装源来自国外，很多时候由于墙的原因，导致下载很慢，或者超时，为了解决这个问题，尝试修改了pip默认安装源（具体操作下文介绍）。但在更改默认源后，如果被安装的包有依赖，需要先安装依赖的包，但这个依赖包还是使用的默认源。本文介绍如何解决这些问题。&lt;/p&gt;

&lt;p&gt;说明：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;本文以Ubuntu OS为例进行文档描述。&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;pip-与easy_install&quot;&gt;pip 与easy_install&lt;/h1&gt;

&lt;p&gt;这两个都是Python的包管理工具，简单来说pip是easy_install的升级版，推荐优先使用pip。&lt;/p&gt;

&lt;p&gt;如果python通过源码setup.py文件进行安装，如python setup.py install xxx，那么其安装所依赖包的下载镜像源的配置文件为easy_install的配置，所以即便修改了pip的下载镜像配置文件(e.g:~/.pip/pip.conf)是没有效果的，要修改~/.pydistutils.cfg才能起作用，具体方式在下文说明。&lt;/p&gt;

&lt;h1 id=&quot;国内安装源&quot;&gt;国内安装源&lt;/h1&gt;

&lt;h2 id=&quot;安装源列表&quot;&gt;安装源列表&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;阿里：https://mirrors.aliyun.com/pypi/simple&lt;/li&gt;
  &lt;li&gt;豆瓣：http://pypi.douban.com/simple/&lt;/li&gt;
  &lt;li&gt;清华大学：https://pypi.tuna.tsinghua.edu.cn/simple&lt;/li&gt;
  &lt;li&gt;中国科学技术大学： https://pypi.mirrors.ustc.edu.cn/simple&lt;/li&gt;
  &lt;li&gt;华中理工大学： http://pypi.hustunique.com/simple&lt;/li&gt;
  &lt;li&gt;山东理工大学： http://pypi.sdutlinux.org/simple&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;测速&quot;&gt;测速&lt;/h2&gt;

&lt;p&gt;阿里:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;root@pytest-70-97:~# ping -c 3 aliyun.com
PING aliyun.com (140.205.60.46) 56(84) bytes of data.
64 bytes from 140.205.60.46: icmp_seq=1 ttl=44 time=9.64 ms
64 bytes from 140.205.60.46: icmp_seq=2 ttl=44 time=8.91 ms
64 bytes from 140.205.60.46: icmp_seq=3 ttl=44 time=9.25 ms

--- aliyun.com ping statistics ---
3 packets transmitted, 3 received, 0% packet loss, time 2003ms
rtt min/avg/max/mdev = 8.917/9.272/9.647/0.318 ms
root@pytest-70-97:~#
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;豆瓣:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;root@pytest-70-97:~# ping -c 3 douban.com
PING douban.com (154.8.131.171) 56(84) bytes of data.
64 bytes from 154.8.131.171: icmp_seq=1 ttl=49 time=25.7 ms
64 bytes from 154.8.131.171: icmp_seq=2 ttl=49 time=26.3 ms
64 bytes from 154.8.131.171: icmp_seq=3 ttl=49 time=25.8 ms

--- douban.com ping statistics ---
3 packets transmitted, 3 received, 0% packet loss, time 2003ms
rtt min/avg/max/mdev = 25.784/25.981/26.344/0.256 ms
root@pytest-70-97:~# 
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;清华大学:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
11
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;root@pytest-70-97:~# ping -c 3 tuna.tsinghua.edu.cn
PING tuna.tsinghua.edu.cn (101.6.6.172) 56(84) bytes of data.
64 bytes from 101.6.6.172: icmp_seq=1 ttl=47 time=33.8 ms
64 bytes from 101.6.6.172: icmp_seq=2 ttl=47 time=31.3 ms
64 bytes from 101.6.6.172: icmp_seq=3 ttl=47 time=31.4 ms

--- tuna.tsinghua.edu.cn ping statistics ---
3 packets transmitted, 3 received, 0% packet loss, time 11045ms
rtt min/avg/max/mdev = 31.311/32.210/33.874/1.195 ms
root@pytest-70-97:~# 

&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;中国科学技术大学:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;root@pytest-70-97:~# ping -c 3 ustc.edu.cn
PING ustc.edu.cn (202.38.64.246) 56(84) bytes of data.
64 bytes from 202.38.64.246: icmp_seq=1 ttl=49 time=16.6 ms
64 bytes from 202.38.64.246: icmp_seq=2 ttl=49 time=16.2 ms
64 bytes from 202.38.64.246: icmp_seq=3 ttl=49 time=16.5 ms

--- ustc.edu.cn ping statistics ---
3 packets transmitted, 3 received, 0% packet loss, time 11025ms
rtt min/avg/max/mdev = 16.204/16.465/16.602/0.212 ms
root@pytest-70-97:~# 
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;华中理工大学:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;root@pytest-70-97:~# ping -c 3 hustunique.com
PING hustunique.com (129.211.140.244) 56(84) bytes of data.
64 bytes from 129.211.140.244: icmp_seq=1 ttl=53 time=10.4 ms
64 bytes from 129.211.140.244: icmp_seq=2 ttl=53 time=10.1 ms
64 bytes from 129.211.140.244: icmp_seq=3 ttl=53 time=10.3 ms

--- hustunique.com ping statistics ---
3 packets transmitted, 3 received, 0% packet loss, time 11022ms
rtt min/avg/max/mdev = 10.182/10.323/10.415/0.131 ms
root@pytest-70-97:~# 
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;山东理工大学:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
6
7
8
9
10
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;root@pytest-70-97:~# ping -c 3 sdutlinux.org
PING sdutlinux.org (170.178.168.203) 56(84) bytes of data.
64 bytes from becrawl-show.flatreutic.com (170.178.168.203): icmp_seq=1 ttl=51 time=182 ms
64 bytes from becrawl-show.flatreutic.com (170.178.168.203): icmp_seq=2 ttl=51 time=181 ms
64 bytes from becrawl-show.flatreutic.com (170.178.168.203): icmp_seq=3 ttl=51 time=182 ms

--- sdutlinux.org ping statistics ---
3 packets transmitted, 3 received, 0% packet loss, time 2002ms
rtt min/avg/max/mdev = 181.990/182.156/182.343/0.144 ms
root@pytest-70-97:~# 
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;从ping效果上看，还是阿里更快一些，故而本文以阿里pip源为示例进行讲述。&lt;/p&gt;

&lt;h1 id=&quot;修改pip默认安装源&quot;&gt;修改pip默认安装源&lt;/h1&gt;

&lt;h2 id=&quot;方法1-配置方式修改永久有效&quot;&gt;方法1 配置方式修改（永久有效）&lt;/h2&gt;

&lt;p&gt;创建或修改pip.conf文件，如果文件或目录不存在，创建之&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;cd ~
mkdir .pip
cd .pip
vi pip.conf
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;添加如下内容：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
3
4
5
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;[global]
index-url=http://mirrors.aliyun.com/pypi/simple/

[install]
trusted-host=mirrors.aliyun.com
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;方法2-命令方式临时修改&quot;&gt;方法2 命令方式临时修改&lt;/h2&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;pip install -i https://mirrors.aliyun.com/pypi/simple fabric&lt;/code&gt;&lt;/p&gt;

&lt;h1 id=&quot;更改easy_install默认安装源&quot;&gt;更改easy_install默认安装源&lt;/h1&gt;

&lt;p&gt;这个主要是解决开篇提及到的pip安装有依赖包时没有使用指定的源问题。&lt;/p&gt;

&lt;p&gt;打开pydistutils.cfg&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;vi ~/.pydistutils.cfg&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;写入以下内容&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;table class=&quot;rouge-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class=&quot;rouge-gutter gl&quot;&gt;&lt;pre class=&quot;lineno&quot;&gt;1
2
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;rouge-code&quot;&gt;&lt;pre&gt;[easy_install]
index_url = https://mirrors.aliyun.com/pypi/simple
&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h1 id=&quot;安装测试&quot;&gt;安装测试&lt;/h1&gt;

&lt;p&gt;读取了requirements.txt(pip install -r requirements.txt)，安装效果如下：&lt;/p&gt;

&lt;p&gt;&lt;img class=&quot;shadow&quot; src=&quot;/img/in-post/pip_install_test.png&quot; width=&quot;1200&quot; /&gt;&lt;/p&gt;

&lt;p&gt;发现已经不在使用python官方源了，换成了阿里的源。&lt;/p&gt;

&lt;h1 id=&quot;综述&quot;&gt;综述&lt;/h1&gt;

&lt;p&gt;只有同时修改了pip 和 easy_install的默认安装源，才能彻底解决pip install时使用指定安装源。&lt;/p&gt;</content><author><name>Gavin</name></author><category term="JBOD" /><summary type="html">概述</summary></entry></feed>