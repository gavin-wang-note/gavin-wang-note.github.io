<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <meta name="description" content="关于软件测试, 与你一起发现更大的世界">
    <meta name="keywords"  content="Gavin的博客, Gavin Blog, 博客, 个人网站">
    <meta name="theme-color" content="#000000">
    
    <!-- Open Graph -->
    <meta property="og:title" content="pytest allure详解 - Gavin的博客 | Gavin Blog">
    
    <meta property="og:type" content="article">
    <meta property="og:description" content="概述
">
    
    <meta property="article:published_time" content="2021-11-04T00:00:00Z">
    
    
    <meta property="article:author" content="Gavin">
    
    
    <meta property="article:tag" content="pytest">
    
    <meta property="article:tag" content="Automation">
    
    <meta property="article:tag" content="Allure">
    
    
    <meta property="og:image" content="http://0.0.0.0:4000/img/avatar-gavin.jpg">
    <meta property="og:url" content="http://0.0.0.0:4000/2021/11/04/pytest_allure/">
    <meta property="og:site_name" content="Gavin的博客 | Gavin Blog">
    
    <title>pytest allure详解 - Gavin的博客 | Gavin Blog</title>

    <!-- Web App Manifest -->
    <link rel="manifest" href="/pwa/manifest.json">

    <!-- Favicon -->
    <link rel="shortcut icon" href="/img/favicon.ico">
    
    <!-- Canonical URL -->
    <link rel="canonical" href="http://0.0.0.0:4000/2021/11/04/pytest_allure/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/gavin-blog.min.css">

    <!-- Custom Fonts -->
    <!-- <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"> -->
    <!-- Gavin change font-awesome CDN to qiniu -->
    <link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css">


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- ga & ba script hoook -->
    <script></script>
</head>


<!-- hack iOS CSS :active style -->
<body ontouchstart="">

    <!-- Navigation -->

<nav class="navbar navbar-default navbar-custom navbar-fixed-top">

    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Gavin Blog</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div id="gavinblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/index.html">Home</a>
                    </li>
                    
                    
                    
                    
                    <li>
                        <a href="/about/">About</a>
                    </li>
                    
                    
                    
                    <li>
                        <a href="/archive/">Archive</a>
                    </li>
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                </ul>
            </div>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>
<script>
    // Drop Bootstarp low-performance Navbar
    // Use customize navbar with high-quality material design animation
    // in high-perf jank-free CSS3 implementation
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#gavinblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    var __GavinNav__ = {
        close: function(){
            $navbar.className = " ";
            // wait until animation end.
            setTimeout(function(){
                // prevent frequently toggle
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        },
        open: function(){
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }

    // Bind Event
    $toggle.addEventListener('click', function(e){
        if ($navbar.className.indexOf('in') > 0) {
            __GavinNav__.close()
        }else{
            __GavinNav__.open()
        }
    })

    /**
     * Since Fastclick is used to delegate 'touchstart' globally
     * to hack 300ms delay in iOS by performing a fake 'click',
     * Using 'e.stopPropagation' to stop 'touchstart' event from 
     * $toggle/$collapse will break global delegation.
     * 
     * Instead, we use a 'e.target' filter to prevent handler
     * added to document close GavinNav.  
     *
     * Also, we use 'click' instead of 'touchstart' as compromise
     */
    document.addEventListener('click', function(e){
        if(e.target == $toggle) return;
        if(e.target.className == 'icon-bar') return;
        __GavinNav__.close();
    })
</script>


    <!-- Post Header -->



<style type="text/css">
    header.intro-header{
        position: relative;
        background-image: url('/img/home-bg.jpg');
        background: ;
    }

    
</style>

<header class="intro-header" >

    <div class="header-mask"></div>
    
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="tags">
                        
                        <a class="tag" href="/archive/?tag=pytest" title="pytest">pytest</a>
                        
                        <a class="tag" href="/archive/?tag=Automation" title="Automation">Automation</a>
                        
                        <a class="tag" href="/archive/?tag=Allure" title="Allure">Allure</a>
                        
                    </div>
                    <h1>pytest allure详解</h1>
                    
                    <h2 class="subheading">pytest with allure</h2>
                    <span class="meta">Posted by Gavin on November 4, 2021</span>
                </div>
            </div>
        </div>
    </div>
</header>






<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

    <!-- Post Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                <!-- Multi-Lingual -->
                

				<h1 id="概述">概述</h1>

<p>本文基于allure 2.13.2 版本介绍allure在pytest下的基本运用。</p>

<p>关于allure，详见官网： <code class="highlighter-rouge">https://github.com/allure-framework</code>。</p>

<h1 id="allure功能介绍">allure功能介绍</h1>

<h2 id="allure-特性">allure 特性</h2>

<p>allure有如下特性：</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre>C:\Users\Wang&gt;python
Python 3.11.4 (tags/v3.11.4:d2340ef, Jun  7 2021, 05:45:37) [MSC v.1934 64 bit (AMD64)] on win32
Type "help", "copyright", "credits" or "license" for more information.
&gt;&gt;&gt; import allure
&gt;&gt;&gt; dir(allure)
['__all__', '__builtins__', '__cached__', '__doc__', '__file__', '__loader__', '__name__', '__package__', '__spec__', 'attach', 'attachment_type', 'description', 'description_html', 'dynamic', 'epic', 'feature', 'id', 'issue', 'label', 'link', 'manual', 'parameter_mode', 'parent_suite', 'severity', 'severity_level', 'step', 'story', 'sub_suite', 'suite', 'tag', 'testcase', 'title']
&gt;&gt;&gt;
</pre></td></tr></tbody></table></code></pre></div></div>

<p>介绍如下：</p>

<table>
  <thead>
    <tr>
      <th>使用方法</th>
      <th>参数值</th>
      <th>参数说明</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>allure.attach()</td>
      <td>添加附件</td>
      <td>给测试用例添加附件</td>
    </tr>
    <tr>
      <td>allure.attachment_type()</td>
      <td>附件类型</td>
      <td>支持txt/pdf/csv/html/xml/image/video等多种类型</td>
    </tr>
    <tr>
      <td>allure.description()</td>
      <td>用例描述</td>
      <td>传递一个字符串参数用来描述测试用例</td>
    </tr>
    <tr>
      <td>allure.description_html()</td>
      <td>用例描述</td>
      <td>传递一段HTML文本，这将在测试报告的”Description”部分渲染出来</td>
    </tr>
    <tr>
      <td>allure.dynamic()</td>
      <td>动态指定标题和描述</td>
      <td>在测试用例执行过程中动态指定标题和描述等标签的方法，主要指：allure.dynamic.description 和 allure.dynamic.title</td>
    </tr>
    <tr>
      <td>allure.epic()</td>
      <td>epic描述</td>
      <td>敏捷里的概念，定义史诗，相当于module级的标签</td>
    </tr>
    <tr>
      <td>allure.feature()</td>
      <td>模块名称</td>
      <td>功能点的描述，往下是story</td>
    </tr>
    <tr>
      <td>allure.id()</td>
      <td>人为给用例添加id</td>
      <td><strong>貌似添加后没有看到效果，未在实际工作中使用过，尚不知应用场景</strong></td>
    </tr>
    <tr>
      <td>allure.issue()</td>
      <td>缺陷链接</td>
      <td>对应缺陷管理系统里的链接，如将JIRA里Bug的URL展示在html报告中</td>
    </tr>
    <tr>
      <td>allure.label()</td>
      <td>给用例添加label</td>
      <td><strong>貌似添加后没有看到效果，未在实际工作中使用过，尚不知应用场景</strong></td>
    </tr>
    <tr>
      <td>allure.link()</td>
      <td>链接</td>
      <td>定义一个链接，在html报告中展示</td>
    </tr>
    <tr>
      <td>allure.manual()</td>
      <td> </td>
      <td><strong>尚不知具体用途</strong></td>
    </tr>
    <tr>
      <td>allure.parameter_mode()</td>
      <td> </td>
      <td><strong>尚不知具体用途</strong></td>
    </tr>
    <tr>
      <td>allure.parent_suite()</td>
      <td>测试套</td>
      <td>测试套的三个级别，爷爷父亲儿子中的爷爷这个级别</td>
    </tr>
    <tr>
      <td>allure.severity()</td>
      <td>用例级别</td>
      <td>测试用例的优先级别，blocker,critical,normal,minor,trivial 五个级别，使用方式：@allure.severity(“BLOCKER”)</td>
    </tr>
    <tr>
      <td>allure.severity_level()</td>
      <td>用例级别</td>
      <td>测试用例的优先级别，blocker,critical,normal,minor,trivial 五个级别，使用方式：@allure.severity(allure.severity_level.CRITICAL)</td>
    </tr>
    <tr>
      <td>allure.step()</td>
      <td>操作步骤</td>
      <td>测试用例的步骤，Step1，Step2，… StepN标记在用例中</td>
    </tr>
    <tr>
      <td>allure.story()</td>
      <td>用户故事</td>
      <td>用户故事，往下是title</td>
    </tr>
    <tr>
      <td>allure.sub_suite()</td>
      <td>测试套</td>
      <td>测试套的三个级别，爷爷父亲儿子中的儿子这个级别</td>
    </tr>
    <tr>
      <td>allure.suite()</td>
      <td>测试套</td>
      <td>测试套的三个级别，爷爷父亲儿子中的父亲这个级别</td>
    </tr>
    <tr>
      <td>allure.tag()</td>
      <td>Tag</td>
      <td>给用例增加tag</td>
    </tr>
    <tr>
      <td>allure.testcase()</td>
      <td>测试用例的链接</td>
      <td>对应功能/性能测试用例系统里的test case URL，如testlink里的</td>
    </tr>
    <tr>
      <td>allure.title()</td>
      <td>用例的标题</td>
      <td>展示在html报告中的测试用例的标题名称</td>
    </tr>
  </tbody>
</table>

<h2 id="allure-实践">allure 实践</h2>

<h3 id="allure为测试用例添加附件attach">allure为测试用例添加附件（attach）</h3>

<h4 id="allureattach的用法">allure.attach的用法</h4>

<h5 id="用法一">用法一</h5>

<p>语法：</p>

<p><code class="highlighter-rouge">allure.attach(body, name, attachment_type, extension)</code></p>

<p>参数解释：</p>

<ul>
  <li>body：要写入附件的内容</li>
  <li>name：附件名字</li>
  <li>attachment_type：附件类型，是allure.attachment_type其中的一种</li>
  <li>extension：附件的扩展名</li>
</ul>

<h5 id="用法二">用法二</h5>

<p>语法：</p>

<p><code class="highlighter-rouge">allure.attach.file(source, name, attachment_type, extension)</code></p>

<p>参数解释：</p>

<ul>
  <li>source：文件路径，相当于传一个文件</li>
  <li>name：附件名字</li>
  <li>attachment_type：附件类型，是allure.attachment_type其中的一种</li>
  <li>extension：附件的扩展名</li>
</ul>

<h4 id="allureattachment_type的所有值">allure.attachment_type的所有值</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre></td><td class="rouge-code"><pre>    TEXT = ("text/plain", "txt")
    CSV = ("text/csv", "csv")
    TSV = ("text/tab-separated-values", "tsv")
    URI_LIST = ("text/uri-list", "uri")
    HTML = ("text/html", "html")

    XML = ("application/xml", "xml")
    JSON = ("application/json", "json")
    YAML = ("application/yaml", "yaml")
    PCAP = ("application/vnd.tcpdump.pcap", "pcap")
    PDF = ("application/pdf", "pdf")

    PNG = ("image/png", "png")
    JPG = ("image/jpg", "jpg")
    SVG = ("image/svg-xml", "svg")
    GIF = ("image/gif", "gif")
    BMP = ("image/bmp", "bmp")
    TIFF = ("image/tiff", "tiff")

    MP4 = ("video/mp4", "mp4")
    OGG = ("video/ogg", "ogg")
    WEBM = ("video/webm", "webm")
</pre></td></tr></tbody></table></code></pre></div></div>

<h4 id="allureattach使用举例">allure.attach使用举例</h4>

<h5 id="测试用例中添加文本附件">测试用例中添加文本附件</h5>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="rouge-code"><pre><span class="c1">#!/usr/bin/env python
# -*- coding:GB2312 -*-
</span>
<span class="kn">import</span> <span class="nn">pytest</span>
<span class="kn">import</span> <span class="nn">allure</span>


<span class="o">@</span><span class="n">pytest</span><span class="p">.</span><span class="n">fixture</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">attach_for_text</span><span class="p">():</span>
    <span class="n">allure</span><span class="p">.</span><span class="n">attach</span><span class="p">(</span><span class="n">body</span><span class="o">=</span><span class="s">"前置条件，这是一段文本"</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">"Test文本01"</span><span class="p">,</span> <span class="n">attachment_type</span><span class="o">=</span><span class="n">allure</span><span class="p">.</span><span class="n">attachment_type</span><span class="p">.</span><span class="n">TEXT</span><span class="p">)</span>
    <span class="k">yield</span>
    <span class="n">allure</span><span class="p">.</span><span class="n">attach</span><span class="p">(</span><span class="n">body</span><span class="o">=</span><span class="s">"后置条件，这是一段文本"</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">"Test文本02"</span><span class="p">,</span> <span class="n">attachment_type</span><span class="o">=</span><span class="n">allure</span><span class="p">.</span><span class="n">attachment_type</span><span class="p">.</span><span class="n">TEXT</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">test_attachment_text</span><span class="p">(</span><span class="n">attach_for_text</span><span class="p">):</span>
    <span class="k">assert</span> <span class="bp">True</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>效果如下图所示：</p>

<p><img class="shadow" src="/img/in-post/allure/attach_text.png" width="1200" /></p>

<h5 id="测试用例中添加html附件">测试用例中添加html附件</h5>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="rouge-code"><pre>def test_mutiple_attachments():
    allure.attach.file(r"C:\Users\Wang\Pictures\OIP-C.jpg", attachment_type=allure.attachment_type.JPG)

    allure.attach("""<span class="cp">&lt;!doctype html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"en-US"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"utf-8"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"viewport"</span> <span class="na">content=</span><span class="s">"width=device-width"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;title&gt;</span>My test page<span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">"https://ts1.cn.mm.bing.net/th/id/R-C.2c7e4d41fc29592168145efb4c27f825?rik=EfVURrooBsEe%2bg&amp;riu=http%3a%2f%2fimg.juimg.com%2ftuku%2fyulantu%2f110611%2f9120-110611114P085.jpg&amp;ehk=ruz2W6AZs%2bLUNeJ83%2ferKheRxWYQyYFYt5GGHhnu4BI%3d&amp;risl=&amp;pid=ImgRaw&amp;r=0"</span> <span class="na">alt=</span><span class="s">"My test image"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
""",
attachment_type=allure.attachment_type.HTML)
</pre></td></tr></tbody></table></code></pre></div></div>

<p>效果如下图所示：</p>

<p><img class="shadow" src="/img/in-post/allure/attach_image.png" width="1200" /></p>

<p>如上图所示，html部分可以嵌套图片，也可以写静态文本。</p>

<h3 id="allure添加测试用例步骤allurestep">allure添加测试用例步骤(allure.step)</h3>

<p>在编写自动化测试用例的时候经常会遇到需要编写流程性测试用例的场景，一般流程性的测试用例的测试步骤比较多，在测试用例中添加详细的步骤会<strong>提高测试用例的可阅读性</strong>。</p>

<p>allure提供的装饰器@allure.step()是allure测试报告框架非常有用的功能，它能帮助我们在测试用例中对测试步骤进行详细的描述。</p>

<p>代码示例：</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
</pre></td><td class="rouge-code"><pre>    def test_566_rollback_snapshot(self):
        """  Sc-566:Snapshot can be rollbacked correctly  """
        with allure.step("Clean unavailable link device"):
            self.client_unlink_unavailable_device_link(self.client_ip_root_password, self.ssh_port, self.client_ip)

        with allure.step("Client umount mount point"):
            self.client_umount_san_device(gateway_group=self.gateway_group, target_id=self.target_id,
                                          iscsi_id=self.iscsi_id, password=self.client_ip_root_password,
                                          port=self.ssh_port, client_ip=self.client_ip,
                                          mount_point=self.mount_point, check_device=False)
        with allure.step("Client login target"):
            self.client_login_logout_target(self.client_ip_root_password, self.ssh_port,
                                            self.client_ip, self.target_id, op_type='logout')
            self.client_login_logout_target(self.client_ip_root_password, self.ssh_port,
                                            self.client_ip, self.target_id, op_type='login')

        with allure.step("Client mkfs the device, then input a file, and get the md5 for the file"):
            self.client_mkfs_san_device(gateway_group=self.gateway_group, target_id=self.target_id,
                                        iscsi_id=self.iscsi_id, password=self.client_ip_root_password,
                                        port=self.ssh_port, client_ip=self.client_ip)
            self.client_mount_san_device(gateway_group=self.gateway_group, target_id=self.target_id,
                                         iscsi_id=self.iscsi_id, password=self.client_ip_root_password,
                                         port=self.ssh_port, client_ip=self.client_ip,
                                         mount_point=self.mount_point)

        with allure.step("Copy some files to the mapped drive"):
            self.client_write_file_to_san(password=self.client_ip_root_password, port=self.ssh_port,
                                          client_ip=self.client_ip, mount_point=self.mount_point,
                                          file_name='before_snap.txt', file_content='before_snap')
        time.sleep(60)
        before_md5 = self.get_file_md5(password=self.client_ip_root_password, port=self.ssh_port,
                                       client_ip=self.client_ip, mount_point=self.mount_point,
                                       file_name='before_snap.txt')

        with allure.step("Take a snapshot"):
            self.create_snapshot(gateway_group=self.gateway_group, target_id=self.target_id,
                                 iscsi_id=self.iscsi_id, snap_name='pytest-snapshot02')

        with allure.step("Client umount mount point,"):
            #  if no this step, when logout target will raise in use error in centos
            self.client_umount_san_device(gateway_group=self.gateway_group, target_id=self.target_id,
                                          iscsi_id=self.iscsi_id, password=self.client_ip_root_password,
                                          port=self.ssh_port, client_ip=self.client_ip,
                                          mount_point=self.mount_point, check_device=False)

        with allure.step("Client disconnect the target"):
            self.client_login_logout_target(password=self.client_ip_root_password, port=self.ssh_port,
                                            client_ip=self.client_ip, target_id=self.target_id,
                                            op_type='logout')

        with allure.step("Disable the volume, then rollback snapshot"):
            self.disable_iscsi_volume(target_id=self.target_id, iscsi_id=self.iscsi_id)
            self.rollback_snap(gateway_group=self.gateway_group, target_id=self.target_id,
                               iscsi_id=self.iscsi_id)

        with allure.step("Enable the volume"):
            self.enable_iscsi_volume(gateway_group=self.gateway_group, target_id=self.target_id,
                                     iscsi_id=self.iscsi_id)

        with allure.step("Client connect to the target"):
            self.client_login_logout_target(password=self.client_ip_root_password, port=self.ssh_port,
                                            client_ip=self.client_ip, target_id=self.target_id,
                                            op_type='login')


            self.client_mount_san_device(gateway_group=self.gateway_group, target_id=self.target_id,
                                         iscsi_id=self.iscsi_id, password=self.client_ip_root_password,
                                         port=self.ssh_port, client_ip=self.client_ip,
                                         mount_point=self.mount_point)

        # Get file of md5
        after_md5 = self.get_file_md5(password=self.client_ip_root_password, port=self.ssh_port,
                                      client_ip=self.client_ip, mount_point=self.mount_point,
                                      file_name='before_snap.txt')

        with allure.step("Check md5"):
            errr_msg = "[ERROR]  before_md5 is : ({}), after_md5 is : ({}),  " \
                       "md5 is not same when reconnect to target : ({})".format(before_md5,
                                                                                after_md5,
                                                                                self.target_id)
            eq_(before_md5, after_md5, errr_msg)

        with allure.step("Client umount"):
            self.client_umount_san_device(gateway_group=self.gateway_group, target_id=self.target_id,
                                          iscsi_id=self.iscsi_id, password=self.client_ip_root_password,
                                          port=self.ssh_port, client_ip=self.client_ip,
                                          mount_point=self.mount_point)

        with allure.step("Client disconnect the target"):
            self.client_login_logout_target(password=self.client_ip_root_password, port=self.ssh_port,
                                            client_ip=self.client_ip, target_id=self.target_id,
                                            op_type='logout')

        with allure.step("Delete all snapshot"):
            self.delete_snapshot(gateway_group=self.gateway_group, target_id=self.target_id,
                                 iscsi_id=self.iscsi_id, delete_all_snap=True)
</pre></td></tr></tbody></table></code></pre></div></div>

<p>这里借助with allure.step() 来完成添加step动作。</p>

<p>上述这个示例代码能否再精简呢？答案是肯定的，如果精简？</p>

<p>这里提供一下思路：</p>

<p>如果这个py文件中含有很多的test case，每个test case都需要增加allure.step，且step里描述的内容相同，可以在被调用的各个函数里增加step动作，test case里完全是函数的调用。</p>

<p>示例如下：</p>

<p>比如上例中的 delete_snapshot 函数，可以将class中定义function时，增加allure.step步骤，参考如下：</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre>    @allure.step("Delete snapshot")
    def delete_snapshot(self, gateway_group=None, target_id=None, iscsi_id=None, snap_name=None,
                        expected_return_code=None, delete_all_snap=None):
        """
        Delete a snapshot
        :param gateway_group, string, a gateway group name
        :param target_id, string, a target name
        :param iscsi_id, string, a iSCSI volume name
        :param expected_return_code, string, status code of return_code
        :param delete_all_snap, bool. True or False, default is False
        :param snapshot_name, string, snapshot name
        """
</pre></td></tr></tbody></table></code></pre></div></div>

<p>这样的话，在测试用例里调用此函数时，无需再额外增加@allure.step()步骤，有一定的用例编写简化作用。当然也可以在 delete_snapshot 函数里面定义内部的step，形成step的嵌套，这样阅读性会更高一些。</p>

<p>allure.step也<strong>支持添加描述且通过占位符传递参数</strong>，示例代码如下：</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre></td><td class="rouge-code"><pre><span class="c1">#!/usr/bin/env python
# -*- coding:GB2312 -*-
</span>
<span class="kn">import</span> <span class="nn">pytest</span>
<span class="kn">import</span> <span class="nn">allure</span>


<span class="kn">import</span> <span class="nn">pytest</span>
<span class="kn">import</span> <span class="nn">allure</span>


<span class="o">@</span><span class="n">allure</span><span class="p">.</span><span class="n">step</span><span class="p">(</span><span class="s">'Delete volume:"{0}" under Target:"{1}" from VirtualStoreage:"{2}"'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">step_title_with_delete_volume_name</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="p">,</span> <span class="n">arg3</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="k">def</span> <span class="nf">test_delete_volume</span><span class="p">():</span>
    <span class="n">step_title_with_delete_volume_name</span><span class="p">(</span><span class="s">'iscsi-name01'</span><span class="p">,</span> <span class="s">'iqn.2021-11.abc:1'</span><span class="p">,</span> <span class="s">'Default'</span><span class="p">)</span>
    <span class="n">step_title_with_delete_volume_name</span><span class="p">(</span><span class="s">'iscsi-name02'</span><span class="p">,</span> <span class="s">'iqn.2021-11.target:ESXi'</span><span class="p">,</span> <span class="s">'NewVS01'</span><span class="p">)</span>
    <span class="n">step_title_with_delete_volume_name</span><span class="p">(</span><span class="s">'iscsi-name03'</span><span class="p">,</span> <span class="s">'iqn.2021-11.target:PVE'</span><span class="p">,</span> <span class="s">'NewVS02'</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>效果图如下：</p>

<p><img class="shadow" src="/img/in-post/allure/step_parameter.png" width="1200" /></p>

<p>也可以设置传递一个/多个可选参数，不传则为None，示例如下：</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre>@allure.step('这是一个带描述语的step，并且通过占位符传递参数：positional = "{0}",keyword = "{key}"')
def step_title_with_placeholder(arg1, key=None):
    pass


def test_step_with_placeholder():
    step_title_with_placeholder(1, key="something")
    step_title_with_placeholder(2)
    step_title_with_placeholder(3, key="anything")
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>小结：</strong></p>

<ul>
  <li>allure.step支持step嵌套，即step下可以嵌套step</li>
  <li>allure.step支持添加描述且通过占位符传递参数</li>
</ul>

<h3 id="allure为测试用例添加描述description">allure为测试用例添加描述（description）</h3>

<h4 id="allure添加描述的三种方式">allure添加描述的三种方式：</h4>

<ul>
  <li>使用装饰器@allure.description，传递一个字符串参数用来描述测试用例</li>
  <li>使用装饰器@allure.description_html，传递一段HTML文本，这将在测试报告的”Description”部分渲染出来</li>
  <li>直接在测试用例方法中通过编写文档注释的方式来添加描述</li>
</ul>

<p>我一般使用第三种，直接将Testlink上用例标题放在这里，即有title的效果，又有description效果。如果使用，具体看个人需要（如下所示）。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre>    @allure.severity('RAT')
    @allure.link(testlink_url+'?tprojectPrefix='+testlink_prefix+'&amp;item=testcase&amp;id='+testlink_prefix+'-432')
    def test_432_create_nfs_folder_mode_async(self):
        """  Sc-432:Create NFS share folder, mode is async  """
        folder_name = 'pytest-' + rand_low_ascii(6)
        self.create_share_folder(folder_name, nfs='true', mode='async')
        self.delete_folder(folder_name)
        self.mds_mgr.check_cluster_state()
</pre></td></tr></tbody></table></code></pre></div></div>

<h4 id="示例">示例</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
</pre></td><td class="rouge-code"><pre><span class="c1">#!/usr/bin/env python
# -*- coding:GB2312 -*-
</span>
<span class="kn">import</span> <span class="nn">pytest</span>
<span class="kn">import</span> <span class="nn">allure</span>


<span class="o">@</span><span class="n">allure</span><span class="p">.</span><span class="n">description</span><span class="p">(</span><span class="s">"""
这是通过传递字符串参数的方式添加的一段描述语，
使用的是装饰器@allure.description，可以换行
"""</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_description_provide_string</span><span class="p">():</span>
    <span class="k">assert</span> <span class="mi">1</span> <span class="o">&gt;</span> <span class="mi">0</span>


<span class="o">@</span><span class="n">allure</span><span class="p">.</span><span class="n">description_html</span><span class="p">(</span><span class="s">"""
&lt;h1&gt;Test with some complicated html description&lt;/h1&gt;
&lt;table style="width:100%" border="1"&gt;
  &lt;tr&gt;
    &lt;th&gt;Name&lt;/th&gt;
    &lt;th&gt;Age&lt;/th&gt;
    &lt;th&gt;Sex&lt;/th&gt;
  &lt;/tr&gt;
  &lt;tr align="center"&gt;
    &lt;td&gt;Json&lt;/td&gt;
    &lt;td&gt;28&lt;/td&gt;
    &lt;td&gt;男&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr align="center"&gt;
    &lt;td&gt;Cathy&lt;/td&gt;
    &lt;td&gt;23&lt;/td&gt;
    &lt;td&gt;女&lt;/td&gt;
  &lt;/tr&gt;
&lt;/table&gt;
"""</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_description_privide_html</span><span class="p">():</span>
    <span class="k">assert</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">1</span>


<span class="k">def</span> <span class="nf">test_description_docstring</span><span class="p">():</span>
    <span class="s">"""
    这是通过文本注释的方式添加的描述语
    同样支持多行描述
    大家好，我是Gavin
    """</span>
    <span class="k">assert</span> <span class="bp">True</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>allure效果图展示如下：</p>

<p><img class="shadow" src="/img/in-post/allure/description_provide_string.png" width="1200" /></p>

<p>上面的测试报告是通过装饰器@allure.description传递字符串参数来添加描述语的方式。</p>

<p><img class="shadow" src="/img/in-post/allure/description_docstring.png" width="1200" /></p>

<p>上面的测试报告是通过直接在测试用例方法中编写文档注释来添加描述语的方式。</p>

<p><img class="shadow" src="/img/in-post/allure/description_privide_html.png" width="1200" /></p>

<p>上面的测试报告是通过装饰器@allure.description_html传递一段HTML文本来添加描述语的方式，这段HTML会渲染在报告的”Description”部分。</p>

<h4 id="allure动态更新描述语alluredynamicdescription">allure动态更新描述语(allure.dynamic.description)</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>@allure.description("这是更新前的描述内容，在使用allure.dynamic.description后将会被更新成新的描述内容")
def test_dynamic_description():
    assert True
    allure.dynamic.description("这是通过使用allure.dynamic.description更新后的描述内容")
</pre></td></tr></tbody></table></code></pre></div></div>

<p>allure html展示效果如下：</p>

<p><img class="shadow" src="/img/in-post/allure/dynamic_description.png" width="1200" /></p>

<p>如果assert失败或用例执行失败，是不会动态更新描述信息的：</p>

<p><img class="shadow" src="/img/in-post/allure/dynamic_description_failed.png" width="1200" /></p>

<h3 id="allure为测试用例添加标题">allure为测试用例添加标题</h3>

<p>通过使用装饰器@allure.title可以为测试用例自定义一个更具有阅读性的易读的标题。</p>

<h4 id="alluretitle的三种使用方式">allure.title的三种使用方式</h4>

<ul>
  <li>直接使用@allure.title为测试用例自定义标题</li>
  <li>@allure.title支持通过占位符的方式传递参数，可以实现测试用例标题参数化，动态生成测试用例标题</li>
  <li>@allure.dynamic.title动态更新测试用例标题</li>
</ul>

<h4 id="alluretitle使用方式示例">allure.title使用方式示例</h4>

<h5 id="直接使用alluretitle为测试用例自定义标题">直接使用@allure.title为测试用例自定义标题</h5>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre><span class="c1">#!/usr/bin/env python
# -*- coding:GB2312 -*-
</span>
<span class="kn">import</span> <span class="nn">pytest</span>
<span class="kn">import</span> <span class="nn">allure</span>


<span class="o">@</span><span class="n">allure</span><span class="p">.</span><span class="n">title</span><span class="p">(</span><span class="s">"自定义测试用例标题"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_case_with_title</span><span class="p">():</span>
    <span class="k">assert</span> <span class="bp">True</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>这个最常用，也是最简单的方式。效果图如下：</p>

<p><img class="shadow" src="/img/in-post/allure/step_title.png" width="1200" /></p>

<h5 id="alluretitle占位符传递参数参数化测试用例标题">allure.title占位符传递参数，参数化测试用例标题</h5>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre><span class="c1">#!/usr/bin/env python
# -*- coding:GB2312 -*-
</span>
<span class="kn">import</span> <span class="nn">pytest</span>
<span class="kn">import</span> <span class="nn">allure</span>


<span class="o">@</span><span class="n">allure</span><span class="p">.</span><span class="n">title</span><span class="p">(</span><span class="s">"参数化测试用例标题：参数1 = {param1} and 参数2 = {param2}"</span><span class="p">)</span>
<span class="o">@</span><span class="n">pytest</span><span class="p">.</span><span class="n">mark</span><span class="p">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s">"param1, param2, expected"</span><span class="p">,</span> <span class="p">[(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">)])</span>
<span class="k">def</span> <span class="nf">test_with_parametrize_title</span><span class="p">(</span><span class="n">param1</span><span class="p">,</span> <span class="n">param2</span><span class="p">,</span> <span class="n">expected</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">param1</span> <span class="o">+</span> <span class="n">param2</span> <span class="o">==</span> <span class="n">expected</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>展示效果如下：</p>

<p><img class="shadow" src="/img/in-post/allure/step_title_parameter.png" width="1200" /></p>

<h5 id="alluredynamictitle动态更新标题">allure.dynamic.title动态更新标题</h5>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>@allure.title("这个标题将会被成功执行的测试用例中的标题替所代替")
def test_with_dynamic_title():
    assert True
    allure.dynamic.title("断言成功后，标题将会被替换成这个标题")
</pre></td></tr></tbody></table></code></pre></div></div>

<p>效果图如下：</p>

<p><img class="shadow" src="/img/in-post/allure/step_dynamic_title.png" width="1200" /></p>

<h4 id="allure集成缺陷管理系统和测试管理系统allurelinkallureissuealluretestcase">allure集成缺陷管理系统和测试管理系统(allure.link、allure.issue、allure.testcase)</h4>

<p>allure测试报告框架提供了@allure.link、@allure.issue、@allure.testcase 这三个装饰器，可以用来与缺陷管理系统和测试管理系统集成，做到更好的自动化管理。</p>

<p>这三个装饰器，使用方法基本一致，但仍然不建议混用，用例相关用@allure.testcase，Bug相关用@allure.issue，其他则使用@allure.link，形成习惯。</p>

<p>代码示例：</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
</pre></td><td class="rouge-code"><pre><span class="c1">#!/usr/bin/env python
# -*- coding:GB2312 -*-
</span>
<span class="kn">import</span> <span class="nn">pytest</span>
<span class="kn">import</span> <span class="nn">allure</span>

<span class="o">@</span><span class="n">allure</span><span class="p">.</span><span class="n">link</span><span class="p">(</span><span class="s">"http://47.99.40.56:8721/List_of_Functional_Requirements-V1.2.html"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_with_link</span><span class="p">():</span>
    <span class="s">"""
    @allure.link() 指定与测试用例关联的链接，直接贴上对应的URL即可
    :return:
    """</span>
    <span class="k">assert</span> <span class="bp">True</span>


<span class="o">@</span><span class="n">allure</span><span class="p">.</span><span class="n">link</span><span class="p">(</span><span class="s">"http://47.99.40.56:8721/List_of_Functional_Requirements-V1.2.html"</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">"需求列表V1.2的链接，点击访问"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_with_link_named</span><span class="p">():</span>
    <span class="s">"""
    @allure.link() 通过指定name的方式来指定关联链接，测试报告中用name替换实际URL展示
    :return:
    """</span>
    <span class="k">assert</span> <span class="bp">True</span>


<span class="o">@</span><span class="n">allure</span><span class="p">.</span><span class="n">issue</span><span class="p">(</span><span class="s">"http://47.99.40.56:8721/bug-view-1446.html"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_with_issue_link</span><span class="p">():</span>
    <span class="s">"""
    @allure.issue() 可以与缺陷管理系统相关联，指定与该测试用例相关联的bug链接地址
    :return:
    """</span>
    <span class="k">assert</span> <span class="bp">True</span>


<span class="o">@</span><span class="n">allure</span><span class="p">.</span><span class="n">testcase</span><span class="p">(</span><span class="s">"http://47.99.40.56:8721/test-case-2166.html"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_with_testcase_link</span><span class="p">():</span>
    <span class="s">"""
    @allure.testcase() 可以与测试用例管理工具相关联，指定与该测试用例关联的测试用例地址
    :return:
    """</span>
    <span class="k">assert</span> <span class="bp">True</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>效果如下：</p>

<p><img class="shadow" src="/img/in-post/allure/allure_link.png" width="1200" /></p>

<p>上图是allure.link的效果。</p>

<p><img class="shadow" src="/img/in-post/allure/allure_issue.png" width="1200" /></p>

<p>上图是allure.issue的效果，用于提示是一个Bug。</p>

<p><img class="shadow" src="/img/in-post/allure/allure_testcase.png" width="1200" /></p>

<p>上图显示allure.testcase的链接，会有一个类似存储的icon。</p>

<p>这几个装饰器的相同点都显示在“Links”下方展示，除了allure.link没有图标外，其他两个都有图标。</p>

<h4 id="allure的tag标记allurestoryallurefeatureseverity">allure的Tag标记(allure.story、allure.feature、severity)</h4>

<p>执行测试用例时，希望能够更加灵活的指定执行某些测试用例（如指定测试用例的级别，用例路径，用例标签/标记等），pytest支持我们通过使用marker装饰器@pytest.mark来实现这个需求，而allure也同样提供了三种类似的方法来实现这个需求。</p>

<h5 id="allure的三种方式">allure的三种方式</h5>

<p>Allure 则提供了 3 种类型的标记装饰器来标记测试，并且可以同步展示到测试报告内：</p>

<ul>
  <li>BDD（行为驱动开发）风格的标签</li>
  <li>严重程度（Severity）的标签</li>
  <li>自定义的标签（allure.title）</li>
</ul>

<p>​</p>

<h5 id="bdd风格的标签">BDD风格的标签</h5>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>@allure.epic：敏捷里面的概念，定义史诗，相当于module级的标签
@allure.feature：功能点的描述，可以理解成模块，相当于class级的标签
@allure.story：故事，可以理解为场景，相当于method级的标签
</pre></td></tr></tbody></table></code></pre></div></div>

<p>allure提供的两个装饰器：@allure.feature和@allure.story，可以将用例根据Feature和Story分类，通过将name使用epic_ 开头的前缀就能够指定Feature和Story属于哪一个epic。</p>

<p>他俩的关系：</p>

<p>epic是feature父级，feature是story父级，是包含关系，效果跟书籍的目录或者项目结构相似。</p>

<p>如果使用allure和pytest来组织的自动化框架，<strong>推荐使用allure的标记来标记用例，替换@pytest.mark.xxx</strong>，因为功能一致，且allure 标记功能可以直接<strong>展示到html报告</strong>内</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
</pre></td><td class="rouge-code"><pre><span class="c1">#!/usr/bin/env python
# -*- coding:GB2312 -*-
</span>
<span class="kn">import</span> <span class="nn">pytest</span>
<span class="kn">import</span> <span class="nn">allure</span>


<span class="k">def</span> <span class="nf">test_without_any_annotations_that_wont_be_executed</span><span class="p">():</span>
    <span class="s">"""
    没有任何注解
    :return:
    """</span>
    <span class="k">pass</span>


<span class="o">@</span><span class="n">allure</span><span class="p">.</span><span class="n">story</span><span class="p">(</span><span class="s">'epic_1'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_with_epic_1</span><span class="p">():</span>
    <span class="s">"""
    通过指定name为epic_前缀的方式来指定story属于哪一个epic
    :return:
    """</span>
    <span class="k">pass</span>


<span class="o">@</span><span class="n">allure</span><span class="p">.</span><span class="n">story</span><span class="p">(</span><span class="s">'story_1'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_with_story_1</span><span class="p">():</span>
    <span class="s">"""
    指定该测试用例属于的story
    :return:
    """</span>
    <span class="k">pass</span>


<span class="o">@</span><span class="n">allure</span><span class="p">.</span><span class="n">story</span><span class="p">(</span><span class="s">'story_2'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_with_story_2</span><span class="p">():</span>
    <span class="s">"""
    指定该测试用例属于的story
    :return:
    """</span>
    <span class="k">pass</span>


<span class="o">@</span><span class="n">allure</span><span class="p">.</span><span class="n">feature</span><span class="p">(</span><span class="s">'feature_2'</span><span class="p">)</span>
<span class="o">@</span><span class="n">allure</span><span class="p">.</span><span class="n">story</span><span class="p">(</span><span class="s">'story_2'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_with_story_2_and_feature_2</span><span class="p">():</span>
    <span class="s">"""
    指定该测试用例属于的feature和story
    :return:
    """</span>
    <span class="k">pass</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>拓展：命令行方式</strong></p>

<p>与@pytest.mark.xxx相同，也可以通过命令行来运行指定epic、feature、story标记的用例：</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>–allure-epics
–allure-features
–allure-stories
</pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>只运行 epic 名为 epic1 的测试用例</strong></p>

<p><code class="highlighter-rouge">pytest --alluredir ./report/allure --allure-epics=epic1</code></p>

<p><strong>只运行 feature 名为 模块级 的测试用例</strong></p>

<p><code class="highlighter-rouge">pytest --alluredir ./report/allure --allure-features=模块级</code></p>

<p><strong>只运行 story1、story2 的测试用例（也可以不用=号 空格即可）</strong></p>

<p><code class="highlighter-rouge">pytest tests.py --allure-stories story1,story2</code></p>

<p><strong>指定 feature和story</strong></p>

<p><code class="highlighter-rouge">pytest tests.py --allure-features feature1,feature2 --allure-stories story1</code></p>

<h5 id="severity-markers">Severity markers</h5>

<p>使用@allure.severity来标识测试用例的严重等级，严重等级是allure.severity_level枚举中的一个。</p>

<p>allure划分用例等级为5个：</p>

<ul>
  <li>blocker：阻塞缺陷（功能未实现，无法下一步）</li>
  <li>critical：严重缺陷（功能点缺失）</li>
  <li>normal：一般缺陷（边界情况，格式错误）</li>
  <li>minor：次要缺陷（界面错误与ui需求不符）</li>
  <li>trivial：轻微缺陷（必须项无提示，或者提示不规范）</li>
</ul>

<p><strong>说明：</strong></p>

<p>​    一些手工用例编写平台，如testlink，它里面定义的测试用例的级别名称，和allure指定的这五种名称是不一样的，是无法直接使用外部的用例级别的，只能使用上面的测试用例的级别。</p>

<p>示例：</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
</pre></td><td class="rouge-code"><pre><span class="c1">#!/usr/bin/env python
# -*- coding:GB2312 -*-
</span>
<span class="kn">import</span> <span class="nn">pytest</span>
<span class="kn">import</span> <span class="nn">allure</span>


<span class="k">def</span> <span class="nf">test_with_no_severity_label</span><span class="p">():</span>
    <span class="s">"""
    不定义任何severity标签
    :return:
    """</span>
    <span class="k">pass</span>


<span class="o">@</span><span class="n">allure</span><span class="p">.</span><span class="n">severity</span><span class="p">(</span><span class="n">allure</span><span class="p">.</span><span class="n">severity_level</span><span class="p">.</span><span class="n">BLOCKER</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_with_blocker_severity</span><span class="p">():</span>
    <span class="s">"""
    定义severity标签为BLOCKER
    :return:
    """</span>
    <span class="k">pass</span>


<span class="o">@</span><span class="n">allure</span><span class="p">.</span><span class="n">severity</span><span class="p">(</span><span class="n">allure</span><span class="p">.</span><span class="n">severity_level</span><span class="p">.</span><span class="n">CRITICAL</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_with_critical_severity</span><span class="p">():</span>
    <span class="s">"""
    定义severity标签为CRITICAL
    :return:
    """</span>
    <span class="k">pass</span>


<span class="o">@</span><span class="n">allure</span><span class="p">.</span><span class="n">severity</span><span class="p">(</span><span class="n">allure</span><span class="p">.</span><span class="n">severity_level</span><span class="p">.</span><span class="n">TRIVIAL</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_with_trivial_severity</span><span class="p">():</span>
    <span class="s">"""
    定义severity标签为TRIVIAL
    :return:
    """</span>
    <span class="k">pass</span>


<span class="o">@</span><span class="n">allure</span><span class="p">.</span><span class="n">severity</span><span class="p">(</span><span class="n">allure</span><span class="p">.</span><span class="n">severity_level</span><span class="p">.</span><span class="n">NORMAL</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_with_normal_severity</span><span class="p">():</span>
    <span class="s">"""
    定义severity标签为NORMAL
    :return:
    """</span>
    <span class="k">pass</span>


<span class="o">@</span><span class="n">allure</span><span class="p">.</span><span class="n">severity</span><span class="p">(</span><span class="n">allure</span><span class="p">.</span><span class="n">severity_level</span><span class="p">.</span><span class="n">MINOR</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_with_minior_severity</span><span class="p">():</span>
    <span class="s">"""
    定义severity标签为MINOR
    :return:
    """</span>
    <span class="k">pass</span>

<span class="o">@</span><span class="n">allure</span><span class="p">.</span><span class="n">severity</span><span class="p">(</span><span class="n">allure</span><span class="p">.</span><span class="n">severity_level</span><span class="p">.</span><span class="n">NORMAL</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">TestClassWithNormalSeverity</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="s">"""
    定义类的severity标签为NORMAL
    """</span>

    <span class="k">def</span> <span class="nf">test_inside_the_normal_severity_test_class</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="o">@</span><span class="n">allure</span><span class="p">.</span><span class="n">severity</span><span class="p">(</span><span class="n">allure</span><span class="p">.</span><span class="n">severity_level</span><span class="p">.</span><span class="n">CRITICAL</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_inside_the_normal_severity_test_class_with_overriding_critical_severity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>severity装饰器可以用在函数、方法和类上面。</p>

<p>通过使用–allure-severities 命令行选项指定运行哪些测试用例，如果命令行选项的值有多个就用逗号分隔。</p>

<p>比如：</p>

<p><img class="shadow" src="/img/in-post/allure/allure_level.png" width="1200" /></p>

<h2 id="综合示例">综合示例</h2>

<p>从网上找了个示例(https://zhuanlan.zhihu.com/p/652835522)，做参考一下：</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
</pre></td><td class="rouge-code"><pre><span class="c1">#!/usr/bin/env python
# -*- coding:GB2312 -*-
</span>
<span class="kn">import</span> <span class="nn">allure</span>
<span class="kn">import</span> <span class="nn">pytest</span>
<span class="kn">from</span> <span class="nn">allure_commons.types</span> <span class="kn">import</span> <span class="n">LinkType</span><span class="p">,</span> <span class="n">Severity</span>


<span class="o">@</span><span class="n">allure</span><span class="p">.</span><span class="n">parent_suite</span><span class="p">(</span><span class="s">'我是parent_suite'</span><span class="p">)</span>
<span class="o">@</span><span class="n">allure</span><span class="p">.</span><span class="n">suite</span><span class="p">(</span><span class="s">'我是suite'</span><span class="p">)</span>
<span class="o">@</span><span class="n">allure</span><span class="p">.</span><span class="n">sub_suite</span><span class="p">(</span><span class="s">'我是sub_suite'</span><span class="p">)</span>
<span class="o">@</span><span class="n">allure</span><span class="p">.</span><span class="n">epic</span><span class="p">(</span><span class="s">'我是epic'</span><span class="p">)</span>
<span class="o">@</span><span class="n">allure</span><span class="p">.</span><span class="n">feature</span><span class="p">(</span><span class="s">'我是feature'</span><span class="p">)</span>
<span class="o">@</span><span class="n">allure</span><span class="p">.</span><span class="n">story</span><span class="p">(</span><span class="s">'我是story'</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">TestAllureDemo</span><span class="p">:</span>
    <span class="o">@</span><span class="n">allure</span><span class="p">.</span><span class="nb">id</span><span class="p">(</span><span class="s">'我是id'</span><span class="p">)</span>
    <span class="o">@</span><span class="n">allure</span><span class="p">.</span><span class="n">title</span><span class="p">(</span><span class="s">'我是title'</span><span class="p">)</span>
    <span class="o">@</span><span class="n">allure</span><span class="p">.</span><span class="n">link</span><span class="p">(</span><span class="s">'百度一下，你就知道'</span><span class="p">,</span> <span class="n">LinkType</span><span class="p">.</span><span class="n">ISSUE</span><span class="p">,</span> <span class="s">'我是link_ISSUE'</span><span class="p">)</span>
    <span class="o">@</span><span class="n">allure</span><span class="p">.</span><span class="n">label</span><span class="p">(</span><span class="s">'我是label'</span><span class="p">)</span>
    <span class="o">@</span><span class="n">allure</span><span class="p">.</span><span class="n">issue</span><span class="p">(</span><span class="s">'百度一下，你就知道'</span><span class="p">,</span> <span class="s">'我是issue'</span><span class="p">)</span>
    <span class="o">@</span><span class="n">allure</span><span class="p">.</span><span class="n">description</span><span class="p">(</span><span class="s">'我是description'</span><span class="p">)</span>
    <span class="o">@</span><span class="n">allure</span><span class="p">.</span><span class="n">severity</span><span class="p">(</span><span class="n">Severity</span><span class="p">.</span><span class="n">BLOCKER</span><span class="p">)</span>
    <span class="o">@</span><span class="n">allure</span><span class="p">.</span><span class="n">tag</span><span class="p">(</span><span class="s">'我是tag'</span><span class="p">)</span>
    <span class="o">@</span><span class="n">allure</span><span class="p">.</span><span class="n">testcase</span><span class="p">(</span><span class="s">'百度一下，你就知道'</span><span class="p">,</span> <span class="s">'testcase'</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_01</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">assert_one</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="o">@</span><span class="n">allure</span><span class="p">.</span><span class="n">step</span><span class="p">(</span><span class="s">'我是断言'</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">assert_one</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">a</span> <span class="o">==</span> <span class="n">b</span>

    <span class="o">@</span><span class="n">allure</span><span class="p">.</span><span class="nb">id</span><span class="p">(</span><span class="s">'我是id'</span><span class="p">)</span>
    <span class="o">@</span><span class="n">allure</span><span class="p">.</span><span class="n">title</span><span class="p">(</span><span class="s">'我是title'</span><span class="p">)</span>
    <span class="o">@</span><span class="n">allure</span><span class="p">.</span><span class="n">link</span><span class="p">(</span><span class="s">'百度一下，你就知道'</span><span class="p">,</span> <span class="n">LinkType</span><span class="p">.</span><span class="n">LINK</span><span class="p">,</span> <span class="s">'我是link'</span><span class="p">)</span>
    <span class="o">@</span><span class="n">allure</span><span class="p">.</span><span class="n">label</span><span class="p">(</span><span class="s">'我是label'</span><span class="p">)</span>
    <span class="o">@</span><span class="n">allure</span><span class="p">.</span><span class="n">issue</span><span class="p">(</span><span class="s">'百度一下，你就知道'</span><span class="p">,</span> <span class="s">'我是issue'</span><span class="p">)</span>
    <span class="o">@</span><span class="n">allure</span><span class="p">.</span><span class="n">description</span><span class="p">(</span><span class="s">'我是description'</span><span class="p">)</span>
    <span class="o">@</span><span class="n">allure</span><span class="p">.</span><span class="n">severity</span><span class="p">(</span><span class="s">'我是severity'</span><span class="p">)</span>
    <span class="o">@</span><span class="n">allure</span><span class="p">.</span><span class="n">tag</span><span class="p">(</span><span class="s">'我是tag'</span><span class="p">)</span>
    <span class="o">@</span><span class="n">allure</span><span class="p">.</span><span class="n">testcase</span><span class="p">(</span><span class="s">'百度一下，你就知道'</span><span class="p">,</span> <span class="s">'我是testcase'</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_02</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">allure</span><span class="p">.</span><span class="n">dynamic</span><span class="p">.</span><span class="n">mro</span><span class="p">()</span>
        <span class="n">allure</span><span class="p">.</span><span class="n">dynamic</span><span class="p">.</span><span class="n">title</span><span class="p">(</span><span class="s">'我是修改后的title'</span><span class="p">)</span>
        <span class="n">allure</span><span class="p">.</span><span class="n">dynamic</span><span class="p">.</span><span class="n">link</span><span class="p">(</span><span class="s">'百度一下，你就知道'</span><span class="p">,</span> <span class="n">LinkType</span><span class="p">.</span><span class="n">LINK</span><span class="p">,</span> <span class="s">'我是修改后的link'</span><span class="p">)</span>
        <span class="n">allure</span><span class="p">.</span><span class="n">dynamic</span><span class="p">.</span><span class="n">label</span><span class="p">(</span><span class="s">'我是修改后的label'</span><span class="p">)</span>
        <span class="n">allure</span><span class="p">.</span><span class="n">dynamic</span><span class="p">.</span><span class="n">issue</span><span class="p">(</span><span class="s">'百度一下，你就知道'</span><span class="p">,</span> <span class="s">'我是修改后的issue'</span><span class="p">)</span>
        <span class="n">allure</span><span class="p">.</span><span class="n">dynamic</span><span class="p">.</span><span class="n">description</span><span class="p">(</span><span class="s">'我是修改后的description'</span><span class="p">)</span>
        <span class="n">allure</span><span class="p">.</span><span class="n">dynamic</span><span class="p">.</span><span class="n">severity</span><span class="p">(</span><span class="s">'我是修改后的severity'</span><span class="p">)</span>
        <span class="n">allure</span><span class="p">.</span><span class="n">dynamic</span><span class="p">.</span><span class="n">tag</span><span class="p">(</span><span class="s">'我是修改后的tag'</span><span class="p">)</span>
        <span class="n">allure</span><span class="p">.</span><span class="n">dynamic</span><span class="p">.</span><span class="n">testcase</span><span class="p">(</span><span class="s">'百度一下，你就知道'</span><span class="p">,</span> <span class="s">'我是修改后的testcase'</span><span class="p">)</span>
        <span class="k">assert</span> <span class="mi">1</span> <span class="o">&gt;</span> <span class="mi">1</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>allure html report 显示效果如下：</p>

<p><img class="shadow" src="/img/in-post/allure/allure_full_example.png" width="1200" /></p>

<h1 id="帮助-help">帮助 –help</h1>

<table>
  <thead>
    <tr>
      <th>命令</th>
      <th>描述</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>generate</td>
      <td>根据给定的allure结果目录生成报告</td>
    </tr>
    <tr>
      <td>serve</td>
      <td>启动报告，可在浏览器中查看生成的报告</td>
    </tr>
    <tr>
      <td>open</td>
      <td>打开生成的报告，默认使用浏览器</td>
    </tr>
    <tr>
      <td>plugin</td>
      <td>生成插件报告</td>
    </tr>
    <tr>
      <td>–help</td>
      <td>打印命令行的帮助信息</td>
    </tr>
    <tr>
      <td>-q,–quite</td>
      <td>开启静默模式，减少信息的输出</td>
    </tr>
    <tr>
      <td>-v,–verbose</td>
      <td>开启详细模式，增加输出信息</td>
    </tr>
    <tr>
      <td>–version</td>
      <td>显示当前allure的版本信息</td>
    </tr>
  </tbody>
</table>

<p>详细帮助参考下图：</p>

<p><img class="shadow" src="/img/in-post/allure/allure_help.png" width="1200" /></p>

<h2 id="报告打开">报告打开</h2>

<h3 id="系统默认目录下生成测试报告并打开">系统默认目录下生成测试报告并打开</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>allure serve path
</pre></td></tr></tbody></table></code></pre></div></div>

<p>示例如下：</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre>C:\Users\Wang&gt;allure serve report/json -o report/html
Generating report to temp directory...
-o does not exists
report\html does not exists
Report successfully generated to C:\Users\Wang\AppData\Local\Temp\8019254791336321592\allure-report
Starting web server...
2021-11-04 11:13:00.556:INFO::main: Logging initialized @1698ms to org.eclipse.jetty.util.log.StdErrLog
Server started at &lt;http://192.168.2.178:2970/&gt;. Press &lt;Ctrl+C&gt; to exit
^C终止批处理操作吗(Y/N)? y
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="在指定目录下生成测试报告使用open打开">在指定目录下生成测试报告，使用open打开</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>allure generate “存储结果的path” -c -o  “在path生成html报告”
allure open “在path生成的html报告”
</pre></td></tr></tbody></table></code></pre></div></div>

<p>示例如下：</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre>C:\Users\Wang&gt;allure generate report/json -o report/html
Report successfully generated to report\html
C:\Users\Wang&gt;allure open report\html
Starting web server...
2021-11-04 11:17:37.560:INFO::main: Logging initialized @160ms to org.eclipse.jetty.util.log.StdErrLog
Server started at &lt;http://192.168.2.178:2999/&gt;. Press &lt;Ctrl+C&gt; to exit
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="environment">Environment</h2>

<p>环境变量参数，设置运行环境参数，比如可以显示被测版本信息，什么时间开始测试，什么时间测试结束，耗时多久之类的信息。默认为空，需要创建environment.properties文件，或者environment.xml文件，并把文件存放<code class="highlighter-rouge">存储结果的path</code>中。</p>

<p><img class="shadow" src="/img/in-post/allure/environment_empty.png" width="1200" /></p>

<h3 id="environmentproperties">environment.properties</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre>PRODUCT_VERSION=VirtualStor Scaler V8.0-269
START_TIME=2021-11-03 21:36:57
END_TIME=2021-11-04 06:29:46
TEST_COUNTS=2596
TEST_PASS=2537
TEST_FAIL=31
TEST_SKIP=27
TEST_BROKEN=1
TEST_UNKNOW=0
TIME_DURATION=31969
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="environmentxml">environment.xml</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
</pre></td><td class="rouge-code"><pre>&lt;environment&gt;
    &lt;parameter&gt;
        &lt;key&gt;PRODUCT_VERSION&lt;/key&gt;
        &lt;value&gt;VirtualStor Scaler V8.0-269&lt;/value&gt;
    &lt;/parameter&gt;
    &lt;parameter&gt;
        &lt;key&gt;START_TIME&lt;/key&gt;
        &lt;value&gt;2021-11-03 21:36:572&lt;/value&gt;
    &lt;/parameter&gt;
    &lt;parameter&gt;
        &lt;key&gt;END_TIME&lt;/key&gt;
        &lt;value&gt;2021-11-04 06:29:46&lt;/value&gt;
    &lt;/parameter&gt;
    &lt;parameter&gt;
        &lt;key&gt;TEST_COUNTS&lt;/key&gt;
        &lt;value&gt;2596&lt;/value&gt;
    &lt;/parameter&gt;
    &lt;parameter&gt;
        &lt;key&gt;TEST_PASS&lt;/key&gt;
        &lt;value&gt;2537&lt;/value&gt;
    &lt;/parameter&gt;
    &lt;parameter&gt;
        &lt;key&gt;TEST_FAIL&lt;/key&gt;
        &lt;value&gt;31&lt;/value&gt;
    &lt;/parameter&gt;
    &lt;parameter&gt;
        &lt;key&gt;TEST_SKIP&lt;/key&gt;
        &lt;value&gt;27&lt;/value&gt;
    &lt;/parameter&gt;
    &lt;parameter&gt;
        &lt;key&gt;TEST_BROKEN&lt;/key&gt;
        &lt;value&gt;1&lt;/value&gt;
    &lt;/parameter&gt;
    &lt;parameter&gt;
        &lt;key&gt;TEST_UNKNOW&lt;/key&gt;
        &lt;value&gt;0&lt;/value&gt;
    &lt;/parameter&gt;
    &lt;parameter&gt;
        &lt;key&gt;TIME_DURATION&lt;/key&gt;
        &lt;value&gt;31969&lt;/value&gt;
    &lt;/parameter&gt;
&lt;/environment&gt;
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="categories">Categories</h2>

<p>将测试用例结果进行分类,默认情况下，有两类缺陷：</p>

<ol>
  <li>Product defects 产品缺陷（测试结果：failed）</li>
  <li>Test defects 测试缺陷（测试结果：error/broken）</li>
</ol>

<p>可以创建自定义缺陷分类的，将 categories.json 文件添加到allure-results目录即可（和上面environment.properties放同一个目录），示例参考如下：</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre></td><td class="rouge-code"><pre>[
  {
    "name": "Ignored tests", 
    "matchedStatuses": ["skipped"] 
  },
  {
    "name": "Infrastructure problems",
    "matchedStatuses": ["broken", "failed"],
    "messageRegex": ".*bye-bye.*" 
  },
  {
    "name": "Outdated tests",
    "matchedStatuses": ["broken"],
    "traceRegex": ".*FileNotFoundException.*" 
  },
  {
    "name": "Product defects",
    "matchedStatuses": ["failed"]
  },
  {
    "name": "Test defects",
    "matchedStatuses": ["broken"]
  }
]
</pre></td></tr></tbody></table></code></pre></div></div>

<p>参数的含义</p>

<ul>
  <li><strong>name</strong>：分类名称，可以是中文</li>
  <li><strong>matchedStatuses</strong>：测试用例的运行状态，默认[“failed”, “broken”, “passed”, “skipped”, “unknown”]</li>
  <li><strong>messageRegex</strong>：测试用例运行的错误信息，默认是 .* ，是通过正则去匹配的</li>
  <li><strong>traceRegex</strong>：测试用例运行的错误堆栈信息，默认是 .* ，也是通过正则去匹配的</li>
</ul>

<p>结合上面文件后，放在report原始文件目录下，生成的可视化报告参考如下：</p>

<p><img class="shadow" src="/img/in-post/allure/environment_OK.png" width="1200" /></p>

<h1 id="结语">结语</h1>

<h2 id="设置测试套中显示内容">设置测试套中显示内容</h2>

<p>@allure.parent_suite,@allure.suite,@allure.sub_suite对应的是allure报告中的测试套的三个级别.爷爷父亲儿子.然后下一级就是测用例的标题。</p>

<p>由于@allure.epic, @allure.feature, @allure.story,@allure.title的存在，上面这三个装饰器很少使用。</p>

<h2 id="设置报告中功能项显示内容">设置报告中功能项显示内容</h2>

<p>@allure.epic, @allure.feature, @allure.story,@allure.title对应功能中的一级菜单,二级菜单,三级菜单,用例标题</p>

<h2 id="设置具体用例显示内容">设置具体用例显示内容</h2>

<p>@allure.id 用例id,@allure.link 用例的超链接,@allure.label 用例的标签
@allure.issue 记录用例的问题(超链接),@allure.description 用例的描述
@allure.severity 用例的优先级,@allure.tag 用例的标记,@allure.testcase 记录用例的地址(超链接)
@allure.description_html 用例的描述的网址(超链接),若存在description_html则@allure.description不显示</p>

<h2 id="设置用例级别">设置用例级别</h2>

<p>@allure.severity的参数说明，’blocker’、 ‘critical’、’normal’、’minor’、’trivial’，从左到右言级别依次降低</p>

<h1 id="参考链接">参考链接</h1>

<p>https://github.com/allure-framework</p>

<p>https://qualitysphere.gitee.io/ext/allure/</p>

<p>https://github.com/orgs/allure-framework/discussions</p>



                <hr style="visibility: hidden;">
                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/2021/11/04/monitor_mds_failed/" data-toggle="tooltip" data-placement="top" title="Monitor mds failed">
                        Previous<br>
                        <span>Monitor mds failed</span>
                        </a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/2021/11/23/PG_auto_repair/" data-toggle="tooltip" data-placement="top" title="ceph PG auto repair">
                        Next<br>
                        <span>ceph PG auto repair</span>
                        </a>
                    </li>
                    
                </ul>
                <hr style="visibility: hidden;">

                
                <!-- disqus 评论框 start -->
                <div class="comment">
                    <div id="disqus_thread" class="disqus-thread"></div>
                </div>
                <!-- disqus 评论框 end -->
                

                
            </div>  

    <!-- Side Catalog Container -->
        
            <div class="
                col-lg-2 col-lg-offset-0
                visible-lg-block
                sidebar-container
                catalog-container">
                <div class="side-catalog">
                    <hr class="hidden-sm hidden-xs">
                    <h5>
                        <a class="catalog-toggle" href="#">CATALOG</a>
                    </h5>
                    <ul class="catalog-body"></ul>
                </div>
            </div>
        

    <!-- Sidebar Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                <!-- Featured Tags -->
                


<section>
    
        <hr class="hidden-sm hidden-xs">
    
    <h5><a href="/archive/">FEATURED TAGS</a></h5>
    <div class="tags">
        
        
        
        </a>
        
        
                <a data-sort="0222" 
                    href="/archive/?tag=oracle"
                    title="oracle"
                    rel="77">oracle</a>
        
                <a data-sort="0227" 
                    href="/archive/?tag=Linux"
                    title="Linux"
                    rel="72">Linux</a>
        
                <a data-sort="0266" 
                    href="/archive/?tag=Automation"
                    title="Automation"
                    rel="33">Automation</a>
        
                <a data-sort="0266" 
                    href="/archive/?tag=python"
                    title="python"
                    rel="33">python</a>
        
                <a data-sort="0268" 
                    href="/archive/?tag=shell"
                    title="shell"
                    rel="31">shell</a>
        
                <a data-sort="0278" 
                    href="/archive/?tag=ceph"
                    title="ceph"
                    rel="21">ceph</a>
        
                <a data-sort="0288" 
                    href="/archive/?tag=pytest"
                    title="pytest"
                    rel="11">pytest</a>
        
                <a data-sort="0293" 
                    href="/archive/?tag=Jenkins"
                    title="Jenkins"
                    rel="6">Jenkins</a>
        
                <a data-sort="0293" 
                    href="/archive/?tag=S3"
                    title="S3"
                    rel="6">S3</a>
        
                <a data-sort="0294" 
                    href="/archive/?tag=nose"
                    title="nose"
                    rel="5">nose</a>
        
                <a data-sort="0294" 
                    href="/archive/?tag=performance"
                    title="performance"
                    rel="5">performance</a>
        
                <a data-sort="0295" 
                    href="/archive/?tag=JBOD"
                    title="JBOD"
                    rel="4">JBOD</a>
        
                <a data-sort="0295" 
                    href="/archive/?tag=Megacli"
                    title="Megacli"
                    rel="4">Megacli</a>
        
                <a data-sort="0295" 
                    href="/archive/?tag=awk"
                    title="awk"
                    rel="4">awk</a>
        
                <a data-sort="0295" 
                    href="/archive/?tag=mysql"
                    title="mysql"
                    rel="4">mysql</a>
        
                <a data-sort="0295" 
                    href="/archive/?tag=perl"
                    title="perl"
                    rel="4">perl</a>
        
                <a data-sort="0296" 
                    href="/archive/?tag=ESXi"
                    title="ESXi"
                    rel="3">ESXi</a>
        
                <a data-sort="0296" 
                    href="/archive/?tag=cosbench"
                    title="cosbench"
                    rel="3">cosbench</a>
        
                <a data-sort="0296" 
                    href="/archive/?tag=iSCSI"
                    title="iSCSI"
                    rel="3">iSCSI</a>
        
                <a data-sort="0297" 
                    href="/archive/?tag=%E8%99%9A%E6%8B%9F%E5%8C%96"
                    title="虚拟化"
                    rel="2">虚拟化</a>
        
                <a data-sort="0297" 
                    href="/archive/?tag=APP"
                    title="APP"
                    rel="2">APP</a>
        
                <a data-sort="0297" 
                    href="/archive/?tag=Disk"
                    title="Disk"
                    rel="2">Disk</a>
        
                <a data-sort="0297" 
                    href="/archive/?tag=PVE"
                    title="PVE"
                    rel="2">PVE</a>
        
                <a data-sort="0297" 
                    href="/archive/?tag=RAID"
                    title="RAID"
                    rel="2">RAID</a>
        
                <a data-sort="0297" 
                    href="/archive/?tag=bzip2"
                    title="bzip2"
                    rel="2">bzip2</a>
        
                <a data-sort="0297" 
                    href="/archive/?tag=fio"
                    title="fio"
                    rel="2">fio</a>
        
                <a data-sort="0297" 
                    href="/archive/?tag=mds"
                    title="mds"
                    rel="2">mds</a>
        
                <a data-sort="0297" 
                    href="/archive/?tag=netconsole"
                    title="netconsole"
                    rel="2">netconsole</a>
        
                <a data-sort="0297" 
                    href="/archive/?tag=network"
                    title="network"
                    rel="2">network</a>
        
                <a data-sort="0297" 
                    href="/archive/?tag=pbzip2"
                    title="pbzip2"
                    rel="2">pbzip2</a>
        
                <a data-sort="0297" 
                    href="/archive/?tag=sed"
                    title="sed"
                    rel="2">sed</a>
        
                <a data-sort="0297" 
                    href="/archive/?tag=serial"
                    title="serial"
                    rel="2">serial</a>
        
                <a data-sort="0297" 
                    href="/archive/?tag=ssh"
                    title="ssh"
                    rel="2">ssh</a>
        
                <a data-sort="0297" 
                    href="/archive/?tag=tr"
                    title="tr"
                    rel="2">tr
    </div>
</section>


                <!-- Friends Blog -->
                
<hr>
<h5>FRIENDS</h5>
<ul class="list-inline">
  
  <li><a href=""></a></li>
  
  <li><a href="http://bean-li.github.io/">Bean Li</a></li>
  
  <li><a href="https://zphj1987.com/">武汉-磨渣</a></li>
  
</ul>

            </div>
        </div>
    </div>
</article>

<!-- add support for mathjax by voleking-->






<!-- disqus 公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = "Gavin";
    var disqus_identifier = "/2021/11/04/pytest_allure";
    var disqus_url = "http://0.0.0.0:4000/2021/11/04/pytest_allure/";

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<!-- disqus 公共JS代码 end -->




<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>
<!-- anchor-js, Doc:http://bryanbraun.github.io/anchorjs/ -->
<script>
    async("//cdnjs.cloudflare.com/ajax/libs/anchor-js/1.1.1/anchor.min.js",function(){
        anchors.options = {
          visible: 'hover',
          placement: 'right',
          // icon: '#'
        };
        anchors.add().remove('.intro-header h1').remove('.subheading').remove('.sidebar-container h5');
    })
</script>
<style>
    /* place left on bigger screen */
    @media all and (min-width: 800px) {
        .anchorjs-link{
            position: absolute;
            left: -0.75em;
            font-size: 1.1em;
            margin-top : -0.1em;
        }
    }
</style>



    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <!-- SNS Link -->
                


<ul class="list-inline text-center">


  
  
  
  
  
  
  
</ul>

                <p class="copyright text-muted">
                    Copyright &copy; Gavin Blog 2023
                    <br>
                    Powered by <a href="https://gavin-wang-note.github.io/index.html">Gavin Blog</a> |
                    <iframe
                        style="margin-left: 2px; margin-bottom:-5px;"
                        frameborder="0" scrolling="0" width="100px" height="20px"
                        src="https://ghbtns.com/github-btn.html?user=gavinpro&repo=gavin.github.io&type=star&count=true" >
                    </iframe>
                </p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js "></script>

<!-- Bootstrap Core JavaScript -->
<!-- Currently, only navbar scroll-down effect at desktop still depends on this -->
<script src="/js/bootstrap.min.js "></script>

<!-- Custom Theme JavaScript -->
<script src="/js/gavin-blog.min.js "></script>

<!-- Service Worker -->

<script src="/js/snackbar.js "></script>
<script src="/js/sw-registration.js "></script>


<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>

<!--
     Because of the native support for backtick-style fenced code blocks
     right within the Markdown is landed in Github Pages,
     From V1.6, There is no need for Highlight.js,
     so Gavinblog drops it officially.

     - https://github.com/blog/2100-github-pages-now-faster-and-simpler-with-jekyll-3-0
     - https://help.github.com/articles/creating-and-highlighting-code-blocks/
     - https://github.com/jneen/rouge/wiki/list-of-supported-languages-and-lexers
-->
<!--
    <script>
        async("http://cdn.bootcss.com/highlight.js/8.6/highlight.min.js", function(){
            hljs.initHighlightingOnLoad();
        })
    </script>
    <link href="http://cdn.bootcss.com/highlight.js/8.6/styles/github.min.css" rel="stylesheet">
-->





<!--fastClick.js -->
<script>
    async("//cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>


<!-- Google Analytics -->

<script>
    // dynamic User by Gavin
    var _gaId = 'UA-49627206-1';
    var _gaDomain = '';

    // Originial
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', _gaId, _gaDomain);
    ga('send', 'pageview');
</script>



<!-- Baidu Tongji -->



<!-- Side Catalog -->

<script type="text/javascript">
    function generateCatalog (selector) {

        // interop with multilangual 
        if ('' == 'true') {
            _containerSelector = 'div.post-container.active'
        } else {
            _containerSelector = 'div.post-container'
        }

        // init
        var P = $(_containerSelector),a,n,t,l,i,c;
        a = P.find('h1,h2,h3,h4,h5,h6');

        // clean
        $(selector).html('')

        // appending
        a.each(function () {
            n = $(this).prop('tagName').toLowerCase();
            i = "#"+$(this).prop('id');
            t = $(this).text();
            c = $('<a href="'+i+'" rel="nofollow">'+t+'</a>');
            l = $('<li class="'+n+'_nav"></li>').append(c);
            $(selector).append(l);
        });
        return true;
    }

    generateCatalog(".catalog-body");

    // toggle side catalog
    $(".catalog-toggle").click((function(e){
        e.preventDefault();
        $('.side-catalog').toggleClass("fold")
    }))

    /*
     * Doc: https://github.com/davist11/jQuery-One-Page-Nav
     * Fork by Gavin to support padding
     */
    async("/js/jquery.nav.js", function () {
        $('.catalog-body').onePageNav({
            currentClass: "active",
            changeHash: !1,
            easing: "swing",
            filter: "",
            scrollSpeed: 700,
            scrollOffset: 0,
            scrollThreshold: .2,
            begin: null,
            end: null,
            scrollChange: null,
            padding: 80
        });
    });
</script>



<!-- Multi-Lingual -->



</body>

</html>
