I"…<h1 id="ä¸ºä»€ä¹ˆéœ€è¦netconsole">ä¸ºä»€ä¹ˆéœ€è¦netconsole</h1>

<p>å¾ˆå¤šæ—¶å€™ï¼Œå¾ˆéš¾æŠ“åˆ°kernel panicï¼Œå› ä¸ºä¸çŸ¥é“å¦‚ä½•å¤ç°ã€‚ æ›´æƒ¨çš„æ˜¯ï¼Œä¸€æ—¦ç³»ç»Ÿé‡å¯ï¼Œç³»ç»Ÿçš„logä¸­å› ä¸ºå†…æ ¸å¼‚å¸¸å¯èƒ½æ²¡æœ‰è®°å½•ä¸‹æœ‰ç”¨çš„ä¿¡æ¯ã€‚è¿™æ—¶å€™netconsoleå°±å¯ä»¥è·³å‡ºæ¥å¸®å¿™äº†ã€‚</p>

<p>æ¯”å¦‚å‡ºç°CPU soft lockupçš„é—®é¢˜ï¼Œé‡å¯ä¹‹åï¼Œä»kernel.logä¸­å¹¶æœªæ‰¾åˆ°æ˜æ˜¾çš„çº¿ç´¢ï¼Œä½¿ç”¨netconsoleï¼Œè®©kernel logè¾“å‡ºåˆ°å¦ä¸€å°æœºå™¨ä¸Šï¼Œè¿™æ ·çš„è¯ï¼Œå¦‚æœæœ¬åœ°ä¸èƒ½å†™ç£ç›˜æ–‡ä»¶ï¼Œkernelçš„printkè¿˜å¯ä»¥é€šè¿‡ç½‘ç»œï¼Œå°†æ‰“å°çš„å†…å®¹è®°å½•åœ¨å¦ä¸€å°æœºå™¨ä¸Šã€‚</p>

<p>netconsoleæ˜¯ä¸€ä¸ªå†…æ ¸æ¨¡å—ï¼Œæˆ‘ä»¬å­˜å‚¨çš„å†…æ ¸å°†netconsoleä»¥moduleçš„å½¢å¼ç¼–è¿›äº†å†…æ ¸ï¼Œå…è®¸å°†å…¶ä½œä¸ºæ¨¡å—åŠ </p>

<p><code class="highlighter-rouge">root@node-191:~# grep NETCONSOLE /boot/config-3.14.35-server CONFIGNETCONSOLE=m CONFIGNETCONSOLE_DYNAMIC=y</code></p>

<p>Ubuntuçš„wikiç»™å‡ºäº†ä¸€ä¸ªå¾ˆå¥½çš„é¡µé¢ï¼Œä»‹ç»netconsoleä»‹ç»çš„å¾ˆè¯¦ç»†ï¼š<code class="highlighter-rouge">https://wiki.ubuntu.com/Kernel/Netconsole</code></p>

<h1 id="linux-serverç«¯è¿è¡Œæ—¶é…ç½®">Linux serverç«¯è¿è¡Œæ—¶é…ç½®</h1>

<p>Netconsole can be loaded as one of?kernel modules? manually after boot or auto during boot depending on this module config. See?kernel modules?for configuring it to load at boot. For loading manually any time after boot:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># set log level for kernel messages
dmesg -n 7
modprobe configfs
modprobe netconsole
mount none -t configfs /sys/kernel/config
# 'netconsole' dir is auto created if the module is loaded 
mkdir /sys/kernel/config/netconsole/target1
cd /sys/kernel/config/netconsole/target1
# set local IP address
echo 192.168.0.111 &gt; local_ip
# set destination IP address
echo 192.168.0.17 &gt; remote_ip
# find destination MAC address
arping `cat remote_ip` -f |grep -o ..:..:..:..:..:.. &gt; remote_mac
echo 1 &gt; enabled

</code></pre></div></div>

<h1 id="to-verify">To verify</h1>

<p>netconsole should now be configured. To verify, run <code class="highlighter-rouge">dmesg |tail</code> and you should see â€œnetconsole: network logging startedâ€. Check available log levels by running <code class="highlighter-rouge">dmesg -h</code>.</p>

<h1 id="æ¥æ”¶ç«¯é…ç½®å¯ä»¥é€‰æ‹©ä¸€å°è™šæ‹Ÿæœº">æ¥æ”¶ç«¯é…ç½®ï¼ˆå¯ä»¥é€‰æ‹©ä¸€å°è™šæ‹Ÿæœºï¼‰</h1>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nc -u -l 6666
or
nc -u -l -p 6666
</code></pre></div></div>

<ul>
  <li>è¯´æ˜ï¼š</li>
  <li>
    <ul>
      <li>Ubuntu 14.4æŒ‰ç…§ä¸Šé¢çš„è®¾ç½®æ— æ•ˆ, å…·ä½“è®¾ç½®ï¼Œå‚è€ƒï¼š
<code class="highlighter-rouge">http://blog.51cto.com/7938217/1662524</code></li>
    </ul>
  </li>
  <li>
    <ul>
      <li>shellè„šæœ¬è¿è¡Œåœ¨è¢«æµ‹è¯•èŠ‚ç‚¹ï¼Œkern logä¿¡æ¯ä¼šè¢«syncåˆ°æœ‰è®¾ç½®confçš„èŠ‚ç‚¹ï¼ˆè¯¥èŠ‚ç‚¹é‡å¯rsyslogæœåŠ¡ï¼‰</li>
    </ul>
  </li>
</ul>

:ET