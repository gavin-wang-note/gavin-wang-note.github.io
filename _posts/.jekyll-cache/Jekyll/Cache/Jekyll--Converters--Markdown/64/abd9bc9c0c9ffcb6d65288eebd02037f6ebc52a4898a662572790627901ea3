I"ûJ<h1 id="å‰è¨€">å‰è¨€</h1>

<p>è‡ª2018-05-01æäº¤ç¬¬ä¸€ä¸ªcommitä»¥æ¥ï¼Œåœ¨ä¸å½±å“æ­£å¸¸æµ‹è¯•å·¥ä½œreleaseç‰ˆæœ¬æƒ…å†µä¸‹ï¼Œæ–­æ–­ç»­ç»­çš„æŒç»­äº†1å¹´8ä¸ªæœˆçš„è‡ªåŠ¨åŒ–å¼€å‘åœ¨ä»Šå¤©(2019-12-31)æ”¶å°¾äº†ï¼Œæ€»æµ‹è¯•ç”¨ä¾‹æ•°ä¸º1310ä¸ªï¼Œä¸€è·¯èµ°æ¥æ·±æœ‰æ„Ÿæ…¨ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚</p>

<p>è™½ç„¶æ”¶å°¾äº†ï¼Œä½†åæœŸç‰ˆæœ¬åŠŸèƒ½å‘ç”Ÿå˜åŒ–ï¼Œæˆ–è€…ç”¨ä¾‹å¼€å‘è¿‡ç¨‹ä¸­æœ‰ä¸€äº›bugæœªè€ƒè™‘åˆ°å¯¼è‡´ç”¨ä¾‹æ‰§è¡Œå¤±è´¥çš„ï¼Œè¿˜æ˜¯éœ€è¦å¯¹ç”¨ä¾‹è¿›è¡Œä¿®æ”¹ã€ä¼˜åŒ–ï¼Œæ€»ä¹‹ï¼Œä¸€ä¸ªäº§å“è‡ªåŠ¨åŒ–çš„å®Œå–„ï¼Œéœ€è¦ä¸€ä¸ªå¾ªåºæ¸è¿›çš„è¿‡ç¨‹ï¼ŒæŒä¹‹ä»¥æ’ï¼Œæ€»ä¼šæ¸å˜æ¸å¥½ï¼</p>

<p>æœ¬æ–‡è®°å½•äº†åœ¨å¼€å‘äº§å“è‡ªåŠ¨åŒ–æœŸé—´(Base on Ubuntu12.04)ï¼Œæ‰€éœ€è¦çš„ä¸€äº›æ¡ä»¶ã€ç¢°åˆ°çš„é—®é¢˜ã€æ³¨æ„äº‹é¡¹ç­‰ï¼Œå¦‚æœæƒ³äº†è§£Nose frameworkçš„å…·ä½“ä½¿ç”¨ï¼Œè¯·å‚è€ƒNoseå®˜ç½‘å§ï¼Œå®˜ç½‘æœ‰è¯¦ç»†çš„guideã€‚</p>

<h1 id="å¿…è¦çš„å®‰è£…å‡çº§ä¿®æ”¹">å¿…è¦çš„å®‰è£…/å‡çº§/ä¿®æ”¹</h1>

<p>è¯´æ˜ï¼š</p>
<ul>
  <li>åœ¨çº¿å®‰è£…ï¼Œæ‰€ä»¥å­˜å‚¨èŠ‚ç‚¹è¦é…ç½® dns serverï¼›</li>
  <li>æœ¬ç« èŠ‚çš„å¦‚ä¸‹æ“ä½œï¼Œæ— éœ€æ‰‹åŠ¨å®‰è£…ï¼Œåªéœ€è¦æ‰§è¡Œ run.pyï¼Œè‡ªåŠ¨å®Œæˆæœ¬ç« èŠ‚çš„æ‰€æœ‰å®‰è£…åŠ¨ä½œã€‚æœ¬ç« èŠ‚ä»…ä¸ºäº†è®°å½•è¦å®‰è£…å“ªäº›æ¨¡å—ã€æ’ä»¶ã€ä¿®æ”¹ç­‰ä¿¡æ¯ã€‚</li>
</ul>

<h2 id="1éäº§å“os-ä½œä¸ºå®¢æˆ·ç«¯éœ€è¦å®‰è£…çš„è½¯ä»¶">1ã€éäº§å“OS ä½œä¸ºå®¢æˆ·ç«¯éœ€è¦å®‰è£…çš„è½¯ä»¶</h2>

<p>æœ¬ç« èŠ‚ä»¥ ubuntu ä¸ºä¾‹ï¼Œå…¶ä»–ç±»å‹çš„ OSï¼Œä¸åšè€ƒè™‘ï¼Œä¸” OS å¹¶ä¸æ˜¯æˆ‘ä»¬çš„äº§å“ã€‚</p>

<p>éœ€è¦å®‰è£… multipath-toolsï¼Œ fioï¼Œopenssh-serverï¼ˆæ”¯æŒ ssh æŒ‡ä»¤ï¼‰ï¼Œ open-iscsiï¼ˆæ”¯æŒ iscsiadmæŒ‡ä»¤ï¼‰ï¼Œ NFS  å’Œ CIFSã€‚ ä¸Šè¿°è½¯ä»¶å®‰è£…æŒ‡ä»¤å¦‚ä¸‹ï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>apt-get install open-iscsi
apt-get install openssh-server apt-get install multipath-tools apt-get install fio
apt-get install cifs-utils
apt-get install nfs-kernel-server
</code></pre></div></div>

<p>å¦‚æœå®¢æˆ·ç«¯æ˜¯å®˜æ–¹çš„Ubuntuï¼Œé‚£è‚¯å®šæ˜¯æ²¡æœ‰å®‰è£… NFS å’Œ CIFS çš„ï¼Œmount NFS/CIFS ä¼šå‡ºé—®é¢˜ï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@nose-ubuntu:/mnt# mount -t nfs 10.16.172.246:/vol/nose_nas /mnt/test mount: wrong fs type, bad option, bad superblock on 10.16.172.246:/vol/nose_nas,
missing codepage or helper program, or other error (for several filesystems (e.g. nfs, cifs) you might need a /sbin/mount.&lt;type&gt; helper program)

In some cases useful info is found in syslog - try dmesg | tail or so.


root@nose-ubuntu:/mnt# mount -t cifs //10.16.172.246/nose_nas_src /mnt/test/ mount: wrong fs type, bad option, bad superblock on //10.16.172.246/nose_nas_src,
missing codepage or helper program, or other error (for several filesystems (e.g. nfs, cifs) you might
need a /sbin/mount.&lt;type&gt; helper program)

In some cases useful info is found in syslog - try dmesg | tail or so.

root@nose-ubuntu:/mnt# dmesg | tail
[  141.523611] device-mapper: multipath: Failing path 65:0. [ 141.638465] device-mapper: multipath: Failing path 65:32. [ 141.638545] device-mapper: multipath: Failing path 65:112. [ 141.687588] device-mapper: multipath: Failing path 65:112. 
[846862.989111] FS-Cache: Loaded
[846862.997304] RPC: Registered named UNIX socket transport module. [846862.997307] RPC: Registered udp transport module. [846862.997308] RPC: Registered tcp transport module.
[846862.997309] RPC: Registered tcp NFSv4.1 backchannel transport module.
[846863.007999] FS-Cache: Netfs 'nfs' registered for caching

</code></pre></div></div>

<p>æ‰€ä»¥éœ€è¦è¿›è¡Œå®‰è£…ï¼ŒæˆåŠŸå®‰è£…åï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@nose:~# dpkg -l | grep nfs
ii  libnfs4:amd64                        1.10.0-7.0+854+6b837f908                   amd64        NFS client library (shared library)
ii  libnfsidmap2:amd64                   0.25-5                                     amd64        NFS idmapping library
ii  nfs-common                           1:1.2.8-6ubuntu1.2                         amd64        NFS support files common to client and server
ii  nfs-kernel-server                    1:1.2.8-6ubuntu1.2                         amd64        support for NFS kernel server
</code></pre></div></div>

<p>è¯´æ˜ï¼š</p>
<ul>
  <li>ç›®å‰ run.py æœ‰åšæ£€æŸ¥ï¼Œä½†ä¸è¿›è¡Œå®‰è£…ï¼Œå…·ä½“å®‰è£…æ“ä½œï¼Œå°šéœ€æ‰‹åŠ¨æ‰§è¡Œã€‚</li>
</ul>

<h2 id="2å®‰è£…python-pip">2ã€å®‰è£…python-pip</h2>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>apt-get install python-pip
</code></pre></div></div>

<h2 id="3å‡çº§requestsæ¨¡å—">3ã€å‡çº§requestsæ¨¡å—</h2>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip install --upgrade --ignore-installed requests --index-url=https://pypi.python.org/simple

root@44:/var/cache/apt/archives# pip install --upgrade --ignore-installed requests --index-url=https://pypi.python.org/simple
Downloading/unpacking requests
  Downloading requests-2.18.4.tar.gz (126Kb): 126Kb downloaded
  Running setup.py egg_info for package requests
    
    warning: no files found matching 'NOTICE'
Downloading/unpacking chardet&gt;=3.0.2,&lt;3.1.0 (from requests)
  Downloading chardet-3.0.4.tar.gz (1.9Mb): 1.9Mb downloaded
  Running setup.py egg_info for package chardet
    
    warning: no files found matching 'requirements.txt'
Downloading/unpacking idna&gt;=2.5,&lt;2.7 (from requests)
  Downloading idna-2.6.tar.gz (135Kb): 135Kb downloaded
  Running setup.py egg_info for package idna
    
    warning: no previously-included files matching '*.pyc' found under directory 'tools'
    warning: no previously-included files matching '*.pyc' found under directory 'tests'
Downloading/unpacking urllib3&gt;=1.21.1,&lt;1.23 (from requests)
  Downloading urllib3-1.22.tar.gz (226Kb): 226Kb downloaded
  Running setup.py egg_info for package urllib3
    
    warning: no previously-included files matching '*' found under directory 'docs/_build'
Downloading/unpacking certifi&gt;=2017.4.17 (from requests)
  Downloading certifi-2018.4.16.tar.gz (149Kb): 149Kb downloaded
  Running setup.py egg_info for package certifi
    
Installing collected packages: requests, chardet, idna, urllib3, certifi
  Found existing installation: requests 1.2.3
    Uninstalling requests:
      Successfully uninstalled requests
  Running setup.py install for requests
    
    warning: no files found matching 'NOTICE'
  Found existing installation: chardet 2.0.1
    Uninstalling chardet:
      Successfully uninstalled chardet
  Running setup.py install for chardet
    
    warning: no files found matching 'requirements.txt'
    Installing chardetect script to /usr/local/bin
  Running setup.py install for idna
    
    warning: no previously-included files matching '*.pyc' found under directory 'tools'
    warning: no previously-included files matching '*.pyc' found under directory 'tests'
  Found existing installation: urllib3 1.6
    Uninstalling urllib3:
      Successfully uninstalled urllib3
  Running setup.py install for urllib3
    
    warning: no previously-included files matching '*' found under directory 'docs/_build'
  Running setup.py install for certifi
    
Successfully installed requests chardet idna urllib3 certifi
Cleaning up...
</code></pre></div></div>

<p>è¯´æ˜ï¼š</p>
<ul>
  <li>requestæ¨¡å—ï¼Œç›®å‰ä»…æœ‰wechatå‘Šè­¦æœ‰ä½¿ç”¨åˆ°ï¼Œå‡çº§ä¸ä¼šå¯¹å­˜å‚¨èŠ‚ç‚¹ä¸­python libå¸¦æ¥é¢å¤–å½±å“ã€‚</li>
</ul>

<h2 id="4å®‰è£…configobjæ¨¡å—">4ã€å®‰è£…configobjæ¨¡å—</h2>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip install configobj
</code></pre></div></div>

<h2 id="5ä½¿ç”¨html-æŠ¥å‘Š">5ã€ä½¿ç”¨html æŠ¥å‘Š</h2>

<p>å‚è€ƒèµ„æ–™: <code class="highlighter-rouge">https://pypi.org/project/nose-html-reporting/</code></p>

<p>å®‰è£…å‘½ä»¤ï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip install nose-html-reporting
</code></pre></div></div>

<h2 id="6å®‰è£…nose">6ã€å®‰è£…nose</h2>

<p>å­˜å‚¨èŠ‚ç‚¹ç³»ç»Ÿå®‰è£…å¥½åè‡ªå¸¦noseï¼Œæ— éœ€å®‰è£…ã€å‡çº§ã€‚</p>

<h2 id="7ä¿®æ”¹nose_html_reportinginitpy">7ã€ä¿®æ”¹nose_html_reporting/<strong>init</strong>.py</h2>

<p>å¦‚æœä¸ä¿®æ”¹ï¼Œä¼šæŠ¥å¦‚ä¸‹é”™è¯¯ï¼š</p>

<p><img class="shadow" src="/img/in-post/modify_nose_html_report_init.png" width="1200" /></p>

<p>è§£å†³æ–¹æ³•ï¼š</p>

<p><code class="highlighter-rouge">vi /usr/local/lib/python2.7/dist-packages/nose_html_reporting-0.2.3-py2.7.egg/nose_html_reporting/__init__.py</code></p>

<p>ä¿®æ”¹ <code class="highlighter-rouge">/usr/local/lib/python2.7/dist-packages/nose_html_reporting-0.2.3-py2.7.egg/nose_html_reportingç›®å½•ä¸‹__init__.pyï¼Œ</code>
å°†203è¡Œ <code class="highlighter-rouge">lstrip_blocks=True</code>æ³¨é‡Šæ‰ï¼Œå¹¶åˆ é™¤æ‰äº§ç”Ÿçš„pycæ–‡ä»¶ã€‚</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@44:/home/nose_test/src# cd /usr/local/lib/python2.7/dist-packages/nose_html_reporting/
root@44:/usr/local/lib/python2.7/dist-packages/nose_html_reporting# rm __init__.pyc
</code></pre></div></div>

<p>è¯´æ˜ï¼š</p>
<ul>
  <li>ä¿®è¿‡__init__.pyæ“ä½œæ— éœ€äººå·¥å¹²é¢„ï¼Œrun.pyè„šæœ¬ä¸­å·²ç»æœ‰ä¿®è¿‡åŠ¨ä½œã€‚</li>
</ul>

<h2 id="8å®‰è£…nose-testconfig">8ã€å®‰è£…nose-testconfig</h2>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip install nose-testconfig --index-url=https://pypi.python.org/simple
</code></pre></div></div>

<p>è¿™ä¸ªæ¨¡å—æ˜¯noseçš„æ’ä»¶ï¼Œç”¨æˆ·ç”¨ä¾‹æ‰§è¡Œæ—¶ï¼Œæ¥å—ç”¨æˆ·æŒ‡å®šçš„è‡ªå®šä¹‰å¾ªç¯æ‰§è¡Œç”¨ä¾‹çš„æ¬¡æ•°ï¼Œå¿…é¡»å®‰è£…ã€‚</p>

<h2 id="9å®‰è£…å…³é”®å­—é«˜äº®plugin">9ã€å®‰è£…å…³é”®å­—é«˜äº®plugin</h2>

<p>å‚è€ƒèµ„æ–™</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://gitee.com/walkingnine/colorunit
https://pypi.org/project/colorama/#files
</code></pre></div></div>

<p>éœ€è¦å®‰è£…å¦‚ä¸‹è¿™ä¸ªåŒ…ï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>colorama-0.3.9.tar.gz
walkingnine-colorunit.gz
</code></pre></div></div>

<p>è¯´æ˜ï¼š</p>
<ul>
  <li>å®‰è£…ä¸Šé¢å®‰è£…åŒ…åï¼Œæºç æœ‰é—®é¢˜ï¼Œéœ€è¦ä¿®æ”¹ä¸€äº›ä¸œè¥¿ï¼Œè¿™é‡Œæ˜¯ä¿®æ”¹å¥½äº†åï¼Œé‡æ–°æ‰“äº†å®‰è£…åŒ…ã€‚</li>
</ul>

<p>ç‰¹åˆ«è¯´æ˜ï¼š</p>
<ul>
  <li>æµ‹è¯•ç”¨ä¾‹ä¸­ä¸éœ€è¦æ·»åŠ ä¸‹åˆ—æ­¥éª¤ä¸­å†…å®¹ï¼Œåªè¦åœ¨nosetestsæ‰§è¡Œç”¨ä¾‹çš„æ—¶å€™ï¼Œä½¿ç”¨â€“with-colorunitå‚æ•°å³å¯ã€‚</li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>import nose; 
from colorunit import ColorUnit
  å’Œï¼š
if __name__ == '__main__':
    nose.main(addplugins = [ColorUnit()])
</code></pre></div></div>

<h2 id="10ç”¨ä¾‹è¿›åº¦">10ã€ç”¨ä¾‹è¿›åº¦</h2>

<p>å‚è€ƒèµ„æ–™</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://github.com/erikrose/blessings
https://github.com/erikrose/nose-progressive
</code></pre></div></div>

<p>æºç è¦æ±‚ä¾èµ–nose 1.2.xï¼Œç›®å‰äº§å“Ubuntu 14.04è‡ªå¸¦nose ç‰ˆæœ¬æ˜¯1.1.2ï¼Œæ‰€ä»¥æ›´æ”¹äº†æºç ç‰ˆæœ¬è¦æ±‚ï¼Œå¹¶é‡æ–°æ‰“åŒ…ï¼Œæ— éœ€å†æ¬¡ä¿®è¿‡ï¼Œç›´æ¥å®‰è£…python_3rd_libç›®å½•ä¸‹å¯¹åº”å®‰è£…åŒ…å³å¯ã€‚</p>

<h2 id="11pylintæ‰§è¡ŒæŠ¥é”™">11ã€pylintæ‰§è¡ŒæŠ¥é”™</h2>

<p><img class="shadow" src="/img/in-post/nose_pylint_error.png" width="1200" /></p>

<p>åŸå› :</p>

<p>æœªå®‰è£…pylintï¼Œ è§£å†³æ–¹æ³•ï¼š</p>

<p>è¿›å…¥nose_framework/python_3rd_lib/ï¼Œè§£å‹pylint-1.7.6.tar.gzï¼Œè¿›å…¥è§£å‹ç¼©ç›®å½•ï¼Œé‡æ–°è¿›è¡Œpylintçš„å®‰è£…ï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd pylint-1.7.6
python setup.py install
</code></pre></div></div>

<h1 id="noseçš„æ—¥å¸¸ä½¿ç”¨">noseçš„æ—¥å¸¸ä½¿ç”¨</h1>

<h2 id="1å¸¸ç”¨å‚æ•°ä»‹ç»">1ã€å¸¸ç”¨å‚æ•°ä»‹ç»</h2>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>-v : debugæ¨¡å¼ï¼Œçœ‹åˆ°å…·ä½“æ‰§è¡Œæƒ…å†µï¼Œæ¨èå¤§å®¶æ‰§è¡Œæ—¶ç”¨è¿™ä¸ªé€‰é¡¹ã€‚
-s : noseä¼šæ•è·æ ‡å‡†è¾“å‡ºï¼Œè°ƒè¯•çš„printä»£ç é»˜è®¤ä¸ä¼šæ‰“å°ã€‚
   nosetest -s å¯æ‰“å¼€outputè¾“å‡ºï¼Œå¦åˆ™å…¨éƒ¨é€šè¿‡æ—¶ä¸æ‰“å°stdoutã€‚
   
-x : ä¸€æ—¦caseå¤±è´¥ç«‹å³åœæ­¢ï¼Œä¸æ‰§è¡Œåç»­case
-w : æŒ‡å®šä¸€ä¸ªç›®å½•è¿è¡Œæµ‹è¯•ã€‚ç›®å½•å¯ä»¥æ˜¯ç›¸å¯¹è·¯å¾„æˆ–ç»å¯¹è·¯å¾„.
--tests : é»˜è®¤æƒ…å†µä¸‹ï¼Œnosetestsä¼šæ‰§è¡Œæ‰€æœ‰çš„æµ‹è¯•ç”¨ä¾‹ï¼Œè‹¥æƒ³å•ç‹¬åªæ‰§è¡Œä¸€ä¸ªcaseï¼Œ
       æ‰§è¡Œnosetest --tests åè·Ÿè¦æµ‹è¯•çš„æ–‡ä»¶(nosetestsåé¢ç›´æ¥è·Ÿæ–‡ä»¶åï¼Œå…¶å®ä¹Ÿå¯ä»¥
       ç›´æ¥è¿è¡Œè¯¥caseã€‚
--collect-only :  nosetests --collect-only -vï¼Œä¸è¿è¡Œç¨‹åºï¼Œåªæ˜¯æœé›†å¹¶è¾“å‡ºå„ä¸ªcaseçš„åç§°ã€‚
--processes ï¼š éœ€è¦å®‰è£…æ’ä»¶ï¼Œ--processes=20ï¼Œ å¹¶å‘æ‰§è¡Œç”¨ä¾‹ï¼Œè§£å†³ç”¨ä¾‹æ€»ä½“æ‰§è¡Œæ—¶é—´
--with-progressiveï¼š éœ€è¦å®‰è£…æ’ä»¶ï¼Œå®æ—¶å±•ç¤ºç”¨ä¾‹æ‰§è¡Œè¿›åº¦
--with-colorunit ï¼š éœ€è¦å®‰è£…æ’ä»¶ï¼Œç”¨ä¾‹æ‰§è¡Œç»“æœå±•ç¤ºçš„stdoutï¼Œä»¥é¢œè‰²é«˜äº®å±•ç¤º
--with-html ï¼š éœ€è¦å®‰è£…æ’ä»¶ï¼Œä¸”éœ€è¦å’Œ--html-reportç»“åˆèµ·æ¥ä½¿ç”¨ã€‚è¿™ä¸ªæ’ä»¶ï¼Œç”ŸæˆHTML
             æ ¼å¼çš„æµ‹è¯•æŠ¥å‘Šï¼Œè¯¥æµ‹è¯•æŠ¥å‘Šï¼Œæ˜¯ä»¥report2.jinja2ä½œä¸ºæ¨¡æ¿ã€‚ å¦‚æœè¦æŒ‡å®šè‡ª
             å®šä¹‰æ¨¡æ¿ï¼Œå¯ä»¥ä½¿ç”¨--html-report-templateå‚æ•°ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š
--with-colorunit --with-html --html-report=../report/sds.html --html-report-template=/usr/local/lib/python2.7/dist-packages/nose_html_reporting/templates/report2.jinja2

--tc : éœ€è¦å®‰è£…æ’ä»¶ï¼ŒæŒ‡å®šç”¨ä¾‹è¿è¡Œæ¬¡æ•°ï¼Œç›®å‰å‚æ•°åç§°å†™æ­»ï¼šrunsï¼Œç¤ºä¾‹ï¼š--tc=runs:20
</code></pre></div></div>

<h2 id="2å·¥å…·nosetoolsçš„ä½¿ç”¨">2ã€å·¥å…·nose.toolsçš„ä½¿ç”¨</h2>

<h3 id="æ‰“æ ‡ç­¾">æ‰“æ ‡ç­¾</h3>

<p>æ‰“æ ‡ç­¾çš„å¥½å¤„æ˜¯ï¼Œå¯ä»¥æ‰§è¡Œå¸¦æœ‰æŸäº›ç‰¹å®štagçš„ç”¨ä¾‹ï¼Œè¿™é‡Œç”¨tagï¼Œæ˜¯å€Ÿç”¨äº†RFçš„æ¦‚å¿µï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>from nose.plugins.attrib import attr
@attr('slow')
def test_big_download():
    pass

@attr(speed='slow')
def test_big_download():
    pass
</code></pre></div></div>

<p>æ‰§è¡Œçš„æ—¶å€™ï¼Œå¸¦ä¸Š -aå‚æ•°ï¼š</p>

<p><code class="highlighter-rouge">nosetests -a '!slow'</code></p>

<h3 id="æ˜¯å¦æµ‹è¯•">æ˜¯å¦æµ‹è¯•</h3>

<p>æµ‹è¯•è„šæœ¬ä¸­å¼•å…¥ï¼š<code class="highlighter-rouge">from nose.tools import nottest,istest</code></p>

<p>1ï¼‰ä¸æµ‹è¯•çš„æ–¹æ³•ï¼šæ–¹æ³•åä¸ŠåŠ ä¿®é¥°å™¨@nottestï¼›</p>

<p>2ï¼‰æŒ‡å®šä¸ºæµ‹è¯•æ–¹æ³•ï¼šæ–¹æ³•åä¸ŠåŠ ä¿®é¥°å™¨@istestï¼ˆæ–¹æ³•åæ— éœ€ç¬¦åˆå‘½åè§„åˆ™ï¼‰</p>

<h3 id="æ–­è¨€">æ–­è¨€</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt;&gt;&gt; from nose import tools
&gt;&gt;&gt; dir(tools)
['TimeExpired', '__all__', '__builtins__', '__doc__', '__file__', '__name__', '__package__', '__path__', 'assert_almost_equal', 'assert_almost_equals', 'assert_dict_contains_subset', 'assert_dict_equal', 'assert_equal', 'assert_equals', 'assert_false', 'assert_greater', 'assert_greater_equal', 'assert_in', 'assert_is', 'assert_is_instance', 'assert_is_none', 'assert_is_not', 'assert_is_not_none', 'assert_items_equal', 'assert_less', 'assert_less_equal', 'assert_list_equal', 'assert_multi_line_equal', 'assert_not_almost_equal', 'assert_not_almost_equals', 'assert_not_equal', 'assert_not_equals', 'assert_not_in', 'assert_not_is_instance', 'assert_not_regexp_matches', 'assert_raises', 'assert_raises_regexp', 'assert_regexp_matches', 'assert_sequence_equal', 'assert_set_equal', 'assert_true', 'assert_tuple_equal', 'eq_', 'istest', 'make_decorator', 'nontrivial', 'nontrivial_all', 'nottest', 'ok_', 'raises', 'set_trace', 'timed', 'trivial', 'trivial_all', 'with_setup']
&gt;&gt;&gt;
</code></pre></div></div>

<h1 id="nose-setupteardown-ä»‹ç»">nose setUP/tearDown ä»‹ç»</h1>

<p>noseé‡Œé¢æœ‰å¤šç§å¯ç”¨çš„setupå’Œteardown</p>

<h2 id="1packageçº§åˆ«çš„">1ã€Packageçº§åˆ«çš„</h2>

<p>å†™åœ¨init.pyæ–‡ä»¶é‡ŒåŒ…è£…</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>def setup_package():
    pass

def teardown_package():
    pass
</code></pre></div></div>

<h2 id="2moduleçº§åˆ«çš„">2ã€Moduleçº§åˆ«çš„</h2>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>def setup_module():
    pass

def teardown_module():
    pass
</code></pre></div></div>

<h2 id="3classçº§åˆ«çš„">3ã€Classçº§åˆ«çš„</h2>

<p>åŒ…è£…class,æ‰€ä»¥åªæ‰§è¡Œä¸€æ¬¡</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@Scaler03:~# cat class_method.py
class TestClass():
    @classmethod
    def setup_class(cls):
        print "class method setup"
        
    @classmethod
    def teardown_class(cls):
        print "class method teardown"
        
    
    def test1(self):
        print "test1"

    def test2(self):
        print "test2"

    def test3(self):
        print "test3"
root@Scaler03:~#
</code></pre></div></div>

<p>æ‰§è¡Œç»“æœ</p>

<p><img class="shadow" src="/img/in-post/nose_eg01.png" width="1200" /></p>

<p>åœ¨noseä¸­ï¼Œä¸éœ€è¦å†™ç±»ï¼Œåªå†™å‡½æ•°å¯èƒ½å°±è¶³å¤Ÿäº†ï¼Œæ‰€ä»¥ç›´æ¥åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­å†™:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@Scaler03:~# cat nose_method_setup.py
def setup():
    print "setup"

def teardown():
    print "teardown"

def test_xxx():
    print "this is test xxx"

def test_yyy():
    print "this is test yyy"

root@Scaler03:~#
</code></pre></div></div>

<p>ç±»ä¼¼çš„ï¼Œä¹Ÿæ˜¯å¯¹æ•´ä¸ªæ–‡ä»¶è€Œè¨€ï¼Œæ•ˆæœåŒä¸Šï¼Œæµ‹è¯•ç»“æœå¦‚ä¸‹ï¼š</p>

<p><img class="shadow" src="/img/in-post/nose_eg02.png" width="1200" /></p>

<h2 id="4classæ–¹æ³•çº§åˆ«">4ã€Classæ–¹æ³•çº§åˆ«</h2>

<p>åŒ…è£…æ¯ä¸€ä¸ªtestæ–¹æ³•ï¼Œæ‰€ä»¥æ¯ä¸€ä¸ªtestå‡½æ•°çš„å‰åéƒ½ä¼šæ‰§è¡Œã€‚</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@node97:/home/nose_framework/src/testcase/Function_Test/case_2_Accounts# cat ../../../testcasebase/Account/wyz.py
#!/usr/bin/env python
# -*- coding:UTF-8 -*-

from __future__ import unicode_literals

import logging


from common.testcasebase import TestBase


class WYZManager(TestBase):
    """  account manager test case base class  """

    def __init__(self):
        super(WYZManager, self).__init__()
root@node97:/home/nose_framework/src/testcase/Function_Test/case_2_Accounts# cat wyz_test.py
#!/usr/bin/env python


from testcasebase.Account.wyz import WYZManager


class TestNose(WYZManager):
    def setUp(self):
       print "\nsetup"

    def tearDown(self):
        print("teardown")

    def test_case1(self):
        """  case 1  """
        print("this is test case 1")

    def test_case2(self):
        """  case 2  """
        print("this is test case 2")

    def test_case3(self):
        """  case 3  """
        print("this is test case 3")
</code></pre></div></div>

<p>æ‰§è¡Œç»“æœï¼š</p>

<p><img class="shadow" src="/img/in-post/nose_eg03.png" width="1200" /></p>

<p>ä»æ‰§è¡Œç»“æœå¯ä»¥çœ‹å‡ºï¼Œæµ‹è¯•ç±»ä¸­çš„setUp å’Œ tearDownï¼Œä¼šåœ¨æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹ä¸­è°ƒç”¨ï¼Œå³æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹æ‰§è¡Œå‰ï¼Œéƒ½ä¼šæ‰§è¡Œä¸€æ¬¡setUpï¼Œç”¨ä¾‹æ‰§è¡Œç»“æŸåï¼Œä¼šæ‰§è¡ŒtearDownã€‚</p>

<h2 id="5åŒ…è£…æŸä¸ªå‡½æ•°">5ã€åŒ…è£…æŸä¸ªå‡½æ•°</h2>

<p>æµ‹è¯•å‡½æ•°ä¹Ÿå¯å®šä¹‰setupå’Œteardownå±æ€§ï¼Œå®ƒä»¬å°†ä¼šåœ¨æµ‹è¯•å‡½æ•°å¼€å§‹å’Œç»“æŸçš„æ—¶å€™è¿è¡Œã€‚è¿˜å¯ä»¥ä½¿ç”¨@with_setupè£…é¥°å™¨ï¼Œè¯¥æ–¹å¼å°¤å…¶é€‚ç”¨äºåœ¨ç›¸åŒçš„æ¨¡å—ä¸­çš„è®¸å¤šæ–¹æ³•éœ€è¦ç›¸åŒçš„setupæ“ä½œ</p>

<p>ç¤ºä¾‹ï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@Scaler03:~# cat fun_nose_setup.py
from nose.tools import with_setup

def setup_func():
    print "set up test fixtures\n"
 
def teardown_func():
    print "tear down test fixtures\n"
 
@with_setup(setup_func, teardown_func)
def test1():
    print "test1"
    
@with_setup(setup_func, teardown_func)
def test2():
    print "test2"
    
    
@with_setup(setup_func, teardown_func)
def test3():
    print "test3"    
root@Scaler03:~# 
</code></pre></div></div>

<p>æ‰§è¡Œç»“æœ</p>

<p><img class="shadow" src="/img/in-post/nose_eg04.png" width="1200" /></p>

<h1 id="ç”¨ä¾‹ç¼–å†™è§„åˆ™è¦æ±‚">ç”¨ä¾‹ç¼–å†™è§„åˆ™è¦æ±‚</h1>

<p>1ã€test_xxxx.pyå°½é‡é¿å…é€»è¾‘æ“ä½œï¼Œçº¯ç²¹æ˜¯functionçš„è°ƒç”¨</p>

<p>2ã€æµ‹è¯•ç”¨ä¾‹çš„åç§°ï¼Œå»ºè®®æºå¸¦ä¸Šç”¨ä¾‹çš„ç¼–å·</p>

<p>ä¾‹å¦‚ï¼š</p>

<p><img class="shadow" src="/img/in-post/test_link_case_no.png" width="400" /></p>

<p>test_9143_same_daemon_different_signalï¼Œ å¯¹åº”TestLinkçš„ç”¨ä¾‹ä¸ºï¼š<code class="highlighter-rouge">Sc-9143:Same daemon, different signal core file</code></p>

<p>3ã€æµ‹è¯•ç”¨ä¾‹çš„__doc__ï¼Œä¸å¾—å«æœ‰ä¸­æ–‡å­—ç¬¦</p>

<p>ä¾‹å¦‚ï¼š</p>

<p><code class="highlighter-rouge">"""  Sc-9143:Same daemonï¼Œdifferent signal core file  """</code></p>

<p>è¿™é‡Œçš„é€—å·ï¼Œæ˜¯ä¸­æ–‡ç¬¦å·ï¼Œä¼šå¯¼è‡´ç”¨ä¾‹æŠ¥é”™ï¼š</p>

<p><img class="shadow" src="/img/in-post/doc_error.png" width="1200" /></p>

<p>4ã€ç”¨ä¾‹__doc__å†…å®¹ï¼Œä»¥TestLinkä¸­åç§°ä¸ºå‡†</p>

<p>å¯¹äºSEGè‡ªå·±å¢åŠ çš„æµ‹è¯•ç”¨ä¾‹ï¼Œéœ€è¦ä»¥[SEG]å¼€å¤´ï¼Œ å‚è€ƒå¦‚ä¸‹ï¼š</p>

<p><img class="shadow" src="/img/in-post/nose_case_doc.png" width="400" /></p>

<p>5ã€é¿å…æµ‹è¯•ç”¨ä¾‹ä¹‹é—´å­˜åœ¨ä¾èµ–å…³ç³»</p>

<p>ï¼ˆ1ï¼‰æ¯ä¸ªæµ‹è¯•suiteä¸­çš„æµ‹è¯•ç”¨ä¾‹äº’ç›¸ä¸ä¾èµ–ï¼›</p>

<p>ï¼ˆ2ï¼‰æµ‹è¯•suiteä¸­çš„ç”¨ä¾‹ï¼Œå°½å¯èƒ½é¿å…ä¾èµ–å…³ç³»</p>

<p>å¦‚TestLInkeä¸­ä¸Šä¸€ä¸ªç”¨ä¾‹æ˜¯åˆ›å»ºï¼Œä¸‹ä¸€ä¸ªç”¨ä¾‹æ˜¯åˆ é™¤ï¼Œåˆ™åˆå¹¶è¿™ä¸¤ä¸ªç”¨ä¾‹ä¸ºä¸€ä¸ªè‡ªåŠ¨åŒ–æµ‹è¯•ç”¨ä¾‹ã€‚</p>

<p>6ã€æ—¥å¿—è®°å½•å¯¹é½è¦æ±‚</p>

<p>æ‰§è¡ŒåŠ¨ä½œçš„è®°å½•ï¼Œå¼€å¤´å¢åŠ [Action]ï¼›æ£€æŸ¥åŠ¨ä½œçš„è®°å½•ï¼Œå¼€å¤´å¢åŠ [Check];</p>

<p>æ–­è¨€è®°å½•çš„logï¼Œå¼€å¤´å¢åŠ [ERROR]ï¼› æ“ä½œæˆåŠŸçš„logï¼Œå¼€å¤´å¢åŠ [SUCCESS]ï¼› ä¸éœ€è¦æ£€æŸ¥ç‚¹çš„ï¼Œå¼€å¤´å¢åŠ [Skip]ï¼›</p>

<p>å…·ä½“è¦æ±‚å¦‚ä¸‹ï¼š</p>

<p><strong>[Prepare]</strong> <strong>åé¢è·Ÿ2</strong><strong>ä¸ªç©ºæ ¼ï¼›</strong></p>

<p><strong>[Action]</strong> <strong>åé¢è·Ÿ3</strong><strong>ä¸ªç©ºæ ¼</strong></p>

<p><strong>[Start]</strong> <strong>åé¢è·Ÿ4</strong><strong>ä¸ªç©ºæ ¼</strong></p>

<p><strong>[Check]</strong> <strong>åé¢è·Ÿ4</strong><strong>ä¸ªç©ºæ ¼</strong></p>

<p><strong>[Success]</strong> <strong>åé¢è·Ÿ2</strong><strong>ä¸ªç©ºæ ¼</strong></p>

<p><strong>[Skip]</strong> <strong>åé¢è·Ÿ5</strong><strong>ä¸ªç©ºæ ¼</strong></p>

<p><strong>debug</strong><strong>çº§åˆ«çš„log</strong><strong>ï¼Œå†…å®¹å‰é¢è·Ÿ2</strong><strong>ä¸ª-</strong><strong>ï¼Œä¹‹å</strong> <strong>å†åŠ 2</strong><strong>ä¸ªç©ºæ ¼</strong></p>

<p><strong>assert</strong><strong>ä¸­ï¼Œ[ERROR]</strong> <strong>åé¢è·Ÿ2</strong><strong>ä¸ªç©ºæ ¼</strong></p>

<p>7ã€ç”¨ä¾‹çš„æ‰§è¡Œé¡ºåº</p>

<p>æ‰§è¡Œ nosetests -s å¯çœ‹åˆ°è°ƒç”¨é¡ºåºï¼Œ ç”¨ä¾‹æ‰§è¡Œé¡ºåºï¼Œæ ¹æ®ASSIIè¿›è¡Œæ’åºï¼Œåœ¨ç”¨ä¾‹æœ‰å…³è”æƒ…å†µä¸‹ï¼Œéœ€è¦å¯¹ç”¨ä¾‹åç§°å¢åŠ æ•°å­—ç¼–å·ï¼Œæ¥äººä¸ºçš„å¹²é¢„ç”¨ä¾‹æ‰§è¡Œé¡ºåºï¼Œæ¯”å¦‚test_1_xxx, test_2_yyyã€‚</p>

<p>8ã€ä»£ç è§„èŒƒè¦æ±‚</p>

<p>æ‰§è¡Œpylintï¼Œç¡®ä¿æ£€æŸ¥ç»“æœåˆ†å€¼=10</p>

<p><code class="highlighter-rouge">pylint -r y testcasebase/Virtual_Storage/vs_user.py --rcfile=./pylintrc</code></p>

<p>MESSAGE_TYPE æœ‰å¦‚ä¸‹å‡ ç§ï¼š</p>

<ul>
  <li>(C) æƒ¯ä¾‹ã€‚è¿åäº†ç¼–ç é£æ ¼æ ‡å‡†</li>
  <li>(R) é‡æ„ã€‚å†™å¾—éå¸¸ç³Ÿç³•çš„ä»£ç ã€‚</li>
  <li>(W) è­¦å‘Šã€‚æŸäº› Python ç‰¹å®šçš„é—®é¢˜ã€‚</li>
  <li>(E) é”™è¯¯ã€‚å¾ˆå¯èƒ½æ˜¯ä»£ç ä¸­çš„é”™è¯¯ã€‚</li>
  <li>(F) è‡´å‘½é”™è¯¯ã€‚é˜»æ­¢ Pylint è¿›ä¸€æ­¥è¿è¡Œçš„é”™è¯¯</li>
</ul>

<p>9ã€ç”¨ä¾‹æ–‡ä»¶æƒé™</p>

<p>ç»Ÿä¸€ä½¿ç”¨ 644 æƒé™ï¼Œå¦åˆ™é»˜è®¤æƒ…å†µä¸‹æ— æ³•è¢« nosetests search åˆ°ï¼Œè‡ªç„¶å°±ä¸ä¼šè¢«æ‰§è¡Œåˆ°ï¼Œå› ä¸º nosetesst é»˜è®¤åªæŸ¥æ‰¾ 644 æƒé™çš„æ–‡ä»¶ã€‚</p>

<p>10ã€é¿å…åœ¨ class ä¸ setup_class ä¹‹é—´åšæ¯”è¾ƒé‡çš„åŠ¨ä½œ</p>

<p>æ¯”å¦‚ä¸‹æ–‡ä¸­çš„ RRS ç”¨ä¾‹ test_remote_replication_tasks.pyï¼ˆä¸‹æ–‡ä»£ç æ˜¯ä¸€ä¸ªä¸å¯å–çš„ä»£ç ï¼Œ è¿™é‡Œä»…åšç¤ºä¾‹ç”¨ï¼‰</p>

<p><img class="shadow" src="/img/in-post/bad_eg.png" width="1200" /></p>

<p>åœ¨class TestReplicationTask ä¸setup_class ä¹‹é—´ï¼Œå¯ç”¨äº†RRS æœåŠ¡ã€åˆ›å»ºäº†S3 è´¦å·å¹¶åˆ›å»ºbucketï¼Œ æœ€åä¸Šä¼ äº†ä¸€äº› object åˆ° bucket ä¸­ã€‚æ­£å¸¸æƒ…å†µä¸‹ï¼Œè¿™éƒ¨åˆ†åŠ¨ä½œåº”è¯¥æ˜¯åœ¨ç”¨ä¾‹è¢«æ‰§è¡Œä¹‹å‰è¦åšçš„ï¼Œç„¶åä¼šç«‹åˆ»æ‰§è¡Œ setup_class ä¸­çš„åŠ¨ä½œï¼Œæ¥ç€æ‰§è¡Œç”¨ä¾‹ï¼Œæœ€å teardownã€‚å®é™…ä¸Šï¼Œåœ¨run.py  å»æ‰§è¡Œæ‰€æœ‰æµ‹è¯•ç”¨ä¾‹çš„æ—¶å€™ï¼Œ åœ¨ init å®Œæ‰€æœ‰çš„ class ä¹‹åï¼ˆå³åˆ›å»ºå®Œ session åï¼‰ï¼Œä¼š å…ˆæ‰§è¡Œæ‰€æœ‰ test_xx.py ä¸­å®šä¹‰åœ¨ class  ä¸ setup_class ä¹‹é—´çš„æ‰€æœ‰åŠ¨ä½œï¼Œ è¿™ä¹Ÿæ— å¯åšéï¼Œä½†æ˜¯ï¼Œç”±äºçº¦æŸäº†ç”¨ä¾‹çš„æ‰§è¡Œé¡ºåºï¼Œcase_2_Accounts ä¼šä¼˜å…ˆäº case_5_Remote_DR è¢«æ‰§è¡Œï¼Œ è€Œ case_2_Accounts é‡Œå°†å…¶ä»– pool è®¾ç½®ä¸º S3 pool çš„åŠ¨ä½œï¼Œè¿™åŠ¿å¿…ä¼šæ¸…ç†æ‰åœ¨æ‰§è¡Œ run.py init ç»“æŸåæ‰€åˆ›å»ºçš„æ‰€æœ‰ bucket ä¸ bucket ä¸‹çš„ objectï¼Œåˆ° case_5_Remote_DR è¢«æ‰§è¡Œæ—¶ï¼Œæ›¾ç»åˆ›å»ºçš„ bucket ä¸ bucket ä¸‹çš„ object æ—©å·²ä¸å¤å­˜åœ¨ï¼Œè‡ªç„¶ case_5_Remote_DR ä¸‹é¢çš„ç›¸å…³ç”¨ä¾‹å°±ä¼šå¤±è´¥ã€‚</p>

<p>æ•…è€Œï¼Œå»ºè®®ï¼š</p>

<p>é¿å…åœ¨ class ä¸setup_class ä¹‹é—´åšæ¯”è¾ƒé‡çš„åŠ¨ä½œã€‚å¯¹äºè¾ƒé‡çš„åŠ¨ä½œï¼Œæ”¾åœ¨ setup_class ä¸­ï¼Œ å¥½å¤„æœ‰ 2ï¼š</p>

<p>ï¼ˆ1ï¼‰	é¿å…è¢«å…¶ä»– class import æ—¶åšæ›´å¤šã€æ›´é‡çš„åŠ¨ä½œ</p>

<p>ï¼ˆ2ï¼‰	é¿å…ç”¨ä¾‹ suite é—´å‰åæœ‰ä¾èµ–å…³ç³»ï¼Œç»™ç”¨ä¾‹æ’æŸ¥å¸¦æ¥éš¾åº¦</p>

<p>11ã€ç”¨ä¾‹æ–‡ä»¶åç§°ã€ç”¨ä¾‹ä¸­å®šä¹‰å˜é‡åç§°å…¨å±€å”¯ä¸€</p>

<p>å¯¹äºæµ‹è¯•ç”¨ä¾‹ä¸­å®šä¹‰çš„å˜é‡ï¼Œè¯¸å¦‚ NAS æ–‡ä»¶å¤¹åç§°ã€å­ç›®å½•åç§°ã€iSCSI target åç§°ã€volume åç§°ã€pool åç§°ã€cephfs åç§°ã€ç”¨ä¾‹æ‰§è¡Œè¿‡ç¨‹ä¸­äº§ç”Ÿçš„æ–‡ä»¶çš„åç§°ç­‰ç­‰ï¼Œè¦ä¿æŒå…¨å±€å”¯ä¸€ï¼Œ å³æ‰€æœ‰ç”¨ä¾‹ä¸­ä¸å‡ºç°åŒåçš„æ–‡ä»¶åã€ç›®å½•åã€pool åç­‰ã€‚å½“æœ‰ç”¨ä¾‹å‡ºé”™æ—¶ï¼Œå¯ä»¥æ ¹æ®è¿™ä¸ªåç§°ï¼Œå®šä½åˆ°æ˜¯å“ªä¸ªç”¨ä¾‹äº§ç”Ÿäº†é—®é¢˜ï¼Œå› ä¸ºå…·æœ‰å”¯ä¸€æ€§ï¼Œå¯ä»¥æ’é™¤å…¶ä»–ç”¨ä¾‹å¸¦æ¥çš„å¹²æ‰°ã€‚</p>

<h1 id="noseçš„å…¶ä»–æ’ä»¶">noseçš„å…¶ä»–æ’ä»¶</h1>

<h2 id="1ç”¨ä¾‹è®¾å®šä¾èµ–å…³ç³»">1ã€ç”¨ä¾‹è®¾å®šä¾èµ–å…³ç³»</h2>

<p>éœ€è¦å®‰è£… nose-dep pluginï¼Œå…·ä½“æ“ä½œï¼Œè¯·å‚è€ƒå¦‚ä¸‹é“¾æ¥ï¼š https://github.com/Zitrax/nose-dep</p>

<p>è¯´æ˜:</p>
<ul>
  <li>è¿™ä¸ª module ç›®å‰å·²ç»ç§»é™¤ï¼Œæœ¬æ–‡æ¡£å†…å®¹æš‚æ—¶ç•™å­˜ï¼Œä¸åˆ é™¤ï¼Œä»¥ä½œå¤‡ç”¨ã€‚</li>
</ul>

<h2 id="2ç”¨ä¾‹æ‰§è¡Œé¡ºåº">2ã€ç”¨ä¾‹æ‰§è¡Œé¡ºåº</h2>

<p>è¿™é‡Œä»‹ç»æ’ä»¶ï¼šnose-randomly</p>

<p>å¯ä»¥é€šè¿‡ <code class="highlighter-rouge">pip install nose-randomly</code></p>

<p>è¿›è¡Œå®‰è£…ï¼ŒæˆåŠŸå®‰è£…åï¼š</p>

<p><img class="shadow" src="/img/in-post/nose_plug01.png" width="1200" /></p>

<p>é»˜è®¤æ˜¯æŒ‰æ—¶é—´æ¥åšä¸ºéšæœºç§å­æ¥æ‰“ä¹±ç”¨ä¾‹é¡ºåºçš„ï¼Œä¹Ÿå¯ä»¥è‡ªå·±å®šä¹‰ç§å­ã€‚</p>

<h1 id="é…ç½®æ–‡ä»¶è¯´æ˜">é…ç½®æ–‡ä»¶è¯´æ˜</h1>

<p>è¯´æ˜ï¼š</p>
<ul>
  <li>é…ç½®æ–‡ä»¶åœ¨ src/config/autotest.configï¼ŒåŒ…æ‹¬ä½†ä¸é™åˆ¶äºé›†ç¾¤é…ç½®ã€å®¢æˆ·ç«¯é…ç½®ã€AD/LDAPé…ç½®ã€æ£€æŸ¥å‘¨æœŸã€é›†ç¾¤æœåŠ¡å¯ç”¨/åœç”¨ç­‰ç›¸å…³é…ç½®ä¿¡æ¯ï¼Œå…¨éƒ¨åœ¨è¿™ä¸ªé…ç½®æ–‡ä»¶ä¸­ï¼Œåœ¨è¿è¡Œç”¨ä¾‹å‰ï¼ŒåŠ¡å¿…ç¡®ä¿è¿™ä¸ªé…ç½®æ–‡ä»¶çš„å‡†ç¡®æ€§ã€‚</li>
</ul>

<h2 id="1autotestconfig-è¯´æ˜">1ã€autotest.config è¯´æ˜</h2>

<p>ï¼ï¼ï¼ è¿™ä¸ªæ–‡ä»¶çš„å†…å®¹ï¼Œéœ€è¦æ ¹æ®è¢«æµ‹ç¯å¢ƒè¿›è¡Œå®é™…ä¿®æ”¹ ï¼ï¼ï¼</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[CLUSTER]	
root_pass = "p@ssw0rd"	# è¢«æµ‹é›†ç¾¤ root å¯†ç ï¼ŒåŠ¡å¿…è¦æ­£ç¡®
ssh_port = 22
cluster_name = NOSE	# è¢«æµ‹é›†ç¾¤åç§°ï¼Œä»…é€‚ç”¨äºæ–°å»ºé›†ç¾¤æƒ…å†µä¸‹ï¼›åœ¨å·²æœ‰é›†ç¾¤ä¸‹è·‘ç”¨ä¾‹ï¼Œä¸ç”¨æ”¹
osd_device = sdb	# å“ªä¸ªåˆ†åŒºè¢«ç”¨äºåˆ›å»º OSDï¼Œä»…é€‚ç”¨äºå…¨æ–°å®‰è£…ç³»ç»Ÿå nose è‡ªåŠ¨åˆ›å»ºé›†ç¾¤
public_iface = ens160		# public interface ç½‘å£åç§°ï¼ŒåŠ¡å¿…è¦æ­£ç¡®
storage_iface = ens192	# storage interface ç½‘å£åç§°ï¼ŒåŠ¡å¿…è¦æ­£ç¡®
rep_no = 2	# é›†ç¾¤å‰¯æœ¬æ•°ï¼Œé»˜è®¤ 2 å‰¯æœ¬ntp_server_ip = 202.120.2.101 # NTP server åœ°å€dns_ip = 172.17.75.100 # DNS IP åœ° å€
storage_ips = "10.10.1.97 10.10.1.98 10.10.1.99" # å­˜å‚¨èŠ‚ç‚¹ storage ç½‘ç»œï¼Œä»¥å•ä¸ªç©ºæ ¼åˆ†å‰²
public_ips = "172.17.75.97 172.17.75.98 172.17.75.99" # å­˜å‚¨èŠ‚ç‚¹ public ç½‘ç»œï¼Œä»¥å•ä¸ªç©ºæ ¼åˆ†å‰²
forth_node_storage_ip = "10.10.10.249"  # ç¬¬å››ä¸ªèŠ‚ç‚¹çš„storage ipåœ°å€
license =
"3TYRSI-7IA0OW-109QON-LAZ8RV-27AICZ-FQBB3U-DLJW2P,3TYY0Z-Y3MUPS-0QRA8N-B5A8MT-7KOI1V-D9 T0RD-18X7QLW,3TZ49H-OOZOQO-1H5HY2-BAD4SB-236PNQ-VXNNGG-IY0LEH" # è¿™é‡Œæ˜¯ Controller
license

[LOGING]
host = https://localhost:8080	# è®¿é—®å­˜å‚¨ UI çš„åœ°å€ï¼Œæ— é¡»ä¿®æ”¹
user_id= admin	# è®¿é—® UI çš„ç®¡ç†å‘˜è´¦å·
password = 1	# è®¿é—® UI çš„ç®¡ç†å‘˜è´¦å·å¯¹åº”çš„å¯†ç 

[AD/LDAP]
ad_server_addr = 172.17.75.231	# AD çš„ç›¸å…³è®¾ç½®
port = 389
ad_base_dns = "DC=hype,DC=com"
ad_admin_account = "hype\Administrator" 
ad_admin_passwd = "Trend#123" 
ad_search_dn = "CN=Users,DC=hype,DC=com" 
ad_acl_folder = 'Shares'
ad_acl_user = 'zhangsan' 
ad_acl_user_passwd = 'bigtera@123' 
ac_guest_folder = 'Guest'

ldap_server_addr = 172.17.75.199	# LDAP çš„ç›¸å…³è®¾ç½®
ldap_base_dns = "dc=bigtera-os,dc=com" ldap_admin_account = "cn=admin,dc=bigtera-os,dc=com" ldap_admin_passwd = "12345678"
ldap_search_dn = "dc=bigtera-os,dc=com"

[TAKEOVERIP]
# ctdb takeover ip
takeover_ips = "172.17.73.91/24 172.17.73.92/24 172.17.73.93/24" #GW æ¥ç®¡ IP åœ°å€ï¼Œä»¥ç©ºæ ¼åˆ†å‰²

# S3 takeover IP
s3_takeover_ips = "172.17.73.94/24,94 172.17.73.95/24,95 172.17.73.96/24,96" # S3 çš„æ¥ç®¡
IP åœ°å€ï¼Œä»¥ç©ºæ ¼åˆ†å‰²ï¼Œæ ¼å¼å¿…é¡»æ˜¯ IP/æ©ç ä½æ•°

[SNMP]	# è¿™éƒ¨åˆ†åªè¦äº§å“ä¸å‘ç”Ÿå˜åŒ–ï¼Œè¿™é‡Œå°±ä¸éœ€è¦æ›´æ”¹
mib_id = ".2.25.31690.11968.43142.4581.44107.2.42453.50459"
snmp_cluster_number = ".1.1"
snmp_product_name = ".1.2"
snmp_product_version = ".1.3"
snmp_fsid = ".1.4"
snmp_cluster_health = ".1.5"
snmp_cluster_disk_total_size = ".1.6"
snmp_cluster_disk_user_size = ".1.7"
snmp_read_io = ".1.8"
snmp_write_io = ".1.9"

esxi_vm_host_name = 'SEG_nose_client(!!!Do not power off it!!!)' # nose client åœ¨ ESXi ä¾§
 
ipmi_ip = "172.17.75.221"	# nose client æ˜¯ç‰©ç†æœºï¼ˆå¯¹åº”ä¸Šé¢çš„ white_list_ip å‚æ•°ï¼‰ï¼Œè¿™ä¸ªç‰©ç†æœºçš„IPMI åœ°å€
ipmi_user = 'ADMIN'	# IPMI çš„ç³»ç»Ÿç®¡ç†å‘˜è´¦å·åç§°
ipmi_user_passwd = 'ADMIN'	# IPMI ç³»ç»Ÿç®¡ç†å‘˜è´¦å·çš„å¯†ç  

[BACKUP] # nose ç”¨ä¾‹æ‰§è¡Œè¿‡ç¨‹ä¸­å¤‡ä»½æ–‡ä»¶çš„å­˜æ¡£ç›®å½•ï¼Œè¿™é‡Œä¸éœ€è¦ä¿®æ”¹
backup_base_path = "/tmp/nose_backup/"
ezs3_log_backup = "/tmp/nose_backup/log_ezs3/"
test_case_output_path = "/tmp/nose_backup/test_case_output"

[RETRY]
retry_interval = 5 # é—´éš” 5 ç§’å°è¯•ä¸€æ¬¡ï¼Œåš check æˆ– mount ä¹‹ç±»çš„åŠ¨ä½œ
retry_timeout = 40 # æ€»å…±å°è¯•æ¬¡æ•°ï¼Œé»˜è®¤ 40 æ¬¡

[DAEMON_SERVICE]	# æœåŠ¡çš„é‡å¯ã€åœæ­¢ç›¸å…³åŠ¨ä½œï¼Œä¸åŒç‰ˆæœ¬çš„æ“ä½œç³»ç»ŸæŒ‡ä»¤ä¸ä¸€æ ·
# restart or stop or start deamon service
restart_ezmonitor = "/etc/init.d/ezmonitor restart"
restart_csmonitor = "/etc/init.d/csmonitor restart"
restart_ezfs_agent = "/etc/init.d/ezfs-agent restart"
restart_ezfs_recycle_flusher = "/etc/init.d/ezfs-recycle-flusher restart"
restart_eziscsi = "/etc/init.d/eziscsi restart"
restart_eziscsi_rbd_clean = "/etc/init.d/eziscsi-rbd-cleaner restart"
restart_apache = "/etc/init.d/apache2 restart"
restart_rgw = "/etc/init.d/radosgw restart"
restart_smart_monitor = "/etc/init.d/ezs3-smart-monitor restart"
restart_ezs3_agent = "/etc/init.d/ezs3-agent restart"

restart_ctdb = "/etc/init.d/ctdb restart"
start_ctdb = "/etc/init.d/ctdb start"
stop_ctdb = "/etc/init.d/ctdb stop"

restart_multipath_tool = "/etc/init.d/multipath-tools restart"
restart_resolvconf = "/etc/init.d/resolvconf restart"

# For ceph service
ceph_start = "/etc/init.d/ceph start"
start_mon = "/etc/init.d/ceph start mon"
start_mds = "/etc/init.d/ceph start mds"
start_osd = "/etc/init.d/ceph start osd"
start_all_osd = "/etc/init.d/ceph -a start osd"
start_all_mon = "/etc/init.d/ceph -a start mon"
start_all_mds = "/etc/init.d/ceph -a start mds"
# # Start all of ceph service on all node(osd, mon and mds)
start_all_ceph_service = "/etc/init.d/ceph -a start"

restart_mon = "/etc/init.d/ceph restart mon"
restart_mds = "/etc/init.d/ceph restart mds"

stop_mon = "/etc/init.d/ceph stop mon"
stop_mds = "/etc/init.d/ceph stop mds"
stop_osd = "/etc/init.d/ceph stop osd"

start_assign_osd = "/etc/init.d/ceph start osd."
stop_assign_osd = "/etc/init.d/ceph stop osd."

# # For keepalived
stop_keepalived = "/etc/init.d/keepalived stop"
</code></pre></div></div>

<h2 id="2logconfig-è¯´æ˜">2ã€log.config è¯´æ˜</h2>

<p>ï¼ï¼ï¼ è¿™ä¸ªæ–‡ä»¶çš„å†…å®¹ï¼Œæ— éœ€æ›´æ”¹ ï¼ï¼ï¼</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#logger.conf
###############################################
[loggers]
keys=root
[logger_root]
level=DEBUG
handlers=hand01
###############################################
[handlers]
keys=hand01
[handler_hand01]
class=StreamHandler
level=ERROR
formatter=form02
args=(sys.stdout,)

[handler_hand02]
class=FileHandler
level=DEBUG
formatter=form01
args=('nose_autotest.log','w')
###############################################
[formatters]
keys=form01,form02
[formatter_form01]
format=%(asctime)s %(filename)-8s[line:%(lineno)-4s] %(levelname)-6s %(message)s
datefmt=%a, %d %b %Y %H:%M:%S
[formatter_form02]
format=%(asctime)s %(filename)-8s[line:%(lineno)-4s] %(levelname)-6s %(message)s
# format=%(name)-12s: %(levelname)-8s %(message)s
datefmt=
###############################################
[nosetests]
verbosity=2
logging-format=%(asctime)s %(filename)-8s[line:%(lineno)-4s] %(levelname)-6s %(message)s
</code></pre></div></div>

<h1 id="æµ‹è¯•ç”¨ä¾‹çš„æ‰§è¡Œ">æµ‹è¯•ç”¨ä¾‹çš„æ‰§è¡Œ</h1>

<h2 id="1æ‰§è¡ŒæŸä¸ªtest-suite">1ã€æ‰§è¡ŒæŸä¸ªtest suite</h2>

<p><code class="highlighter-rouge">nosetests -v -x testcase/test_account.py:ManagerAccount --with-html --html-report=../report/nose.html --html-report-template=/usr/local/lib/python2.7/dist-packages/nose_html_reporting/templates/report2.jinja2</code></p>

<p>è¯´æ˜ï¼š</p>
<ul>
  <li>è¿™é‡Œçš„ManagerAccountï¼Œ æ˜¯test_account.pyçš„ä¸€ä¸ªclassã€‚</li>
</ul>

<h2 id="2æ‰§è¡ŒæŒ‡å®šæµ‹è¯•ç”¨ä¾‹">2ã€æ‰§è¡ŒæŒ‡å®šæµ‹è¯•ç”¨ä¾‹</h2>

<p><code class="highlighter-rouge">nosetests -v -x testcase/test_account.py:TestManagerAccount.test_add_user_success --with-html --html-report=../report/nose.html</code></p>

<p>è¯´æ˜ï¼š</p>
<ul>
  <li>è¿™é‡Œçš„test_add_user_successï¼Œ æ˜¯å…·ä½“çš„æµ‹è¯•ç”¨ä¾‹ï¼Œè¡¨æ˜è¿™ä¸ªç”¨ä¾‹æ˜¯test_account.pyæ–‡ä»¶ä¸­TestManagerAccountç±»ä¸‹çš„ç”¨ä¾‹</li>
</ul>

<h2 id="3æ‰§è¡Œå¤šä¸ªæµ‹è¯•ç”¨ä¾‹æµ‹è¯•é›†åˆ">3ã€æ‰§è¡Œå¤šä¸ªæµ‹è¯•ç”¨ä¾‹/æµ‹è¯•é›†åˆ</h2>

<p>å¦‚æœæ˜¯æ‰§è¡Œä¸åŒæµ‹è¯•é›†åˆä¸­çš„ä¸åŒç”¨ä¾‹ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š</p>

<p><code class="highlighter-rouge">nosetests -v --with-progressive --with-html --html-report=../report/test.html testcase/Function_Test/case_4_Virtual_Storages/NAS/test_NAS_general_management.py:TestN ASGeneral.test_434_create_nfs_cifs_folder testcase/Function_Test/case_7_Statistics_Logs/test_query_export_log.py:TestLogs.test_74
5_4_query_log_by_category_node_management</code></p>

<h2 id="4å¤šè¿›ç¨‹å¹¶å‘æµ‹è¯•">4ã€å¤šè¿›ç¨‹å¹¶å‘æµ‹è¯•</h2>

<p>æºå¸¦å‚æ•°â€“processesï¼Œ å¦‚â€“processes=2</p>

<p>å¯ä»¥ç¼©çŸ­æµ‹è¯•æ—¶é—´ï¼ŒåŒæ—¶ï¼Œè¦ä¸€å¹¶æºå¸¦ä¸Š â€“process-restartworkerå’Œ â€“process-timeoutå‚æ•°ï¼Œâ€“process-timeoutæ•°å€¼è¦æ¯”è¾ƒå¤§ï¼ˆå•ä½ï¼šç§’ï¼‰ï¼Œå¦åˆ™å¯èƒ½ä¼šå‡ºç°å†…å­˜æ³„éœ²ã€‚</p>

<p>ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>

<p><code class="highlighter-rouge">nosetests -v -x --tc=runs:3 --process-restartworker --process-timeout=100000 --processes=5 testcase/Function_Test/case_4_Virtual_Storages/NAS/test_samba_account.py</code></p>

<h2 id="5dry-run">5ã€dry-run</h2>

<p>åªåˆ—å‡ºè¦æ‰§è¡Œå“ªäº›ç”¨ä¾‹</p>

<p><code class="highlighter-rouge">nosetests --collect-only  -v</code></p>

<h2 id="6è¿è¡Œä¸åŒæ¨¡å—ä¸‹ä¸åŒç”¨ä¾‹">6ã€è¿è¡Œä¸åŒæ¨¡å—ä¸‹ä¸åŒç”¨ä¾‹</h2>

<p><code class="highlighter-rouge">nosetests -v -x --tests=testcase/test_account.py:ManagerAccount,testcase/test_mds.py:restart_mds --with-html --html-report=../report/nose.html</code></p>

<h2 id="7ç”¨ä¾‹æ‰§è¡Œæ—¶å…³é”®å­—é«˜äº®">7ã€ç”¨ä¾‹æ‰§è¡Œæ—¶å…³é”®å­—é«˜äº®</h2>

<p>ä½¿ç”¨å‰é¢å®‰è£…çš„colurunit pluginï¼Œç”¨ä¾‹æ‰§è¡Œæ—¶å¸¦ä¸Šå‚æ•°â€“with-colorunit</p>

<p><code class="highlighter-rouge">nosetests --with-colorunit -s -x -v --with-html --html-report=../report/nose_all_cases.html</code></p>

<h2 id="8ç”¨ä¾‹æ‰§è¡Œæ˜¾ç¤ºè¿›åº¦">8ã€ç”¨ä¾‹æ‰§è¡Œæ˜¾ç¤ºè¿›åº¦</h2>

<p><code class="highlighter-rouge">nosetests --with-progressive --with-colorunit -s -x -v --with-html --html-report=../report/nose_all_cases.html</code></p>

<p>è¾“å‡ºç¤ºä¾‹ï¼š</p>

<p><img class="shadow" src="/img/in-post/nose_eg04.png" width="1200" /></p>

<p>è¿™é‡Œæºç æœ‰ä¸ªé—®é¢˜ï¼ŒåŒæ—¶ä½¿ç”¨é«˜äº®å’Œè¿›åº¦ï¼Œä¼šå¯¼è‡´é«˜äº®å’Œè¿›åº¦åœ¨ç”¨ä¾‹æ‰§è¡Œç»“æœä¿¡æ¯è¾“å‡ºæ—¶ï¼Œä¸¤éƒ¨åˆ†ä¿¡æ¯å±•ç¤ºæ··æ‚åœ¨ä¸€èµ·ï¼Œå·²ç»ä¿®æ”¹æºç è§£å†³ï¼Œå®‰è£…åæ— éœ€åšä»»ä½•è°ƒæ•´ã€‚</p>

<h2 id="9å¾ªç¯è¿è¡Œç”¨ä¾‹">9ã€å¾ªç¯è¿è¡Œç”¨ä¾‹</h2>

<p>æºå¸¦runså‚æ•°ï¼Œå¹¶åˆ¶å®šå¾ªç¯æ‰§è¡Œçš„æ¬¡æ•°ï¼Œå¦‚æœä¸æºå¸¦è¯¥å‚æ•°ï¼Œé»˜è®¤ä¸å¾ªåºï¼Œå³åªè¿è¡Œä¸€æ¬¡ï¼ˆç‰¹æ®Šç”¨ä¾‹é™¤å¤–ï¼Œæ¯”å¦‚è´¦å·ä¸­åªåˆ›å»ºã€åˆ é™¤ï¼Œä¸åšæ£€æŸ¥ï¼Œæœ€ååšä¸€è½®æ£€æŸ¥çš„åœºæ™¯ï¼‰ã€‚</p>

<p><code class="highlighter-rouge">nosetests -s -x -v --with-progressive --with-colorunit --with-html --html-report=../report/sds.html testcase/Function_Test/case_4_Virtual_Storages/NAS/test_samba_account.py:TestSambaAccount.test_add_delete_samab_user_no_check --tc=runs:50</code></p>

<p>è¯´æ˜:</p>
<ul>
  <li>å¦‚æœä¸æŒ‡å®šrunsï¼Œé»˜è®¤ä¸å¾ªç¯ï¼Œå³åªæ‰§è¡Œç”¨ä¾‹ä¸€æ¬¡ï¼ˆCodeå†™æ­»ï¼‰ã€‚</li>
</ul>

<h1 id="ç¼–å†™ç”¨ä¾‹ç¢°åˆ°çš„é—®é¢˜">ç¼–å†™ç”¨ä¾‹ç¢°åˆ°çš„é—®é¢˜</h1>

<h2 id="1ç”¨ä¾‹æ— æ³•ç”Ÿæˆ-html-report">1ã€ç”¨ä¾‹æ— æ³•ç”Ÿæˆ html report</h2>

<p>Jenkins æˆ–è€…æ‰‹åŠ¨æ‰§è¡Œç”¨ä¾‹æ— æ³•ç”Ÿæˆ html report</p>

<p><img class="shadow" src="/img/in-post/nose_report_error.png" width="1200" /></p>

<p>åŸå› ï¼š</p>

<p>ä»»æ„ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹å­˜åœ¨UnicodeDecodeError assert é”™è¯¯ï¼Œéƒ½ä¼šå¯¼è‡´html æŠ¥å‘Šçš„æ— æ³•ç”Ÿæˆã€‚</p>

<p>è§£å†³æ–¹æ³•ï¼š</p>

<p>æ‰¾å‡ºæœ‰ UnicodeDecodeError æ–­è¨€é”™è¯¯çš„ç”¨ä¾‹ï¼Œå¾€å¾€æ˜¯æµ‹è¯•ä¸­æ–‡ç›¸å…³çš„æµ‹è¯•ç”¨ä¾‹ï¼Œè§£å†³UnicodeDecodeErrorã€‚</p>

<h2 id="2ç”¨ä¾‹æ‰§è¡Œå¤±è´¥æç¤º-nose_html_reporting-adderror-init__-takes-at-least-3-arguments-2-given">2ã€ç”¨ä¾‹æ‰§è¡Œå¤±è´¥ï¼Œæç¤º nose_html_reporting addError init__() takes at least 3 arguments (2 given)</h2>

<p>å †æ ˆä¿¡æ¯æ˜¾ç¤ºï¼š</p>

<p><img class="shadow" src="/img/in-post/nose_report_error2.png" width="1200" /></p>

<p>è¿™ä¸ªåŸå› ï¼Œå¾€å¾€æ˜¯æµ‹è¯•ç”¨ä¾‹ç¼–å†™ä¸Šå‡ºäº†é—®é¢˜ï¼Œå¯ä»¥é€šè¿‡å¢åŠ  log æˆ–æ‰§è¡Œ pylint æ¥æ£€æŸ¥ä¸€ä¸‹ã€‚</p>

<h2 id="3ç”¨ä¾‹æ–‡ä»¶æƒé™é—®é¢˜">3ã€ç”¨ä¾‹æ–‡ä»¶æƒé™é—®é¢˜</h2>

<p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæµ‹è¯•ç”¨ä¾‹æ–‡ä»¶çš„æƒé™ä¸èƒ½æ˜¯ 755ï¼Œå»ºè®®ç»Ÿä¸€è®¾ç½®ä¸º 644ï¼Œå¦åˆ™ç”¨ä¾‹æ— æ³•è¢«nosetest æŸ¥æ‰¾åˆ°ï¼Œä¹Ÿå°±ä¸ä¼šè¢«æ‰§è¡Œåˆ°ï¼ˆnose é»˜è®¤æƒ…å†µä¸‹å¹¶ä¸æµ‹è¯•é‚£äº›æ‹¥æœ‰å¯æ‰§è¡Œæƒé™çš„æ–‡ä»¶ï¼‰ã€‚</p>

<p><img class="shadow" src="/img/in-post/nose_primession01.png" width="1200" /></p>

<p>å¦‚æœè¦æ‰§è¡Œå¯ä»¥åŠ ä¸Š â€“exe, å¦‚ nosetests â€“exe, æˆ–è€…å»æ‰å¯æ‰§è¡Œå±æ€§chmod 644 xxx.py</p>

<p><img class="shadow" src="/img/in-post/nose_primession02.png" width="600" /></p>

<h2 id="4ç”¨ä¾‹å¤šè½®è°ƒæµ‹æˆåŠŸåæ–¹å¯æäº¤ä»£ç ">4ã€ç”¨ä¾‹å¤šè½®è°ƒæµ‹æˆåŠŸåæ–¹å¯æäº¤ä»£ç </h2>

<p>ä¸‹é¢çš„ç¤ºä¾‹æŒ‡ä»¤ï¼š</p>

<p><code class="highlighter-rouge">nosetests -v --tc=runs:1 --with-xunit --traverse-namespace --process-restartworker
--process-timeout=432000 --processes=10 --with-coverage
--cover-package=/home/nose_framework/src/ --cover-inclusive --with-progressive
--with-colorunit --with-html --html-report=/home/nose_framework/src/../report/rrs.html -c config/log.config
/home/nose_framework/src/testcase/Function_Test/case_5_Remote_DR/test_remote_replication_tasks.py</code></p>

<p>æ˜¯å®Œæ•´çš„è°ƒæµ‹æŸä¸€ä¸ªsuite ä¸‹çš„æ‰€æœ‰ case æŒ‡ä»¤ï¼Œ ç¬¬ä¸€éæ•´ä½“è°ƒè¯•æ²¡æœ‰é—®é¢˜åï¼Œå°†â€“tc=runs:1 è°ƒæ•´æˆ â€“tc=runs:2ï¼Œ å†æ¬¡æ‰§è¡Œç”¨ä¾‹ï¼Œç¡®ä¿æ‰€æœ‰ç”¨ä¾‹éƒ½æ˜¯æˆåŠŸçš„ï¼Œè€Œä¸” html report ä¹ŸæˆåŠŸç”Ÿæˆ ï¼Œ æ–¹ å¯ æ äº¤ æµ‹ è¯• ä»£ ç  ï¼Œ ï¼ ï¼ ï¼ è¯· åŠ¡ å¿… è¿™ æ · åš ï¼ ï¼ ï¼ ï¼ˆ å‚ è€ƒtest_9339_reupload_onject_to_bucket_after_new_s3_poolï¼‰ã€‚</p>

<h2 id="5ç”¨ä¾‹æ‰§è¡ŒæœŸé—´vm-è¢«é‡å¯">5ã€ç”¨ä¾‹æ‰§è¡ŒæœŸé—´ï¼ŒVM è¢«é‡å¯</h2>

<p>ä¸‹å›¾ä¸ºç”¨ä¾‹æ‰§è¡Œå¡åœ¨äº†å‡Œæ™¨ 01:28:32</p>

<p><img class="shadow" src="/img/in-post/nose_vm_boot01.png" width="600" /></p>

<p>æŸ¥çœ‹å¯¹åº”æ—¶é—´ç‚¹çš„ nodeï¼š</p>

<p><img class="shadow" src="/img/in-post/nose_vm_boot02.png" width="600" /></p>

<p>VM çš„ç¡®è¢«é‡å¯äº†ï¼Œæ‰€æœ‰æ‰§è¡Œç”¨ä¾‹çš„è¿›ç¨‹éƒ½ä¸åœ¨äº†ï¼š</p>

<p><img class="shadow" src="/img/in-post/nose_vm_boot03.png" width="500" /></p>

<p>å›  VM ä½¿ç”¨ converger æä¾›çš„ LUNï¼Œ converger ç¯å¢ƒåœ¨é‚£ä¸ªæ—¶é—´ç‚¹å‰åå¹¶æ²¡æœ‰å¼‚å¸¸ï¼›å¯¹åº” ESXi
åœ¨é‚£ä¸ªæ—¶é—´ç‚¹å‰æœ‰ä¸€ä¸ªå‘Šè­¦ï¼š</p>

<p><img class="shadow" src="/img/in-post/nose_vm_boot04.png" width="600" /></p>

<p>é™¤æ­¤ä¹‹å¤–ï¼Œå¹¶æœªå‘ç°å…¶ä»–é—®é¢˜ï¼Œå³è¿™ä¸ªè‡ªåŠ¨é‡å¯çš„åŸå› æœªçŸ¥ã€‚</p>

<p>åæ¥åœ¨ ESXi å¯¹åº” VM ç›®å½•ä¸‹ï¼Œvmware.log æ–‡ä»¶ä¸­ï¼š</p>

<p><img class="shadow" src="/img/in-post/nose_vm_boot05.png" width="600" />
<img class="shadow" src="/img/in-post/nose_vm_boot06.png" width="600" /></p>

<p>æ ¹ æ® VMWare KB çš„ è§£ é‡Š ï¼š <code class="highlighter-rouge">https://kb.vmware.com/s/article/2000542 kern panic</code>ï¼Œå¯¼è‡´è™šæœºè¢«é‡å¯ã€‚</p>

<p>ç›®å‰å°šæ— æœ‰æ•ˆè§£å†³æ–¹æ³•ï¼Œå…ˆæ”¾å¤§å†…å­˜çœ‹çœ‹ï¼ˆä» 4G è°ƒæ•´ä¸º 6Gï¼‰</p>

<h2 id="6æ‰§è¡Œç”¨ä¾‹çš„å­˜å‚¨èŠ‚ç‚¹vmnose-å ç”¨è¿‡å¤šå†…å­˜">6ã€æ‰§è¡Œç”¨ä¾‹çš„å­˜å‚¨èŠ‚ç‚¹ï¼ˆVMï¼‰ï¼Œnose å ç”¨è¿‡å¤šå†…å­˜</h2>

<p><img class="shadow" src="/img/in-post/nose_memory_leak.png" width="600" /></p>

<p>ç”±äºç°åœ¨ç”¨ä¾‹æ•°æ¯”è¾ƒå¤šï¼Œnose è¿è¡Œæ—¶é—´é•¿ï¼Œç›®å‰å°šä¸çŸ¥åœ¨ä½•ç§çŠ¶å†µä¸‹å¯¼è‡´ nose å ç”¨äº†è¿‡å¤šçš„å†…å­˜ã€‚æ ¹æ®å®˜æ–¹æä¾›çš„èµ„æ–™ï¼š</p>

<p><img class="shadow" src="/img/in-post/nose_memory_leak2.png" width="300" /></p>

<p>å¢åŠ â€“proces-restartworker å¯ä»¥é¿å…å†…å­˜æ³„éœ²ï¼Œä½† run.py æ˜¯æœ‰æºå¸¦è¿™ä¸ªå‚æ•°çš„ï¼Œæ²¡çœ‹åˆ°æ•ˆæœã€‚ç›®å‰æ¨æµ‹æ˜¯<strong>å¤±è´¥çš„ç”¨ä¾‹è¾ƒå¤šå¯¼è‡´</strong>çš„ï¼Œä¹Ÿè®¸æé«˜ç”¨ä¾‹çš„æˆåŠŸç‡ï¼Œèƒ½å¤Ÿè§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒæŒç»­è·Ÿè¸ªè¯¥é—®é¢˜ã€‚</p>

<h2 id="7apache2-æœåŠ¡å¼‚å¸¸å¯¼è‡´-connectionerrorcannot-assign-requested-address">7ã€apache2 æœåŠ¡å¼‚å¸¸ï¼Œå¯¼è‡´ ConnectionErrorï¼ŒCannot assign requested address</h2>

<p><img class="shadow" src="/img/in-post/apache_error.png" width="600" /></p>

<p>è¿™é‡Œå‘ç°å¯¹åº”èŠ‚ç‚¹çš„ apache2 service å·²ç»ä¸å­˜åœ¨äº†ï¼Œå¯¼è‡´åç»­ç”¨ä¾‹å…¨éƒ¨å¤±è´¥ï¼Œæš‚æ—¶æœªçŸ¥å…·ä½“åŸå› ï¼Œç›®å‰æƒ³åˆ°çš„è§„é¿æ–¹æ³•å¦‚ä¸‹ï¼š</p>

<p>æ–¹æ³• 1ï¼šä¿®æ”¹ http_session.py ä¸­ HTTP session header ä¸­ Connectionï¼Œç”±â€˜keep-aliveâ€™è°ƒæ•´ä¸ºâ€˜closeâ€™ï¼Œ åŒæ—¶ï¼Œåœ¨å‘èµ· HTTP request åï¼Œsleep 0.01 ç§’ã€‚</p>

<p>æ–¹æ³• 2ï¼šéœ€è¦å¢åŠ ä¸€ä¸ª watchdogï¼Œæ¥æ‹‰èµ· apache æœåŠ¡ã€‚</p>

<p>ç›®å‰ä¸Šè¿°ä¸¤ä¸ªæ–¹æ³•æš‚æ—¶æœªåŠ¨æ‰‹ï¼Œè¿™é‡Œå…ˆè®°å½•ä¸€ä¸‹ï¼Œå¦‚æœæœªæ¥è¿˜ä¼šå‘ç”Ÿï¼Œå†æ¥å¤„ç†ã€‚</p>

<p>2019-05-28 å†æ¬¡å‘ç”Ÿï¼š</p>

<p><img class="shadow" src="/img/in-post/apache_error2.png" width="600" /></p>

<p>apache2 è¿›ç¨‹å…¨éƒ¨é€€å‡º</p>

<p><img class="shadow" src="/img/in-post/apache_exit_log.png" width="600" /></p>

<p>ç›®å‰å¯¹ http_session.py åšå¦‚ä¸‹è°ƒæ•´ï¼š</p>

<p>(1)å°† HTTP session header ä¸­ Connectionï¼Œç”±â€˜keep-aliveâ€™è°ƒæ•´ä¸ºâ€˜closeâ€™</p>

<p><img class="shadow" src="/img/in-post/keep_alive.png" width="600" /></p>

<p>(2)æ•è· ConnectionError å¼‚å¸¸ï¼Œå¹¶é‡å¯ apache2 æœåŠ¡</p>

<p><img class="shadow" src="/img/in-post/connection_exception.png" width="600" /></p>

<p>2019-10-10:</p>

<p>é‰´äºä¹‹å‰çš„ä¿®å¤ï¼Œé—®é¢˜å†æ¬¡å‘ç”Ÿï¼Œç°åœ¨ http_session.py å¢åŠ å¦‚ä¸‹å†…å®¹ï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>requests.adapters.DEFAULT_RETRIES = 5 # å¢åŠ é‡è¿æ¬¡æ•°
self.session.keep_alive = False # å…³é—­å¤šä½™è¿æ¥
</code></pre></div></div>

<p>ä½†é—®é¢˜ä¾ç„¶å­˜åœ¨ã€‚</p>

<p>2019-10-11:</p>

<p>å†æ¬¡ä¿®å¤ï¼Œåˆ é™¤<code class="highlighter-rouge">requests.adapters.DEFAULT_RETRIES = 5</code>,å°† <code class="highlighter-rouge">session.keep_alive = False</code> æ”¾åœ¨ http_request å‡½æ•°é‡Œï¼Œç»§ç»­è§‚å¯Ÿä¸€ä¸‹å§ï¼Œä¸‹æ¬¡é—®é¢˜å†æ¬¡å‘ç”Ÿæ—¶å€™ï¼Œæ‰§è¡Œ netstat -tn æˆ–è€…netstat | grep -c tcpï¼Œæ¥æŸ¥çœ‹æ˜¯å¦æ˜¯æœ‰å¤ªå¤šå¤„äºâ€TIME_WAITâ€ çŠ¶æ€çš„ TCP è¿æ¥å¯¼è‡´é—®é¢˜çš„å‘ç”Ÿï¼› å¦‚æœæ˜¯ï¼Œ éœ€è¦è€ƒè™‘ä¼˜åŒ–ä¸‹å½“å‰ automation åˆ›å»º sessionã€ä½¿ç”¨session é—®é¢˜äº†ã€‚</p>

<h2 id="8è§„é¿logretate-ä½¿å¾—apache-reload-å¯¼è‡´å‘é€-http-request-åå°è¿”å›-500">8ã€è§„é¿logretate ä½¿å¾—apache reload å¯¼è‡´å‘é€ HTTP request åå°è¿”å› 500</h2>

<p><img class="shadow" src="/img/in-post/backend_return_500.png" width="600" /></p>

<p>åœ¨00:17 å‰åï¼Œä¼šå‘ç”ŸLogrotateï¼Œå…¶ä¸­æœ‰ä¸€æ­¥apache reloadï¼Œå‡å¦‚æ­¤åˆ»æ°å·§æœ‰å‘é€HTTP requestï¼Œæ­¤æ—¶ apache  æœåŠ¡çŠ¶æ€å¼‚å¸¸ï¼Œåå°è¿”å› 500 é”™è¯¯ç ã€‚ ä¸ºäº†è§„é¿è¿™ä¸ªé—®é¢˜ï¼Œè‡ªåŠ¨åŒ–åšäº†ç‰¹æ®Šå¤„ç†ï¼Œå³åœ¨å‘é€ HTTP è¯·æ±‚æ—¶ï¼Œhard code å»åˆ¤æ–­æ­¤åˆ»æ˜¯å¦æ˜¯ 00:16ï¼Œå¦‚æœæ˜¯ï¼Œç­‰å¾…150 ç§’è¿›è¡Œè§„é¿ã€‚</p>

<p><img class="shadow" src="/img/in-post/skip_logrotate.png" width="600" /></p>

<h2 id="9è§„é¿client-mount-san-device-å‡ºç°-already-mounted-or-busy">9ã€è§„é¿client mount SAN device å‡ºç° already mounted or busy</h2>

<p><img class="shadow" src="/img/in-post/mount_busy.png" width="600" /></p>

<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå½“ nose æ—¥å¿—æ˜¾ç¤ºå®¢æˆ·ç«¯ mount å‡ºç° device already mounted or busy çŠ¶å†µæ—¶ï¼Œ ä¼šå½±å“åç»­å‡ ä¸ªç”¨ä¾‹çš„æ­£å¸¸æ‰§è¡Œã€‚</p>

<p>ç›®å‰å°šæœªæ‰¾åˆ°è§£å†³æ–¹æ³•ï¼Œåªèƒ½é‡å¯æœºå™¨ï¼Œä½†æ˜¯æ­¤ç§æƒ…å†µä¸‹ï¼Œreboot or reboot -f æŒ‡ä»¤å¾€å¾€å¤±æ•ˆï¼Œåªèƒ½ç¡¬é‡å¯ã€‚</p>

<p>ç›®å‰è§£å†³æ–¹æ³•æ˜¯ï¼š</p>

<p>æ— è®ºå®¢æˆ·ç«¯æ˜¯ VM è¿˜æ˜¯ç‰©ç†æœºï¼Œ</p>

<ul>
  <li>ï¼ˆ1ï¼‰	æ‰§è¡Œ run.py æ—¶ï¼Œé‡å¯ä¸€æ¬¡ Clientï¼›</li>
  <li>ï¼ˆ2ï¼‰	å½“ mount SAN device å‡ºç° device already mounted or busyï¼Œé‡å¯ä¸€æ¬¡ Client</li>
</ul>

<p>å¯¹äº VMï¼Œé€šè¿‡ ssh è·³è½¬åˆ° ESXi æ‰§è¡Œï¼Œæ‰€ä»¥ ESXi éœ€è¦å¼€å¯ SSH æœåŠ¡</p>

<p><code class="highlighter-rouge">vim-cmd vmsvc/power.off {vm_id}&amp;&amp; vim-cmd vmsvc/power.on {vm_id}</code></p>

<p>å¯¹äºç‰©ç†æœºï¼Œé€šè¿‡æ‰§è¡Œ ipmitool å‘½ä»¤è¿˜ power reset ä¸€ä¸‹ï¼Œè¾¾åˆ°é‡å¯æœºå™¨çš„ç›®çš„ï¼š</p>

<p><code class="highlighter-rouge">ipmitool -I lanplus -H {å®¢æˆ·ç«¯ IP åœ°å€} -U{ç®¡ç†å‘˜è´¦å·} -P {ç®¡ç†å‘˜è´¦å·å¯†ç } power reset	</code></p>

<h1 id="æ³¨æ„äº‹é¡¹">æ³¨æ„äº‹é¡¹</h1>

<h2 id="1vm-ç³»ç»Ÿåˆ†åŒºç£ç›˜å¤§å°è¦å¤§äº-140g">1ã€VM ç³»ç»Ÿåˆ†åŒºç£ç›˜å¤§å°è¦å¤§äº 140G</h2>

<p>åœ¨åˆ›å»º VM åˆ†é…ç£ç›˜å¤§å°æ—¶ï¼Œéœ€è¦ç³»ç»Ÿå¯¹åº”ç£ç›˜çš„åˆ†åŒºå¤§å°æ˜¯ 140Gï¼Œä¹‹æ‰€ä»¥æœ‰è¿™ä¸ªè¦æ±‚ï¼Œæ˜¯å› ä¸ºéœ€è¦ä½¿ç”¨æ“ä½œç³»ç»Ÿçš„ä¸€ä¸ªå­åˆ†åŒºï¼ˆæ¯”å¦‚ sda4ï¼‰ä½œä¸º cephfs çš„ cacheï¼Œå¦‚æœ total size æ˜¯ 32Gï¼Œé‚£ sda4 åªæœ‰å‡ ç™¾ Mï¼Œæ— æ³•æ»¡è¶³ cache size æœ€ä½æ˜¯ 10G çš„è¦æ±‚ã€‚é‰´äºæ­¤ï¼Œé€šè¿‡ PXE è‡ªåŠ¨å®‰è£… VM å¯¹åº”çš„é…ç½®æ–‡ä»¶ nose_70_97-99ï¼Œosdisksize è¦è®¾ç½®æˆ 140ï¼š</p>

<p>ç»éªŒè¯ï¼Œå¦‚æœè®¾ç½®æˆ 128Gï¼Œ åˆ™ sda4 æ˜¯ 6Gï¼Œ è®¾ç½®æˆ 256ï¼Œ sda4 æ˜¯ 134G</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sda	8:0	0	256G 0 disk
â”œâ”€sda1	8:1		0	7M	0 part
â”œâ”€sda2	8:2		0	95.4G 0 part /
â”œâ”€sda3	8:3		0	26.7G 0 part [SWAP]
â””â”€sda4	8:4		0	134G	0 part
sdb	8:16	0		32G	0 disk
sdc	8:32	0		32G	0 disk
sdd	8:48	0		32G	0 disk
sde	8:64	0		32G	0 disk
</code></pre></div></div>

<p>åœ¨ os disk size æ˜¯ 140G çš„æƒ…å†µä¸‹ï¼Œç¡®ä¿ sda4ï¼ˆ18Gï¼‰æœ‰è¶…è¿‡ 10G çš„ç©ºé—´å¤§å°ã€‚</p>

<h2 id="2æµ‹è¯•ç”¨ä¾‹ä¸è¦åœ¨ç¬¬ä¸€ä¸ªæˆ–æœ€åä¸€ä¸ªèŠ‚ç‚¹ä¸Šæ‰§è¡Œ">2ã€æµ‹è¯•ç”¨ä¾‹ä¸è¦åœ¨ç¬¬ä¸€ä¸ªæˆ–æœ€åä¸€ä¸ªèŠ‚ç‚¹ä¸Šæ‰§è¡Œ</h2>

<p>æœ‰ä¸€äº› S3 takeover IP çš„ç”¨ä¾‹ï¼Œä¼šæ‰§è¡Œ reboot æˆ– ifdown ç¬¬ä¸€ä¸ªæˆ–æœ€åä¸€ä¸ªèŠ‚ç‚¹çš„ publicå’Œstorage NICï¼Œæ•…è€Œï¼Œé¿å…åœ¨ç¬¬ä¸€ä¸ªæˆ–æœ€åä¸€ä¸ªèŠ‚ç‚¹ä¸Šæ‰§è¡Œç”¨ä¾‹ã€‚ç›®å‰ run.py è„šæœ¬æœ‰åšçº¦æŸæ€§æ£€æŸ¥ã€‚</p>

<h2 id="3å®¢æˆ·ç«¯å­˜åœ¨-dsa-key">3ã€å®¢æˆ·ç«¯å­˜åœ¨ dsa key</h2>

<p>åœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½®çš„white_list_ipï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>

<p><img class="shadow" src="/img/in-post/key_1.png" width="300" /></p>

<p>white_list_ip è¿™å°æœºå™¨æ‰€åœ¨çš„/root/.ssh/ç›®å½•ä¸‹ï¼Œéœ€è¦å­˜åœ¨ id_dsa.pub è¿™ä¸ªæ–‡ä»¶ï¼š</p>

<p><img class="shadow" src="/img/in-post/key_2.png" width="300" /></p>

<p>å¦‚æœä¸å­˜åœ¨ï¼Œéœ€è¦æ‰§è¡Œä¸‹æ¥å‘½ä»¤æ¥äº§ç”Ÿï¼š</p>

<p><code class="highlighter-rouge">ssh-keygen -t dsa</code></p>

<p>åªæ‰€ä»¥éœ€è¦è¿™ä¸ª key çš„åŸå› ï¼Œæ˜¯ RRS automation éœ€è¦ä»è¿œç«¯è·å–è¿™ä¸ª sshkeyï¼Œå¦åˆ™ä¼šå¯¼è‡´RRS SSH KEY è¿™éƒ¨åˆ†ç›¸å…³ç”¨ä¾‹å¤±è´¥ï¼ˆtest_remote_SSH_keys.pyï¼‰ã€‚</p>

<p>è¯´æ˜ï¼š</p>
<ul>
  <li>è¿™éƒ¨åˆ†æ“ä½œï¼Œæ— éœ€äººå·¥å¹²é¢„ï¼Œå·²ç»æ”¾åˆ°run.py è„šæœ¬ä¸­äº†ã€‚</li>
</ul>

<h2 id="4å®¢æˆ·ç«¯å¯ç”¨-multi-path">4ã€å®¢æˆ·ç«¯å¯ç”¨ multi-path</h2>

<p>å¦‚æœé»˜è®¤æ²¡æœ‰å¯ç”¨ï¼Œåœ¨ç¡®ä¿å®‰è£…äº† multipath-tool çš„æƒ…å†µä¸‹ï¼Œå°†ä¸‹åˆ—å‘½ä»¤å†™å…¥/etc/rc.local
<code class="highlighter-rouge">/etc/init.d/multipath-tools start</code></p>

<p>ä¸Šè¿°å‘½ä»¤ï¼Œéœ€è¦ä¹¦å†™åœ¨exit 0 å‰é¢ã€‚</p>

<h2 id="5å®¢æˆ·ç«¯å®šæœŸé‡å¯">5ã€å®¢æˆ·ç«¯å®šæœŸé‡å¯</h2>

<p>ç”±äºå½“å‰å®¢æˆ·ç«¯æ˜¯ä¸€å° VMï¼Œå»ºè®®ç”¨ä¾‹æ‰§è¡Œå‰é‡å¯ä¸€ä¸‹è¿™å°VMï¼Œä¸»è¦ç›®çš„åœ¨äº:</p>

<h3 id="1é‡Šæ”¾æ— æ•ˆçš„-dm-è®¾å¤‡">1ã€é‡Šæ”¾æ— æ•ˆçš„ dm è®¾å¤‡</h3>

<p>ï¼ï¼ï¼æ­¤æ¡é€‚ç”¨äºæ‰€æœ‰ nose automation çš„ clientï¼Œæ— è®ºæ˜¯ç‰©ç†æœºè¿˜æ˜¯ VM ï¼ï¼ï¼</p>

<p><img class="shadow" src="/img/in-post/dm_device1.png" width="1200" /></p>

<p>å¯¹äºä¸Šå›¾ï¼Œé™¤äº† 27d7e5983bd6f7dc5 å¯¹åº”çš„ dm è®¾å¤‡æ˜¯æœ‰æ•ˆçš„ï¼Œå…¶ä»–çš„ dm è®¾å¤‡éƒ½æ˜¯æ— æ•ˆçš„ï¼Œä¸€æ—¦è¿™ä¸ª client login ä¸€ä¸ª iSCSI LUN åï¼Œå¦‚æœ map åˆ°äº†ä¸Šé¢ä¸€ä¸ªå·²ç»å­˜åœ¨çš„ dm è®¾å¤‡ï¼Œ mkfs çš„æ—¶å€™ä¼šæŠ¥ç±»ä¼¼å¦‚ä¸‹çš„é”™è¯¯ï¼š</p>

<p><code class="highlighter-rouge">/dev/dm-2 is apparently in use by the system; will not make a filesystem here!</code></p>

<p>å°è¯•ä½¿ç”¨ dmsetup remove -f device_name æŒ‡ä»¤å»åˆ é™¤ï¼Œå‘½ä»¤å¡ä½ï¼Œ<strong>ç›®å‰å°šæ— è§£å†³æ–¹æ³•ï¼Œ åªèƒ½é‡å¯æœºå™¨</strong>ï¼Œé‡å¯åæ¢å¤æ­£å¸¸ï¼š</p>

<p><img class="shadow" src="/img/in-post/dm_device2.png" width="600" /></p>

<p>å¦å¤–ï¼Œåœ¨ kernen.log ä¸­å‘ç°å¾ˆå¤šçš„â€œBUG: unable to handle kernel NULL pointer dereference at (null)â€ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>

<p><img class="shadow" src="/img/in-post/dm_device3.png" width="600" /></p>

<p>ä¸ç¡®å®šè¿™ä¸ªé‡æŒ‡é’ˆæ˜¯å¦å¯¼è‡´ dm è®¾å¤‡çš„æ®‹ç•™ã€‚</p>

<h3 id="2é‡Šæ”¾èµ„æºé¿å…å®¢æˆ·ç«¯å“åº”è¿‡æ…¢">2ã€é‡Šæ”¾èµ„æºï¼Œé¿å…å®¢æˆ·ç«¯å“åº”è¿‡æ…¢</h3>

<p>å¦‚æœå®¢æˆ·ç«¯æ˜¯ç‰©ç†æœºï¼Œå¯å¿½ç•¥é‡å¯æ“ä½œã€‚è®¾ç½®è„šæœ¬ï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@NoseClient:/usr/local/bin# cat /usr/local/bin/reboot_machine.sh #!/bin/bash

reboot -f root@NoseClient:/usr/local/bin#
</code></pre></div></div>

<p>æ¯å¤©å‡Œæ™¨3 ç‚¹ï¼ˆJenkins æ˜¯æ¯å¤©3:20 æ‰§è¡Œç”¨ä¾‹ï¼Œå› ä¸ºè¿™ä¸ªæ—¶åˆ»ISO æ­£å¥½ä»å°åŒ—åŒæ­¥åˆ°å—äº¬LABï¼Œ å½“ç„¶ä¹Ÿå¯è‡ªç”±è®¾å®šæ‰§è¡Œæ—¶é—´ï¼‰è¿›è¡Œ VM çš„é‡å¯åŠ¨ä½œï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@NoseClient:/usr/local/bin# cat /etc/cron.d/reboot_machine PATH=/bin:/usr/bin:/sbin

1 3 * * * root bash /usr/local/bin/reboot_machine.sh &gt;/dev/null 2&gt;&amp;1 root@NoseClient:/usr/local/bin#
</code></pre></div></div>

<h2 id="6èƒ½ç¼–å†™ä½†éœ€è¦å»¶è¿Ÿç¼–å†™çš„ç”¨ä¾‹å¢åŠ -raise-skiptest">6ã€èƒ½ç¼–å†™ä½†éœ€è¦å»¶è¿Ÿç¼–å†™çš„ç”¨ä¾‹ï¼Œå¢åŠ  raise SkipTest</h2>

<p>æ¯”å¦‚åœ¨å†™Folder quota è¿™éƒ¨åˆ†çš„æµ‹è¯•ç”¨ä¾‹ï¼Œé‡Œé¢æœ‰ RRS å’Œ pool quota ç›¸å…³çš„å‡ ä¸ªcaseï¼Œ å›  RRS æˆ– pool quota ç›¸å…³ class base å°šæœªå…·å¤‡ï¼Œå¯ä»¥æ ‡è®°è¿™éƒ¨åˆ†ç”¨ä¾‹ä¸ºskip çŠ¶æ€ï¼Œè¿™æ ·åšçš„ç›®çš„æ˜¯é¿å…ä¸åŠ skip è€Œåœ¨å°†æ¥è¢«å¿½ç•¥æ‰ï¼Œå¯¼è‡´è¿™éƒ¨åˆ†ç”¨ä¾‹å¹¶æ²¡æœ‰ç¼–å†™ã€‚</p>

<p>ä¸»è¦ç›®çš„:</p>

<ul>
  <li>1ã€æ„åœ¨æé†’ skip çŠ¶æ€çš„ç”¨ä¾‹è¦åœ¨å°†æ¥è¢«å®Œæˆ</li>
  <li>2ã€æŸäº›ç”¨ä¾‹åªé€‚ç”¨äºç‰©ç†æœºï¼ŒVM æ— æ³•éªŒè¯ï¼Œå¢åŠ åˆ¤æ–­ï¼Œå¯¹äº VM è¦ skip</li>
</ul>

<p>skip ç¤ºä¾‹è¯·å‚è€ƒå¦‚ä¸‹é“¾æ¥ï¼š</p>

<p><code class="highlighter-rouge">http://swordstyle.com/func_test_tutorial/part_one/extra_skip_test.html</code></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>class TestFolderQuota(ShareFolderManager): @loop_run()
def test_1090_folder_quota_less_than_pool_quota(self):
""" Sc-1090:Folder quota &lt; Pool Quota [limited by folder quota] """ raise SkipTest
</code></pre></div></div>

<h2 id="7base-class-é‡Œç¦æ­¢å‡½æ•°åç§°å«æœ‰-test">7ã€base class é‡Œï¼Œç¦æ­¢å‡½æ•°åç§°å«æœ‰ test</h2>

<p>nose è¿è¡Œç”¨ä¾‹çš„æ—¶å€™ï¼Œæ ¹æ®æ­£åˆ™åŒ¹é…æµ‹è¯•ç”¨ä¾‹ï¼Œä¼šåŒ¹é…åˆ°å«æœ‰ test çš„å‡½æ•°ï¼Œä¼šè®¤ä¸ºè¿™ä¸ªå‡½æ•°æ˜¯ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼Œæ•…è€Œè¦é¿å…æ­¤ç§æƒ…å†µçš„å‘ç”Ÿï¼Œtest å¯ä»¥ä½¿ç”¨å•è¯examination ä»£æ›¿ã€‚</p>

<p><img class="shadow" src="/img/in-post/skip_start_test.png" width="600" /></p>

<h2 id="8åˆ›å»ºvs-æ—¶pool-åç§°å¿…é¡»ä»¥nose-å¼€å¤´">8ã€åˆ›å»ºVS æ—¶ï¼Œpool åç§°å¿…é¡»ä»¥nose å¼€å¤´</h2>

<p>ç›®å‰æ˜¯ hard code çš„é™åˆ¶ï¼Œå¦åˆ™å¯¹ pool çš„ä¸€äº›æ£€éªŒä¼šæ— æ³•é€šè¿‡ã€‚</p>

<h2 id="9ad-ä¾§å­˜åœ¨ä¸€ä¸ª-shares-å’Œ-guest-å…±äº«ç›®å½•">9ã€AD ä¾§å­˜åœ¨ä¸€ä¸ª Shares å’Œ Guest å…±äº«ç›®å½•</h2>

<p>ç›®å‰æ˜¯ hard code çš„é™åˆ¶ï¼š</p>

<p><img class="shadow" src="/img/in-post/hard_code1.png" width="600" /></p>

<p>åœ¨ NAS migration ç”¨ä¾‹é‡Œï¼Œæ¶‰åŠåˆ° Windows Server æä¾›çš„ folderï¼Œç›®å‰å†™åœ¨ config ä¸­ï¼š</p>

<p><img class="shadow" src="/img/in-post/hard_code2.png" width="300" /></p>

<h2 id="10esxi-å¼€å¯-ssh-æœåŠ¡">10ã€ESXi å¼€å¯ SSH æœåŠ¡</h2>

<p>å¦‚æœ client æ˜¯ESXi ä¸Šçš„ä¸€å° VMï¼Œåˆ™éœ€è¦ ESXi å¼€å¯ SSH æœåŠ¡ï¼Œå› ä¸ºéœ€è¦é€šè¿‡ ssh ESXiï¼Œ æ‰§è¡Œé‡å¯ VM æ“ä½œã€‚</p>

<h1 id="æµ‹è¯•ç»“æœå±•ç¤º">æµ‹è¯•ç»“æœå±•ç¤º</h1>

<p>è¯´æ˜ï¼š</p>
<ul>
  <li>ç”¨ä¾‹æ‰§è¡Œè¿‡ç¨‹ä¸­äº§ç”Ÿæ—¥å¿—æ–‡ä»¶å’Œç”Ÿæˆä¸€ä¸ªHTMLæ ¼å¼çš„æµ‹è¯•æŠ¥å‘Šï¼Œæ—¥å¿—æ–‡ä»¶åç§°ï¼ˆé»˜è®¤ï¼šnose_autotest.logï¼‰åœ¨src/config/ autotest.configä¸­é…ç½®ï¼Œä»¥åŠæ‰“å°çš„æ—¥å¿—çº§åˆ«ï¼ˆé»˜è®¤ï¼šDEBUGï¼‰ï¼Œ ä¹Ÿåœ¨è¿™ä¸ªé…ç½®æ–‡ä»¶ä¸­è®¾ç½®ã€‚</li>
</ul>

<h2 id="1å±æ˜¾è¾“å‡ºä¿¡æ¯">1ã€å±æ˜¾è¾“å‡ºä¿¡æ¯</h2>

<p>ç¤ºä¾‹ï¼š</p>

<p><code class="highlighter-rouge">root@node98:/home/nose_framework/src# nosetests -s -x -v --processes=10  --with-progressive --with-colorunit --with-html --html-report=../report/sds.html testcase/Function_Test/case_2_Accounts/test_SDS_admin_account_settings.py</code></p>

<p><img class="shadow" src="/img/in-post/display_01.png" width="600" />
â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”-  ä¸­é—´å†…å®¹çœç•¥  â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“
<img class="shadow" src="/img/in-post/display_02.png" width="600" /></p>

<h2 id="2è‡ªåŠ¨åŒ–äº§ç”Ÿçš„æ—¥å¿—æ–‡ä»¶">2ã€è‡ªåŠ¨åŒ–äº§ç”Ÿçš„æ—¥å¿—æ–‡ä»¶</h2>

<p>æ—¥å¿—æ–‡ä»¶è·¯å¾„ï¼šreport/ nose_autotest.logï¼Œå†…å®¹ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>

<p><img class="shadow" src="/img/in-post/nose_log_file.png" width="600" /></p>

<h2 id="3htmlæµ‹è¯•æŠ¥å‘Š">3ã€HTMLæµ‹è¯•æŠ¥å‘Š</h2>

<p>html æµ‹è¯•æŠ¥å‘Šé»˜è®¤è·¯å¾„ä¸ºï¼šreport/ all_test_cases.htmlï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š</p>

<p><img class="shadow" src="/img/in-post/nose_report_show.png" width="600" /></p>

<p>è¯´æ˜ï¼š</p>
<ul>
  <li>ç»¿è‰²ï¼š è¡¨æ˜ç”¨ä¾‹æ‰§è¡ŒæˆåŠŸï¼Œ SuccessçŠ¶æ€</li>
  <li>æ©™è‰²ï¼š è¡¨æ˜ç”¨ä¾‹æ‰§è¡Œå¤±è´¥ï¼Œ FailçŠ¶æ€</li>
  <li>çº¢è‰²ï¼š è¡¨æ˜ç”¨ä¾‹æ‰§è¡Œå‘ç”Ÿé”™è¯¯ï¼Œ ErrorçŠ¶æ€</li>
</ul>

<p>ç‚¹å‡»å·¦ä¸‹è§’çš„â€œFull log raw outputâ€ï¼Œ å±•ç¤ºç”¨ä¾‹æ‰§è¡ŒæœŸé—´è®°å½•çš„æ—¥å¿—ä¿¡æ¯ï¼Œå¦‚æœå‡ºé”™ï¼Œä¹Ÿä¼šå°†å¼‚å¸¸è¯¦ç»†ä¿¡æ¯è®°å½•ä¸‹æ¥ï¼š</p>

<p><img class="shadow" src="/img/in-post/nose_fail_log.png" width="1200" /></p>

<h1 id="noseå­˜åœ¨çš„é—®é¢˜">Noseå­˜åœ¨çš„é—®é¢˜</h1>

<h2 id="1nose-memory-leak">1ã€nose memory leak</h2>

<p>ç›®å‰noseæ˜¯æ‰§è¡Œåœ¨å­˜å‚¨èŠ‚ç‚¹ä¸Šï¼Œå¯¹äºVMè€Œè¨€ï¼Œèµ‹äºˆVMçš„VMemoryå¹¶ä¸æ˜¯å¾ˆå¤§ï¼Œè€Œnosetestsæœ‰æ—¶å€™å ç”¨70%ä»¥ä¸Šçš„å†…å­˜ï¼Œå¼•å‘é›†ç¾¤å¼‚å¸¸ï¼Œæ­¤ç§çŠ¶å†µçš„å‘ç”Ÿï¼Œä¼šå¯¼è‡´VMå†…å­˜ä¸è¶³ï¼Œæ²¡æ³•ä¿è¯é›†ç¾¤æ­£å¸¸è¿è¡Œã€‚</p>

<p>è¿™ç‚¹ï¼Œæœ¬æ–‡ä¹‹å‰çš„ç« èŠ‚æœ‰æåŠåˆ°ï¼Œæ€€ç–‘é—®é¢˜çš„å‘ç”Ÿç‚¹ï¼Œåœ¨äºè¿‡å¤šçš„æµ‹è¯•ç”¨ä¾‹æ‰§è¡Œå¤±è´¥ï¼Œå¼•å‘nose è¦captureè¿‡å¤šçš„ä¿¡æ¯æ”¾åœ¨memoryé‡Œã€‚</p>

<h2 id="2nose-crash">2ã€nose crash</h2>

<p>æ­¤é—®é¢˜åœ¨2019-12-19 00:52:31 å·¦å³å‘ç”Ÿï¼Œç›´æ¥å¯¼è‡´noseå´©æºƒï¼Œç»ˆæ­¢ç”¨ä¾‹çš„æ‰§è¡Œã€‚</p>

<p><img class="shadow" src="/img/in-post/nose_crash01.png" width="600" />
<img class="shadow" src="/img/in-post/nose_crash02.png" width="600" />
<img class="shadow" src="/img/in-post/nose_crash03.png" width="600" /></p>

<p>äº§å“æˆåŠŸæ£€æµ‹åˆ°nosetests core dumpäº†ã€‚</p>

<h1 id="ä»£ç åˆ†æ”¯ä»‹ç»">ä»£ç åˆ†æ”¯ä»‹ç»</h1>

<p>Masteræ˜¯6.3ï¼Œ å…¶ä»–åˆ†æ”¯ä»¥å…·ä½“ç‰ˆæœ¬å·åˆ›å»ºåˆ†æ”¯ã€‚ Masteråˆ†æ”¯ç›®å‰æš‚åœç”¨ä¾‹ç¼–å†™/æ›´æ–°ã€‚</p>

<h1 id="ä¸jenkinsç»“åˆ">ä¸jenkinsç»“åˆ</h1>

<h2 id="ç”¨åˆ°çš„jenkinsæ’ä»¶">ç”¨åˆ°çš„jenkinsæ’ä»¶</h2>

<p>Jenkinsæ‹¥æœ‰ä¸°å¯Œçš„ç¬¬ä¸‰æ–¹æ’ä»¶ï¼Œå¯ä»¥ç”¨æ¥å¸®åŠ©æˆ‘ä»¬å®Œæˆå„ç§å„æ ·çš„é›ªçƒã€‚ä¸‹åˆ—æ˜¯æœ¬æ–‡ä¸­ç”¨åˆ°çš„å‡ ä¸ªæ’ä»¶ï¼š</p>

<ul>
  <li>Junit Plugin: ç”¨æ¥å±•ç¤ºnoseæ¡†æ¶ç”Ÿæˆçš„å•å…ƒæµ‹è¯•æŠ¥è¡¨</li>
  <li>Cobertura Pluginï¼šç”¨æ¥å±•ç¤ºPythonä»£ç æµ‹è¯•è¦†ç›–ç‡æŠ¥è¡¨</li>
  <li>Violationsï¼šç”¨æ¥å±•ç¤ºPythoné™æ€ä»£ç å®¡æŸ¥æŠ¥è¡¨ï¼Œæ”¯æŒpylintã€jslintç­‰</li>
</ul>

<h2 id="jenkinsçš„jobé…ç½®">jenkinsçš„jobé…ç½®</h2>

<p>ä¸‹æ–‡ä»¥ nose-7.0 projectä¸ºç¤ºä¾‹ã€‚</p>

<h3 id="1åˆ›å»ºcredentials">1ï¼‰åˆ›å»ºCredentials</h3>

<p><img class="shadow" src="/img/in-post/nose_jenkins1.png" width="600" /></p>

<p><img class="shadow" src="/img/in-post/nose_jenkins2.png" width="600" /></p>

<p><img class="shadow" src="/img/in-post/nose_jenkins3.png" width="600" /></p>

<h3 id="2è®¾ç½®remote-ssh">2ï¼‰è®¾ç½®remote ssh</h3>

<p>è¿›å…¥jenkisnâ€“ç³»ç»Ÿç®¡ç†â€“ç³»ç»Ÿè®¾ç½®ç•Œé¢ï¼Œåœ¨â€œSSH remote hostsâ€å¤„ï¼Œæ–°å¢æ–°çš„ssh remote hostsï¼Œå¹¶è¿›è¡Œcheck connectionï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>

<p><img class="shadow" src="/img/in-post/nose_jenkins4.png" width="600" /></p>

<p>è¿æ¥æµ‹è¯•æˆåŠŸåï¼Œä¿å­˜é€€å‡ºã€‚</p>

<h2 id="3é…ç½®nose-70-project">3ï¼‰é…ç½®nose-7.0 project</h2>

<h3 id="general">General</h3>

<p>è¿›å…¥nose-7.0 projectï¼Œè®¾ç½®å¦‚ä¸‹ï¼š</p>

<p><img class="shadow" src="/img/in-post/nose_jenkins5.png" width="600" /></p>

<h3 id="æºç ç®¡ç†">æºç ç®¡ç†</h3>

<p><img class="shadow" src="/img/in-post/nose_jenkins6.png" width="600" /></p>

<p>ä¸‹è½½åˆ° /work/automation-test/nose_7.0/nose_framework/</p>

<h3 id="æ„å»ºè§¦å‘å™¨">æ„å»ºè§¦å‘å™¨</h3>

<p><img class="shadow" src="/img/in-post/nose_jenkins7.png" width="600" /></p>

<h3 id="æ„å»ºç¯å¢ƒ">æ„å»ºç¯å¢ƒ</h3>

<p><img class="shadow" src="/img/in-post/nose_jenkins8.png" width="600" /></p>

<p>éœ€è¦æ‰§è¡Œçš„è„šæœ¬å‘½ä»¤å¦‚ä¸‹ï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># delete report on 234
cd /var/lib/jenkins/jobs/nose_7.0/workspace;
rm -rf report;
sleep 2;

# install VM
sshpass -p 1 ssh -p 22 172.17.75.235 -l root "/root/batch_install_vs/batch_install_vs.py /root/batch_install_vs/config/nose/nose_70_97-99"

# scp code to VM
cd /work/automation-test/nose_7.0/nose_framework;
rm -rf build.properties;
rm -rf report;
cd jenkins;chmod a+x *;
ssh-keygen -f "/var/lib/jenkins/.ssh/known_hosts" -R 172.17.75.98;
./rsync_nose.sh 172.17.75.98 root p@ssw0rd
</code></pre></div></div>
<p><img class="shadow" src="/img/in-post/nose_jenkins9.png" width="600" /></p>

<p>ç›¸å…³å‘½ä»¤å¦‚ä¸‹ï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd /work/automation-test/nose_7.0/nose_framework/jenkins; 
./rsync_report.sh 172.17.75.98 root p@ssw0rd;
./jenkins_build_properties.sh
</code></pre></div></div>

<p>å¤–éƒ¨å˜é‡çš„ä½¿ç”¨ï¼š</p>

<p><img class="shadow" src="/img/in-post/nose_jenkins10.png" width="600" /></p>

<p>è·¯å¾„è®¾ç½®ä¸ºï¼š</p>

<p><code class="highlighter-rouge">/work/automation-test/nose_7.0/nose_framework/build.properties</code></p>

<p>è¿™é‡Œä½¿ç”¨Inject environment variablesçš„ç›®çš„ï¼Œæ˜¯ä¸ºäº†å‘é€é‚®ä»¶å†…å®¹ä¸­ï¼Œå±•ç¤ºä»»åŠ¡æ˜¯ä»ä»€ä¹ˆæ—¶é—´å¼€å§‹ã€ä»€ä¹ˆæ—¶é—´ç‚¹ç»“æŸï¼Œç”¨ä¾‹æ‰§è¡ŒæˆåŠŸã€å¤±è´¥ç­‰æƒ…å†µï¼Œä»¥åŠè¢«æµ‹è¯•ç‰ˆæœ¬ä¿¡æ¯ã€‚</p>

<h3 id="æ„å»ºåæ“ä½œ">æ„å»ºåæ“ä½œ</h3>

<p>å‘é€é‚®ä»¶:</p>

<p><img class="shadow" src="/img/in-post/nose_jenkins11.png" width="600" /></p>

<p>HTMLå†…å®¹å¦‚ä¸‹ï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;html&gt;</span>
    <span class="nt">&lt;head&gt;</span>
        <span class="nt">&lt;title&gt;&lt;/title&gt;</span>
    <span class="nt">&lt;/head&gt;</span>
    <span class="nt">&lt;body&gt;</span>
        <span class="nt">&lt;h2</span> <span class="na">style=</span><span class="s">"color: #5e9ca0; text-align: center;"</span><span class="nt">&gt;</span>
            Note:(This email generated by system automatically, please do not reply!)
        <span class="nt">&lt;/h2&gt;</span>
        <span class="nt">&lt;table</span> <span class="na">class=</span><span class="s">"editorDemoTable"</span> <span class="na">style=</span><span class="s">"height: 549px; width: 811px;"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;thead&gt;</span>
                <span class="nt">&lt;tr&gt;</span>
                    <span class="nt">&lt;td</span> <span class="na">style=</span><span class="s">"background-color: #3498db; text-align: center; width: 801px;"</span> <span class="na">colspan=</span><span class="s">"2"</span> <span class="na">nowrap=</span><span class="s">"nowrap"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;h2&gt;</span>
                            <span class="nt">&lt;span</span> <span class="na">style=</span><span class="s">"color: #000000;"</span><span class="nt">&gt;</span>SEG V7.0 NOSE Automation Test Result<span class="nt">&lt;/span&gt;</span>
                        <span class="nt">&lt;/h2&gt;</span>
                    <span class="nt">&lt;/td&gt;</span>
                <span class="nt">&lt;/tr&gt;</span>
                <span class="nt">&lt;tr&gt;</span>
                    <span class="nt">&lt;td</span> <span class="na">style=</span><span class="s">"background-color: #3498db; width: 801px; text-align: left;"</span> <span class="na">colspan=</span><span class="s">"2"</span> <span class="na">nowrap=</span><span class="s">"nowrap"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;span</span> <span class="na">style=</span><span class="s">"color: #000000;"</span><span class="nt">&gt;</span>Build Information<span class="nt">&lt;/span&gt;</span>
                    <span class="nt">&lt;/td&gt;</span>
                <span class="nt">&lt;/tr&gt;</span>
            <span class="nt">&lt;/thead&gt;</span>
            <span class="nt">&lt;tbody&gt;</span>
                <span class="nt">&lt;tr&gt;</span>
                    <span class="nt">&lt;td</span> <span class="na">style=</span><span class="s">"background-color: #beedc7; width: 150px;"</span> <span class="na">nowrap=</span><span class="s">"nowrap"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;span</span> <span class="na">style=</span><span class="s">"color: #000000;"</span><span class="nt">&gt;</span>Test Result<span class="nt">&lt;/span&gt;</span>
                    <span class="nt">&lt;/td&gt;</span>
                    <span class="nt">&lt;td</span> <span class="na">style=</span><span class="s">"background-color: #beedc7; width: 643px;"</span> <span class="na">nowrap=</span><span class="s">"nowrap"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;span</span> <span class="na">style=</span><span class="s">"color: #000000;"</span><span class="nt">&gt;</span><span class="ni">&amp;nbsp;</span><span class="nt">&lt;/span&gt;</span>
                        <span class="nt">&lt;ul&gt;</span>
                            <span class="nt">&lt;li&gt;</span>
                                <span class="nt">&lt;span</span> <span class="na">style=</span><span class="s">"color: #000000;"</span><span class="nt">&gt;</span>Total Cases:<span class="ni">&amp;nbsp;</span> <span class="ni">&amp;nbsp;</span> ${TEST_COUNTS}<span class="nt">&lt;/span&gt;</span>
                            <span class="nt">&lt;/li&gt;</span>
                            <span class="nt">&lt;li&gt;</span>
                                <span class="nt">&lt;span</span> <span class="na">style=</span><span class="s">"color: #000000; background-color: #008000;"</span><span class="nt">&gt;</span>Pass<span class="ni">&amp;nbsp;</span> Cases:<span class="ni">&amp;nbsp;</span> <span class="ni">&amp;nbsp;</span> ${TEST_PASS}<span class="nt">&lt;/span&gt;</span>
                            <span class="nt">&lt;/li&gt;</span>
                            <span class="nt">&lt;li&gt;</span>
                                <span class="nt">&lt;span</span> <span class="na">style=</span><span class="s">"color: #000000; background-color: #ffff00;"</span><span class="nt">&gt;</span>Fail<span class="ni">&amp;nbsp;</span> <span class="ni">&amp;nbsp;</span>Cases:<span class="ni">&amp;nbsp;</span> <span class="ni">&amp;nbsp;</span> ${TEST_FAIL}<span class="nt">&lt;/span&gt;</span>
                            <span class="nt">&lt;/li&gt;</span>
                            <span class="nt">&lt;li&gt;</span>
                                <span class="nt">&lt;span</span> <span class="na">style=</span><span class="s">"color: #000000; background-color: #3366ff;"</span><span class="nt">&gt;</span>Skip<span class="ni">&amp;nbsp;</span> Cases:<span class="ni">&amp;nbsp;</span> <span class="ni">&amp;nbsp;</span> ${TEST_SKIP}<span class="nt">&lt;/span&gt;</span>
                            <span class="nt">&lt;/li&gt;</span>
                            <span class="nt">&lt;li&gt;</span>
                                <span class="nt">&lt;span</span> <span class="na">style=</span><span class="s">"color: #000000; background-color: #ff0000;"</span><span class="nt">&gt;</span>Error Cases:<span class="ni">&amp;nbsp;</span> <span class="ni">&amp;nbsp;</span> ${TEST_ERROR}<span class="nt">&lt;/span&gt;</span>
                            <span class="nt">&lt;/li&gt;</span>
                        <span class="nt">&lt;/ul&gt;</span>
                    <span class="nt">&lt;/td&gt;</span>
                <span class="nt">&lt;/tr&gt;</span>
                <span class="nt">&lt;tr&gt;</span>
                    <span class="nt">&lt;td</span> <span class="na">style=</span><span class="s">"background-color: #beedc7; width: 150px;"</span> <span class="na">nowrap=</span><span class="s">"nowrap"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;span</span> <span class="na">style=</span><span class="s">"color: #000000;"</span><span class="nt">&gt;</span>Product Version<span class="nt">&lt;/span&gt;</span>
                    <span class="nt">&lt;/td&gt;</span>
                    <span class="nt">&lt;td</span> <span class="na">style=</span><span class="s">"background-color: #beedc7; width: 643px;"</span> <span class="na">nowrap=</span><span class="s">"nowrap"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;span</span> <span class="na">style=</span><span class="s">"color: #000000;"</span><span class="nt">&gt;</span>$PRODUCT_VERSION<span class="nt">&lt;/span&gt;</span>
                    <span class="nt">&lt;/td&gt;</span>
                <span class="nt">&lt;/tr&gt;</span>
                <span class="nt">&lt;tr&gt;</span>
                    <span class="nt">&lt;td</span> <span class="na">style=</span><span class="s">"background-color: #beedc7; width: 150px;"</span> <span class="na">nowrap=</span><span class="s">"nowrap"</span><span class="nt">&gt;</span>
                        Time Consuming
                    <span class="nt">&lt;/td&gt;</span>
                    <span class="nt">&lt;td</span> <span class="na">style=</span><span class="s">"background-color: #beedc7; width: 643px;"</span> <span class="na">nowrap=</span><span class="s">"nowrap"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;span</span> <span class="na">style=</span><span class="s">"color: #000000;"</span><span class="nt">&gt;</span>From ($START_TIME) To ($END_TIME)<span class="nt">&lt;/span&gt;</span>
                    <span class="nt">&lt;/td&gt;</span>
                <span class="nt">&lt;/tr&gt;</span>
                <span class="nt">&lt;tr&gt;</span>
                    <span class="nt">&lt;td</span> <span class="na">style=</span><span class="s">"background-color: #beedc7; width: 150px;"</span> <span class="na">nowrap=</span><span class="s">"nowrap"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;span</span> <span class="na">style=</span><span class="s">"color: #000000;"</span><span class="nt">&gt;</span>Project Name<span class="nt">&lt;/span&gt;</span>
                    <span class="nt">&lt;/td&gt;</span>
                    <span class="nt">&lt;td</span> <span class="na">style=</span><span class="s">"background-color: #beedc7; width: 643px;"</span> <span class="na">nowrap=</span><span class="s">"nowrap"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;span</span> <span class="na">style=</span><span class="s">"color: #000000;"</span><span class="nt">&gt;</span>$PROJECT_NAME<span class="nt">&lt;/span&gt;</span>
                    <span class="nt">&lt;/td&gt;</span>
                <span class="nt">&lt;/tr&gt;</span>
                <span class="nt">&lt;tr&gt;</span>
                    <span class="nt">&lt;td</span> <span class="na">style=</span><span class="s">"background-color: #beedc7; width: 150px;"</span> <span class="na">nowrap=</span><span class="s">"nowrap"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;span</span> <span class="na">style=</span><span class="s">"color: #000000;"</span><span class="nt">&gt;</span>Build Number<span class="nt">&lt;/span&gt;</span>
                    <span class="nt">&lt;/td&gt;</span>
                    <span class="nt">&lt;td</span> <span class="na">style=</span><span class="s">"background-color: #beedc7; width: 643px;"</span> <span class="na">nowrap=</span><span class="s">"nowrap"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;span</span> <span class="na">style=</span><span class="s">"color: #000000;"</span><span class="nt">&gt;</span>$BUILD_NUMBER<span class="nt">&lt;/span&gt;</span>
                    <span class="nt">&lt;/td&gt;</span>
                <span class="nt">&lt;/tr&gt;</span>
                <span class="nt">&lt;tr&gt;</span>
                    <span class="nt">&lt;td</span> <span class="na">style=</span><span class="s">"background-color: #beedc7; width: 150px;"</span> <span class="na">nowrap=</span><span class="s">"nowrap"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;span</span> <span class="na">style=</span><span class="s">"color: #000000;"</span><span class="nt">&gt;</span>Build Status<span class="nt">&lt;/span&gt;</span>
                    <span class="nt">&lt;/td&gt;</span>
                    <span class="nt">&lt;td</span> <span class="na">style=</span><span class="s">"background-color: #beedc7; width: 643px;"</span> <span class="na">nowrap=</span><span class="s">"nowrap"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;span</span> <span class="na">style=</span><span class="s">"color: #000000;"</span><span class="nt">&gt;</span>$BUILD_STATUS<span class="nt">&lt;/span&gt;</span>
                    <span class="nt">&lt;/td&gt;</span>
                <span class="nt">&lt;/tr&gt;</span>
                <span class="nt">&lt;tr&gt;</span>
                    <span class="nt">&lt;td</span> <span class="na">style=</span><span class="s">"background-color: #beedc7; width: 150px;"</span> <span class="na">nowrap=</span><span class="s">"nowrap"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;span</span> <span class="na">style=</span><span class="s">"color: #000000;"</span><span class="nt">&gt;</span>Trigger Reason<span class="nt">&lt;/span&gt;</span>
                    <span class="nt">&lt;/td&gt;</span>
                    <span class="nt">&lt;td</span> <span class="na">style=</span><span class="s">"background-color: #beedc7; width: 643px;"</span> <span class="na">nowrap=</span><span class="s">"nowrap"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;span</span> <span class="na">style=</span><span class="s">"color: #000000;"</span><span class="nt">&gt;</span>${CAUSE}<span class="nt">&lt;/span&gt;</span>
                    <span class="nt">&lt;/td&gt;</span>
                <span class="nt">&lt;/tr&gt;</span>
                <span class="nt">&lt;tr&gt;</span>
                    <span class="nt">&lt;td</span> <span class="na">style=</span><span class="s">"background-color: #3498db; width: 801px; text-align: left;"</span> <span class="na">colspan=</span><span class="s">"2"</span> <span class="na">nowrap=</span><span class="s">"nowrap"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;span</span> <span class="na">style=</span><span class="s">"color: #000000;"</span><span class="nt">&gt;</span>Test Information<span class="nt">&lt;/span&gt;</span>
                    <span class="nt">&lt;/td&gt;</span>
                <span class="nt">&lt;/tr&gt;</span>
                <span class="nt">&lt;tr&gt;</span>
                    <span class="nt">&lt;td</span> <span class="na">style=</span><span class="s">"background-color: #beedc7; border-color: gray; width: 150px;"</span> <span class="na">nowrap=</span><span class="s">"nowrap"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;span</span> <span class="na">style=</span><span class="s">"color: #000000;"</span><span class="nt">&gt;</span>Build<span class="ni">&amp;nbsp;</span>Result<span class="nt">&lt;/span&gt;</span>
                    <span class="nt">&lt;/td&gt;</span>
                    <span class="nt">&lt;td</span> <span class="na">style=</span><span class="s">"background-color: #beedc7; border-color: gray; width: 643px;"</span> <span class="na">nowrap=</span><span class="s">"nowrap"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;span</span> <span class="na">style=</span><span class="s">"color: #000000;"</span><span class="nt">&gt;&lt;a</span> <span class="na">style=</span><span class="s">"color: #000000;"</span> <span class="na">title=</span><span class="s">"Build Result"</span> <span class="na">href=</span><span class="s">"${BUILD_URL}console"</span><span class="nt">&gt;</span>${BUILD_URL}<span class="nt">&lt;/a&gt;&lt;/span&gt;</span>
                    <span class="nt">&lt;/td&gt;</span>
                <span class="nt">&lt;/tr&gt;</span>
                <span class="nt">&lt;tr&gt;</span>
                    <span class="nt">&lt;td</span> <span class="na">style=</span><span class="s">"background-color: #beedc7; border-color: gray; width: 150px;"</span> <span class="na">nowrap=</span><span class="s">"nowrap"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;span</span> <span class="na">style=</span><span class="s">"color: #000000;"</span><span class="nt">&gt;</span>Build Log<span class="nt">&lt;/span&gt;</span>
                    <span class="nt">&lt;/td&gt;</span>
                    <span class="nt">&lt;td</span> <span class="na">style=</span><span class="s">"background-color: #beedc7; border-color: gray; width: 643px;"</span> <span class="na">nowrap=</span><span class="s">"nowrap"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;span</span> <span class="na">style=</span><span class="s">"color: #000000;"</span><span class="nt">&gt;&lt;a</span> <span class="na">style=</span><span class="s">"color: #000000;"</span> <span class="na">title=</span><span class="s">"Build Log"</span> <span class="na">href=</span><span class="s">"${BUILD_URL}console"</span><span class="nt">&gt;</span>${BUILD_URL}console<span class="nt">&lt;/a&gt;&lt;/span&gt;</span>
                    <span class="nt">&lt;/td&gt;</span>
                <span class="nt">&lt;/tr&gt;</span>
                <span class="nt">&lt;tr&gt;</span>
                    <span class="nt">&lt;td</span> <span class="na">style=</span><span class="s">"background-color: #beedc7; border-color: gray; width: 150px;"</span> <span class="na">nowrap=</span><span class="s">"nowrap"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;span</span> <span class="na">style=</span><span class="s">"color: #000000;"</span><span class="nt">&gt;</span>Log<span class="ni">&amp;amp;</span>Report<span class="nt">&lt;/span&gt;</span>
                    <span class="nt">&lt;/td&gt;</span>
                    <span class="nt">&lt;td</span> <span class="na">style=</span><span class="s">"background-color: #beedc7; border-color: gray; width: 643px;"</span> <span class="na">nowrap=</span><span class="s">"nowrap"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;br&gt;</span>
                        <span class="nt">&lt;ul&gt;</span>
                            <span class="nt">&lt;li&gt;</span>
                                <span class="nt">&lt;span</span> <span class="na">style=</span><span class="s">"color: #000000;"</span><span class="nt">&gt;</span>Test Report:<span class="ni">&amp;nbsp;</span> <span class="ni">&amp;nbsp;</span> <span class="ni">&amp;nbsp;</span> <span class="ni">&amp;nbsp;</span> <span class="ni">&amp;nbsp;</span> <span class="ni">&amp;nbsp;</span> <span class="ni">&amp;nbsp;</span> <span class="ni">&amp;nbsp;</span> <span class="ni">&amp;nbsp;</span> <span class="ni">&amp;nbsp;</span> <span class="ni">&amp;nbsp;</span> <span class="ni">&amp;nbsp;</span> <span class="ni">&amp;nbsp;</span> <span class="ni">&amp;nbsp;</span> <span class="ni">&amp;nbsp;</span> <span class="nt">&lt;a</span> <span class="na">style=</span><span class="s">"color: #000000;"</span> <span class="na">title=</span><span class="s">"Test Report"</span> <span class="na">href=</span><span class="s">"${BUILD_URL}testReport"</span><span class="nt">&gt;</span>${BUILD_URL}testReport<span class="nt">&lt;/a&gt;&lt;/span&gt;</span>
                            <span class="nt">&lt;/li&gt;</span>
                            <span class="nt">&lt;li&gt;</span>
                                <span class="nt">&lt;span</span> <span class="na">style=</span><span class="s">"color: #000000;"</span><span class="nt">&gt;</span>Pylint Violations Report:<span class="ni">&amp;nbsp;</span> <span class="ni">&amp;nbsp;</span> <span class="ni">&amp;nbsp;</span> <span class="ni">&amp;nbsp;&amp;nbsp;</span> <span class="nt">&lt;a</span> <span class="na">style=</span><span class="s">"color: #000000;"</span> <span class="na">title=</span><span class="s">"Pylint Violations Report"</span> <span class="na">href=</span><span class="s">"${BUILD_URL}violations"</span><span class="nt">&gt;</span>${BUILD_URL}violations<span class="nt">&lt;/a&gt;&lt;/span&gt;</span>
                            <span class="nt">&lt;/li&gt;</span>
                            <span class="nt">&lt;li&gt;</span>
                                <span class="nt">&lt;span</span> <span class="na">style=</span><span class="s">"color: #000000;"</span><span class="nt">&gt;</span>Cobertura Coverage Report:<span class="ni">&amp;nbsp;&amp;nbsp;</span> <span class="nt">&lt;a</span> <span class="na">style=</span><span class="s">"color: #000000;"</span> <span class="na">title=</span><span class="s">"Cobertura Coverage Report"</span> <span class="na">href=</span><span class="s">"${BUILD_URL}cobertura"</span><span class="nt">&gt;</span>${BUILD_URL}cobertura<span class="nt">&lt;/a&gt;&lt;/span&gt;</span>
                            <span class="nt">&lt;/li&gt;</span>
                        <span class="nt">&lt;/ul&gt;</span>
                    <span class="nt">&lt;/td&gt;</span>
                <span class="nt">&lt;/tr&gt;</span>
             <span class="nt">&lt;/tbody&gt;</span>
        <span class="nt">&lt;/table&gt;</span>
    <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>

<p>é‚®ä»¶é™„ä»¶ä¿¡æ¯</p>

<p><img class="shadow" src="/img/in-post/nose_jenkins12.png" width="1200" /></p>

<p>åœ¨Attachmentå¤„ï¼Œå¡«å†™å¦‚ä¸‹é™„ä»¶è·¯å¾„ä¿¡æ¯ï¼š</p>

<p><code class="highlighter-rouge">report/create_cluster.html,report/setup_cluster.html,report/all_test_cases.html,report/nose_autotest.log</code></p>

<p>è®¾ç½®Publish JUnit test result report</p>

<p><img class="shadow" src="/img/in-post/nose_jenkins13.png" width="1200" /></p>

<p>è®¾ç½®Publish Cobertura coverage report</p>

<p><img class="shadow" src="/img/in-post/nose_jenkins14.png" width="1200" /></p>

<p>è®¾ç½® Report Violation</p>

<p><img class="shadow" src="/img/in-post/nose_jenkins15.png" width="1200" /></p>

<p>åœ¨pylintå¤„ï¼Œå½•å…¥report/pylint</p>

<p><img class="shadow" src="/img/in-post/nose_jenkins16.png" width="1200" /></p>

<h3 id="4éƒ¨åˆ†å‘½ä»¤è®°å½•">4ï¼‰éƒ¨åˆ†å‘½ä»¤è®°å½•</h3>

<p>è¿™éƒ¨åˆ†å‘½ä»¤ï¼Œå·²ç»å†™å…¥åˆ°run.pyä¸­ï¼Œå¦‚æœæƒ³æ‰‹åŠ¨å•ç‹¬æ‰§è¡Œï¼Œå¯ä»¥å‚è€ƒå¦‚ä¸‹å‘½ä»¤</p>

<h4 id="ç”Ÿæˆnosetestsxml">ç”Ÿæˆnosetests.xml</h4>

<p><code class="highlighter-rouge">nosetests --tc=runs:1 --with-xunit --traverse-namespace --with-coverage --cover-package=/home/nose_framework/src --cover-inclusive --with-progressive --with-colorunit --with-html --html-report=../report/all_case.html</code></p>

<h4 id="ç”Ÿæˆcoveragexml">ç”Ÿæˆcoverage.xml</h4>

<p><code class="highlighter-rouge">python -m coverage xml --include=/home/nose_framework/src*</code></p>

<h4 id="pylint">pylint</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd /home/nose_framework/src

pylint --rcfile=.pylintrc -f parseable -d I0011,R0801 * | tee pylint.out
</code></pre></div></div>

<h4 id="æ•ˆæœå›¾">æ•ˆæœå›¾</h4>

<p><img class="shadow" src="/img/in-post/nose_jenkins17.png" width="1200" /></p>

<p>è¯´æ˜ï¼š</p>
<ul>
  <li>1ã€å³ä¾§ï¼Œpylintï¼Œæ˜¾ç¤ºä»£ç è§„èŒƒè´¨é‡æ›²çº¿å›¾</li>
  <li>2ã€ç‚¹å‡»â€ Code Coverageâ€ æŸ¥çœ‹æµ‹è¯•ä»£ç è¦†ç›–ç‡</li>
  <li>3ã€ç‚¹å‡» â€œæœ€æ–°æµ‹è¯•ç»“æœâ€ï¼ŒæŸ¥çœ‹å…·ä½“çš„HTMLæµ‹è¯•æŠ¥å‘Š</li>
</ul>

<h5 id="æµ‹è¯•ä»£ç è¦†ç›–ç‡">æµ‹è¯•ä»£ç è¦†ç›–ç‡</h5>

<p><img class="shadow" src="/img/in-post/nose_jenkins18.png" width="1200" /></p>

<h5 id="htmlå±•ç¤ºç”¨ä¾‹æµ‹è¯•ç»“æœ">HTMLå±•ç¤ºç”¨ä¾‹æµ‹è¯•ç»“æœ</h5>

<p><img class="shadow" src="/img/in-post/nose_jenkins19.png" width="1200" /></p>

<h5 id="é‚®ä»¶æ¥æ”¶äººæ¥æ”¶åˆ°çš„é‚®ä»¶ä¿¡æ¯">é‚®ä»¶æ¥æ”¶äººæ¥æ”¶åˆ°çš„é‚®ä»¶ä¿¡æ¯</h5>

<p><img class="shadow" src="/img/in-post/nose_jenkins20.png" width="1200" /></p>

<h1 id="jenkins-ç¢°åˆ°çš„é—®é¢˜">Jenkins ç¢°åˆ°çš„é—®é¢˜</h1>

<h2 id="1æ— æ³•æ­£å¸¸å‘é€é‚®ä»¶">1ã€æ— æ³•æ­£å¸¸å‘é€é‚®ä»¶</h2>

<p>testé‚®ä»¶æ˜¯OKçš„ï¼Œä½†æ˜¯æ¯æ¬¡buildçš„ç»“æœï¼Œæ— æ³•æ­£å¸¸å‘é€é‚®ä»¶ï¼Œconsoleä¿¡æ¯æ˜¾ç¤ºï¼š</p>

<p><img class="shadow" src="/img/in-post/nose_jenkins21.png" width="1200" /></p>

<p>é—®é¢˜è§£å†³æ–¹æ³•</p>

<p>è¿™ä¸ªé—®é¢˜æ˜¯Jenkinsç®¡ç†ç”¨æˆ·çš„ä¸€ä¸ªé—®é¢˜ï¼Œå®ƒå¯ä»¥è‡ªåŠ¨ä»gitæˆ–è€…svnè¯»å–ç”¨æˆ·ä¿¡æ¯ä»¥åŠé‚®ä»¶ï¼ˆå¦‚æœgitç­‰ä¸­è®¾ç½®äº†çš„è¯ï¼‰ï¼Œ ä½†å®ƒä¸åˆä¸åˆ›å»ºJenkinsä¸Šçš„ç”¨æˆ·ï¼Œæ‰€ä»¥ä½ å¯ä»¥åœ¨pepoleåˆ—è¡¨ä¸Šçœ‹åˆ°æœ‰ç”¨æˆ·åï¼Œä½†åœ¨jenkinsçš„ç”¨æˆ·åˆ—è¡¨ä¸Šåˆæ²¡æœ‰è¯¥ç”¨æˆ·ã€‚</p>

<p>ä¿®å¤çš„æ–¹æ³•ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯ç”¨adminç™»é™†jenkinsï¼Œå¸®æ‰€æœ‰peopleåˆ—è¡¨ä¸Šçš„ç”¨æˆ·è®¾ç½®ä¸€ä¸‹é»˜è®¤å¯†ç ï¼ˆè‡ªå·±çº¦å®šï¼‰å¹¶ä¿å­˜ï¼Œåˆ™ä¼šåˆ›å»ºç›¸åº”çš„jenkinsç”¨æˆ·äº†ï¼Œè¿™æ ·ç”¨æˆ·å°±éƒ½æ˜¯registreredç”¨æˆ·äº†ã€‚</p>

<p>è¯¦è¯·å‚è€ƒï¼š<code class="highlighter-rouge">https://www.oschina.net/question/3567295_2246136</code></p>

<h2 id="2console-ä¿¡æ¯å‡ºç°é¢œè‰²å€¼">2ã€Console ä¿¡æ¯å‡ºç°é¢œè‰²å€¼</h2>

<p>å¦‚ä¸‹å›¾æ‰€ç¤º</p>

<p><img class="shadow" src="/img/in-post/nose_jenkins22.png" width="1200" /></p>

<p>ä¸Šå›¾ä¸­çš„â€œ[32m[1mâ€å³ä¸ºé¢œè‰²å€¼ï¼Œä¸å¤ªç¾è§‚ï¼Œæ”¹è¿›ä¹‹ã€‚</p>

<p>Jenkins æœ‰ ä¸€ ä¸ª æ’ ä»¶ AnsiColorï¼Œ è¯¦ è¯· å‚ è€ƒ ï¼š <code class="highlighter-rouge">https://www.jianshu.com/p/12083063957b?utm_campaign=maleskine&amp;utm_content=note&amp;ut m_medium=seo_notes&amp;utm_source=recommendation</code></p>

<p>å®‰è£…æˆåŠŸå¹¶é‡å¯Jenkins æœåŠ¡åï¼Œåœ¨ Build Environment å¤„ï¼Œé€‰æ‹©â€œColor ANSI Console Outputâ€ï¼Œå¹¶è®¾ç½®â€œANSI color mapâ€ä¸º xterm å³å¯ï¼š</p>

<p><img class="shadow" src="/img/in-post/nose_jenkins23.png" width="1200" /></p>

<p>æ•ˆæœå›¾ï¼š</p>

<p><img class="shadow" src="/img/in-post/nose_jenkins24.png" width="800" /></p>

:ET