I"Å<h1 id="æ¦‚è¿°">æ¦‚è¿°</h1>

<p>è¯´å‡è®¾æœ‰ä¸€ä¸ª100å°èŠ‚ç‚¹çš„Hadoopé›†ç¾¤ï¼Œè¦é…ç½®èŠ‚ç‚¹ä¹‹é—´çš„SSHå…å¯†ç ç™»å½•ï¼Œè¯¥å¦‚ä½•ç”¨shellè„šæœ¬å®ç°ï¼Ÿ</p>

<h2 id="æ–¹æ¡ˆ1è„šæœ¬å®ç°">æ–¹æ¡ˆ1ï¼šè„šæœ¬å®ç°</h2>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#!/bin/expect
#å¾ªç¯100å°æœºå™¨çš„IPåœ°å€ï¼Œç”Ÿæˆå¯†é’¥æ–‡ä»¶authorized_keys

for ip in {cat ip.list}
do
  ssh user@$ip ssh-keygen -t rsa  &amp;&gt;/dev/null
  expect{
â€‹        "yes/no" { send "yes\r";exp_continue}
â€‹        "password:"{send "$passwd\r";exp_continue}
â€‹       }

  cat ~/.ssh/id_rsa.pub &gt; ~/.ssh/authorized_keys &amp;&gt; /dev/null  
  exit

  if [ !-f ~/.ssh/authorized_keys ];&lt;br&gt;   then
â€‹    touch ~/.ssh/authorized_keys&lt;br&gt;   fi
  ssh user@$ip cat ~/.ssh/authorized_keys &gt;&gt; ~/.ssh/authorized_keys  &amp;&gt; /dev/null
  expect{
â€‹        "yes/no" { send "yes\r";exp_continue}
â€‹        "password:"{send "$passwd\r";exp_continue}
â€‹       }  
done

 
#scp authorized_keys æ–‡ä»¶åˆ°å„å°æœºå™¨ä¸Šé¢ã€‚
for ip in {cat ip.list}
do
  scp ~/.ssh/authorized_keys user@$ip:~/.ssh/ 
  expect{
â€‹        "yes/no" { send "yes\r";exp_continue}
â€‹        "password:"{send "$passwd\r";exp_continue}
â€‹       }  
done
</code></pre></div></div>

<h2 id="æ–¹æ¡ˆ2æ‰€æœ‰nodeä½¿ç”¨ç›¸åŒkey">æ–¹æ¡ˆ2ï¼šæ‰€æœ‰nodeä½¿ç”¨ç›¸åŒkey</h2>

<p>å°†ç¬¬ä¸€ä¸ªnodeä¸Šç”Ÿæˆçš„dsa public keyï¼ˆä¸€èˆ¬æ˜¯/root/.ssh/id_dsa.pubï¼‰ï¼Œscpåˆ°å…¶ä»–èŠ‚ç‚¹çš„/root/.ssh/ç›®å½•ä¸‹ï¼Œå³æ‰€æœ‰èŠ‚ç‚¹çš„dsa public keyéƒ½ä¸€æ ·ï¼Œè‡ªç„¶å°±å®ç°sshçš„äº’ä¿¡äº†ã€‚</p>

<p>è¿™é‡Œä»‹ç»ä¸ªå¿«é€Ÿä¼ é€’ssh keyçš„å‘½ä»¤ï¼Œssh-copy-id ï¼š</p>

<p>ssh-copy-id å°†æœ¬æœºçš„å…¬é’¥å¤åˆ¶åˆ°è¿œç¨‹æœºå™¨çš„authorized_keysæ–‡ä»¶ä¸­ï¼Œssh-copy-idä¹Ÿèƒ½è®©ä½ åˆ°è¿œç¨‹æœºå™¨çš„home, ~./ssh , å’Œ ~/.ssh/authorized_keysçš„æƒåˆ©ã€‚</p>

<p>è¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> ssh-copy-id å°†keyå†™åˆ°è¿œç¨‹æœºå™¨çš„ ~/ .ssh/authorized_key.æ–‡ä»¶ä¸­ 
</code></pre></div></div>

<p>ç¤ºä¾‹ï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> ssh-copy-id -i .ssh/id_rsa.pub ç”¨æˆ·åå­—@192.168.x.xxx
</code></pre></div></div>

:ET