I"É<h1 id="æ¦‚è¦">æ¦‚è¦</h1>

<p>æœ¬ç¯‡ä»‹ç»äº†iscsiadmå¸¸è§å‘½ä»¤å’ŒiSCSIè‡ªåŠ¨æŒ‚è½½çš„æ–¹æ³•ã€‚</p>

<p>iscsiadmå·¥å…·ç”¨äºLinuxè¿æ¥ä»¥å¤ªç½‘ä¸Šçš„iSCSIè®¾å¤‡ï¼Œæˆ‘ä»¬çš„ç³»ç»Ÿä¸­å†…ç½®æœ¬å·¥å…·ï¼Œå¦‚æœæ˜¯å…¶ä»–OSï¼Œå¯èƒ½éœ€è¦å…ˆå®‰è£…ç›¸åº”åŒ…ã€‚</p>

<h1 id="å®‰è£…">å®‰è£…</h1>

<p>Ubuntu</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>apt-get install open-iscsi
apt-get install open-iscsi-utils
</code></pre></div></div>

<p>CentOS</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>yum install iscsi-initiator-utils
</code></pre></div></div>

<p>å®‰è£…å®Œæˆååº”è¯¥ä¼šè‡ªåŠ¨å¯åŠ¨ï¼Œå¦‚æœæ²¡æœ‰ä½¿ç”¨service iscsi start</p>

<h1 id="ä½¿ç”¨">ä½¿ç”¨</h1>

<p>å¸¸è§æ­¥éª¤å¦‚ä¸‹ï¼š</p>

<p><code class="highlighter-rouge">iscsiadm -m discovery -t sendtargets -p {ip_address:port}</code></p>
<ul>
  <li>å‘ç°ç»™å®šIPçš„targetï¼Œportå¯ä¸åŠ ï¼Œé»˜è®¤æ˜¯3260ï¼Œsendtargetså¯ç®€å†™ä¸ºst</li>
</ul>

<p><code class="highlighter-rouge">iscsiadm -m node -T { target-name } -p { ip_address:port } -l</code></p>
<ul>
  <li>æŒ‚è½½iSCSI è®¾å¤‡</li>
</ul>

<p><code class="highlighter-rouge">iscsiadm -m node -T { target-name } -p { ip_address:port } -u</code></p>
<ul>
  <li>å¸è½½iSCSI è®¾å¤‡</li>
</ul>

<p>å…¶ä»–å¸¸è§å‘½ä»¤ï¼š</p>

<ul>
  <li>æŸ¥çœ‹iSCSIçŠ¶æ€
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>iscsiadm -m session # æŸ¥çœ‹å½“å‰ç™»å½•çš„sessionï¼Œå¯ä»¥å¸¦å‚æ•°-P 3æŸ¥çœ‹åˆ°è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬targetå’ŒsdXçš„å¯¹åº”å…³ç³»ï¼
iscsiadm -m node # æŸ¥çœ‹å½“å‰å·²ç»discoveryåˆ°çš„target
</code></pre></div>    </div>
  </li>
  <li>åˆ é™¤iSCSIè®¾å¤‡</li>
</ul>

<p><code class="highlighter-rouge">iscsiadm -m node -o delete -T { target-name } -p { ip_address:port }</code></p>

<ul>
  <li>
    <ul>
      <li>å¯ä»¥çµæ´»é€‰ç”¨-på’Œ-Tï¼Œæ¯”å¦‚iscsiadm -m node -T iqn.2016-12.bigtera.com:test -lè¡¨ç¤ºæŒ‚è½½å½“å‰discoveryåˆ°çš„åå­—æ˜¯iqn.2016-12.bigtera.com:testçš„targetï¼Œæ‰€æœ‰çš„IPéƒ½ä¼šè¢«æŒ‚è½½åˆ°ï¼›åŒç†ï¼Œå¦‚æœæ˜¯iscsiadm -m node -p 192.168.1.1 -uï¼Œè¡¨ç¤ºå¸è½½192.168.1.1ä¸Šçš„æ‰€æœ‰targetï¼›å¦‚æœæ—¢æ²¡æœ‰-pï¼Œä¹Ÿæ²¡æœ‰-Tï¼Œè¡¨ç¤ºæŒ‚è½½/å¸è½½æ‰€æœ‰sessionã€‚</li>
    </ul>
  </li>
</ul>

<h1 id="å¼€æœºè‡ªåŠ¨æŒ‚è½½">å¼€æœºè‡ªåŠ¨æŒ‚è½½</h1>

<h2 id="step1-ä¿®æ”¹-etciscsiiscsidconf">Step1. ä¿®æ”¹ â€œ/etc/iscsi/iscsid.confâ€</h2>

<p>æŠŠ node.startup æ”¹æˆ automaticã€‚(å¦‚æœå·²ç»discoveryäº†çš„è¯éœ€è¦å…ˆåˆ é™¤targetï¼Œå¦‚ä¸Šè¿°å‘½ä»¤â€åˆ é™¤iSCSIè®¾å¤‡â€)</p>

<h2 id="step2-é‡æ–°å‘ç°">Step2. é‡æ–°å‘ç°</h2>

<p><code class="highlighter-rouge">iscsiadm -m discovery -t sendtargets -p ip</code></p>

<h2 id="step3-é…ç½®æ–‡ä»¶æ£€æŸ¥">Step3. é…ç½®æ–‡ä»¶æ£€æŸ¥</h2>

<p>æ£€æŸ¥ç±»ä¼¼å¦‚ä¸‹configä¸­çš„startupæ˜¯å¦æ˜¯automaticï¼Œå¯¹äºä¸åŒçš„releaseç‰ˆæœ¬ä½ç½®æœ‰æ‰€ä¸åŒï¼Œä¸¾ä¾‹ï¼š</p>

<h3 id="for-ubuntu">For Ubuntu:</h3>

<p><code class="highlighter-rouge">/etc/iscsi/nodes/iqnname/192.168.0.1:servername.iscsiTargetName/default</code></p>

<h3 id="for-centos">For Centos:</h3>

<p><code class="highlighter-rouge">/var/lib/iscsi/nodes/iqn.2001-06.com.test\:storage/192.168.0.14\,3260\,1/default</code></p>

<p>å¯ä»¥é’ˆå¯¹ä¸åŒçš„sessionè®¾ç½®ä¸åŒçš„startupç­–ç•¥(manual/automatic)ã€‚</p>
:ET