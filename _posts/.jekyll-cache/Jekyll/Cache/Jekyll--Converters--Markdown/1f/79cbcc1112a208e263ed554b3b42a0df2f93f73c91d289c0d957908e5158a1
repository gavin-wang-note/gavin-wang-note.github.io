I"®8<h1 id="æ¦‚è¿°">æ¦‚è¿°</h1>

<p>ä»Šå¤©éªŒè¯åœ¨å¯¹å­˜å‚¨ä¸æ–­çŒS3 10Kå°å¯¹è±¡æ•°æ®æƒ…å†µä¸‹ï¼Œå¯¹è®¾å¤‡å¼ºåˆ¶æ–­ç”µï¼Œè§‚å¯Ÿæ˜¯å¦å¼•å‘ceph-osd crashé—®é¢˜ï¼Œç®€æ˜“å†™äº†ä¸ªä¸´æ—¶å‘½ä»¤å®Œæˆæ£€æŸ¥æ“ä½œï¼Œå¦‚ä¸‹ï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>for i in {1..100}; do echo "================== $i =================="; rand_time=`expr $RANDOM / 400`; echo "  sleep ${rand_time}s"; sleep ${rand_time}; ipmitool -I lan  -U ADMIN -P ADMIN -H 172.17.75.169 chassis power off; rand_time=`expr $RANDOM / 400`; echo "  sleep ${rand_time}s"; sleep ${rand_time};ipmitool -I lan  -U ADMIN -P ADMIN -H 172.17.75.169 chassis power on; echo "  power on, then sleep 300s"; sleep 300;done
</code></pre></div></div>

<p>å¦å¤–ä¸€ä¸ªä¸´æ—¶checkè„šæœ¬å‚è€ƒå¦‚ä¸‹:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@node76:~# cat check_cores.sh 
#!/bin/bash

i=1

while [[ $i -lt 1000  ]];do
    echo "=========================== $i ==============================="

    res=`onnode all 'ls /var/log/cores -lhrt | grep -vi ldb' 2&gt;/dev/null|grep ezcore`
    if [[ $? -eq 0 ]]; then
        echo "`date`: FAIL!! Core dump of others yielded."
        exit 1
    else
        rand_time=`expr $RANDOM / 1000`
        echo "  OK --&gt; sleep ${rand_time}s"
        sleep ${rand_time} 
        let i+=1
    fi    
    
done
root@node76:~# 
</code></pre></div></div>

<p>è¿™é‡Œä½¿ç”¨åˆ°äº†éšæœºæ•°ï¼Œæœ¬æ–‡ä»‹ç»shellå‡ ç§ç”Ÿæˆéšæœºæ•°çš„æ–¹æ³•ã€‚</p>

<h1 id="shell-äº§ç”Ÿéšæœºæ•°çš„å‡ ç§æ–¹æ³•">shell äº§ç”Ÿéšæœºæ•°çš„å‡ ç§æ–¹æ³•</h1>

<h2 id="å†…ç½®å˜é‡random">å†…ç½®å˜é‡$RANDOM</h2>

<p>å‚è€ƒ <code class="highlighter-rouge">http://www.tldp.org/LDP/abs/html/randomvar.html</code></p>

<p>RANDOM æ˜¯ Bash çš„ä¸€ä¸ªå†…å»ºå‡½æ•°(è€Œä¸æ˜¯å¸¸é‡)ï¼Œä¼šè¿”å›ä¸€ä¸ªåœ¨åŒºé—´ [0, 32767] å†…çš„æ•´æ•°ï¼Œè‹¥è¶…è¿‡5ä½å¯ä»¥åŠ ä¸ªå›ºå®š10ä½æ•´æ•°ï¼Œç„¶åè¿›è¡Œæ±‚ä½™ã€‚</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@node76:~# echo $RANDOM 
27399
root@node76:~# echo $RANDOM 
17012
root@node76:~#
</code></pre></div></div>

<h3 id="ç¤ºä¾‹ç”Ÿæˆ10ä»¥å†…">ç¤ºä¾‹ï¼šç”Ÿæˆ10ä»¥å†…</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@node76:~# expr $RANDOM % 10 + 1
10
root@node76:~# 
</code></pre></div></div>

<h3 id="ç¤ºä¾‹-ç”ŸæˆæŒ‡å®šèŒƒå›´å†…çš„éšæœºæ•°">ç¤ºä¾‹ï¼š ç”ŸæˆæŒ‡å®šèŒƒå›´å†…çš„éšæœºæ•°</h3>

<p>ç”Ÿæˆ1000~2000çš„éšæœºæ•°ï¼Œç¤ºä¾‹å¦‚ä¸‹:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@node76:~/shell# cat r.sh 
#!/bin/bash    

function rand(){
    min=$1
    max=$(($2 - $min + 1))
    num=$(($RANDOM+1000000000)) # å¢åŠ ä¸€ä¸ª10ä½çš„æ•°å†æ±‚ä½™
    echo $(($num%$max + $min))
}

rand_no=$(rand 1000 2000)
echo $rand_no

exit 0
root@node76:~/shell#
</code></pre></div></div>

<p>è¿è¡Œç»“æœç¤ºä¾‹å¦‚ä¸‹:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@node76:~/shell# bash r.sh
1332
root@node76:~/shell# bash r.sh
1581
root@node76:~/shell# bash r.sh
1293
root@node76:~/shell# bash r.sh
1787
root@node76:~/shell# 
</code></pre></div></div>

<h2 id="ä½¿ç”¨awkçš„éšæœºå‡½æ•°">ä½¿ç”¨awkçš„éšæœºå‡½æ•°</h2>

<p><code class="highlighter-rouge">awk 'BEGIN{srand();print rand()*1000000}' </code></p>

<h2 id="ä½¿ç”¨date-sn">ä½¿ç”¨date +%s%N</h2>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>date +%s%N  # ç”Ÿæˆ19ä½æ•°
date +%s%N | cut -c6-13 # å–å…«ä½æ•°å­—
date +%s%N | md5sum | head -c 8 # å…«ä½å­—æ¯å’Œæ•°å­—çš„ç»„åˆ
</code></pre></div></div>

<h3 id="ç¤ºä¾‹ç”Ÿæˆ150çš„éšæœºæ•°">ç¤ºä¾‹ï¼šç”Ÿæˆ1~50çš„éšæœºæ•°</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>

<span class="k">function </span>rand<span class="o">(){</span>
    <span class="nv">min</span><span class="o">=</span><span class="nv">$1</span>
    <span class="nv">max</span><span class="o">=</span><span class="k">$((</span><span class="nv">$2</span><span class="o">-</span> <span class="nv">$min</span> <span class="o">+</span> <span class="m">1</span><span class="k">))</span>
    <span class="nv">num</span><span class="o">=</span><span class="si">$(</span><span class="nb">date</span> +%s%N<span class="si">)</span>
    <span class="nb">echo</span> <span class="k">$((</span><span class="nv">$num</span> <span class="o">%</span> <span class="nv">$max</span> <span class="o">+</span> <span class="nv">$min</span><span class="k">))</span>
<span class="o">}</span>

<span class="nv">rnd</span><span class="o">=</span><span class="si">$(</span>rand 1 50<span class="si">)</span>
<span class="nb">echo</span> <span class="nv">$rnd</span>

<span class="nb">exit </span>0
</code></pre></div></div>

<h2 id="openssl-randäº§ç”Ÿéšæœºæ•°">openssl randäº§ç”Ÿéšæœºæ•°</h2>

<p>openssl rand ç”¨äºäº§ç”ŸæŒ‡å®šé•¿åº¦ä¸ªbytesçš„éšæœºå­—ç¬¦ã€‚-base64æˆ–-hexå¯¹éšæœºå­—ç¬¦ä¸²è¿›è¡Œbase64ç¼–ç æˆ–ç”¨hexæ ¼å¼æ˜¾ç¤ºã€‚</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>openssl rand -base64 3 | md5sum | cut -c1-8      # å…«ä½å­—æ¯å’Œæ•°å­—çš„ç»„åˆ
openssl rand -base64 2 | cksum | cut -c1-8       # å…«ä½æ•°å­—
</code></pre></div></div>

<p>é¢å¤–è¡¥å……ä¸€ä¸‹ï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@node76:~/shell# openssl rand  -base64 0 | md5sum | cut -c1-8
d41d8cd9
root@node76:~/shell# openssl rand  -base64 0 | md5sum | cut -c1-8
d41d8cd9
root@node76:~/shell# openssl rand  -base64 0 | md5sum | cut -c1-8
d41d8cd9
root@node76:~/shell# openssl rand  -base64 1 | md5sum | cut -c1-8
e2740bcc
root@node76:~/shell# openssl rand  -base64 1 | md5sum | cut -c1-8
d8fb4cee
root@node76:~/shell# openssl rand  -base64 1 | md5sum | cut -c1-8
212e9682
root@node76:~/shell# 
root@node76:~/shell# openssl rand  -base64 0
root@node76:~/shell# openssl rand  -base64 1
IQ==
root@node76:~/shell# openssl rand  -base64 1
4g==
root@node76:~/shell# openssl rand  -base64 1
zA==
root@node76:~/shell# openssl rand  -base64 10
94pxE5KZvYNU9g==
root@node76:~/shell# openssl rand  -base64 30
PxfQot0kAO9KdTO6H4ny71AguR28LZiWa/ruVaja
root@node76:~/shell#
</code></pre></div></div>

<p>é€šè¿‡ä¸Šé¢å‚æ•°-base64åé¢çš„å€¼ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œå½“å€¼ä¸º0æ—¶ï¼Œ<code class="highlighter-rouge">openssl rand  -base64 0</code>è¾“å‡ºä¸ºç©ºï¼Œè€Œé0å€¼æ—¶æ‰æœ‰è¾“å‡ºï¼Œæ²¡æœ‰æ‰¾åˆ°è¿™ä¸ªå…·ä½“æ•°å€¼çš„å«ä¹‰ï¼Œä¸ªäººæ¨æµ‹æ˜¯seed(ç§å­)ï¼Œseed=0,äº§ç”Ÿçš„å€¼æ—¶ä¸€ä¸ªå›ºå®šå€¼ã€‚</p>

<h2 id="é€šè¿‡ç³»ç»Ÿå†…å”¯ä¸€æ•°æ®ç”Ÿæˆéšæœºæ•°devrandomåŠdevurandom">é€šè¿‡ç³»ç»Ÿå†…å”¯ä¸€æ•°æ®ç”Ÿæˆéšæœºæ•°ï¼ˆ/dev/randomåŠ/dev/urandomï¼‰</h2>

<h3 id="random">random</h3>

<p>/dev/randomæ˜¯ Linux ä¸Šçš„ä¸€ä¸ªå­—ç¬¦è®¾å¤‡ï¼Œé‡Œé¢ä¼šæºæºä¸æ–­åœ°äº§ç”Ÿéšæœºæ•°(å­˜å‚¨ç³»ç»Ÿå½“å‰è¿è¡Œçš„ç¯å¢ƒçš„å®æ—¶æ•°æ®), æ˜¯é˜»å¡çš„éšæœºæ•°å‘ç”Ÿå™¨ï¼Œè¯»å–æœ‰æ—¶éœ€è¦ç­‰å¾…ï¼Œå¯ä»¥çœ‹ä½œç³»ç»ŸæŸæ—¶å€™çš„å”¯ä¸€å€¼æ•°æ®ã€‚</p>

<p>ä¸€èˆ¬æ¥è¯´ï¼Œç”¨ od å‘½ä»¤å³å¯:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@node76:~/shell# od -An -N2 -i /dev/random
        4291
root@node76:~/shell# 
</code></pre></div></div>

<p>è¿™é‡Œçš„ -N2 æŒ‡å®šè¦è¯»å–çš„å­—èŠ‚æ•°ï¼Œ -i åˆ™æ˜¯æŒ‡å®šè¾“å…¥ã€‚</p>

<p>è‹¥è¦äº§ç”Ÿç‰¹å®šèŒƒå›´å†…çš„éšæœºæ•°ï¼Œåˆ™å’Œä½¿ç”¨ $RANDOM çš„æ–¹æ³•ç±»ä¼¼:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># @args &lt;beg&gt; &lt;end&gt;
# return random integer in [&lt;beg&gt;, &lt;end&gt;)
function random_range() {
    local beg=$1
    local end=$2
    echo $(($(od -An -N2 -i /dev/random) % ($end - $beg) + $beg))
}
</code></pre></div></div>

<h3 id="urandom">urandom</h3>

<p>/dev/urandom æ˜¯éé˜»å¡çš„éšæœºæ•°äº§ç”Ÿå™¨ï¼Œè¯»å–æ—¶ä¸ä¼šäº§ç”Ÿé˜»å¡ï¼Œé€Ÿåº¦æ›´å¿«ã€å®‰å…¨æ€§è¾ƒå·®çš„éšæœºæ•°å‘ç”Ÿå™¨ã€‚</p>

<p><code class="highlighter-rouge">cat /dev/urandom | head -n 10 | md5sum | head -c 10</code>     # ç”Ÿæˆå­—æ¯æ•°å­—ç»„åˆä¸²</p>

<p><code class="highlighter-rouge">cat /dev/urandom | strings -n 8 | head -n 1</code>      # ç”Ÿæˆå…¨å­—ç¬¦çš„éšæœºå­—ç¬¦ä¸²ï¼Œå«ç‰¹æ®Šå­—ç¬¦ï¼ˆe.g: NO&gt;0/D}I?lnï¼‰</p>

<p><code class="highlighter-rouge">cat /dev/urandom | sed -e 's/[^a-zA-Z0-9]//g' | strings -n 8 | head -n 1</code>   # ç”Ÿæˆæ•°å­—åŠ å­—æ¯çš„éšæœºå­—ç¬¦ä¸²</p>

<p>å…¶ä¸­ strings -nè®¾ç½®å­—ç¬¦ä¸²çš„å­—ç¬¦æ•°ï¼Œhead -nå¹¶ä¸åƒæ˜¯è®¾ç½®è¾“å‡ºçš„è¡Œæ•°ï¼Œæ›´åƒæ˜¯seed(ç§å­)ã€‚</p>

<p><code class="highlighter-rouge">head -n 20 /dev/urandom| cksum | cut -d" " -f1</code>   # urandomçš„æ•°æ®å¾ˆå¤šä½¿ç”¨catä¼šæ¯”è¾ƒæ…¢ï¼Œåœ¨æ­¤ä½¿ç”¨headè¯»20è¡Œï¼Œcksumå°†è¯»å–æ–‡ä»¶å†…å®¹ç”Ÿæˆå”¯ä¸€çš„è¡¨ç¤ºæ•´å‹æ•°æ®ï¼Œcutä»¥ç©ºæ ¼åˆ†å‰²ç„¶åå¾—åˆ°åˆ†å‰²çš„ç¬¬ä¸€ä¸ªå­—æ®µæ•°æ®</p>

<h3 id="ç¤ºä¾‹ä½¿ç”¨devurandomç”Ÿæˆ100500çš„éšæœºæ•°">ç¤ºä¾‹ï¼šä½¿ç”¨/dev/urandomç”Ÿæˆ100~500çš„éšæœºæ•°</h3>

<p>è¿™é‡Œä½¿ç”¨urandomé¿å…é˜»å¡ã€‚</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>

<span class="k">function </span>rand<span class="o">(){</span>
    <span class="nv">min</span><span class="o">=</span><span class="nv">$1</span>
    <span class="nv">max</span><span class="o">=</span><span class="k">$((</span><span class="nv">$2</span> <span class="o">-</span> <span class="nv">$min</span> <span class="o">+</span> <span class="m">1</span><span class="k">))</span>
    <span class="nv">num</span><span class="o">=</span><span class="si">$(</span><span class="nb">cat</span> /dev/urandom | <span class="nb">head</span> <span class="nt">-n</span> 10 | <span class="nb">cksum</span> | <span class="nb">awk</span> <span class="nt">-F</span> <span class="s1">' '</span> <span class="s1">'{print $1}'</span><span class="si">)</span>
    <span class="nb">echo</span> <span class="k">$((</span><span class="nv">$num</span> <span class="o">%</span> <span class="nv">$max</span> <span class="o">+</span> <span class="nv">$min</span><span class="k">))</span>
<span class="o">}</span>

<span class="nv">rnd</span><span class="o">=</span><span class="si">$(</span>rand 100 500<span class="si">)</span>
<span class="nb">echo</span> <span class="nv">$rnd</span>

<span class="nb">exit </span>0
</code></pre></div></div>

<h2 id="seq--sort">seq + sort</h2>

<p>sort å‘½ä»¤æœ‰ä¸€ä¸ª -R é€‰é¡¹ï¼Œå¯ä»¥æ ¹æ®éšæœº hash æ’åºï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ç”¨ seq å‘½ä»¤å…ˆç”Ÿæˆä¸€ä¸ªæ•´æ•°åºåˆ—ï¼Œç„¶åç”¨ sort çš„ -R é€‰é¡¹å¤„ç†å–å…¶ä¸­ä¸€è¡Œå³å¯ã€‚</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># @args &lt;beg&gt; &lt;end&gt;
# return random integer in [&lt;beg&gt;, &lt;end&gt;]
function random_range {
    local beg=$1
    local end=$2
    seq $beg $end | sort -R | head -n1
}
</code></pre></div></div>

<p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œä½¿ç”¨è¿™ç§æ–¹æ³•æ—¶ï¼Œè¦æ±‚çš„å€¼åŸŸå¯ä»¥åŒ…å«è´Ÿæ•°åŒºåŸŸï¼Œè€Œæœ¬æ–‡çš„å…¶ä»–æ–¹æ³•åˆ™è¦è¿›è¡Œä¸åŒçš„å¤„ç†ã€‚</p>

<h2 id="shuf">shuf</h2>

<p>shuf å’Œ â€˜sort -Râ€™ çš„ä½œç”¨ç±»ä¼¼ï¼Œç”¨æ¥æ ¹æ®è¾“å…¥ç”Ÿæˆéšæœºåºåˆ—:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># @args &lt;beg&gt; &lt;end&gt;
# return random integer in [&lt;beg&gt;, &lt;end&gt;]
function random_range {
    shuf -i $1-$2 -n1
}
</code></pre></div></div>

<p>åœ¨å„ç§æ–¹æ³•ä¸­ï¼Œä½¿ç”¨ shuf å‘½ä»¤æ˜¯æœ€ç®€æ´çš„ã€‚</p>

<h2 id="è¯»å–linuxçš„uuidç ">è¯»å–linuxçš„uuidç </h2>

<p>UUIDç å…¨ç§°æ˜¯é€šç”¨å”¯ä¸€è¯†åˆ«ç  (Universally Unique Identifier, UUID)ï¼ŒUUIDæ ¼å¼æ˜¯ï¼šåŒ…å«32ä¸ª16è¿›åˆ¶æ•°å­—ï¼Œä»¥â€œ-â€è¿æ¥å·åˆ†ä¸ºäº”æ®µï¼Œå½¢å¼ä¸º8-4-4-4-12çš„32ä¸ªå­—ç¬¦ã€‚linuxçš„uuidç ä¹Ÿæ˜¯æœ‰å†…æ ¸æä¾›çš„ï¼Œåœ¨/proc/sys/kernel/random/uuidè¿™ä¸ªæ–‡ä»¶å†…ã€‚cat/proc/sys/kernel/random/uuidæ¯æ¬¡è·å–åˆ°çš„æ•°æ®éƒ½ä¼šä¸åŒã€‚</p>

<p><code class="highlighter-rouge">cat /proc/sys/kernel/random/uuid| cksum | cut -f1 -d" "</code>    # è·å–ä¸åŒçš„éšæœºæ•´æ•°</p>

<p><code class="highlighter-rouge">cat /proc/sys/kernel/random/uuid| md5sum | cut -c1-8</code>      # æ•°å­—åŠ å­—æ¯çš„éšæœºæ•°</p>

<h3 id="ç¤ºä¾‹-ä½¿ç”¨linux-uuid-ç”Ÿæˆ100500éšæœºæ•°">ç¤ºä¾‹: ä½¿ç”¨linux uuid ç”Ÿæˆ100~500éšæœºæ•°</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash    </span>
    
<span class="k">function </span>rand<span class="o">(){</span>    
    <span class="nv">min</span><span class="o">=</span><span class="nv">$1</span>    
    <span class="nv">max</span><span class="o">=</span><span class="k">$((</span><span class="nv">$2</span> <span class="o">-</span> <span class="nv">$min</span> <span class="o">+</span> <span class="m">1</span><span class="k">))</span>    
    <span class="nv">num</span><span class="o">=</span><span class="si">$(</span><span class="nb">cat</span> /proc/sys/kernel/random/uuid | <span class="nb">cksum</span> | <span class="nb">awk</span> <span class="nt">-F</span> <span class="s1">' '</span> <span class="s1">'{print $1}'</span><span class="si">)</span>    
    <span class="nb">echo</span> <span class="k">$((</span><span class="nv">$num</span> <span class="o">%</span> <span class="nv">$max</span> <span class="o">+</span> <span class="nv">$min</span><span class="k">))</span>    
<span class="o">}</span>    
    
<span class="nv">rnd</span><span class="o">=</span><span class="si">$(</span>rand 100 500<span class="si">)</span>    
<span class="nb">echo</span> <span class="nv">$rnd</span>    
    
<span class="nb">exit </span>0
</code></pre></div></div>

<h2 id="ä»å…ƒç´ æ± ä¸­éšæœºæŠ½å–å–">ä»å…ƒç´ æ± ä¸­éšæœºæŠ½å–å–</h2>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pool=(a b c d e f g h i j k l m n o p q r s t u v w x y z 0 1 2 3 4 5 6 7 8 9)

num=${#pool[*]}

result=${pool[$((RANDOM%num))]}
</code></pre></div></div>

<p>ç”¨äºç”Ÿæˆä¸€æ®µç‰¹å®šé•¿åº¦çš„æœ‰æ•°å­—å’Œå­—æ¯ç»„æˆçš„å­—ç¬¦ä¸²ï¼Œå­—ç¬¦ä¸²ä¸­å…ƒç´ æ¥è‡ªè‡ªå®šä¹‰çš„æ± å­ã€‚</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>length=10 
i=1

seq=(0 1 2 3 4 5 6 7 8 9 a b c d e f g h i j k l m n o p q r s t u v w x y z A B C D E F G H I J K L M N O P Q R S T U V W X Y Z)
num_seq=${#seq[@]}
  
while [ "$i" -le "$length" ]
do
    seqrand[$i]=${seq[$((RANDOM%num_seq))]}  
    let "i=i+1"  
done  
  
echo "The random string is:"  
for j in ${seqrand[@]}  
do  
    echo -n $j  
done  

echo
</code></pre></div></div>

:ET