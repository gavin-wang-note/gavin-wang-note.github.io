I"°{<h1 id="dataguardæ¦‚è¿°">dataguardæ¦‚è¿°</h1>

<p>Oracle Dataguardä¸»è¦å®ç°æ•°æ®åº“çš„å®¹ç¾ï¼Œæ ¹æ®archive logè¿›è¡Œæ•°æ®çš„åŒæ­¥ï¼Œå½“ä¸»åº“å¼‚å¸¸æ—¶ï¼Œè‡ªåŠ¨åˆ‡æ¢åˆ°å¤‡åº“ã€‚</p>

<h1 id="å®è·µ">å®è·µ</h1>

<h2 id="èƒŒæ™¯">èƒŒæ™¯</h2>

<p>XXè¡Œä¸šç½‘å…³ï¼Œæœ¬æœŸé…ç½®äº†4å—æœåŠ¡å™¨ï¼ˆ4C8Gï¼‰ï¼Œåˆ†åˆ«éƒ¨ç½²åœ¨Aåœ°å’ŒBåœ°ä¸¤åœ°ï¼Œç»„æˆä¸¤ä¸¤åŒæœºçš„å¯¹ç­‰é›†ç¾¤ã€‚Aåœ°å’ŒBåœ°ä¸¤åœ°ç›¸è·30KMï¼Œé‡‡ç”¨åƒå…†ä¸“çº¿æ‹‰é€šï¼Œå…·ä½“æ‹“æ‰‘å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>

<p><img class="shadow" src="/img/in-post/oracle-dg.png" width="1200" /></p>

<h3 id="æ•°æ®åº“å®¹ç¾æ–¹æ¡ˆ">æ•°æ®åº“å®¹ç¾æ–¹æ¡ˆ</h3>

<p>åœ¨Aåœ°å’ŒBåœ°ä¸šåŠ¡ã€æ•°æ®åº“å’Œè®¡è´¹æœåŠ¡å™¨å‡è¿›è¡Œåˆè®¾ã€‚å¹³æ—¶Aåœ°èŠ‚ç‚¹ä½œä¸ºæ•°æ®åº“ç”Ÿäº§èŠ‚ç‚¹ï¼ŒBåœ°èŠ‚ç‚¹ä½œä¸ºæ•°æ®åº“å®¹ç¾èŠ‚ç‚¹ï¼Œç”Ÿäº§èŠ‚ç‚¹å’Œå®¹ç¾èŠ‚ç‚¹é€šè¿‡DATAGUARDè¿›è¡Œæ•°æ®åŒæ­¥ã€‚</p>

<p>æ•°æ®åº“ç”Ÿäº§èŠ‚ç‚¹å’Œå®¹ç¾èŠ‚ç‚¹é€šè¿‡F5å®ç°å¯¹ä¸šåŠ¡æœåŠ¡å™¨çš„ç»Ÿä¸€IPã€‚å³åœ¨F5ä¸Šä¸ºæ•°æ®åº“ä¸“é—¨é…ç½®ä¸€ä¸ªPOOLå’ŒVISUAL SERVERã€‚VISUAL SERVERæ˜¯å¯¹å¤–æä¾›çš„æ•°æ®åº“ç»Ÿä¸€IPï¼Œå°†æ•°æ®åº“ç”Ÿäº§èŠ‚ç‚¹ä¼˜å…ˆçº§è®¾ç½®ä¸ºé«˜ä¼˜å…ˆçº§ï¼Œå®¹æ‚èŠ‚ç‚¹è®¾ç½®ä¸ºä½ä¼˜å…ˆçº§ã€‚å¹³æ—¶F5ä¼šå°†æµé‡å‘é€é«˜ä¼˜å…ˆçº§çš„ç”Ÿäº§èŠ‚ç‚¹å¤„ç†ï¼Œå½“ç”Ÿäº§èŠ‚ç‚¹ä¸å¯ç”¨æ—¶ä¼šè‡ªåŠ¨å‘é€ç»™ä½ä¼˜å…ˆçº§çš„å®¹ç¾èŠ‚ç‚¹ã€‚</p>

<h2 id="è¯•éªŒç¯å¢ƒ">è¯•éªŒç¯å¢ƒ</h2>

<p>SUSE Linux Enterprise Server 10 SP1 (x86_64) - Kernel 2.6.16.46-0.12-smp (3)</p>

<p>IPè§„åˆ’å¦‚ä¸‹ï¼š</p>

<table>
  <thead>
    <tr>
      <th>IP</th>
      <th>ç¡¬ä»¶ç±»å‹</th>
      <th>è¯´æ˜</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>10.137.49.114</td>
      <td>R2+å•æ¿</td>
      <td>primaryæ•°æ®åº“</td>
    </tr>
    <tr>
      <td>10.137.49.167</td>
      <td>R2å•æ¿</td>
      <td>standbyæ•°æ®åº“</td>
    </tr>
  </tbody>
</table>

<h2 id="è½¯ä»¶ç¯å¢ƒ">è½¯ä»¶ç¯å¢ƒ</h2>

<p>Oracle Database 11g Enterprise Edition Release 11.1.0.7.0 - 64bit Production</p>

<h2 id="data-guard-æ“ä½œ">Data guard æ“ä½œ</h2>

<h3 id="é…ç½®æ“ä½œ">é…ç½®æ“ä½œ</h3>

<h4 id="1-ç¡®è®¤primaryæ•°æ®åº“å¤„äºå½’æ¡£æ¨¡å¼">1ã€ ç¡®è®¤primaryæ•°æ®åº“å¤„äºå½’æ¡£æ¨¡å¼</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SQL&gt; archive log list
æ•°æ®åº“æ—¥å¿—æ¨¡å¼             éå­˜æ¡£æ¨¡å¼
è‡ªåŠ¨å­˜æ¡£             ç¦ç”¨
å­˜æ¡£ç»ˆç‚¹            /opt/oracle/product/11g/dbs/arch
æœ€æ—©çš„è”æœºæ—¥å¿—åºåˆ—     1
å½“å‰æ—¥å¿—åºåˆ—           2
SQL&gt;
</code></pre></div></div>

<p>å¦‚æœä¸ºéå½’æ¡£æ¨¡å¼ï¼Œè¯·æ‰§è¡Œä¸‹åˆ—å‘½ä»¤ä¿®æ”¹</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SQL&gt; shutdown immediate
æ•°æ®åº“å·²ç»å…³é—­ã€‚
å·²ç»å¸è½½æ•°æ®åº“ã€‚
ORACLE ä¾‹ç¨‹å·²ç»å…³é—­ã€‚
SQL&gt; startup mount
ORACLE ä¾‹ç¨‹å·²ç»å¯åŠ¨ã€‚

Total System Global Area 1603411968 bytes
Fixed Size                  2160112 bytes
Variable Size             385878544 bytes
Database Buffers         1207959552 bytes
Redo Buffers                7413760 bytes
æ•°æ®åº“è£…è½½å®Œæ¯•ã€‚
SQL&gt; ALTER DATABASE ARCHIVELOG;

æ•°æ®åº“å·²æ›´æ”¹ã€‚

SQL&gt; ALTER DATABASE OPEN;

æ•°æ®åº“å·²æ›´æ”¹ã€‚

SQL&gt;
</code></pre></div></div>

<h4 id="2-è®¾ç½®å½’æ¡£æ—¥å¿—è·¯å¾„">2ã€ è®¾ç½®å½’æ¡£æ—¥å¿—è·¯å¾„</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SQL&gt; show parameter log_archive_dest

NAME                                 TYPE        VALUE
------------------------------------ ----------- ------------------------------
log_archive_dest                     string
log_archive_dest_1                   string
log_archive_dest_10                  string
log_archive_dest_2                   string
log_archive_dest_3                   string
log_archive_dest_4                   string
log_archive_dest_5                   string
log_archive_dest_6                   string
log_archive_dest_7                   string
log_archive_dest_8                   string
log_archive_dest_9                   string

NAME                                 TYPE        VALUE
------------------------------------ ----------- ------------------------------
log_archive_dest_state_1             string      enable
log_archive_dest_state_10            string      enable
log_archive_dest_state_2             string      enable
log_archive_dest_state_3             string      enable
log_archive_dest_state_4             string      enable
log_archive_dest_state_5             string      enable
log_archive_dest_state_6             string      enable
log_archive_dest_state_7             string      enable
log_archive_dest_state_8             string      enable
log_archive_dest_state_9             string      enable

#archç›®å½•è¯·åˆ°dbsç›®å½•ä¸‹æ‰‹å·¥åˆ›å»º
SQL&gt; alter system set log_archive_dest_1=' location=/opt/oracle/diag/arch ' scope=spfile;
ç³»ç»Ÿå·²æ›´æ”¹ã€‚

SQL&gt; alter system set log_archive_format=' arch_%t_%s_%r.arc' scope=spfile;

ç³»ç»Ÿå·²æ›´æ”¹ã€‚
SQL&gt; 
</code></pre></div></div>

<h4 id="3-å°†primaryæ•°æ®åº“ç½®ä¸ºforce-loggingæ¨¡å¼">3ã€ å°†primaryæ•°æ®åº“ç½®ä¸ºFORCE LOGGINGæ¨¡å¼</h4>

<p>é€šè¿‡ä¸‹åˆ—è¯­å¥ï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SQL&gt; alter database force logging; 

æ•°æ®åº“å·²æ›´æ”¹ã€‚

#éœ€è¦é‡å¯æ•°æ®åº“ï¼Œåšå¦‚ä¸‹æ“ä½œï¼š
SQL&gt; shutdown immediate
SQL&gt; startup
SQL&gt; show parameter log_archive_dest
SQL&gt; 
</code></pre></div></div>

<h4 id="4-primaryæ•°æ®åº“åˆ›å»ºstandbyæ•°æ®åº“æ§åˆ¶æ–‡ä»¶">4ã€ primaryæ•°æ®åº“åˆ›å»ºstandbyæ•°æ®åº“æ§åˆ¶æ–‡ä»¶</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SQL&gt; shutdown immediate
SQL&gt; startup mount
SQL&gt; alter database create standby controlfile as '/opt/oracle/oradata/mmsgdb/backupctl.ctl';  

æ•°æ®åº“å·²æ›´æ”¹ã€‚

SQL&gt; SQL&gt; alter database open;

æ•°æ®åº“å·²æ›´æ”¹ã€‚

SQL&gt; alter system archive log current;

ç³»ç»Ÿå·²æ›´æ”¹ã€‚

SQL&gt;
</code></pre></div></div>

<h4 id="5-åˆ›å»ºprimaryæ•°æ®åº“å®¢æˆ·ç«¯åˆå§‹åŒ–å‚æ•°æ–‡ä»¶">5ã€ åˆ›å»ºprimaryæ•°æ®åº“å®¢æˆ·ç«¯åˆå§‹åŒ–å‚æ•°æ–‡ä»¶</h4>

<p>æ³¨ï¼š</p>
<ul>
  <li>ä¸»è¦æ­¤å¤„ä¿®æ”¹é¡¹è¾ƒå¤šï¼Œä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘ä»¬é¦–å…ˆåˆ›å»ºå¹¶ä¿®æ”¹pfileï¼Œç„¶åå†é€šè¿‡pfileé‡å»ºspfileï¼Œä½ å½“ç„¶ä¹Ÿå¯ä»¥é€šè¿‡alter system setå‘½ä»¤ç›´æ¥ä¿®æ”¹spfileå†…å®¹ï¼Œä¸è¿‡ï¼Œéº»çƒ¦ã€‚</li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SQL&gt; create pfile from spfile;

æ–‡ä»¶å·²åˆ›å»ºã€‚
</code></pre></div></div>

<p>å°†è¯¥åˆå§‹åŒ–å‚æ•°æ–‡ä»¶å¤åˆ¶ä¸€ä»½ï¼Œåšä¸ºstandbyæ•°æ®åº“çš„å®¢æˆ·ç«¯åˆå§‹åŒ–å‚æ•°æ–‡ä»¶</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SQL&gt; host
oracle@mmsg:~&gt; cp /opt/oracle/product/11g/dbs/initmmsgdb.ora  /opt/oracle/product/11g/dbs/bakinitmmsgdb.ora
</code></pre></div></div>

<p>å¤‡ä»½å·²æœ‰çš„spfileæ–‡ä»¶</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>oracle@mmsg:~&gt; cd $ORACLE_HOME/dbs
oracle@mmsg:~/product/11g/dbs&gt; cp spfilemmsgdb.ora bak_spfilemmsgdb.ora
</code></pre></div></div>

<p>ä¿®æ”¹å®¢æˆ·ç«¯åˆå§‹åŒ–å‚æ•°æ–‡ä»¶ï¼Œå¢åŠ ä¸‹åˆ—å†…å®¹</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>*.DB_UNIQUE_NAME=uqn_primary              //è‡ªå®šä¹‰ä¸€ä¸ªunique_nameåå­—
*.LOG_ARCHIVE_CONFIG='DG_CONFIG=(uqn_primary,uqn_standby)'  //æ­¤å¤„ä¸ºä¸»å¤‡æœåŠ¡å™¨çš„unique_name
*.LOG_ARCHIVE_DEST_2='SERVICE=standby ASYNC VALID_FOR=(ONLINE_LOGFILES,PRIMARY_ROLE) DB_UNIQUE_NAME=uqn_standby'
*.LOG_ARCHIVE_DEST_STATE_1=ENABLE
*.LOG_ARCHIVE_DEST_STATE_2=ENABLE
*.LOG_ARCHIVE_MAX_PROCESSES=30

#--------é…ç½®standbyè§’è‰²çš„å‚æ•°ç”¨äºè§’è‰²è½¬æ¢
*.FAL_SERVER=standby                        //è¿™é‡Œä¸ºnet service name
*.FAL_CLIENT=primary
*.STANDBY_FILE_MANAGEMENT=AUTO
</code></pre></div></div>

<p>ä¸Šè¿°æ–°å¢å†…å®¹ä¸­çš„æ³¨é‡Šéƒ¨åˆ†ä¸éœ€è¦ï¼Œè¯·æ·»åŠ æ—¶å»æ‰ã€‚</p>

<p>åˆå§‹åŒ–å‚æ•°å‚è€ƒ</p>

<p>å¯¹äºprimaryæ•°æ®åº“ï¼Œéœ€è¦å®šä¹‰å‡ ä¸ªprimaryè§’è‰²çš„åˆå§‹åŒ–å‚æ•°æ§åˆ¶redoä¼ è¾“æœåŠ¡ï¼Œè¿˜æœ‰å‡ ä¸ªé™„åŠ çš„standbyè§’è‰²çš„å‚æ•°éœ€è¦æ·»åŠ ä»¥æ§åˆ¶æ¥æ”¶redoæ•°æ®åº“å¹¶åº”ç”¨(switchover/failoveråprimary/standbyè§’è‰²å¯èƒ½äº’æ¢ï¼Œæ‰€ä»¥å»ºè®®å¯¹äºä¸¤ç±»è§’è‰² ç›¸å…³çš„ åˆå§‹åŒ–å‚æ•°éƒ½è¿›è¡Œé…ç½®)ã€‚</p>

<p>ä¸‹åˆ—å‚æ•°ä¸ºprimaryè§’è‰²ç›¸å…³çš„åˆå§‹åŒ–å‚æ•°ï¼š</p>

<table>
  <thead>
    <tr>
      <th>å‚æ•°</th>
      <th>è¯´æ˜</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>DB_NAME</td>
      <td>æ³¨æ„ä¿æŒåŒä¸€ä¸ªData Guardä¸­æ‰€æœ‰æ•°æ®åº“DB_NAMEç›¸åŒã€‚ ä¾‹å¦‚ï¼šDB_NAME=mmsgdb</td>
    </tr>
    <tr>
      <td>DB_UNIQUE_NAME</td>
      <td>ä¸ºæ¯ä¸€ä¸ªæ•°æ®åº“æŒ‡å®šä¸€ä¸ªå”¯ä¸€çš„åç§°ï¼Œè¯¥å‚æ•°ä¸€ç»æŒ‡å®šä¸ä¼šå†å‘ç”Ÿå˜åŒ–ï¼Œé™¤éä½ ä¸»åŠ¨ä¿®æ”¹å®ƒã€‚ ä¾‹å¦‚ï¼šDB_UNIQUE_NAME= uqn_mmsgdb</td>
    </tr>
    <tr>
      <td>LOG_ARCHIVE_CONFIG</td>
      <td>è¯¥å‚æ•°é€šè¿‡DG_CONFIGå±æ€§ç½—åˆ—åŒä¸€ä¸ªData Guardä¸­æ‰€æœ‰DB_UNIQUE_NAME(å«primary dbåŠstandby db)ï¼Œä»¥é€—å·åˆ†éš” ä¾‹å¦‚ï¼šLOG_ARCHIVE_CONFIG=â€™DB_CONFIG= uqn_primary, uqn_standby)â€™</td>
    </tr>
    <tr>
      <td>CONTROL_FILES</td>
      <td>æ²¡å•¥è¯´çš„ï¼Œæ§åˆ¶æ–‡ä»¶æ‰€åœ¨è·¯å¾„ã€‚</td>
    </tr>
    <tr>
      <td>LOG_ARCHIVE_DEST_n</td>
      <td>å½’æ¡£æ–‡ä»¶çš„ç”Ÿæˆè·¯å¾„ ã€‚è¯¥å‚æ•°éå¸¸é‡è¦ï¼Œå¹¶ä¸”å±æ€§å’Œå­å‚æ•°ä¹Ÿç‰¹åˆ«å¤š(è¿™é‡Œä¸ä¸€ä¸€åˆ—ä¸¾ï¼Œåé¢ç”¨åˆ°æ—¶å•ç‹¬è®²è§£;å¦‚æœä½ å¾ˆå¥½å¥‡ï¼Œå»ºè®®ç›´æ¥æŸ¥è¯¢oracleå®˜æ–¹æ–‡æ¡£ã€‚Data guardç™½çš®ä¹¦ç¬¬14ç« ä¸“é—¨ä»‹ç»äº†è¯¥å‚æ•°å„å±æ€§åŠå­å‚æ•°çš„åŠŸèƒ½å’Œè®¾ç½®)ã€‚ ä¾‹å¦‚ï¼š LOG_ARCHIVE_DEST_1= â€˜LOCATION= /opt/oracle/diag/arch VALID_FOR=(ALL_LOGFILES,ALL_ROLES) DB_UNIQUE_NAME= uqn_primaryâ€™</td>
    </tr>
    <tr>
      <td>LOG_ARCHIVE_DEST_STATE_n</td>
      <td>æŒ‡å®šå‚æ•°å€¼ä¸ºENABLEï¼Œå…è®¸redoä¼ è¾“æœåŠ¡ä¼ è¾“redoæ•°æ®åˆ°æŒ‡å®šçš„è·¯å¾„ã€‚ è¯¥å‚æ•°å…±æ‹¥æœ‰4ä¸ªå±æ€§å€¼ï¼ŒåŠŸèƒ½å„ä¸ç›¸åŒã€‚</td>
    </tr>
    <tr>
      <td>REMOTE_LOGIN_PASSWORDFILE</td>
      <td>æ¨èè®¾ç½®å‚æ•°å€¼ä¸ºEXCLUSIVEæˆ–è€…SHAREDï¼Œæ³¨æ„ä¿è¯ç›¸åŒData Guardé…ç½®ä¸­æ‰€æœ‰dbæœåŠ¡å™¨syså¯†ç ç›¸åŒã€‚</td>
    </tr>
    <tr>
      <td>LOG_ARCHIVE_FORMAT</td>
      <td>æŒ‡å®šå½’æ¡£æ–‡ä»¶æ ¼å¼ã€‚</td>
    </tr>
    <tr>
      <td>LOG_ARCHIVE_MAX_PRODUCESSES</td>
      <td>æŒ‡å®šå½’æ¡£è¿›ç¨‹çš„æ•°é‡(1-30)ï¼Œé»˜è®¤å€¼é€šå¸¸æ˜¯4 ã€‚</td>
    </tr>
  </tbody>
</table>

<p>ä»¥ä¸‹å‚æ•°ä¸ºstandbyè§’è‰²ç›¸å…³çš„å‚æ•°ï¼Œå»ºè®®åœ¨Primaryæ•°æ®åº“ çš„åˆå§‹åŒ–å‚æ•°ä¸­ä¹Ÿè¿›è¡Œè®¾ç½®ï¼Œè¿™æ ·åœ¨role transitionå(Primaryè½¬ä¸ºStandby)ä¹Ÿèƒ½æ­£å¸¸è¿è¡Œï¼š</p>

<table>
  <thead>
    <tr>
      <th>å‚æ•°</th>
      <th>è¯´æ˜</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>FAL_SERVER</td>
      <td>æŒ‡å®šä¸€ä¸ªæ•°æ®åº“SIDï¼Œé€šå¸¸è¯¥åº“ä¸ºprimaryè§’è‰²ã€‚ ä¾‹å¦‚ï¼šFAL_SERVER=primary</td>
    </tr>
    <tr>
      <td>FAL_CLIENT</td>
      <td>æŒ‡å®šä¸€ä¸ªæ•°æ®åº“SIDï¼Œé€šå¸¸è¯¥åº“ä¸ºstandbyè§’è‰²ã€‚ ä¾‹å¦‚ï¼šFAL_CLIENT=standby</td>
    </tr>
    <tr>
      <td>æç¤ºï¼šFALæ˜¯Fetch Archived Logçš„ç¼©å†™</td>
      <td>Â </td>
    </tr>
    <tr>
      <td>DB_FILE_NAME_CONVERT</td>
      <td>åœ¨åšduplicateå¤åˆ¶å’Œä¼ è¾“è¡¨ç©ºé—´çš„æ—¶å€™è¿™ç±»å‚æ•°è®²è¿‡å¾ˆå¤šéï¼Œè¯¥å‚æ•°åŠä¸Šè¿°å†…å®¹ä¸­åŒåå‚æ•°åŠŸèƒ½ï¼Œæ ¼å¼ç­‰å®Œå…¨ç›¸åŒã€‚</td>
    </tr>
    <tr>
      <td>LOG_FILE_NAME_CONVERT</td>
      <td>åŒä¸Š</td>
    </tr>
    <tr>
      <td>STANDBY_FILE_MANAGEMENT</td>
      <td>å¦‚æœprimaryæ•°æ®åº“æ•°æ®æ–‡ä»¶å‘ç”Ÿä¿®æ”¹ï¼ˆå¦‚æ–°å»ºï¼Œé‡å‘½åç­‰ï¼‰åˆ™æŒ‰ç…§æœ¬å‚æ•°çš„è®¾ç½®åœ¨standbyä¸­åšç›¸åº”ä¿®æ”¹ã€‚è®¾ä¸ºAUTOè¡¨ç¤ºè‡ªåŠ¨ç®¡ç†ã€‚è®¾ä¸ºMANUALè¡¨ç¤ºéœ€è¦æ‰‹å·¥ç®¡ç†ã€‚ä¾‹å¦‚ï¼šSTANDBY_FILE_MANAGEMENT=AUTO</td>
    </tr>
  </tbody>
</table>

<p>æ³¨æ„ï¼š</p>
<ul>
  <li>ä¸Šé¢åˆ—ä¸¾çš„è¿™äº›å‚æ•°ä»…åªæ˜¯å¯¹äºprimary/standbyä¸¤è§’è‰²å¯èƒ½ä¼šç›¸å…³çš„å‚æ•°ï¼Œè¿˜æœ‰ä¸€äº›åŸºç¡€æ€§å‚æ•°æ¯”å¦‚<em>_dest,</em>_sizeç­‰æ•°æ®åº“ç›¸å…³çš„å‚æ•°åœ¨å…·ä½“é…ç½®æ—¶ä¹Ÿéœ€è¦æ ¹æ®å®é™…æƒ…å†µåšå‡ºé€‚å½“ä¿®æ”¹ã€‚</li>
</ul>

<p>é€šè¿‡pfileé‡å»ºspfile</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SQL&gt; shutdown immediate
æ•°æ®åº“å·²ç»å…³é—­ã€‚
å·²ç»å¸è½½æ•°æ®åº“ã€‚
ORACLE ä¾‹ç¨‹å·²ç»å…³é—­ã€‚
SQL&gt; startup pfile='/opt/oracle/product/11g/dbs/initmmsgdb.ora'
ORACLE ä¾‹ç¨‹å·²ç»å¯åŠ¨ã€‚

Total System Global Area 1603411968 bytes
Fixed Size                  2160112 bytes
Variable Size             385878544 bytes
Database Buffers         1207959552 bytes
Redo Buffers                7413760 bytes
æ•°æ®åº“è£…è½½å®Œæ¯•ã€‚
æ•°æ®åº“å·²ç»æ‰“å¼€ã€‚
SQL&gt;

SQL&gt; create spfile='/opt/oracle/product/11g/dbs/spfilemmsgdb.ora' from pfile='/opt/oracle/product/11g/dbs/initmmsgdb.ora';

æ–‡ä»¶å·²åˆ›å»ºã€‚

SQL&gt;
SQL&gt; shutdown immediate
</code></pre></div></div>

<h4 id="6-å¤åˆ¶æ•°æ®æ–‡ä»¶åˆ°standbyæœåŠ¡å™¨æ–¹å¼å¤šæ ·ä¸è¯¦è¿°">6ã€ å¤åˆ¶æ•°æ®æ–‡ä»¶åˆ°standbyæœåŠ¡å™¨(æ–¹å¼å¤šæ ·ï¼Œä¸è¯¦è¿°)</h4>

<p>æ³¨:</p>
<ul>
  <li>è¦å…ˆåœæ­¢primaryå’ŒstandbyæœåŠ¡å™¨ä¸Šçš„oracleæ•°æ®åº“ï¼Œç„¶åå¤åˆ¶æ‰€æœ‰æ•°æ®æ–‡ä»¶ï¼Œå¤‡ä»½çš„æ§åˆ¶æ–‡ä»¶åŠå®¢æˆ·ç«¯åˆå§‹åŒ–å‚æ•°æ–‡ä»¶ï¼ˆæ•°æ®æ–‡ä»¶ã€å£ä»¤æ–‡ä»¶ã€pfileæ–‡ä»¶ã€æ§åˆ¶æ–‡ä»¶ï¼‰åˆ°standbyæ•°æ®åº“ï¼ˆåŒæ—¶ï¼Œå»ºè®®å…ˆå¤‡ä»½ä¸€ä¸‹standbyæ•°æ®åº“ä¾§çš„æ•°æ®æ–‡ä»¶ã€æ§åˆ¶æ–‡ä»¶ã€å‚æ•°æ–‡ä»¶å’Œå£ä»¤æ–‡ä»¶ï¼‰ ï¼Œå…·ä½“æ–‡ä»¶åˆ—è¡¨ä¿¡æ¯å¦‚ä¸‹ï¼š</li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#æ§åˆ¶æ–‡ä»¶
backupctl.ctl
control01.ctl
control02.ctl
control03.ctl
#é‡åšæ—¥å¿—æ–‡ä»¶
redo01.log
redo02.log
redo03.log
#æ•°æ®æ–‡ä»¶
sysaux01.dbf
system01.dbf
temp01.dbf
undotbs01.dbf
users01.dbf
#å£ä»¤æ–‡ä»¶
orapwmmsgdb
å‚æ•°æ–‡ä»¶
initmmsgdb.ora
</code></pre></div></div>

<p>è¿˜éœ€è¦åˆ°STANDBYæœåŠ¡å™¨ä¸Šæ‰§è¡Œä¸‹é¢çš„æ“ä½œã€‚</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>oracle@mmsg1:~&gt; cd /opt/oracle/oradata/ora11g
oracle@mmsg1:~/oradata/ora11g&gt; rm -rf control0*
oracle@mmsg1:~/oradata/ora11g&gt; mv backupctl.ctl  control01.ctl
oracle@mmsg1:~/oradata/ora11g&gt; cp control01.ctl control02.ctl
oracle@mmsg1:~/oradata/ora11g&gt; cp control01.ctl control03.ctl
oracle@mmsg1:~&gt; cd $ORACLE_HOME/dbs 
# æ›¿æ¢å£ä»¤ï¼ˆå¦‚æœsyså¯†ç ä¸åŒï¼‰å’Œpfileæ–‡ä»¶
oracle@mmsg1:~/product/11g/dbs&gt; ftp 10.137.49.114
Connected to 10.137.49.114.
220-Welcome to Pure-FTPd.
220-You are user number 1 of 50 allowed.
220-IPv6 connections are also welcome on this server.
220 You will be disconnected after 15 minutes of inactivity.
Name (10.137.49.114:root): oracle
331 User oracle OK. Password required
Password:
230-User oracle has group access to:  dba      oinstall
230 OK. Current directory is /opt/oracle
Remote system type is UNIX.
Using binary mode to transfer files.
ftp&gt; cd ~/product/11g/dbs
250 OK. Current directory is /opt/oracle/product/11g/dbs
ftp&gt; ls
229 Extended Passive mode OK (|||60900|)
150 Accepted data connection
-rw-r-----    1 oracle   oinstall     2560 Aug  9 15:16 bak_spfilemmsgdb.ora
-rw-r--r--    1 oracle   oinstall      908 Aug  9 15:00 bakinitmmsgdb.ora
-rw-rw----    1 oracle   oinstall     1552 Aug  9 16:16 hc_mmsgdb.dat
-rw-r--r--    1 oracle   oinstall     2774 Sep 11  2007 init.ora
-rw-r--r--    1 oracle   oinstall    12920 May  3  2001 initdw.ora
-rw-r--r--    1 oracle   oinstall     1262 Aug  9 16:14 initmmsgdb.ora
-rw-r-----    1 oracle   oinstall       24 Aug  9 12:38 lkMMSGDB
-rw-r-----    1 oracle   oinstall     1536 Aug  9 13:31 orapwmmsgdb
-rw-r-----    1 oracle   oinstall     3584 Aug  9 16:18 spfilemmsgdb.ora
226-Options: -l 
226 9 matches total
ftp&gt; asc
200 TYPE is now ASCII
ftp&gt; get initmmsgdb.ora
local: initmmsgdb.ora remote: initmmsgdb.ora
229 Extended Passive mode OK (|||11762|)
150 Accepted data connection
100% |*****************************************************************************************|  1300       3.44 MB/s    --:-- ETA
226-File successfully transferred
226 0.000 seconds (measured here), 25.62 Mbytes per second
1300 bytes received in 00:00 (31.72 KB/s)
ftp&gt; bin
200 TYPE is now 8-bit binary
ftp&gt; get orapwmmsgdb
local: orapwmmsgdb remote: orapwmmsgdb
229 Extended Passive mode OK (|||59851|)
150 Accepted data connection
100% |*****************************************************************************************|  1536       6.28 MB/s    00:00 ETA
226-File successfully transferred
226 0.000 seconds (measured here), 34.13 Mbytes per second
1536 bytes received in 00:00 (36.22 KB/s)
ftp&gt; by
221-Goodbye. You uploaded 0 and downloaded 3 kbytes.
221 Logout.
</code></pre></div></div>

<h4 id="7-ä¿®æ”¹standbyæ•°æ®åº“å‚æ•°æ–‡ä»¶">7ã€ ä¿®æ”¹standbyæ•°æ®åº“å‚æ•°æ–‡ä»¶</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>*.DB_UNIQUE_NAME=uqn_standby
*.LOG_ARCHIVE_CONFIG='DG_CONFIG=(uqn_primary,uqn_standby)'
*.LOG_ARCHIVE_DEST_2='SERVICE=primary ASYNC VALID_FOR=(ONLINE_LOGFILES,PRIMARY_ROLE) DB_UNIQUE_NAME=uqn_primary'
*.LOG_ARCHIVE_DEST_STATE_1=ENABLE
*.LOG_ARCHIVE_DEST_STATE_2=ENABLE
*.LOG_ARCHIVE_MAX_PROCESSES=30

#--------é…ç½®standbyè§’è‰²çš„å‚æ•°ç”¨äºè§’è‰²è½¬æ¢
*.FAL_SERVER=primary
*.FAL_CLIENT=standby
*.STANDBY_FILE_MANAGEMENT=AUTO
</code></pre></div></div>

<h4 id="8-ä¿®æ”¹listeneråŠtnsä¿¡æ¯">8ã€ ä¿®æ”¹listeneråŠtnsä¿¡æ¯</h4>

<p>é…ç½®primaryæ•°æ®åº“å’Œstandbyæ•°æ®åº“çš„listeneråŠnet service names(æ–¹å¼å¤šæ ·ï¼Œä¸è¯¦è¿°)</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SID_LIST_LISTENER =
(SID_LIST =
   (SID_DESC =
      (SID_NAME = PLSExtProc)
      (ORACLE_HOME = /opt/oracle/product/11g)
      (PROGRAM = extproc)
  )
    (SID_DESC =
        (GLOBAL_DBNAME = mmsgdb)
        (ORACLE_HOME = /opt/oracle/product/11g)
        (SID_NAME = mmsgdb)           
     )
  )

LISTENER =
  (DESCRIPTION_LIST =
    (DESCRIPTION =
      (ADDRESS = (PROTOCOL = TCP)(HOST = 10.137.49.114)(PORT = 1521))
      (ADDRESS = (PROTOCOL = IPC)(KEY = EXTPROC1521))
    )
  )
</code></pre></div></div>

<p>ä¸Šé¢ä¸ºprimaryæ•°æ®åº“çš„listenerä¿¡æ¯ï¼Œstandbyæ•°æ®åº“åŒç†ã€‚å…¶ä¸­â€SID_LIST_LISTENER = â€œå†…å®¹ä¸ºæ–°å¢ä¿¡æ¯ï¼Œçº¢è‰²éƒ¨åˆ†ä¸ºprimaryæ•°æ®åº“ipåœ°å€ã€‚</p>

<p>é…ç½®primaryæ•°æ®åº“å’Œstandbyæ•°æ®åº“çš„tnsnames.oraæ–‡ä»¶ï¼Œä¿®æ”¹æˆå¦‚ä¸‹ä¿¡æ¯</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PRIMARY =
  (DESCRIPTION =
    (ADDRESS = (PROTOCOL = TCP)(HOST = 10.137.49.114)(PORT = 1521))
    (CONNECT_DATA =
      (SERVER = DEDICATED)
      (SERVICE_NAME = mmsgdb)
    )
  )
  
STANDBY =
  (DESCRIPTION =
    (ADDRESS = (PROTOCOL = TCP)(HOST = 10.137.49.167)(PORT = 1521))
    (CONNECT_DATA =
      (SERVER = DEDICATED)
      (SERVICE_NAME = mmsgdb)
    )
  )
</code></pre></div></div>

<p>å®Œæˆä¹‹åé‡å¯primaryæ•°æ®åº“å’Œstandbyæ•°æ®åº“çš„listenerï¼Œå¹¶æµ‹è¯•ç›‘å¬:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>oracle@mmsg:~/product/11g/network/admin&gt; lsnrctl stop
oracle@mmsg:~/product/11g/network/admin&gt; lsnrctl start
oracle@mmsg:~/product/11g/network/admin&gt; tnsping primary 10

TNS Ping Utility for Linux: Version 11.1.0.7.0 - Production on 10-8æœˆ -2010 11:14:02

Copyright (c) 1997, 2008, Oracle.  All rights reserved.

å·²ä½¿ç”¨çš„å‚æ•°æ–‡ä»¶:


å·²ä½¿ç”¨ TNSNAMES é€‚é…å™¨æ¥è§£æåˆ«å
Attempting to contact (DESCRIPTION = (ADDRESS = (PROTOCOL = TCP)(HOST = 10.137.49.114)(PORT = 1521)) (CONNECT_DATA = (SERVER = DEDICATED) (SERVICE_NAME = mmsgdb)))
OK (0 æ¯«ç§’)
OK (0 æ¯«ç§’)
OK (0 æ¯«ç§’)
OK (0 æ¯«ç§’)
OK (0 æ¯«ç§’)
OK (0 æ¯«ç§’)
OK (0 æ¯«ç§’)
OK (0 æ¯«ç§’)
OK (0 æ¯«ç§’)
OK (0 æ¯«ç§’)
oracle@mmsg:~/product/11g/network/admin&gt; tnsping standby 10

TNS Ping Utility for Linux: Version 11.1.0.7.0 - Production on 10-8æœˆ -2010 11:14:08

Copyright (c) 1997, 2008, Oracle.  All rights reserved.

å·²ä½¿ç”¨çš„å‚æ•°æ–‡ä»¶:


å·²ä½¿ç”¨ TNSNAMES é€‚é…å™¨æ¥è§£æåˆ«å
Attempting to contact (DESCRIPTION = (ADDRESS = (PROTOCOL = TCP)(HOST = 10.137.49.167)(PORT = 1521)) (CONNECT_DATA = (SERVER = DEDICATED) (SERVICE_NAME = mmsgdb)))
OK (0 æ¯«ç§’)
OK (0 æ¯«ç§’)
OK (0 æ¯«ç§’)
OK (0 æ¯«ç§’)
OK (0 æ¯«ç§’)
OK (0 æ¯«ç§’)
OK (0 æ¯«ç§’)
OK (0 æ¯«ç§’)
OK (0 æ¯«ç§’)
OK (0 æ¯«ç§’)

oracle@mmsg:~/product/11g/network/admin&gt; 
</code></pre></div></div>

<p>æ‰§è¡Œpingæ“ä½œï¼Œprimaryå’Œstandbyäº’pingä¸€ä¸‹ipåœ°å€ï¼Œå¦‚æœèƒ½pingé€šï¼Œåˆ™ç»§ç»­æ‰§è¡Œä¸‹é¢çš„æ“ä½œï¼Œå¦‚æœpingä¸é€šï¼Œè¯·æ£€æŸ¥é…ç½®ã€‚</p>

<h4 id="9-å¯åŠ¨standbyæ•°æ®åº“">9ã€ å¯åŠ¨standbyæ•°æ®åº“</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>oracle@mmsg1:~/product/11g/dbs&gt; sqlplus / as sysdba

SQL*Plus: Release 11.1.0.7.0 - Production on æ˜ŸæœŸäºŒ 8æœˆ 10 14:47:21 2010

Copyright (c) 1982, 2008, Oracle.  All rights reserved.

å·²è¿æ¥åˆ°ç©ºé—²ä¾‹ç¨‹ã€‚

SQL&gt; create spfile from pfile='/opt/oracle/product/11g/dbs/initmmsgdb.ora';

æ–‡ä»¶å·²åˆ›å»ºã€‚

SQL&gt;

å¯åŠ¨standbyæ•°æ®åº“åˆ°mountçŠ¶æ€
SQL&gt; startup mount
ORACLE ä¾‹ç¨‹å·²ç»å¯åŠ¨ã€‚

Total System Global Area 1603411968 bytes
Fixed Size                  2160112 bytes
Variable Size             385878544 bytes
Database Buffers         1207959552 bytes
Redo Buffers                7413760 bytes
æ•°æ®åº“è£…è½½å®Œæ¯•ã€‚
SQL&gt; alter database recover managed standby database disconnect from session; 

æ•°æ®åº“å·²æ›´æ”¹ã€‚

SQL&gt;
</code></pre></div></div>

<h3 id="æŸ¥çœ‹åŒæ­¥æƒ…å†µ">æŸ¥çœ‹åŒæ­¥æƒ…å†µ</h3>

<h4 id="æ–¹æ³•ä¸€">æ–¹æ³•ä¸€</h4>

<h5 id="é¦–å…ˆè¿æ¥åˆ°primaryæ•°æ®åº“">é¦–å…ˆè¿æ¥åˆ°primaryæ•°æ®åº“</h5>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SQL&gt; show parameter instance_name

NAME                                 TYPE        VALUE
------------------------------------ ----------- ------------------------------
instance_name                        string      mmsgdb
SQL&gt; alter system switch logfile;

ç³»ç»Ÿå·²æ›´æ”¹ã€‚

SQL&gt; select max(sequence#) from v$archived_log; 

MAX(SEQUENCE#)
--------------
             5

SQL&gt; 
</code></pre></div></div>

<h5 id="è¿æ¥åˆ°standbyæ•°æ®åº“">è¿æ¥åˆ°standbyæ•°æ®åº“</h5>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SQL&gt; alter database recover managed standby database disconnect from session; 

æ•°æ®åº“å·²æ›´æ”¹ã€‚

SQL&gt; show parameter instance_name

NAME                                 TYPE        VALUE
------------------------------------ ----------- ------------------------------
instance_name                        string      mmsgdb
SQL&gt; select max(sequence#) from v$archived_log;

MAX(SEQUENCE#)
--------------
             5
SQL&gt;

MAX(SEQUENCE#)å€¼ä¸€è‡´ï¼ŒåŒæ­¥æˆåŠŸã€‚
</code></pre></div></div>

<h4 id="æ–¹æ³•äºŒ">æ–¹æ³•äºŒ</h4>

<p>åœ¨standbyæœåŠ¡å™¨ï¼Œæ‰§è¡Œå¦‚ä¸‹æ“ä½œï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SQL&gt; SELECT SEQUENCE#, FIRST_TIME, NEXT_TIME FROM V$ARCHIVED_LOG ORDER BY SEQUENCE#;

 SEQUENCE# FIRST_TIME     NEXT_TIME
---------- -------------- --------------
         2 09-8æœˆ -10     10-8æœˆ -10
         3 10-8æœˆ -10     10-8æœˆ -10
         4 10-8æœˆ -10     10-8æœˆ -10
         5 10-8æœˆ -10     10-8æœˆ -10
</code></pre></div></div>

<p>åœ¨primaryæœåŠ¡å™¨ï¼Œæ‰§è¡Œå½’æ¡£æ“ä½œï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SQL&gt; ALTER SYSTEM SWITCH LOGFILE; 

ç³»ç»Ÿå·²æ›´æ”¹ã€‚

SQL&gt;
</code></pre></div></div>

<p>è¿”å›standbyæœåŠ¡å™¨</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SQL&gt; SELECT SEQUENCE#, FIRST_TIME, NEXT_TIME FROM V$ARCHIVED_LOG ORDER BY SEQUENCE#;

 SEQUENCE# FIRST_TIME     NEXT_TIME
---------- -------------- --------------
         2 09-8æœˆ -10     10-8æœˆ -10
         3 10-8æœˆ -10     10-8æœˆ -10
         4 10-8æœˆ -10     10-8æœˆ -10
         5 10-8æœˆ -10     10-8æœˆ -10
         6 10-8æœˆ -10     10-8æœˆ -10

SQL&gt; SELECT SEQUENCE#,APPLIED FROM V$ARCHIVED_LOG ORDER BY SEQUENCE#;

 SEQUENCE# APPLIED
---------- ---------
         2 YES
         3 YES
         4 YES
         5 YES
         6 YES

SQL&gt;
</code></pre></div></div>

<p>å‘ç°æœ‰ä¸€æ¡æ–°çš„è®°å½•,è¯´æ˜åŒæ­¥æ˜¯æ­£å¸¸çš„ã€‚</p>

<h2 id="å®¹ç¾å…³é—­">å®¹ç¾å…³é—­</h2>

<p>å…³é—­æ•°æ®åº“ä¸€å®šè¦å…ˆå…³é—­primaryæ•°æ®åº“ï¼Œç„¶åå†å»å…³é—­standbyæ•°æ®åº“ã€‚</p>

<p>primaryæ•°æ®åº“</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SQL&gt; shutdown immediate
</code></pre></div></div>

<p>standbyæ•°æ®åº“</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SQL&gt; alter database recover managed standby database cancel;

æ•°æ®åº“å·²æ›´æ”¹ã€‚

SQL&gt; shutdown immediate
</code></pre></div></div>

<h3 id="ä¸»å¤‡åˆ‡æ¢">ä¸»å¤‡åˆ‡æ¢</h3>

<p>æ³¨ï¼š</p>
<ul>
  <li>ä¸»å¤‡åˆ‡æ¢å¿…é¡»å…ˆä¸»åˆ‡å¤‡ï¼Œåœ¨å¤‡åˆ‡ä¸»ã€‚</li>
</ul>

<h4 id="1-primaryåˆ‡æ¢åˆ°standby-æ•°æ®åº“">1ã€ primaryåˆ‡æ¢åˆ°standby æ•°æ®åº“</h4>

<p>åœ¨primaryæ•°æ®åº“åšå¦‚ä¸‹æ“ä½œ</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SQL&gt; startup
ORACLE ä¾‹ç¨‹å·²ç»å¯åŠ¨ã€‚

Total System Global Area 1603411968 bytes
Fixed Size                  2160112 bytes
Variable Size             385878544 bytes
Database Buffers         1207959552 bytes
Redo Buffers                7413760 bytes
æ•°æ®åº“è£…è½½å®Œæ¯•ã€‚
æ•°æ®åº“å·²ç»æ‰“å¼€ã€‚
SQL&gt; alter system switch logfile; //ä¸»å¤‡åˆ‡æ¢åšå¥½åšä¸€æ¬¡å½’æ¡£

ç³»ç»Ÿå·²æ›´æ”¹ã€‚

SQL&gt; alter database commit to switchover to standby with session shutdown;

æ•°æ®åº“å·²æ›´æ”¹ã€‚

SQL&gt; shutdown immediate
ORA-01507: æœªè£…è½½æ•°æ®åº“


ORACLE ä¾‹ç¨‹å·²ç»å…³é—­ã€‚
SQL&gt; startup nomount               
ORACLE ä¾‹ç¨‹å·²ç»å¯åŠ¨ã€‚

Total System Global Area 1603411968 bytes
Fixed Size                  2160112 bytes
Variable Size             385878544 bytes
Database Buffers         1207959552 bytes
Redo Buffers                7413760 bytes
SQL&gt; alter database mount standby database;

æ•°æ®åº“å·²æ›´æ”¹ã€‚

SQL&gt; alter database recover managed standby database disconnect from session;

æ•°æ®åº“å·²æ›´æ”¹ã€‚

SQL&gt;
</code></pre></div></div>

<h4 id="2-standby-åˆ‡æ¢åˆ°-primary">2ã€ standby åˆ‡æ¢åˆ° primary</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SQL&gt; startup mount
ORACLE ä¾‹ç¨‹å·²ç»å¯åŠ¨ã€‚

Total System Global Area 1603411968 bytes
Fixed Size                  2160112 bytes
Variable Size             385878544 bytes
Database Buffers         1207959552 bytes
Redo Buffers                7413760 bytes
æ•°æ®åº“è£…è½½å®Œæ¯•ã€‚
SQL&gt; alter database commit to switchover to primary with session shutdown;
alter database commit to switchover to primary with session shutdown
*
ç¬¬ 1 è¡Œå‡ºç°é”™è¯¯:
ORA-16139: éœ€è¦ä»‹è´¨æ¢å¤


SQL&gt; shutdown immediate
ORA-01109: æ•°æ®åº“æœªæ‰“å¼€


å·²ç»å¸è½½æ•°æ®åº“ã€‚
ORACLE ä¾‹ç¨‹å·²ç»å…³é—­ã€‚
SQL&gt; startup
ORACLE ä¾‹ç¨‹å·²ç»å¯åŠ¨ã€‚

Total System Global Area 1603411968 bytes
Fixed Size                  2160112 bytes
Variable Size             385878544 bytes
Database Buffers         1207959552 bytes
Redo Buffers                7413760 bytes
æ•°æ®åº“è£…è½½å®Œæ¯•ã€‚
æ•°æ®åº“å·²ç»æ‰“å¼€ã€‚
SQL&gt; 
</code></pre></div></div>

<p>è‡³æ­¤ï¼Œprimaryä¸standbyæ•°æ®åº“å·²ç»åˆ‡æ¢å®Œæˆ</p>

<p>å¦‚æœæƒ³å†å»åˆ‡æ¢å›æ¥ï¼Œè¯·é‡å¤ä¸Šè¿°æ“ä½œï¼Œæ³¨æ„primaryå’Œstandbyæ•°æ®åº“å·²ç»å‘ç”Ÿäº†å˜åŒ–ï¼Œä»¥å‰çš„primaryç°åœ¨ä¸ºstandbyæ•°æ®åº“äº†ã€‚</p>

<h3 id="åˆ‡æ¢çš„æœ€å¤§å¯ç”¨æ¨¡å¼">åˆ‡æ¢çš„æœ€å¤§å¯ç”¨æ¨¡å¼</h3>

<h4 id="1-é¦–å…ˆåº”å½“åœ¨standbyæ•°æ®åº“åˆ›å»ºstandby-redolog">1ã€ é¦–å…ˆåº”å½“åœ¨standbyæ•°æ®åº“åˆ›å»ºstandby redolog</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SQL&gt; startup mount
SQL&gt; alter  database recover managed standby database cancel;
alter  database recover managed standby database cancel
*
ç¬¬ 1 è¡Œå‡ºç°é”™è¯¯:	
ORA-16136: å—ç®¡å¤‡ç”¨æ¢å¤æœªæ¿€æ´»

æ³¨ï¼š
æ­¤æ—¶åªæ˜¯æš‚æ—¶redoåº”ç”¨ï¼Œå¹¶ä¸æ˜¯åœæ­¢Standbyæ•°æ®åº“ï¼Œstandbyä»ä¼šä¿æŒæ¥æ”¶åªä¸è¿‡ä¸ä¼šå†åº”ç”¨æ¥æ”¶åˆ°çš„å½’æ¡£ï¼Œç›´åˆ°ä½ å†æ¬¡å¯åŠ¨redoåº”ç”¨ä¸ºæ­¢ã€‚

SQL&gt; alter database add standby logfile group 4 '/opt/oracle/oradata/mmsgdb/stdREDO01.LOG' size 500M;  

æ•°æ®åº“å·²æ›´æ”¹ã€‚

SQL&gt; alter database add standby logfile group 5 '/opt/oracle/oradata/mmsgdb/stdREDO02.LOG' size 500M;

æ•°æ®åº“å·²æ›´æ”¹ã€‚

SQL&gt; alter database add standby logfile group 6 '/opt/oracle/oradata/mmsgdb/stdREDO03.LOG' size 500M;

æ•°æ®åº“å·²æ›´æ”¹ã€‚

SQL&gt; alter database add standby logfile group 7 '/opt/oracle/oradata/mmsgdb/stdREDO04.LOG' size 500M;


æ•°æ®åº“å·²æ›´æ”¹ã€‚

SQL&gt; SQL&gt; ALTER DATABASE RECOVER MANAGED STANDBY DATABASE USING CURRENT LOGFILE DISCONNECT FROM SESSION;     //å¯åŠ¨å®æ—¶åº”ç”¨

æ•°æ®åº“å·²æ›´æ”¹ã€‚

SQL&gt; 
</code></pre></div></div>

<p>æ³¨ï¼š</p>
<ul>
  <li>1ã€standy redelogçš„ç»„æ•°å‚è€ƒå…¬å¼ï¼šï¼ˆonline redologç»„æ•°+1ï¼‰*æ•°æ®åº“çº¿ç¨‹æ•°ï¼šå•æœºçº¿ç¨‹æ•°ä¸º1ï¼ŒRACä¸€èˆ¬ä¸º2</li>
  <li>2ã€stabdby redologçš„ç»„æˆå‘˜æ•°å’Œå¤§å°ä¹Ÿå°½é‡å’Œonline redologä¸€æ ·</li>
</ul>

<p>æ£€æŸ¥standby redologæ˜¯å¦å·²ç»æ·»åŠ æˆåŠŸ</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SQL&gt; select group#,thread#,sequence#,archived,status from v$standby_log;

    GROUP#    THREAD#  SEQUENCE# ARC STATUS
---------- ---------- ---------- --- ----------
         4          0          0 YES UNASSIGNED
         5          0          0 YES UNASSIGNED
         6          0          0 YES UNASSIGNED
         7          0          0 YES UNASSIGNED

SQL&gt;
</code></pre></div></div>

<h4 id="2-standbyæ•°æ®åº“é‡æ–°å¯åŠ¨æ¢å¤ç®¡ç†æ¨¡å¼">2ã€ standbyæ•°æ®åº“é‡æ–°å¯åŠ¨æ¢å¤ç®¡ç†æ¨¡å¼</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SQL&gt; alter database recover managed standby database disconnect from session;
alter database recover managed standby database disconnect from session
*
ç¬¬ 1 è¡Œå‡ºç°é”™è¯¯:
ORA-01153: æ¿€æ´»äº†ä¸å…¼å®¹çš„ä»‹è´¨æ¢å¤


SQL&gt; 
</code></pre></div></div>

<h4 id="3-ä¿®æ”¹primaryæ•°æ®åº“å‚æ•°">3ã€ ä¿®æ”¹primaryæ•°æ®åº“å‚æ•°</h4>

<p>è®¾ç½®standbyæ•°æ®åº“ä¸ºæœ€å¤§æ€§èƒ½æ¨¡å¼ï¼ˆprimaryåº“ä¼˜å…ˆï¼‰</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SQL&gt; alter system set log_archive_dest_2='SERVICE=STANDBY SYNC LGWR AFFIRM NET_TIMEOUT=10' SCOPE=SPFILE;

ç³»ç»Ÿå·²æ›´æ”¹ã€‚

SQL&gt; shutdown immediate
æ•°æ®åº“å·²ç»å…³é—­ã€‚
å·²ç»å¸è½½æ•°æ®åº“ã€‚
ORACLE ä¾‹ç¨‹å·²ç»å…³é—­ã€‚
SQL&gt; startup mount
ORACLE ä¾‹ç¨‹å·²ç»å¯åŠ¨ã€‚

Total System Global Area 1603411968 bytes
Fixed Size                  2160112 bytes
Variable Size             385878544 bytes
Database Buffers         1207959552 bytes
Redo Buffers                7413760 bytes
æ•°æ®åº“è£…è½½å®Œæ¯•ã€‚

SQL&gt; alter database set standby database to maximize availability;

æ•°æ®åº“å·²æ›´æ”¹ã€‚

SQL&gt; alter database open;

æ•°æ®åº“å·²æ›´æ”¹ã€‚

SQL&gt;
</code></pre></div></div>

<h4 id="4-primaryæ•°æ®åº“ä¾§æŸ¥çœ‹ä¿æŠ¤æ¨¡å¼">4ã€ primaryæ•°æ®åº“ä¾§ï¼ŒæŸ¥çœ‹ä¿æŠ¤æ¨¡å¼</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SQL&gt; select protection_mode ,protection_level from v$database;

PROTECTION_MODE      PROTECTION_LEVEL
-------------------- --------------------
MAXIMUM AVAILABILITY RESYNCHRONIZATION

SQL&gt;
æ˜¾ç¤ºå½“å‰ä¸ºæœ€å¤§å¯ç”¨æ¨¡å¼ã€‚
</code></pre></div></div>

<h4 id="5-ä¸»primaryå¤‡standbyåˆ‡æ¢">5ã€ ä¸»ï¼ˆprimaryï¼‰å¤‡ï¼ˆstandbyï¼‰åˆ‡æ¢</h4>

<p>å¦‚æœè¦ä½¿å¾—ä¸»å¤‡åº“å¯ä»¥åˆ‡æ¢ï¼Œåˆ™åº”å¦‚æ­¥éª¤1~4åŒç†åœ¨ä¸»å¤‡åº“åšç›¸åº”ä¿®æ”¹ã€‚</p>

:ET