I"üE<h1 id="å¼•è¨€">å¼•è¨€</h1>
<p><strong>vsftpd(very secure FTP daemon)</strong>ï¼Œå¦‚æœä½ æƒ³åœ¨ä½ çš„Linux/UnixæœåŠ¡å™¨ä¸Šæ­å»ºä¸€ä¸ªå®‰å…¨ã€é«˜æ€§èƒ½ã€ç¨³å®šæ€§å¥½çš„FTPæœåŠ¡å™¨ï¼Œé‚£ä¹ˆvsftpdå¯èƒ½æ˜¯ä½ çš„é¦–é€‰åº”ç”¨ã€‚
æˆ‘ä»¬çš„å®¢æˆ·å¯¹FTPæœ‰éœ€æ±‚ï¼Œç›®å‰åªèƒ½é€šè¿‡æ‰‹åŠ¨éƒ¨ç½²ã€é…ç½®çš„æ–¹å¼æ¥å®ç°å®¢æˆ·çš„è¦æ±‚ï¼Œå·¥ä½œå¾€å¾€é‡å¤ã€‚ä¸ºäº†è§„èŒƒåŒ–FTPé…ç½®æµç¨‹ï¼Œæœ¬æ–‡æ•´ç†ä¸€ä¸‹FTPçš„éœ€æ±‚ï¼Œä»¥ä¾›RDå‚è€ƒã€‚
<br /><br /></p>

<h1 id="åŸºæœ¬é…ç½®">åŸºæœ¬é…ç½®</h1>
<p>é»˜è®¤å¦‚ä¸‹æ‹¥æœ‰é…ç½®é¡¹ï¼š</p>

<h2 id="1ftp-port">(1)ftp port</h2>

<p>æ”¯æŒé»˜è®¤ä¸éé»˜è®¤çš„ä¿®æ”¹,é’ˆå¯¹å¯¹å®‰å…¨æœ‰ç‰¹æ®Šè¦æ±‚çš„ç”¨æˆ·</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    listen_port=&lt;port&gt; :è®¾ç½®æ§åˆ¶è¿æ¥çš„ç›‘å¬ç«¯å£å·ï¼Œé»˜è®¤ä¸º21
    connect_from_port_20=&lt;YES/NO&gt; :è‹¥ä¸ºYESï¼Œåˆ™å¼ºè¿«FTPï¼DATAçš„æ•°æ®ä¼ é€ä½¿ç”¨port 20ï¼Œé»˜è®¤YES
</code></pre></div></div>

<h2 id="2listenyes">(2)Listen=yes</h2>

<p>ç‹¬ç«‹çš„VSFTPDæœåŠ¡å™¨</p>

<h2 id="3è®°å½•vsftpdçš„log">(3)è®°å½•vsftpdçš„log</h2>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    log_ftp_protocol=YES (all FTP requests and responses are logged)
    xferlog_enable=yes  ï¼ˆæ¿€æ´»ä¸Šä¼ å’Œä¸‹ä¼ çš„æ—¥å¿—ï¼‰
    xferlog_std_format=yes (ä½¿ç”¨æ ‡å‡†çš„æ—¥å¿—æ ¼å¼)  
</code></pre></div></div>

<h2 id="4anon_root">(4)anon_root</h2>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    This option represents a directory  which  vsftpd  will  try  to change  into  after  an  anonymous  login.  Failure  is silently ignored.
    Default: (none)
    ç•™ç»™åŒ¿åè´¦å·ä½¿ç”¨ã€‚
</code></pre></div></div>

<h2 id="5local_umask">(5)local_umask</h2>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>default 022
</code></pre></div></div>

<p>å»ºè®®è®¾ç½®æˆ002</p>

<h2 id="6-å…¶ä»–é»˜è®¤é…ç½®é¡¹">(6) å…¶ä»–é»˜è®¤é…ç½®é¡¹</h2>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    dirmessage_enable=YES
    use_localtime=YES
    secure_chroot_dir=/var/run/vsftpd/empty
    pam_service_name=ftp
    rsa_cert_file=/etc/ssl/private/vsftpd.pem  ï¼ˆè¿™é¡¹å¯æœ‰å¯æ— ï¼Œè™šæ‹Ÿç”¨æˆ·è®¿é—®FTP Serverã€PAMè®¤è¯æ—¶ä½¿ç”¨ï¼‰
</code></pre></div></div>

<h1 id="éœ€æ±‚">éœ€æ±‚</h1>

<h2 id="åŒ¿åè®¿é—®">åŒ¿åè®¿é—®</h2>

<p>è¯´æ˜ï¼š</p>

<p>åŸºäºå®‰å…¨è€ƒè™‘ï¼Œç¦æ­¢åŒ¿åç”¨æˆ·å¯ç”¨SSLï¼Œå³ï¼š<code class="highlighter-rouge">allow_anon_ssl=NO</code></p>

<h3 id="åœºæ™¯1ä»…æœ‰ä¸Šä¼ æƒé™">åœºæ™¯1ã€ä»…æœ‰ä¸Šä¼ æƒé™</h3>

<h4 id="vsftpdconféœ€è¦ä¿®æ”¹çš„å†…å®¹å¦‚ä¸‹">vsftpd.conféœ€è¦ä¿®æ”¹çš„å†…å®¹å¦‚ä¸‹</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    anon_upload_enable=YES (å¼€æ”¾ä¸Šä¼ æƒé™)
    anon_mkdir_write_enable=YESï¼ˆå¯åˆ›å»ºç›®å½•çš„åŒæ—¶å¯ä»¥åœ¨æ­¤ç›®å½•ä¸­ä¸Šä¼ æ–‡ä»¶ï¼‰
    anon_other_write_enable=NO (åŒ¿åå¸å·å¯ä»¥æœ‰åˆ é™¤çš„æƒé™ï¼ŒåŸºäºå®‰å…¨è€ƒè™‘ï¼Œå»ºè®®è®¾ç½®ä¸ºNO)
    anon_root=/var/share/ezfs/shareroot/gz/ ï¼ˆè®¾å®šåŒ¿åç”¨æˆ·çš„base_homeï¼Œè¦ä¸/etc/passwd ä¸­ftpç”¨æˆ·ä¿æŒä¸€è‡´ï¼‰
    anon_umask=002
    hide_ids=YES
    no_anon_password=YES ï¼ˆæ˜¯å¦è¯¢é—®åŒ¿åè®¿é—®æ—¶è¾“å…¥å¯†ç ï¼‰
    write_enable=yes (å¼€æ”¾æœ¬åœ°ç”¨æˆ·å†™çš„æƒé™)
</code></pre></div></div>

<h4 id="æµ‹è¯•">æµ‹è¯•</h4>

<h5 id="ftpçš„åŒ¿åç™»å½•ä¸€èˆ¬æœ‰ä¸‰ç§">FTPçš„åŒ¿åç™»å½•ä¸€èˆ¬æœ‰ä¸‰ç§ï¼š</h5>

<ul>
  <li>1ã€ç”¨æˆ·åï¼šanonymous å¯†ç ï¼šEmailæˆ–è€…ä¸ºç©º</li>
  <li>2ã€ç”¨æˆ·åï¼šFTP å¯†ç ï¼šFTPæˆ–è€…ä¸ºç©º</li>
  <li>3ã€ç”¨æˆ·åï¼šUSER å¯†ç ï¼špass</li>
</ul>

<h5 id="å‡ºç°å¦‚ä¸‹é”™è¯¯">å‡ºç°å¦‚ä¸‹é”™è¯¯</h5>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    500 OOPS: vsftpd: refusing to run with writable root inside chroot()
</code></pre></div></div>

<h5 id="è§£å†³æ–¹æ³•">è§£å†³æ–¹æ³•</h5>

<p>Bean ä¿®æ”¹äº†vsftpdçš„source codeï¼Œå°†vsftpd æ ¡éªŒæ ¹ç›®å½•çš„å†™æƒé™è¿™éƒ¨åˆ†codeæ³¨é‡Šæ‰ï¼Œä»è€Œè§„é¿è¿™ä¸ªé—®é¢˜ã€‚ è®°å¾—patch æ–°çš„vsftpd debã€‚</p>

<h3 id="åœºæ™¯2ä»…æœ‰ä¸‹è½½æƒé™">åœºæ™¯2ã€ä»…æœ‰ä¸‹è½½æƒé™</h3>

<p>vsftpd.confå†…å®¹å˜æ›´å¦‚ä¸‹ï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    anonymous_enable=YES
    anon_world_readable_only=YES
    anon_root=/var/share/ezfs/shareroot/gz/
    hide_ids=YES
    no_anon_password=YES
    local_enable=YES
</code></pre></div></div>

<p>è¯´æ˜ï¼š</p>

<p>è¦æ³¨æ„æ–‡ä»¶å¤¹çš„å±æ€§ï¼ŒåŒ¿åå¸æˆ·æ˜¯å…¶å®ƒï¼ˆotherï¼‰ç”¨æˆ·æ¥å¼€å¯å®ƒçš„è¯»å†™æ‰§è¡Œçš„æƒé™</p>
<ul>
  <li>ï¼ˆRï¼‰è¯» â€“ ä¸‹è½½</li>
  <li>ï¼ˆWï¼‰å†™ â€“ ä¸Šä¼ </li>
  <li>ï¼ˆXï¼‰æ‰§è¡Œ â€“ å¦‚æœä¸å¼€FTPçš„ç›®å½•éƒ½è¿›ä¸å»</li>
</ul>

<h3 id="åœºæ™¯3ä¸Šä¼ ä¸‹è½½æƒé™éƒ½æœ‰">åœºæ™¯3ã€ä¸Šä¼ ã€ä¸‹è½½æƒé™éƒ½æœ‰</h3>

<p>vsftpd.confå†…å®¹å˜æ›´å¦‚ä¸‹ï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    anonymous_enable=YES
    anon_umask=002
    anon_upload_enable=YES
    anon_mkdir_write_enable=YES
    anon_other_write_enable=NO
    anon_world_readable_only=YES
    anon_root=/var/share/ezfs/shareroot/gz/
    hide_ids=YES
    no_anon_password=YES
    local_enable=YES
    write_enable=YES
</code></pre></div></div>

<h3 id="åœºæ™¯4çº¦æŸä¼ è¾“é€Ÿç‡">åœºæ™¯4ã€çº¦æŸä¼ è¾“é€Ÿç‡</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    anon_max_rate=51200  ï¼ˆåŒ¿åç”¨æˆ·çš„ä¼ è¾“æ¯”ç‡ï¼Œå•ä½b/sï¼‰
</code></pre></div></div>

<p>ä½œä¸ºåœºæ™¯1ã€2ã€3çš„é™„å±é…ç½®ã€‚</p>

<h3 id="åœºæ™¯5æ›´æ”¹æ–‡ä»¶ä¸Šä¼ å±ä¸»">åœºæ™¯5ã€æ›´æ”¹æ–‡ä»¶ä¸Šä¼ å±ä¸»</h3>

<p>è¿™ä¸ªä½œä¸ºåœºæ™¯3çš„é™„å±é…ç½®ï¼Œä¸€æ—¦è®¾ç½®äº†å±ä¸»ï¼Œæ–‡ä»¶çš„umaskå§‹ç»ˆæ˜¯600ï¼Œè¿™æ ·ï¼Œftpç”¨æˆ·åªæœ‰ä¸Šä¼ æƒé™ï¼Œæ— æ³•ä¸‹è½½ã€‚</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    chown_uploads=YES
    chown_username=æŒ‡å®šä¸€ä¸ªè´¦å·
</code></pre></div></div>

<p>è¯´æ˜:</p>

<ul>
  <li>
    <p>chown_uploads=YES æƒ…å†µä¸‹ï¼Œanon_umask çš„è®¾ç½®å¤±æ•ˆï¼Œä¸Šä¼ çš„æ–‡ä»¶çš„æƒé™å§‹ç»ˆæ˜¯600</p>
  </li>
  <li>
    <p>chown_uploads=YES</p>
  </li>
  <li>
    <ul>
      <li>è¿™ç§æƒ…å†µä¸‹éœ€è¦è®¾ç½®chown_usernameï¼Œä½†æ˜¯ä½ ä¸è®¾ç½®ä¹Ÿä¸ä¼šæŠ¥é”™ï¼Œå› ä¸ºç³»ç»Ÿé»˜è®¤ç»™ä½ è®¾ç½®äº†ä¸ªrootç”¨æˆ·ï¼Œä¸Šä¼ ä¸Šå»çš„æ–‡ä»¶æ‰€æœ‰ä¼šæ˜¯root:ftpã€‚æ— è®ºä½ æ˜¯å¦è®¾ç½®anon_umaskï¼Œä¸Šä¼ çš„æ–‡ä»¶éƒ½ä¼šæ˜¯600æƒé™ï¼Œå¾ˆæ¶å¿ƒï¼Œè‡ªå·±èƒ½ä¸Šä¼ ä½†æ˜¯ä¸èƒ½ä¸‹è½½ã€‚</li>
    </ul>
  </li>
  <li>
    <ul>
      <li>è¿™ç§æƒ…å†µå¯ç”¨äºå…¬å¸å¼€å‘æ–‡ä»¶ä¸Šä¼ ï¼Œåªè¦ä¸Šä¼ äº†ä½ å°±ä¸èƒ½ä¿®æ”¹ã€‚</li>
    </ul>
  </li>
  <li>
    <p>chown_uploads=NO</p>
  </li>
  <li>
    <ul>
      <li>è¿™ç§æƒ…å†µä¸‹ï¼Œé€šè¿‡ä¿®æ”¹anon_umaskæ–‡ä»¶æ¥æ§åˆ¶åŒ¿åç”¨æˆ·ä¸Šä¼ æ–‡ä»¶çš„æƒé™ï¼Œä¸è¿‡ä¸Šä¼ çš„æ–‡ä»¶æ‰€æœ‰è€…ä¼šå˜ä¸ºftp:ftpï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ç§æƒ…å†µä¸‹åŒ¿åç”¨æˆ·æ€»æ˜¯å¯ä»¥ä¿®æ”¹è‡ªå·±ä¸Šä¼ çš„æ–‡ä»¶çš„ï¼Œå³ä½¿anon_umask=777ï¼Œä¹Ÿæ˜¯æœ‰æƒé™çš„ã€‚</li>
    </ul>
  </li>
  <li>
    <ul>
      <li>æ— è®ºåœ¨å“ªç§æƒ…å†µä¸‹ï¼Œä¸Šä¼ çš„æ–‡ä»¶æ˜¯ä¸ä¼šæ‹¥æœ‰Xï¼Œå³æ‰§è¡Œæƒé™ã€‚</li>
    </ul>
  </li>
</ul>

<h1 id="æ™®é€šftpç”¨æˆ·çš„ä¸Šä¼ ">æ™®é€šftpç”¨æˆ·çš„ä¸Šä¼ </h1>

<h2 id="åªèƒ½ä¸Šä¼ æ— æ³•ä¸‹è½½">åªèƒ½ä¸Šä¼ ï¼Œæ— æ³•ä¸‹è½½</h2>

<p>vsftpd.confå†…å®¹å˜æ›´å¦‚ä¸‹ï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    anonymous_enable=NO
    local_enable=YES
    write_enable=YES
    download_enable=NO
    log_ftp_protocol=YES
    use_sendfile=NO
    local_umask=002
</code></pre></div></div>

<h2 id="æ™®é€šftpç”¨æˆ·çš„ä¸‹è½½">æ™®é€šftpç”¨æˆ·çš„ä¸‹è½½</h2>

<p>vsftpd.confå†…å®¹å˜æ›´å¦‚ä¸‹ï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    anonymous_enable=NO
    local_enable=YES
    write_enable=NO
    download_enable=YES
    log_ftp_protocol=YES
    use_sendfile=NO
    local_umask=002
</code></pre></div></div>

<h2 id="æ™®é€šftpç”¨æˆ·çš„ä¸Šä¼ ä¸‹è½½">æ™®é€šftpç”¨æˆ·çš„ä¸Šä¼ ã€ä¸‹è½½</h2>

<p>vsftpd.confå†…å®¹å˜æ›´å¦‚ä¸‹ï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    anonymous_enable=NO
    local_enable=YES
    write_enable=YES
    log_ftp_protocol=YES
    use_sendfile=NO
    local_umask=002
</code></pre></div></div>

<h2 id="å†»ç»“ftpè´¦å·">å†»ç»“FTPè´¦å·</h2>

<p>vsftpd.confå†…å®¹å¢åŠ å¦‚ä¸‹é…ç½®é¡¹ï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    userlist_enable=YES
    userlist_deny=YES
    userlist_file=xxxPATH
</code></pre></div></div>

<p>åŒæ—¶ï¼Œè¦å°†è¢«å†»ç»“è´¦å·ä¿¡æ¯åŠ å…¥åˆ°userlist_fileä¸­</p>

<h3 id="æµ‹è¯•-1">æµ‹è¯•</h3>

<h4 id="vsftpdconfä¸­å¢åŠ ">vsftpd.confä¸­å¢åŠ </h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    userlist_enable=YES
    userlist_deny=YES
    userlist_file=/etc/vsftpd.deny_list 
</code></pre></div></div>

<h4 id="ç„¶åå¢åŠ è¢«é™åˆ¶è´¦å·åˆ°userlist_fileä¸­">ç„¶åï¼Œå¢åŠ è¢«é™åˆ¶è´¦å·åˆ°userlist_fileä¸­</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    echo -n "guizhou" &gt; vsftpd.deny_list
</code></pre></div></div>

<h4 id="æœ€årestart-vsftpä½¿ç”¨client-è®¿é—®ftp-server">æœ€åï¼Œrestart vsftpï¼Œä½¿ç”¨client è®¿é—®FTP server</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    root@631:~# ftp 172.17.59.5
    Connected to 172.17.59.5.
    220 (vsFTPd 2.3.5)
    Name (172.17.59.5:root): guizhou
    530 Permission denied.
    Login failed.
    ftp&gt;
</code></pre></div></div>

<h2 id="çº¦æŸftpç”¨æˆ·è®¿é—®ç›®å½•èŒƒå›´">çº¦æŸftpç”¨æˆ·è®¿é—®ç›®å½•èŒƒå›´</h2>

<h3 id="åŸå› ">åŸå› </h3>

<p>å¦‚æœä¸çº¦æŸä½ftpç”¨æˆ·çš„è®¿é—®ç›®å½•èŒƒå›´ï¼Œä»»å…¶å¯ä»¥è®¿é—®ébase_homeä¸‹æ–‡ä»¶ï¼Œè¿™æ˜¯éå¸¸å±é™©çš„ã€‚</p>

<h3 id="çº¦æŸé…ç½®">çº¦æŸé…ç½®</h3>

<p>å¦‚æœè®¾ç½®ä¸ºï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    chroot_local_userï¼YES
    chroot_list_enable=YES(è¿™è¡Œå¯ä»¥æ²¡æœ‰, ä¹Ÿå¯ä»¥æœ‰)
    chroot_list_file=/etc/vsftpd.chroot_list
</code></pre></div></div>

<p>é‚£ä¹ˆ, å‡¡æ˜¯åŠ åœ¨æ–‡ä»¶vsftpd.chroot_listä¸­çš„ç”¨æˆ·éƒ½æ˜¯ä¸å—é™æ­¢çš„ç”¨æˆ·</p>

<p>å³, å¯ä»¥æµè§ˆå…¶ä¸»ç›®å½•çš„ä¸Šçº§ç›®å½•.</p>

<p>æ‰€ä»¥, å¦‚æœä¸å¸Œæœ›æŸç”¨æˆ·èƒ½å¤Ÿæµè§ˆå…¶ä¸»ç›®å½•ä¸Šçº§ç›®å½•ä¸­çš„å†…å®¹,å¯ä»¥å¦‚ä¸Šè®¾ç½®, ç„¶ååœ¨æ–‡ä»¶vsftpd.chroot_listä¸­ä¸æ·»åŠ è¯¥ç”¨æˆ·å³å¯(æ­¤æ—¶, åœ¨è¯¥æ–‡ä»¶ä¸­çš„ç”¨æˆ·éƒ½æ˜¯å¯ä»¥æµè§ˆå…¶ä¸»ç›®å½•ä¹‹å¤–çš„ç›®å½•çš„).</p>

<p>æˆ–è€…, è®¾ç½®å¦‚ä¸‹ï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    chroot_local_userï¼NO
    chroot_list_enable=YES(è¿™è¡Œå¿…é¡»è¦æœ‰, å¦åˆ™æ–‡ä»¶
    vsftpd.chroot_listä¸ä¼šèµ·ä½œç”¨)
    chroot_list_file=/etc/vsftpd.chroot_list
</code></pre></div></div>

<p>ç„¶åæŠŠæ‰€æœ‰ä¸å¸Œæœ›æœ‰è¿™ç§æµè§ˆå…¶ä¸»ç›®å½•ä¹‹ä¸Šçš„å„ç›®å½•æƒé™çš„ç”¨æˆ·æ·»åŠ åˆ°æ–‡ä»¶vsftpd.chroot_list(æ­¤æ—¶, åœ¨è¯¥æ–‡ä»¶ä¸­çš„ç”¨æˆ·éƒ½æ˜¯ä¸å¯ä»¥æµè§ˆå…¶ä¸»ç›®å½•ä¹‹å¤–çš„ç›®å½•çš„)</p>

<p>ä¸­å³å¯(ä¸€è¡Œä¸€ä¸ªç”¨æˆ·å).</p>

<p>ä¸‹å›¾ï¼Œä¸ºè¿™ä¸¤ä¸ªå‚æ•°çš„è¯¦ç»†è§£é‡Šï¼š
<img class="shadow" src="/img/in-post/ftp_parameter_desc.png" width="1200" /></p>

<h4 id="æµ‹è¯•-2">æµ‹è¯•</h4>
<p>æŒ‰ç…§ä¸Šé¢çš„é…ç½®ï¼Œåœ¨é™åˆ¶ä½ç”¨æˆ·åªèƒ½è®¿é—®bash_homeæƒ…å†µä¸‹ï¼Œä¼šå‡ºç°FTP 500é”™è¯¯ç ï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    root@scaler01:/var/share/ezfs/shareroot# ftp 172.17.59.5
    Connected to 172.17.59.5.
    220 (vsFTPd 2.3.5)
    Name (172.17.59.5:root): guizhou
    331 Please specify the password.
    Password:
    500 OOPS: vsftpd: refusing to run with writable root inside chroot()
    Login failed.
    ftp&gt; 
</code></pre></div></div>

<p>ä½†å¦‚æœæ³¨é”€æ‰è¿™ä¸‰ä¸ªå‚æ•°ï¼Œåˆ™ä¼šé™åˆ¶ä½ç›®å½•ï¼Œä¸€åˆ‡OKã€‚</p>

<h2 id="é™åˆ¶ftp-ä¼ è¾“é€Ÿç‡">é™åˆ¶ftp ä¼ è¾“é€Ÿç‡</h2>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>local_max_rate=5120000 ï¼ˆæœ¬åœ°ç”¨æˆ·çš„ä¼ è¾“æ¯”ç‡ï¼Œå•ä½b/s ï¼‰
</code></pre></div></div>

<h2 id="é™åˆ¶ip">é™åˆ¶IP</h2>

<p>è¦æ±‚ï¼š</p>

<ul>
  <li>æ”¯æŒå…·ä½“çš„IPã€IPæ®µã€åŸŸå</li>
</ul>

<p>è°ƒæ•´çš„å†…å®¹ï¼š</p>

<ul>
  <li>vsftpd.confä¸­å¢åŠ ï¼š</li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    tcp_wrappers=YES
</code></pre></div></div>

<p>åŒæ—¶ï¼Œè¦ä¿®æ”¹/etc/hosts.deny  å’Œ /etc/hosts.allowä¸¤ä¸ªæ–‡ä»¶</p>

<p>/etc/hosts.deny ä¸­å¢åŠ å¦‚ä¸‹å†…å®¹ï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    #vsftpd
    vsftpd:ALL

/etc/hosts.allow
    #vsftpd
    vsftpd:172.17.59.
</code></pre></div></div>

<h3 id="æµ‹è¯•-3">æµ‹è¯•</h3>

<p>åœ¨/etc/hosts.deny ä¸­å¢åŠ å¦‚ä¸‹å†…å®¹ï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    #vsftpd
    vsftpd:ALL
</code></pre></div></div>

<p>åœ¨/etc/hosts.allowä¸­å¢åŠ å¦‚ä¸‹å†…å®¹ï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    #vsftpd
    vsftpd:172.19.5.
</code></pre></div></div>

<p>clientè®¿é—®ftp serverï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    root@631:~# ftp 172.17.59.5
    Connected to 172.17.59.5.
    421 Service not available.
    ftp&gt; 
</code></pre></div></div>

<p>vsftpdçš„logæ˜¾ç¤ºï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    Thu Oct 12 14:46:44 2017 [pid 2] CONNECT: Client "172.17.59.8", "Connection refused: tcp_wrappers denial."
    Thu Oct 12 14:46:44 2017 [pid 2] FTP response: Client "172.17.59.8", "421 Service not available."
</code></pre></div></div>

<p>è¯´æ˜ï¼š</p>

<p>/etc/hosts.allow å†…å®¹æ ¼å¼ä¸è¦æ±‚ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    vsftpd:.hype.com
    vsftpd:172.17.59.
    vsftpd:172.17.0.0/255.255.254.0
</code></pre></div></div>

<p>ç¬¬ä¸€è¡Œè¡¨ç¤ºï¼Œåªæœ‰hype.comè¿™ä¸ªåŸŸé‡Œçš„ä¸»æœºå…è®¸è®¿é—®vsftpdæœåŠ¡ï¼Œæ³¨æ„hype.comå‰é¢çš„é‚£ä¸ªç‚¹(.)ï¼›</p>

<p>ç¬¬äºŒè¡Œè¡¨ç¤ºï¼Œåªæœ‰172.17.59è¿™ä¸ªç½‘æ®µçš„ç”¨æˆ·å…è®¸è®¿é—®vsftpdæœåŠ¡ï¼Œæ³¨æ„0åé¢çš„ç‚¹(.)ï¼›</p>

<p>ç¬¬ä¸‰è¡Œè¡¨ç¤ºï¼Œåªæœ‰172.17.0è¿™ä¸ªç½‘æ®µçš„ç”¨æˆ·å…è®¸è®¿é—®vsftpdæœåŠ¡ï¼Œæ³¨æ„è¿™é‡Œä¸èƒ½å†™ä¸º172.17.0.0/24ã€‚</p>

<h2 id="ftp-tlsåŠ å¯†ä¼ è¾“">ftp TLSåŠ å¯†ä¼ è¾“</h2>
<h3 id="æœªåŠ å¯†ä¼ è¾“æƒ…å†µä¸‹ç›´æ¥æŠ“åŒ…">æœªåŠ å¯†ä¼ è¾“æƒ…å†µä¸‹ï¼Œç›´æ¥æŠ“åŒ…ï¼š</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    1146	7.562069	172.17.59.8	172.17.59.5	FTP	74	Request: PASS 1
</code></pre></div></div>

<p><img class="shadow" src="/img/in-post/ftp_tcpdump.png" widtgh="1200" /></p>

<p>ä¸Šé¢ä¸€è¡Œä¸ºæŠ“åŒ…åˆ°çš„å†…å®¹ï¼Œå¯ä»¥æ˜ç¡®çš„çœ‹å‡ºï¼Œå¯†ç ä¸º1ï¼Œæ˜æ–‡çš„ï¼Œé£é™©ç³»æ•°è¾ƒé«˜</p>

<h3 id="å…ˆç¡®è®¤vsftpdæ˜¯å¦æ”¯æŒsslè®¤è¯">å…ˆç¡®è®¤ï¼Œvsftpdæ˜¯å¦æ”¯æŒSSLè®¤è¯ï¼š</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    root@scaler01:/etc# ldd /usr/sbin/vsftpd |grep libssl
	libssl.so.1.0.0 =&gt; /lib/x86_64-linux-gnu/libssl.so.1.0.0 (0x00007fc154eb4000)
</code></pre></div></div>

<p>å‡ºç°ç±»ä¼¼å¦‚ä¸Šä¿¡æ¯ï¼Œè¡¨æ˜æ”¯æŒSSLã€‚</p>

<h3 id="ç”Ÿæˆvsftpdpem-è¯ä¹¦">ç”Ÿæˆvsftpd.pem è¯ä¹¦</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    root@scaler01:/etc/ssl/private# openssl req -x509 -nodes -days 365 -newkey rsa:1024 \-keyout /etc/ssl/private/vsftpd.pem \-out /etc/ssl/private/vsftpd.pem
    Generating a 1024 bit RSA private key
    ................++++++
    .............................++++++
    writing new private key to '/etc/ssl/private/vsftpd.pem'
    -----
    You are about to be asked to enter information that will be incorporated
    into your certificate request.
    What you are about to enter is what is called a Distinguished Name or a DN.
    There are quite a few fields but you can leave some blank
    For some fields there will be a default value,
    If you enter '.', the field will be left blank.
    -----
    Country Name (2 letter code) [AU]:CN
    State or Province Name (full name) [Some-State]:shanghai
    Locality Name (eg, city) []:nanjing
    Organization Name (eg, company) [Internet Widgits Pty Ltd]:bigtera
    Organizational Unit Name (eg, section) []:bigtera
    Common Name (e.g. server FQDN or YOUR name) []:virtualstor
    Email Address []:virtualstor@bigtera.com.cn

</code></pre></div></div>

<p>vsftpd.confçš„è®¾ç½®</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    ssl_enable=YES
    allow_anon_ssl=NO
    force_local_data_ssl=YES
    force_local_logins_ssl=YES
    ssl_tlsv1=YES
    ssl_sslv2=NO
    ssl_sslv3=NO
    rsa_cert_file=/etc/ssl/private/vsftpd.pem
</code></pre></div></div>

<h3 id="æµ‹è¯•-4">æµ‹è¯•</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    root@631:~# ftp 172.17.59.5
    Connected to 172.17.59.5.
    220 (vsFTPd 2.3.5)
    Name (172.17.59.5:root): guizhou
    530 Non-anonymous sessions must use encryption.
    Login failed.
    421 Service not available, remote server has closed connection
    ftp&gt; 
</code></pre></div></div>

<p>è¯´æ˜å·²ç»å¯ç”¨äº†è®¤è¯ï¼Œclientæ— æ³•è®¿é—®FTP serverã€‚</p>

<p>è¿™é‡Œï¼Œå¯ä»¥ä¸‹è½½flashftpå·¥å…·ï¼Œæµ‹è¯•ä¸€ä¸‹ã€‚
<img class="shadow" src="/img/in-post/ftp_Accept_key.png" widtgh="1200" /></p>

<p>åœ¨å¼€å¯SSLè®¤è¯æƒ…å†µä¸‹æŠ“åŒ…ï¼š
<img class="shadow" src="/img/in-post/ftp_tcp_desc.png" widtgh="1200" /></p>

<h1 id="å‚è€ƒæ–‡æ¡£">å‚è€ƒæ–‡æ¡£</h1>
<p>http://manpages.ubuntu.com/manpages/trusty/man5/vsftpd.conf.5.html</p>

<p>http://os.51cto.com/art/201008/221842_all.htm</p>

<p>http://viong.blog.51cto.com/844766/261354</p>
:ET