I"ñ<h1 id="undoè¡¨ç©ºé—´è¿‡å¤§">UNDOè¡¨ç©ºé—´è¿‡å¤§</h1>

<h2 id="ç°è±¡">ç°è±¡</h2>

<h2 id="æŸ¥çœ‹undoè¡¨ç©ºé—´åç§°">æŸ¥çœ‹UNDOè¡¨ç©ºé—´åç§°</h2>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SQL&gt; show parameter undo_tablespace  

NAME                                 TYPE        VALUE
------------------------------------ ----------- ------------------------------
undo_tablespace                      string      UNDOTBS1
SQL&gt;
</code></pre></div></div>

<h3 id="æŸ¥çœ‹å½“å‰undoè¡¨ç©ºé—´å¤§å°">æŸ¥çœ‹å½“å‰UNDOè¡¨ç©ºé—´å¤§å°</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SQL&gt; select bytes/1024/1024 from dba_data_files where tablespace_name like 'UNDO%';

BYTES/1024/1024
---------------
           5745

SQL&gt;
</code></pre></div></div>

<h3 id="æ£€æŸ¥undo-segmentçŠ¶æ€">æ£€æŸ¥UNDO SegmentçŠ¶æ€</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SQL&gt; select usn,xacts,rssize/1024/1024/1024,hwmsize/1024/1024/1024,shrinks from v$rollstat order by rssize;

       USN      XACTS RSSIZE/1024/1024/1024 HWMSIZE/1024/1024/1024    SHRINKS
---------- ---------- --------------------- ---------------------- ----------
         0          0            .000358582             .000358582          0
         3          0            .004020691             .030387878         92
         2          0            .004997253             .029411316         80
         9          0            .004997253             .037223816         82
         6          0            .004997253             .027458191         77
         7          0            .004997253             .028434753         85
         1          0            .005973816             .026481628         80
        10          0            .005973816             .028434753         78
         4          0            .006950378             .028434753         84
         8          0            .009880066             .028434753         82
         5          0            .013786316             .028434753         88

11 rows selected.

SQL&gt;
</code></pre></div></div>

<p>å¦‚æœè¡¨ç©ºé—´è¿‡å¤§ï¼Œæœ€ç»ˆå°†mountç‚¹freeç©ºé—´æ¶ˆè€—å®Œï¼Œoracleæœ€ç»ˆå°†å› ç³»ç»Ÿç©ºé—´ä¸è¶³è€Œå´©æºƒã€‚</p>

<h2 id="è§£å†³æ–¹æ³•">è§£å†³æ–¹æ³•</h2>

<h3 id="é‡æ–°åˆ›å»ºæ–°çš„undoè¡¨ç©ºé—´">é‡æ–°åˆ›å»ºæ–°çš„UNDOè¡¨ç©ºé—´</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>create undo tablespace undotbs1 
datafile '/opt/oracle/oradata/mmsgdb/UNDOTBS2.dbf' size 1000m reuse 
autoextend on next 800m maxsize unlimited;
</code></pre></div></div>

<p>æ³¨ï¼š</p>
<ul>
  <li>ä¸€èˆ¬ä¸å»ºè®®è¿™ä¹ˆåˆ›å»ºï¼Œä¸€æ¬¡æ€§ç»™äºˆundoè¡¨ç©ºé—´è¶³å¤Ÿå¤§çš„ç©ºé—´ï¼Œå¹¶å…³é—­è‡ªåŠ¨å¢é•¿ã€‚</li>
</ul>

<h3 id="ä¿®æ”¹pfileæ–‡ä»¶">ä¿®æ”¹pfileæ–‡ä»¶</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SQL&gt; alter system set undo_tablespace=undotbs2 scope=both;
</code></pre></div></div>

<h3 id="ç­‰å¾…åŸundoè¡¨ç©ºé—´æ‰€æœ‰undo-segment-offlin">ç­‰å¾…åŸUNDOè¡¨ç©ºé—´æ‰€æœ‰UNDO SEGMENT OFFLIN</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SQL&gt; select usn,xacts,rssize/1024/1024/1024,hwmsize/1024/1024/1024,shrinks from v$rollstat order by rssize;
</code></pre></div></div>

<p>æ³¨ï¼š</p>
<ul>
  <li>åˆ›å»ºå¥½æ–°çš„UNDOè¡¨ç©ºé—´åï¼Œä¸èƒ½ç«‹å³åˆ é™¤åŸæœ‰çš„UNDOè¡¨ç©ºé—´ï¼Œç­‰åˆ°æ‰€æœ‰çš„å›æ»šæ®µofflineæˆ–è€…è¾¾åˆ°undo_retentionè®¾å®šå€¼åï¼Œæ–¹å¯æ‰§è¡Œdropæ‰æ—§çš„undoè¡¨ç©ºé—´ã€‚</li>
</ul>

<h3 id="åˆ é™¤æ—§çš„undoè¡¨ç©ºé—´">åˆ é™¤æ—§çš„undoè¡¨ç©ºé—´</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SQL&gt; drop tablespace undotbs1 including contents and datafiles;
</code></pre></div></div>

<h3 id="ç¡®è®¤åˆ é™¤æ˜¯å¦æˆåŠŸ">ç¡®è®¤åˆ é™¤æ˜¯å¦æˆåŠŸ</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SQL&gt;select * from dba_data_files where tablespace_name like â€˜UNDO%â€™;
</code></pre></div></div>

:ET