<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="Megacli详解, 软硬件测试">
    <meta name="description" content="概述
通常，我们使用的DELL/HP/IBM三家的机架式PC级服务器阵列卡是从LSI的卡OEM出来的，DELL和IBM两家的阵列卡原生程度较高， 没有做太多封装，可以用原厂提供的阵列卡管理工具进行监控；而HP的阵列卡一般都做过封装了，因此需">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <!-- Global site tag (gtag.js) - Google Analytics -->

<script async src="https://www.googletagmanager.com/gtag/js?id="></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag() {
        dataLayer.push(arguments);
    }

    gtag('js', new Date());
    gtag('config', '');
</script>


    <title>Megacli详解 | Transcendent</title>
    <link rel="icon" type="image/png" href="/favicon.png">
    


    <!-- bg-cover style     -->



<link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.min.css">
<link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
<link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
<link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
<link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
<link rel="stylesheet" type="text/css" href="/css/matery.css">
<link rel="stylesheet" type="text/css" href="/css/my.css">
<link rel="stylesheet" type="text/css" href="/css/dark.css" media="none" onload="if(media!='all')media='all'">




    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
    <link rel="stylesheet" href="/css/post.css">




    
        <link rel="stylesheet" type="text/css" href="/css/reward.css">
    



    <script src="/libs/jquery/jquery-3.6.0.min.js"></script>

<style type="text/css" lang="css">
    #loading-container{
        position: fixed;
        top: 0;
        left: 0;
        min-height: 100vh;
        width: 100vw;
        z-index: 9999;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        background: #FFF;
        text-align: center;
        /* loader页面消失采用渐隐的方式*/
        -webkit-transition: opacity 1s ease;
        -moz-transition: opacity 1s ease;
        -o-transition: opacity 1s ease;
        transition: opacity 1s ease;
    }
    .loading-image{
        width: 120px;
        height: 50px;
        transform: translate(-50%);
    }

    .loading-image div:nth-child(2) {
        -webkit-animation: pacman-balls 1s linear 0s infinite;
        animation: pacman-balls 1s linear 0s infinite
    }

    .loading-image div:nth-child(3) {
        -webkit-animation: pacman-balls 1s linear .33s infinite;
        animation: pacman-balls 1s linear .33s infinite
    }

    .loading-image div:nth-child(4) {
        -webkit-animation: pacman-balls 1s linear .66s infinite;
        animation: pacman-balls 1s linear .66s infinite
    }

    .loading-image div:nth-child(5) {
        -webkit-animation: pacman-balls 1s linear .99s infinite;
        animation: pacman-balls 1s linear .99s infinite
    }

   .loading-image div:first-of-type {
        width: 0;
        height: 0;
        border: 25px solid #49b1f5;
        border-right-color: transparent;
        border-radius: 25px;
        -webkit-animation: rotate_pacman_half_up .5s 0s infinite;
        animation: rotate_pacman_half_up .5s 0s infinite;
    }
    .loading-image div:nth-child(2) {
        width: 0;
        height: 0;
        border: 25px solid #49b1f5;
        border-right-color: transparent;
        border-radius: 25px;
        -webkit-animation: rotate_pacman_half_down .5s 0s infinite;
        animation: rotate_pacman_half_down .5s 0s infinite;
        margin-top: -50px;
    }
    @-webkit-keyframes rotate_pacman_half_up {0% {transform: rotate(270deg)}50% {transform: rotate(1turn)}to {transform: rotate(270deg)}}

    @keyframes rotate_pacman_half_up {0% {transform: rotate(270deg)}50% {transform: rotate(1turn)}to {transform: rotate(270deg)}}

    @-webkit-keyframes rotate_pacman_half_down {0% {transform: rotate(90deg)}50% {transform: rotate(0deg)}to {transform: rotate(90deg)}}

    @keyframes rotate_pacman_half_down {0% {transform: rotate(90deg)}50% {transform: rotate(0deg)}to {transform: rotate(90deg)}}

    @-webkit-keyframes pacman-balls {75% {opacity: .7}to {transform: translate(-100px, -6.25px)}}

    @keyframes pacman-balls {75% {opacity: .7}to {transform: translate(-100px, -6.25px)}}


    .loading-image div:nth-child(3),
    .loading-image div:nth-child(4),
    .loading-image div:nth-child(5),
    .loading-image div:nth-child(6){
        background-color: #49b1f5;
        width: 15px;
        height: 15px;
        border-radius: 100%;
        margin: 2px;
        width: 10px;
        height: 10px;
        position: absolute;
        transform: translateY(-6.25px);
        top: 25px;
        left: 100px;
    }
    .loading-text{
        margin-bottom: 20vh;
        text-align: center;
        color: #2c3e50;
        font-size: 2rem;
        box-sizing: border-box;
        padding: 0 10px;
        text-shadow: 0 2px 10px rgba(0,0,0,0.2);
    }
    @media only screen and (max-width: 500px) {
         .loading-text{
            font-size: 1.5rem;
         }
    }
    .fadeout {
        opacity: 0;
        filter: alpha(opacity=0);
    }
    /* logo出现动画 */
    @-webkit-keyframes fadeInDown{0%{opacity:0;-webkit-transform:translate3d(0,-100%,0);transform:translate3d(0,-100%,0)}100%{opacity:1;-webkit-transform:none;transform:none}}
    @keyframes fadeInDown{0%{opacity:0;-webkit-transform:translate3d(0,-100%,0);}}
 </style>
 <script>
(function () {
    const loaded = function(){
       setTimeout(function(){
            const loader = document.getElementById("loading-container");
            loader.className="fadeout" ;//使用渐隐的方法淡出loading page
            // document.getElementById("body-wrap").style.display="flex";
            setTimeout(function(){
                loader.style.display="none";
            },1000); 
        },1000);//强制显示loading page 1s  
    };
    loaded();
})()
 </script><meta name="generator" content="Hexo 7.1.1">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<link rel="alternate" href="/atom.xml" title="Transcendent" type="application/atom+xml">
</head>



 <div id="loading-container">
     <p class="loading-text">玩命加载中 . . . </p> 
     <div class="loading-image">
         <div></div>
         <div></div>
         <div></div>
         <div></div> 
         <div></div>
     </div>
 </div><body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/img/loading.gif" data-original="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">Transcendent</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/stat" class="waves-effect waves-light">
      
      <i class="fas fa-list-alt" style="zoom: 0.6;"></i>
      
      <span>统计</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="" class="waves-effect waves-light">

      
      <i class="fas fa-bars" style="zoom: 0.6;"></i>
      
      <span>文章</span>
      <i class="fas fa-chevron-down" aria-hidden="true" style="zoom: 0.6;"></i>
    </a>
    <ul class="sub-nav menus_item_child ">
      
      <li>
        <a href="/archives">
          
          <i class="fas fa-archive" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>归档</span>
        </a>
      </li>
      
      <li>
        <a href="/categories">
          
          <i class="fas fa-bookmark" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>分类</span>
        </a>
      </li>
      
      <li>
        <a href="/tags">
          
          <i class="fas fa-tags" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>标签</span>
        </a>
      </li>
      
    </ul>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="" class="waves-effect waves-light">

      
      <i class="fas fa-star" style="zoom: 0.6;"></i>
      
      <span>关于</span>
      <i class="fas fa-chevron-down" aria-hidden="true" style="zoom: 0.6;"></i>
    </a>
    <ul class="sub-nav menus_item_child ">
      
      <li>
        <a href="/about">
          
          <i class="fas fa-user-circle" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>知我</span>
        </a>
      </li>
      
      <li>
        <a href="/friends">
          
          <i class="fas fa-address-book" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>友链</span>
        </a>
      </li>
      
      <li>
        <a href="/goodpapers">
          
          <i class="fas fa-coffee" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>收藏</span>
        </a>
      </li>
      
    </ul>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/resume" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>简历</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
  <li>
    <a href="javascript:;" class="waves-effect waves-light" onclick="switchNightMode()" title="深色/浅色模式" >
      <i id="sum-moon-icon" class="fas fa-sun" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/img/loading.gif" data-original="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">Transcendent</div>
        <div class="logo-desc">
            
            资深测试工程师一枚，擅长pytest
            
        </div>
    </div>

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/stat" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-list-alt"></i>
			
			统计
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="javascript:;">
			
				<i class="fa-fw fas fa-bars"></i>
			
			文章
			<span class="m-icon"><i class="fas fa-chevron-right"></i></span>
		</a>
            <ul  style="background:  ;" >
              
                <li>

                  <a href="/archives " style="margin-left:75px">
				  
				   <i class="fa fas fa-archive" style="position: absolute;left:50px" ></i>
			      
		          <span>归档</span>
                  </a>
                </li>
              
                <li>

                  <a href="/categories " style="margin-left:75px">
				  
				   <i class="fa fas fa-bookmark" style="position: absolute;left:50px" ></i>
			      
		          <span>分类</span>
                  </a>
                </li>
              
                <li>

                  <a href="/tags " style="margin-left:75px">
				  
				   <i class="fa fas fa-tags" style="position: absolute;left:50px" ></i>
			      
		          <span>标签</span>
                  </a>
                </li>
              
            </ul>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="javascript:;">
			
				<i class="fa-fw fas fa-star"></i>
			
			关于
			<span class="m-icon"><i class="fas fa-chevron-right"></i></span>
		</a>
            <ul  style="background:  ;" >
              
                <li>

                  <a href="/about " style="margin-left:75px">
				  
				   <i class="fa fas fa-user-circle" style="position: absolute;left:50px" ></i>
			      
		          <span>知我</span>
                  </a>
                </li>
              
                <li>

                  <a href="/friends " style="margin-left:75px">
				  
				   <i class="fa fas fa-address-book" style="position: absolute;left:50px" ></i>
			      
		          <span>友链</span>
                  </a>
                </li>
              
                <li>

                  <a href="/goodpapers " style="margin-left:75px">
				  
				   <i class="fa fas fa-coffee" style="position: absolute;left:50px" ></i>
			      
		          <span>收藏</span>
                  </a>
                </li>
              
            </ul>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/resume" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			简历
		</a>
          
        </li>
        
        
    </ul>
</div>


        </div>

        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/78.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">Megacli详解</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/Megacli/">
                                <span class="chip bg-color">Megacli</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/Megacli/" class="post-category">
                                Megacli
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2020-05-06
                </div>
                

                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    3.2k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    14 分
                </div>
                

                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
        </div>
        <hr class="clearfix">

        
        <!-- 是否加载使用自带的 prismjs. -->
        <link rel="stylesheet" href="/libs/prism/prism.min.css">
        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <h1 id="gai-shu">概述</h1>
<p>通常，我们使用的DELL/HP/IBM三家的机架式PC级服务器阵列卡是从LSI的卡OEM出来的，DELL和IBM两家的阵列卡原生程度较高， 没有做太多封装，可以用原厂提供的阵列卡管理工具进行监控；而HP的阵列卡一般都做过封装了，因此需要使用自身特有的管理工具来监控。本文以几种常用的阵列卡为例，展示其阵列卡及硬盘监控的方法。</p>
<p>DELL SAS 6/iR卡，全称LSI Logic SAS1068E，只支持RAID 0, RAID 1, RAID 1+0, 不支持RAID 5等高级RAID特性，不支持阵列卡电池。<br>
DELL PERC PERC H700卡，全称LSI Logic MegaRAID SAS 2108，支持各种RAID级别及高级特性，可选配阵列卡电池。<br>
DELL PERC H310 Mini卡 ，全称LSI Logic / Symbios Logic MegaRAID SAS 2008，支持常见RAID级别，不支持高级RAID特性，不支持阵列卡电池。<br>
IBM ServeRAID M5014 SAS/SATA Controller卡，全称LSI Logic / Symbios Logic MegaRAID SAS 2108，支持各种RAID级别及高级特性，可选配阵列卡电池。<br>
IBM ServeRAID-MR10i SAS/SATA Controller卡，全称LSI Logic / Symbios Logic MegaRAID SAS 1078，支持常见RAID级别，不支持高级RAID特性，可选配阵列卡电池，这个卡其实和DELL的PERC 6/i卡是一样的，都是基于LSI MegaRAID SAS 1078基础上OEM出来的。</p>
<p>上面是几种常见的阵列卡型号，更多的可以自行查看官方的技术手册。下面我们要继续的是，这些阵列卡以及硬盘如何监控，阵列卡的管理也请查看官方技术手册，不在本文讨论范畴。一般地，支持RAID 5的卡，我们称其为阵列卡，都可以使用LSI官方提供的MegaCli工具来管理，而不支持RAID 5的卡，我们称其为SAS卡，使用lsiutil工具来管理。HP的服务器使用其特有的hpacucli工具来管理。</p>
<h1 id="gong-ju-gai-shu">工具概述</h1>
<h2 id="strong-mega-cli-gong-ju-strong"><strong>MegaCli工具</strong></h2>
<h3 id="mega-cli-adpallinfo-aall-cha-kan-zhen-lie-qia-xin-xi">MegaCli -adpallinfo -aall — 查看阵列卡信息</h3>
<p>-a 参数指定阵列卡的编号，一般服务器上只会配一个阵列卡，因此我们通常指定为 -a0（阵列卡适配器编号，从0开始） 即可，主要关注下面几个信息：</p>
<table>
<thead>
<tr>
<th><strong>状态值</strong></th>
<th><strong>对应含义</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>Product Name : PERC  H710 Mini</td>
<td>阵列卡名称</td>
</tr>
<tr>
<td>FW Package Build:  21.2.0-0007</td>
<td>阵列卡firmware版本号，版本如果太低，建议升级以提高稳定性及性能</td>
</tr>
<tr>
<td>BBU : Present</td>
<td>是否有配BBU电池</td>
</tr>
</tbody>
</table>
<h3 id="mega-cli-cfgdsply-aall-cha-kan-zhen-lie-pei-zhi">MegaCli -cfgdsply -aall — 查看阵列配置</h3>
<table>
<thead>
<tr>
<th><strong>状态值</strong></th>
<th><strong>对应含义</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>Memory: 512MB</td>
<td>阵列卡cache大小，2的N次方，如果不是，说明阵列卡有异常</td>
</tr>
<tr>
<td>Number of dedicated  Hotspares: 0</td>
<td>阵列是否有专用/独享热备盘（如果有多个逻辑磁盘组/disk group，则可以指定一个硬盘用于全局热备，那么该disk group上的专用热备盘数量为0也不用担心），除了RAID  1/RAID 1+0一般不指定热备盘以外，其他几个阵列级别建议都要指定热备盘</td>
</tr>
<tr>
<td>State : Optimal</td>
<td>阵列状态，如果不是 Optimal 就要关注了</td>
</tr>
<tr>
<td>Current Cache  Policy: WriteBack, ReadAheadNone, Direct, Write Cache OK if Bad BBU</td>
<td>阵列读写cache策略，建议写策略设置为FORCE WB，最起码是WB，预读策略可以关掉，意义不大，几乎没影响</td>
</tr>
<tr>
<td>Disk Cache Policy :  Disabled</td>
<td>硬盘cache策略，建议关闭，防止意外时数据丢失</td>
</tr>
<tr>
<td>Current Power  Savings Policy: None</td>
<td>节电策略，建议关闭</td>
</tr>
<tr>
<td>Media Error Count:  0</td>
<td>三个错误计数器，任何一个值大于100就要立刻引起关注，尤其要关注起增长速度。1T以上SATA盘，计数值不够精确，可能所有盘上该值都会大于0，一般重启就会重新清0，如果重启后还是大于0的话，赶紧报修吧。SAS盘的计数值则比较准确。</td>
</tr>
<tr>
<td>Other Error Count:  0</td>
<td></td>
</tr>
<tr>
<td>Predictive Failure  Count: 0</td>
<td></td>
</tr>
<tr>
<td>Firmware state:  Online, Spun Up</td>
<td>查看硬盘状态，如果是unconfigured表示该硬盘未分配加入到阵列中；如果是  unconfigured(bad)表示该盘不但是未分配，而且还坏了，正是“出师未捷身先死”；如果是failed，表示该盘故障无法识别；如果是  rebuilding，表示该盘正在重建数据</td>
</tr>
</tbody>
</table>
<h3 id="mega-cli-adpbbucmd-aall-cha-kan-zhen-lie-qia-dian-chi-xin-xi">MegaCli -adpbbucmd -aall — 查看阵列卡电池信息</h3>
<table>
<thead>
<tr>
<th><strong>状态值</strong></th>
<th><strong>对应含义</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>Temperature: 39 C</td>
<td>查看电池温度，如果相比上一次查看高出不少，就需要关注了，或者可以根据经验设置一个基线值</td>
</tr>
<tr>
<td>Battery State:  Optimal</td>
<td>电池状态，如果不是为Optimal，就需要关注了</td>
</tr>
<tr>
<td>Charger Status:  Complete</td>
<td>电池充放电状态</td>
</tr>
<tr>
<td>isSOHGood: Yes</td>
<td>电池状态，如果不是为Yes，需要关注</td>
</tr>
<tr>
<td>Relative State of  Charge: 93 %</td>
<td>当前电量，当电量低于15%，或者电池坏掉时，默认都会将写策略从WB改成WT，除非设定为FORCE WB策略</td>
</tr>
<tr>
<td>Max Error = 0 %</td>
<td>电池是否有错误信息</td>
</tr>
<tr>
<td>Next Learn time:  Tue Oct 14 22:06:50 2014</td>
<td>电池充放电时间，注意这是美国时间。另外，新的阵列卡电池很多改成电容式的了，也就不需要重复充放电了</td>
</tr>
</tbody>
</table>
<h2 id="lsiutil-gong-ju">lsiutil工具</h2>
<p>lsiutil有交互和非交互两种方式，作为监控，我们肯定选择非交互模式。想要使用交互模式的，可以根据非交互模式自行练习。</p>
<h3 id="lsiutil-p-1-a-20-12-0-0-cha-kan-ying-pan-ji-shu-qi">lsiutil -p 1 -a 20,12,0,0 — 查看硬盘计数器</h3>
<p>Invalid DWord Count 2,563 — 任何一个值大于0，都需要引起关注</p>
<p>Running Disparity Error Count 2,366</p>
<p>Loss of DWord Synch Count 0</p>
<p>Phy Reset Problem Count 0</p>
<h3 id="lsiutil-p-1-a-21-1-0-0-0-cha-kan-luo-ji-juan-zhuang-tai">lsiutil -p 1 -a 21,1,0,0,0 — 查看逻辑卷状态</h3>
<table>
<thead>
<tr>
<th><strong>状态值</strong></th>
<th><strong>对应含义</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>Volume State:  optimal, enabled</td>
<td>逻辑卷健康状况</td>
</tr>
<tr>
<td>Volume draws from  Hot Spare Pools: 0</td>
<td>是否有热备</td>
</tr>
<tr>
<td>Volume Size 139392  MB, 2 Members</td>
<td>由几块硬盘组成</td>
</tr>
<tr>
<td>Primary is PhysDisk  1 (Bus 0 Target 9)</td>
<td>物理硬盘1</td>
</tr>
<tr>
<td>Secondary is  PhysDisk 0 (Bus 0 Target 3)</td>
<td>物理硬盘0</td>
</tr>
</tbody>
</table>
<h3 id="lsiutil-p-1-a-21-2-0-0-0-cha-kan-wu-li-ying-pan-zhuang-tai">lsiutil -p 1 -a 21,2,0,0,0 — 查看物理硬盘状态</h3>
<table>
<thead>
<tr>
<th><strong>状态值</strong></th>
<th><strong>对应含义</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>PhysDisk 0 is Bus 0  Target 3</td>
<td>编号</td>
</tr>
<tr>
<td>PhysDisk State:  online</td>
<td>状态</td>
</tr>
<tr>
<td>Error Count 13,  Last Error: Command = 28h, Key = 3, ASC/ASCQ = 11h/00h</td>
<td>错误计数器，大于0的话，就需要引起关注</td>
</tr>
</tbody>
</table>
<h2 id="hpacucli-gong-ju">hpacucli工具</h2>
<p>hpacucli工具查看阵列、硬盘、电池信息，其实就只要一条指令：</p>
<p><strong>hpacucli ctrl all show config detail — 查看阵列详细信息、配置</strong></p>
<table>
<thead>
<tr>
<th><strong>状态值</strong></th>
<th><strong>对应含义</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>Controller Status:  OK</td>
<td>阵列卡状态</td>
</tr>
<tr>
<td>Firmware Version:  1.18</td>
<td>firmware版本，太低了建议升级，以提高稳定性及性能</td>
</tr>
<tr>
<td>Cache Board  Present: True</td>
<td>是否配备了cache模块</td>
</tr>
<tr>
<td>Cache Status: OK</td>
<td>cache模块状态</td>
</tr>
<tr>
<td>Cache Ratio: 100%  Read / 0% Write</td>
<td>cache策略，此处只有读cache，不用于写cache，因为没有bbu电池，见下方结果</td>
</tr>
<tr>
<td>Drive Write Cache:  Disabled</td>
<td>关闭磁盘cache</td>
</tr>
<tr>
<td>Total Cache Size:  256 MB</td>
<td>cache大小</td>
</tr>
<tr>
<td>Total Cache Memory  Available: 208 MB</td>
<td>实际可用cache大小，和理论cache大小不一样，说明cache模块可能有问题</td>
</tr>
<tr>
<td>No-Battery Write  Cache: Disabled</td>
<td>关闭FORCEWB策略</td>
</tr>
<tr>
<td>Battery/Capacitor  Count: 0</td>
<td>阵列卡BBU电池数量为0，也就是没有BBU模块</td>
</tr>
<tr>
<td>Battery/Capacitor  Status: Failed (Replace Batteries)</td>
<td>阵列卡BBU电池状态，这里显示是错误状态，需要及时更换</td>
</tr>
<tr>
<td>Array: A</td>
<td>第一个乌列阵列，编号从A开始，依次是A、B、C</td>
</tr>
<tr>
<td>Status: OK</td>
<td>物理阵列状态</td>
</tr>
<tr>
<td>Logical Drive: 1</td>
<td>第一个逻辑卷，编号从1开始</td>
</tr>
<tr>
<td>Fault Tolerance:  RAID 5</td>
<td>第一个逻辑卷的阵列级别</td>
</tr>
<tr>
<td>Status: OK</td>
<td>第一个逻辑卷状态</td>
</tr>
<tr>
<td>Caching: Enabled</td>
<td>第一个逻辑卷是否启用了cache策略</td>
</tr>
<tr>
<td>physicaldrive  1I:1:1</td>
<td>第一块物理硬盘，编号从1开始</td>
</tr>
<tr>
<td>Status: OK</td>
<td>第一块物理硬盘状态</td>
</tr>
<tr>
<td>Firmware Revision:  HPDA</td>
<td>第一块物理硬盘firmware，如果太低，也需要及时升级，HP的硬盘每个批次都有不同的firmware</td>
</tr>
</tbody>
</table>
<h1 id="megacli-shi-jian">Megacli实践</h1>
<h2 id="cha-kan-you-feng-xian-de-pan">查看有风险的盘</h2>
<p><code>/opt/MegaRAID/MegaCli/MegaCli64 -LDPDinfo -A0 |grep "Device Id" |awk '{print $3}' |xargs -I {} smartctl -a -d megaraid,{} /dev/sdc |grep -Ei "^187|^188|^197|^198|Reallocated_Sector_Ct" | xargs -I{} echo {} </code></p>
<h2 id="cha-kan-ci-pan-de-smart-xin-xi">查看磁盘的smart信息</h2>
<p>如果磁盘在RAID卡上：</p>
<p>（1）先获取磁盘的device id</p>
<p><code>/opt/MegaRAID/MegaCli/MegaCli64 PDList aall </code></p>
<p>这里的输出，会有ES信息，同时还会有device id</p>
<p>（2）根据device id，查询smart信息</p>
<p><code>smartctl -a -d megaraid,11 /dev/sdc </code></p>
<p>这里的11就是磁盘的device id，哪怕后面的/dev/sdc不存在，获取是这颗磁盘不属于sdc，也能输出正确的信息，只要device id是正确的就行。</p>
<p>如果不在RAID卡上，直接<code>smartctl -a /dev/sdc </code></p>
<h2 id="shou-gong-pei-zhi-chu-shi-hua">手工配置初始化</h2>
<pre><code class="language-shell">/opt/MegaRAID/MegaCli/MegaCli64 -LDInit -start –L0 -a0         # 快速初始化

/opt/MegaRAID/MegaCli/MegaCli64 -LDInit -start -full –L0 -a0     # 完全初始化

/opt/MegaRAID/MegaCli/MegaCli64 -LDInit -progdsply -L0 -a0      # 显示初始化的进度

/opt/MegaRAID/MegaCli/MegaCli64 -LDInit -abort -L0 -a0        # 结束完全初始化

/opt/MegaRAID/MegaCli/MegaCli64 -LDBI -Abort -LALL -aALL # 忽略初始化

/opt/MegaRAID/MegaCli/MegaCli64 -LDBI -ProgDsply -LALL -aALL
</code></pre>
<h2 id="she-zhi-raid-cache">设置RAID cache</h2>
<pre><code class="language-shell">/opt/MegaRAID/MegaCli/MegaCli64 -ldinfo -l1 -a0

/opt/MegaRAID/MegaCli/MegaCli64 -ldsetprop cached -l1 -a0

/opt/MegaRAID/MegaCli/MegaCli64 -ldinfo -l1 -a0

</code></pre>
<h2 id="xian-shi-rebuid-jin-du">显示Rebuid进度</h2>
<p><code>/opt/MegaRAID/MegaCli/MegaCli64 -PDRbld -ShowProg -physdrv[20:2] -aALL </code></p>
<h2 id="cha-kan-e-s">查看E S</h2>
<p><code>/opt/MegaRAID/MegaCli/MegaCli64 -PDList -aAll -NoLog | grep -Ei "(enclosure|slot)" </code></p>
<h2 id="cha-kan-suo-you-ying-pan-de-zhuang-tai">查看所有硬盘的状态</h2>
<p><code>/opt/MegaRAID/MegaCli/MegaCli64 -PDList -aAll -NoLog  </code></p>
<p>如果有热备，则 Firmware State会显示为hotspace</p>
<h2 id="cha-kan-copyback-jin-du">查看copyback进度</h2>
<p><code>/opt/MegaRAID/MegaCli/MegaCli64 -PDCpyBk -ShowProg -PhysDrv[33:3] -a0 </code></p>
<h2 id="cha-kan-suo-you-virtual-disk-de-zhuang-tai">查看所有Virtual Disk的状态</h2>
<p><code>/opt/MegaRAID/MegaCli/MegaCli64 -LdPdInfo -aAll -NoLog</code></p>
<p>RAID Level对应关系：</p>
<pre><code class="language-shell">RAID Level : Primary-1, Secondary-0, RAID Level Qualifier-0	RAID 1
RAID Level : Primary-0, Secondary-0, RAID Level Qualifier-0	RAID 0
RAID Level : Primary-5, Secondary-0, RAID Level Qualifier-3	RAID 5
RAID Level : Primary-1, Secondary-3, RAID Level Qualifier-0	RAID 10
</code></pre>
<h2 id="zai-xian-zuo-raid">在线做Raid</h2>
<pre><code class="language-shell">/opt/MegaRAID/MegaCli/MegaCli64 -CfgLdAdd -r0 [0:11] WB NORA Direct CachedBadBBU -strpsz64 -a0 -NoLog
/opt/MegaRAID/MegaCli/MegaCli64 -CfgLdAdd -r5 [12:2,12:3,12:4,12:5,12:6,12:7] WB Direct -a0 
</code></pre>
<h2 id="rang-ying-pan-led-deng-shan-shuo-ding-wei">让硬盘LED灯闪烁（定位）</h2>
<pre><code class="language-shell">    1、  MegaCli  -AdpSetProp UseDiskActivityforLocate -1 -a0 
    2、  MegaCli  -PdLocate  -start  –physdrv[E:S]  -a0  让硬盘LED灯闪烁
    3、  MegaCli  -PdLocate  -stopt  –physdrv[E:S]  -a0 停掉硬盘LED灯
</code></pre>
<h2 id="qing-chu-foreign-zhuang-tai">清除Foreign状态</h2>
<p><code>/opt/MegaRAID/MegaCli/MegaCli64 -CfgForeign -Clear -a0 </code></p>
<h2 id="cha-kan-raid-zhen-lie-zhong-diao-xian-de-pan">查看RAID阵列中掉线的盘</h2>
<p><code>/opt/MegaRAID/MegaCli/MegaCli64 -pdgetmissing -a0 </code></p>
<h2 id="ti-huan-pi-diao-de-mo-kuai">替换坏掉的模块</h2>
<p><code>/opt/MegaRAID/MegaCli/MegaCli64 -pdreplacemissing -physdrv[12:10] -Array5 -row0 -a0 </code></p>
<h2 id="shou-dong-kai-qi-rebuid">手动开启rebuid</h2>
<p><code>/opt/MegaRAID/MegaCli/MegaCli64 -pdrbld -start -physdrv[12:10] -a0 </code></p>
<h2 id="she-zhi-hot-spare">设置HotSpare</h2>
<pre><code class="language-shell">/opt/MegaRAID/MegaCli/MegaCli64 -pdhsp -set [-Dedicated [-Array2]] [-EnclAffinity] [-nonRevertible] -PhysDrv[4:11] -a0
/opt/MegaRAID/MegaCli/MegaCli64 -pdhsp -set [-EnclAffinity] [-nonRevertible] -PhysDrv[32：1}] -a0
</code></pre>
<h2 id="guan-bi-rebuild">关闭Rebuild</h2>
<p><code>/opt/MegaRAID/MegaCli/MegaCli64 -AdpAutoRbld -Dsbl -a0 </code></p>
<h2 id="she-zhi-rebuild-de-su-lu">设置rebuild的速率</h2>
<p><code>/opt/MegaRAID/MegaCli/MegaCli64 -AdpSetProp RebuildRate -30 -a0 </code></p>
<h2 id="cha-kan-raid-zu-cheng-yuan">查看RAID组成员</h2>
<p><code>/opt/MegaRAID/MegaCli/MegaCli64  -LdPdInfo -aAll </code></p>
<h2 id="qiang-zhi-xiu-gai-raid-qia-you-write-through-dao-write-back-fang-fa">强制修改RAID卡由write through到write back 方法</h2>
<p><code>opt/MegaRAID/MegaCli/MegaCli64 -LDSetProp CachedBadBBU -Lall -aALL </code></p>
<p>一般在没有BBU情况下， 要执行如下命令进行修改：</p>
<pre><code class="language-shell">/opt/MegaRAID/MegaCli/MegaCli64 -ldsetprop WB -lall -aall;

/opt/MegaRAID/MegaCli/MegaCli64 -LDSetProp CachedBadBBU -Lall -aALL;

/opt/MegaRAID/MegaCli/MegaCli64 ldinfo lall aall
</code></pre>
<h2 id="cha-raid-qia-xin-xi">查raid卡信息</h2>
<p><code>/opt/MegaRAID/MegaCli/MegaCli64 -AdpAllInfo -aALL </code></p>
<h2 id="cha-kan-dian-chi-xin-xi">查看电池信息</h2>
<p><code>/opt/MegaRAID/MegaCli/MegaCli64 -AdpBbuCmd -aAll </code></p>
<h2 id="cha-kan-raid-qia-ri-zhi">查看raid卡日志</h2>
<p><code>/opt/MegaRAID/MegaCli/MegaCli64 -FwTermLog -Dsply -aALL </code></p>
<h2 id="xian-shi-gua-pei-qi-ge-shu">显示适配器个数</h2>
<p><code>/opt/MegaRAID/MegaCli/MegaCli64 -adpCount </code></p>
<h2 id="xian-shi-gua-pei-qi-shi-jian">显示适配器时间</h2>
<p><code>/opt/MegaRAID/MegaCli/MegaCli64 -AdpGetTime –aALL </code></p>
<h2 id="xian-shi-suo-you-gua-pei-qi-xin-xi">显示所有适配器信息</h2>
<p><code>/opt/MegaRAID/MegaCli/MegaCli64 -AdpAllInfo -aAll </code></p>
<h2 id="xian-shi-suo-you-luo-ji-ci-pan-zu-xin-xi">显示所有逻辑磁盘组信息</h2>
<p><code>/opt/MegaRAID/MegaCli/MegaCli64 -LDInfo -LALL -aAll  </code></p>
<h2 id="xian-shi-suo-you-de-wu-li-xin-xi">显示所有的物理信息</h2>
<p><code>/opt/MegaRAID/MegaCli/MegaCli64 -PDList -aAll </code></p>
<h2 id="cha-kan-chong-dian-zhuang-tai">查看充电状态</h2>
<p><code>/opt/MegaRAID/MegaCli/MegaCli64 -AdpBbuCmd -GetBbuStatus -aALL |grep 'Charger Status' </code></p>
<h2 id="xian-shi-bbu-zhuang-tai-xin-xi">显示BBU状态信息</h2>
<p><code>/opt/MegaRAID/MegaCli/MegaCli64 -AdpBbuCmd -GetBbuStatus -aALL </code></p>
<h2 id="xian-shi-bbu-rong-liang-xin-xi">显示BBU容量信息</h2>
<p><code>/opt/MegaRAID/MegaCli/MegaCli64 -AdpBbuCmd -GetBbuCapacityInfo -aALL </code></p>
<h2 id="xian-shi-bbu-she-ji-can-shu">显示BBU设计参数</h2>
<p><code>/opt/MegaRAID/MegaCli/MegaCli64 -AdpBbuCmd -GetBbuDesignInfo -aALL </code></p>
<h2 id="xian-shi-dang-qian-bbu-shu-xing">显示当前BBU属性</h2>
<p><code>/opt/MegaRAID/MegaCli/MegaCli64 -AdpBbuCmd -GetBbuProperties -aALL</code></p>
<h2 id="xian-shi-raid-qia-xing-hao-raid-she-zhi-disk-xiang-guan-xin-xi">显示Raid卡型号，Raid设置，Disk相关信息</h2>
<p><code>/opt/MegaRAID/MegaCli/MegaCli64-cfgdsply -aALL </code></p>
<h2 id="ci-pan-zhuang-tai-de-bian-hua-cong-ba-pan-dao-cha-pan-de-guo-cheng-zhong">磁盘状态的变化，从拔盘，到插盘的过程中</h2>
<p>Device             : Normal --&gt; Damage --&gt; Rebuild --&gt; Normal</p>
<p>Virtual Drive      : Optimal --&gt; Degraded --&gt; Degraded --&gt; Optimal</p>
<p>Physical Drive     : Online --&gt; Failed Unconfigured --&gt; Rebuild --&gt; Online</p>
<h2 id="cha-kan-wu-li-ci-pan-zhuang-tai">查看物理磁盘状态</h2>
<p><code>/opt/MegaRAID/MegaCli/MegaCli64 -PDRbld -ShowProg -PhysDrv [Enclosure Device ID:Slot Number] -a0</code></p>
<p>Rebuild 中的物理磁盘状态中会显示：“Firmware state: Rebuild”</p>
<h2 id="yi-wen-ben-jin-du-tiao-yang-shi-xian-shi-rebuild-jin-du">以文本进度条样式显示 Rebuild 进度</h2>
<p><code>/opt/MegaRAID/MegaCli/MegaCli64-pdrbld -progdsply -physdrv[E:S] -aALL </code></p>
<p>屏幕显示类似下面的内容：</p>
<pre><code class="language-shell">Rebuild progress of physical drives...
Enclosure:Slot         Percent Complete           Time Elps
     032 :05   #######################87 %################*******  01:59:07

</code></pre>
<h2 id="cha-kan-raid-qia-rebuild-can-shu">查看 RAID 卡 Rebuild 参数</h2>
<p><code>/opt/MegaRAID/MegaCli/MegaCli64-AdpAllinfo -aALL | grep -i rebuild </code></p>
<p>返回结果类似下面这样</p>
<pre><code class="language-shell">Rebuild Rate                             : 30%
Auto Rebuild                             : Enabled
Rebuild Rate                             : Yes
Force Rebuild                            : Yes
</code></pre>
<h2 id="she-zhi-raid-qia-rebuild-bi-li-wei-60">设置 RAID 卡 Rebuild 比例为60%</h2>
<p><code>/opt/MegaRAID/MegaCli/MegaCli64-AdpSetProp { RebuildRate -60} -aALL </code></p>
<h2 id="shan-chu-quan-ju-re-bei">删除全局热备</h2>
<p><code>/opt/MegaRAID/MegaCli/MegaCli64-PDHSP -Rmv -PhysDrv[E:S] -a0 </code></p>
<h2 id="jiang-wu-li-pan-xia-xian-he-shang-xian">将物理盘下线和上线</h2>
<p><code>/opt/MegaRAID/MegaCli/MegaCli64 -PDOffline/Online -PhysDrv [E:S] -a0 </code></p>
<h2 id="zai-xian-tian-jia-ci-pan">在线添加磁盘</h2>
<p><code>/opt/MegaRAID/MegaCli/MegaCli64-LDRecon -Start -r5 -Add -PhysDrv[E:S] -L1 -a0</code></p>
<h2 id="shan-chu-zhen-lie">删除阵列</h2>
<p><code>/opt/MegaRAID/MegaCli/MegaCli64 -CfgLdDel -L1 -a0 </code></p>
<h2 id="cha-kan-ci-pan-huan-cun-ce-lue">查看磁盘缓存策略</h2>
<p><code>/opt/MegaRAID/MegaCli/MegaCli64-LDGetProp -DskCache -LALL -aALL </code></p>
<p>or</p>
<p><code>/opt/MegaRAID/MegaCli/MegaCli64 -LDGetProp -Cache -LALL -aALL</code></p>
<h2 id="cha-kan-raid-qia-event-log">查看raid卡event log</h2>
<p><code>/opt/MegaRAID/MegaCli/MegaCli64 -AdpEventLog -GetEvents -f event.log -A0 </code></p>
<h2 id="cha-kan-megacli-de-log">查看Megacli的log</h2>
<p><code>/opt/MegaRAID/MegaCli/MegaCli64 -fwtermlog -dsply -aALL</code> ，关注里面的error/fail/warn等多个关键字</p>
<h2 id="cha-kan-raid-qia-shi-jian">查看raid卡时间</h2>
<p><code>/opt/MegaRAID/MegaCli/MegaCli64 -AdpGetTime -A0 ; date </code></p>
<h2 id="stop-yi-zhi-xing-jian-cha">Stop 一致性检查</h2>
<p><code>/opt/MegaRAID/MegaCli/MegaCli64 -LDCC -stop -lall -aall </code></p>
<h1 id="can-kao-wen-dang">参考文档</h1>
<p><code>https://kamaok.org.ua/?p=2507 </code></p>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>
                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">Gavin Wang</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://gavin-wang-note.github.io/2020/05/06/megacli_guide/">https://gavin-wang-note.github.io/2020/05/06/megacli_guide/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">Gavin Wang</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/Megacli/">
                                    <span class="chip bg-color">Megacli</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/img/loading.gif" data-original="/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/img/loading.gif" data-original="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2020/05/08/get_jenkins_information/">
                    <div class="card-image">
                        
                        
                        <img src="/img/loading.gif" data-original="/medias/featureimages/220.jpg" class="responsive-img" alt="API获取Jenkins构建信息">
                        
                        <span class="card-title">API获取Jenkins构建信息</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2020-05-08
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/Automation/" class="post-category">
                                    Automation
                                </a>
                            
                            <a href="/categories/Jenkins/" class="post-category">
                                    Jenkins
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Automation/">
                        <span class="chip bg-color">Automation</span>
                    </a>
                    
                    <a href="/tags/Jenkins/">
                        <span class="chip bg-color">Jenkins</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2020/05/05/change_pip_install_source/">
                    <div class="card-image">
                        
                        
                        <img src="/img/loading.gif" data-original="/medias/featureimages/87.jpg" class="responsive-img" alt="更改pip&amp;easy_install默认安装源">
                        
                        <span class="card-title">更改pip&amp;easy_install默认安装源</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2020-05-05
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/python/" class="post-category">
                                    python
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/python/">
                        <span class="chip bg-color">python</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>


<script>
    $('#articleContent').on('copy', function (e) {
        // IE8 or earlier browser is 'undefined'
        if (typeof window.getSelection === 'undefined') return;

        var selection = window.getSelection();
        // if the selection is short let's not annoy our users.
        if (('' + selection).length < Number.parseInt('120')) {
            return;
        }

        // create a div outside of the visible area and fill it with the selected text.
        var bodyElement = document.getElementsByTagName('body')[0];
        var newdiv = document.createElement('div');
        newdiv.style.position = 'absolute';
        newdiv.style.left = '-99999px';
        bodyElement.appendChild(newdiv);
        newdiv.appendChild(selection.getRangeAt(0).cloneContents());

        // we need a <pre> tag workaround.
        // otherwise the text inside "pre" loses all the line breaks!
        if (selection.getRangeAt(0).commonAncestorContainer.nodeName === 'PRE' || selection.getRangeAt(0).commonAncestorContainer.nodeName === 'CODE') {
            newdiv.innerHTML = "<pre>" + newdiv.innerHTML + "</pre>";
        }

        var url = document.location.href;
        newdiv.innerHTML += '<br />'
            + '来源: Transcendent<br />'
            + '文章作者: Gavin Wang<br />'
            + '文章链接: <a href="' + url + '">' + url + '</a><br />'
            + '本文章著作权归作者所有，任何形式的转载都请注明出处。';

        selection.selectAllChildren(newdiv);
        window.setTimeout(function () {bodyElement.removeChild(newdiv);}, 200);
    });
</script>


<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>


  <!-- 是否加载使用自带的 prismjs. -->
  <script type="text/javascript" src="/libs/prism/prism.min.js"></script>


<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>



    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('2'),
            headingSelector: 'h1, h2, h3, h4'
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    

    <div class="container row center-align"
         style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2009-2024</span>
            
            <a href="/about" target="_blank">Gavin Wang</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            
                <span id="translate">|&nbsp;繁/简：</span><a id="translateLink" href="javascript:translatePage();">繁</a>
            
            <br>
            
                &nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span
                        class="white-color">857.7k</span>
            
            
            
                
            
            
                <span id="busuanzi_container_site_pv">
                &nbsp;|&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;
                    <span id="busuanzi_value_site_pv" class="white-color"></span>
            </span>
            
            
                <span id="busuanzi_container_site_uv">
                &nbsp;|&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;
                    <span id="busuanzi_value_site_uv" class="white-color"></span>
            </span>
            
            <br>

            <!-- 运行天数提醒. -->
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">


    <a href="mailto:250556531@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=250556531" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 250556531" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 白天和黑夜主题 -->
<div class="stars-con">
    <div id="stars"></div>
    <div id="stars2"></div>
    <div id="stars3"></div>  
</div>

<script>
    function switchNightMode() {
        $('<div class="Cuteen_DarkSky"><div class="Cuteen_DarkPlanet"></div></div>').appendTo($('body')),
        setTimeout(function () {
            $('body').hasClass('DarkMode') 
            ? ($('body').removeClass('DarkMode'), localStorage.setItem('isDark', '0'), $('#sum-moon-icon').removeClass("fa-sun").addClass('fa-moon')) 
            : ($('body').addClass('DarkMode'), localStorage.setItem('isDark', '1'), $('#sum-moon-icon').addClass("fa-sun").removeClass('fa-moon')),
            
            setTimeout(function () {
            $('.Cuteen_DarkSky').fadeOut(1e3, function () {
                $(this).remove()
            })
            }, 2e3)
        })
    }
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    

    
        <script type="text/javascript" src="/js/tw_cn.js"></script>
        <script type="text/javascript">
          var defaultEncoding = 2; //网站编写字体是否繁体，1-繁体，2-简体
          var translateDelay = 0; //延迟时间,若不在前, 要设定延迟翻译时间, 如100表示100ms,默认为0
          var cookieDomain = "https://gavin-wang-note.github.io"; //Cookie地址, 一定要设定, 通常为你的网址
          var msgToTraditionalChinese = "繁"; //此处可以更改为你想要显示的文字
          var msgToSimplifiedChinese = "简"; //同上，但两处均不建议更改
          var translateButtonId = "translateLink"; //默认互换id
          translateInitilization();
        </script>
    
    
    

    <!-- 雪花特效 -->
    

    <!-- 鼠标星星特效 -->
     
        <script type="text/javascript">
            // 只在桌面版网页启用特效
            var windowWidth = $(window).width();
            if (windowWidth > 768) {
                document.write('<script type="text/javascript" src="/libs/others/star.js"><\/script>');
            }
        </script>
    

    

    <!-- Baidu Analytics -->

<script>
    var _hmt = _hmt || [];
    (function () {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    <!--腾讯兔小巢-->
    
    

    

    
    <script type="text/javascript" src="/libs/background/ribbon-dynamic.js" async="async"></script>
    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    


        <style>
            [bg-lazy] {
                background-image: none !important;
                background-color: #eee !important;
            }
        </style>
        <script>
            window.imageLazyLoadSetting = {
                isSPA: false,
                preloadRatio: 1,
                processImages: null,
            };
        </script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})});</script><script>!function(r){r.imageLazyLoadSetting.processImages=t;var e=r.imageLazyLoadSetting.isSPA,c=(r.imageLazyLoadSetting.preloadRatio,n());function n(){var t=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")),e=Array.prototype.slice.call(document.querySelectorAll("[bg-lazy]"));return t.concat(e)}function t(){e&&(c=n());for(var t,o=0;o<c.length;o++)0<=(t=(t=c[o]).getBoundingClientRect()).bottom&&0<=t.left&&t.top<=(r.innerHeight+240||document.documentElement.clientHeight+240)&&function(){var t,e,n,a,i=c[o];e=function(){c=c.filter(function(t){return i!==t}),r.imageLazyLoadSetting.onImageLoaded&&r.imageLazyLoadSetting.onImageLoaded(i)},(t=i).hasAttribute("bg-lazy")?(t.removeAttribute("bg-lazy"),e&&e()):(n=new Image,a=t.getAttribute("data-original"),n.onload=function(){t.src=a,t.removeAttribute("data-original"),e&&e()},t.src!==a&&(n.src=a))}()}function a(){clearTimeout(t.tId),t.tId=setTimeout(t,500)}t(),document.addEventListener("scroll",a),r.addEventListener("resize",a),r.addEventListener("orientationchange",a)}(this);</script></body>

</html>
